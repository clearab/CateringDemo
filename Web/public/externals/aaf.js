(function webpackUniversalModuleDefinition(root, factory) {
	if(typeof exports === 'object' && typeof module === 'object')
		module.exports = factory();
	else if(typeof define === 'function' && define.amd)
		define([], factory);
	else if(typeof exports === 'object')
		exports["AAFRuntime"] = factory();
	else
		root["AAFRuntime"] = factory();
})(window, function() {
return /******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./src/aaf.ts");
/******/ })
/************************************************************************/
/******/ ({

/***/ "../adaptivecards/lib/adaptivecards.js":
/*!*********************************************!*\
  !*** ../adaptivecards/lib/adaptivecards.js ***!
  \*********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

function __export(m) {
    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];
}
Object.defineProperty(exports, "__esModule", { value: true });
// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
__export(__webpack_require__(/*! ./serialization */ "../adaptivecards/lib/serialization.js"));
__export(__webpack_require__(/*! ./registry */ "../adaptivecards/lib/registry.js"));
__export(__webpack_require__(/*! ./card-object */ "../adaptivecards/lib/card-object.js"));
__export(__webpack_require__(/*! ./card-elements */ "../adaptivecards/lib/card-elements.js"));
__export(__webpack_require__(/*! ./enums */ "../adaptivecards/lib/enums.js"));
__export(__webpack_require__(/*! ./host-config */ "../adaptivecards/lib/host-config.js"));
__export(__webpack_require__(/*! ./shared */ "../adaptivecards/lib/shared.js"));
__export(__webpack_require__(/*! ./utils */ "../adaptivecards/lib/utils.js"));
//# sourceMappingURL=adaptivecards.js.map

/***/ }),

/***/ "../adaptivecards/lib/card-elements.js":
/*!*********************************************!*\
  !*** ../adaptivecards/lib/card-elements.js ***!
  \*********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
var Enums = __webpack_require__(/*! ./enums */ "../adaptivecards/lib/enums.js");
var shared_1 = __webpack_require__(/*! ./shared */ "../adaptivecards/lib/shared.js");
var Utils = __webpack_require__(/*! ./utils */ "../adaptivecards/lib/utils.js");
var host_config_1 = __webpack_require__(/*! ./host-config */ "../adaptivecards/lib/host-config.js");
var TextFormatters = __webpack_require__(/*! ./text-formatters */ "../adaptivecards/lib/text-formatters.js");
var card_object_1 = __webpack_require__(/*! ./card-object */ "../adaptivecards/lib/card-object.js");
var serialization_1 = __webpack_require__(/*! ./serialization */ "../adaptivecards/lib/serialization.js");
var registry_1 = __webpack_require__(/*! ./registry */ "../adaptivecards/lib/registry.js");
var CardElement = /** @class */ (function (_super) {
    __extends(CardElement, _super);
    function CardElement() {
        //#region Schema
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this._truncatedDueToOverflow = false;
        return _this;
    }
    Object.defineProperty(CardElement.prototype, "lang", {
        get: function () {
            var lang = this.getValue(CardElement.langProperty);
            if (lang) {
                return lang;
            }
            else {
                if (this.parent) {
                    return this.parent.lang;
                }
                else {
                    return undefined;
                }
            }
        },
        set: function (value) {
            this.setValue(CardElement.langProperty, value);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CardElement.prototype, "isVisible", {
        get: function () {
            return this.getValue(CardElement.isVisibleProperty);
        },
        set: function (value) {
            // If the element is going to be hidden, reset any changes that were due
            // to overflow truncation (this ensures that if the element is later
            // un-hidden it has the right content)
            if (shared_1.GlobalSettings.useAdvancedCardBottomTruncation && !value) {
                this.undoOverflowTruncation();
            }
            if (this.isVisible !== value) {
                this.setValue(CardElement.isVisibleProperty, value);
                this.updateRenderedElementVisibility();
                if (this._renderedElement) {
                    raiseElementVisibilityChangedEvent(this);
                }
            }
        },
        enumerable: true,
        configurable: true
    });
    CardElement.prototype.internalRenderSeparator = function () {
        var renderedSeparator = Utils.renderSeparation(this.hostConfig, {
            spacing: this.hostConfig.getEffectiveSpacing(this.spacing),
            lineThickness: this.separator ? this.hostConfig.separator.lineThickness : undefined,
            lineColor: this.separator ? this.hostConfig.separator.lineColor : undefined
        }, this.separatorOrientation);
        if (shared_1.GlobalSettings.alwaysBleedSeparators && renderedSeparator && this.separatorOrientation == Enums.Orientation.Horizontal) {
            // Adjust separator's margins if the option to always bleed separators is turned on
            var parentContainer = this.getParentContainer();
            if (parentContainer && parentContainer.getEffectivePadding()) {
                var parentPhysicalPadding = this.hostConfig.paddingDefinitionToSpacingDefinition(parentContainer.getEffectivePadding());
                renderedSeparator.style.marginLeft = "-" + parentPhysicalPadding.left + "px";
                renderedSeparator.style.marginRight = "-" + parentPhysicalPadding.right + "px";
            }
        }
        return renderedSeparator;
    };
    CardElement.prototype.updateRenderedElementVisibility = function () {
        if (this._defaultRenderedElementDisplayMode) {
            var displayMode = this.isDesignMode() || this.isVisible ? this._defaultRenderedElementDisplayMode : "none";
            if (this._renderedElement) {
                this._renderedElement.style.display = displayMode;
            }
            if (this._separatorElement) {
                if (this.parent && this.parent.isFirstElement(this)) {
                    this._separatorElement.style.display = "none";
                }
                else {
                    this._separatorElement.style.display = displayMode;
                }
            }
        }
    };
    CardElement.prototype.hideElementDueToOverflow = function () {
        if (this._renderedElement && this.isVisible) {
            this._renderedElement.style.visibility = "hidden";
            this.isVisible = false;
            raiseElementVisibilityChangedEvent(this, false);
        }
    };
    CardElement.prototype.showElementHiddenDueToOverflow = function () {
        if (this._renderedElement && !this.isVisible) {
            this._renderedElement.style.removeProperty("visibility");
            this.isVisible = true;
            raiseElementVisibilityChangedEvent(this, false);
        }
    };
    // Marked private to emulate internal access
    CardElement.prototype.handleOverflow = function (maxHeight) {
        if (this.isVisible || this.isHiddenDueToOverflow()) {
            var handled = this.truncateOverflow(maxHeight);
            // Even if we were unable to truncate the element to fit this time,
            // it still could have been previously truncated
            this._truncatedDueToOverflow = handled || this._truncatedDueToOverflow;
            if (!handled) {
                this.hideElementDueToOverflow();
            }
            else if (handled && !this.isVisible) {
                this.showElementHiddenDueToOverflow();
            }
        }
    };
    // Marked private to emulate internal access
    CardElement.prototype.resetOverflow = function () {
        var sizeChanged = false;
        if (this._truncatedDueToOverflow) {
            this.undoOverflowTruncation();
            this._truncatedDueToOverflow = false;
            sizeChanged = true;
        }
        if (this.isHiddenDueToOverflow()) {
            this.showElementHiddenDueToOverflow();
        }
        return sizeChanged;
    };
    CardElement.prototype.createPlaceholderElement = function () {
        var styleDefinition = this.getEffectiveStyleDefinition();
        var foregroundCssColor = Utils.stringToCssColor(styleDefinition.foregroundColors.default.subtle);
        var element = document.createElement("div");
        element.style.border = "1px dashed " + foregroundCssColor;
        element.style.padding = "4px";
        element.style.minHeight = "32px";
        element.style.fontSize = "10px";
        element.style.color = foregroundCssColor;
        element.innerText = "Empty " + this.getJsonTypeName();
        return element;
    };
    CardElement.prototype.adjustRenderedElementSize = function (renderedElement) {
        if (this.height === "auto") {
            renderedElement.style.flex = "0 0 auto";
        }
        else {
            renderedElement.style.flex = "1 1 auto";
        }
    };
    CardElement.prototype.isDisplayed = function () {
        return this._renderedElement !== undefined && this.isVisible && this._renderedElement.offsetHeight > 0;
    };
    CardElement.prototype.overrideInternalRender = function () {
        return this.internalRender();
    };
    CardElement.prototype.applyPadding = function () {
        if (this.separatorElement) {
            if (shared_1.GlobalSettings.alwaysBleedSeparators && this.separatorOrientation == Enums.Orientation.Horizontal && !this.isBleeding()) {
                var padding = new shared_1.PaddingDefinition();
                this.getImmediateSurroundingPadding(padding);
                var physicalPadding = this.hostConfig.paddingDefinitionToSpacingDefinition(padding);
                this.separatorElement.style.marginLeft = "-" + physicalPadding.left + "px";
                this.separatorElement.style.marginRight = "-" + physicalPadding.right + "px";
            }
            else {
                this.separatorElement.style.marginRight = "0";
                this.separatorElement.style.marginLeft = "0";
            }
        }
    };
    /*
     * Called when this element overflows the bottom of the card.
     * maxHeight will be the amount of space still available on the card (0 if
     * the element is fully off the card).
     */
    CardElement.prototype.truncateOverflow = function (maxHeight) {
        // Child implementations should return true if the element handled
        // the truncation request such that its content fits within maxHeight,
        // false if the element should fall back to being hidden
        return false;
    };
    /*
     * This should reverse any changes performed in truncateOverflow().
     */
    CardElement.prototype.undoOverflowTruncation = function () { };
    CardElement.prototype.getDefaultPadding = function () {
        return new shared_1.PaddingDefinition();
    };
    CardElement.prototype.getHasBackground = function () {
        return false;
    };
    CardElement.prototype.getPadding = function () {
        return this._padding;
    };
    CardElement.prototype.setPadding = function (value) {
        this._padding = value;
    };
    Object.defineProperty(CardElement.prototype, "useDefaultSizing", {
        get: function () {
            return true;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CardElement.prototype, "allowCustomPadding", {
        get: function () {
            return true;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CardElement.prototype, "separatorOrientation", {
        get: function () {
            return Enums.Orientation.Horizontal;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CardElement.prototype, "defaultStyle", {
        get: function () {
            return Enums.ContainerStyle.Default;
        },
        enumerable: true,
        configurable: true
    });
    CardElement.prototype.parse = function (source, context) {
        _super.prototype.parse.call(this, source, context ? context : new SerializationContext());
    };
    CardElement.prototype.toJSON = function (context) {
        return _super.prototype.toJSON.call(this, context ? context : new SerializationContext());
    };
    CardElement.prototype.asString = function () {
        return "";
    };
    CardElement.prototype.isBleeding = function () {
        return false;
    };
    CardElement.prototype.getEffectiveStyle = function () {
        if (this.parent) {
            return this.parent.getEffectiveStyle();
        }
        return this.defaultStyle;
    };
    CardElement.prototype.getEffectiveStyleDefinition = function () {
        return this.hostConfig.containerStyles.getStyleByName(this.getEffectiveStyle());
    };
    CardElement.prototype.getForbiddenActionTypes = function () {
        return [];
    };
    CardElement.prototype.getImmediateSurroundingPadding = function (result, processTop, processRight, processBottom, processLeft) {
        if (processTop === void 0) { processTop = true; }
        if (processRight === void 0) { processRight = true; }
        if (processBottom === void 0) { processBottom = true; }
        if (processLeft === void 0) { processLeft = true; }
        if (this.parent) {
            var doProcessTop = processTop && this.parent.isTopElement(this);
            var doProcessRight = processRight && this.parent.isRightMostElement(this);
            var doProcessBottom = processBottom && this.parent.isBottomElement(this);
            var doProcessLeft = processLeft && this.parent.isLeftMostElement(this);
            var effectivePadding = this.parent.getEffectivePadding();
            if (effectivePadding) {
                if (doProcessTop && effectivePadding.top != Enums.Spacing.None) {
                    result.top = effectivePadding.top;
                    doProcessTop = false;
                }
                if (doProcessRight && effectivePadding.right != Enums.Spacing.None) {
                    result.right = effectivePadding.right;
                    doProcessRight = false;
                }
                if (doProcessBottom && effectivePadding.bottom != Enums.Spacing.None) {
                    result.bottom = effectivePadding.bottom;
                    doProcessBottom = false;
                }
                if (doProcessLeft && effectivePadding.left != Enums.Spacing.None) {
                    result.left = effectivePadding.left;
                    doProcessLeft = false;
                }
            }
            if (doProcessTop || doProcessRight || doProcessBottom || doProcessLeft) {
                this.parent.getImmediateSurroundingPadding(result, doProcessTop, doProcessRight, doProcessBottom, doProcessLeft);
            }
        }
    };
    CardElement.prototype.getActionCount = function () {
        return 0;
    };
    CardElement.prototype.getActionAt = function (index) {
        throw new Error("Index out of range.");
    };
    CardElement.prototype.remove = function () {
        if (this.parent && this.parent instanceof CardElementContainer) {
            return this.parent.removeItem(this);
        }
        return false;
    };
    CardElement.prototype.render = function () {
        this._renderedElement = this.overrideInternalRender();
        this._separatorElement = this.internalRenderSeparator();
        if (this._renderedElement) {
            if (this.customCssSelector) {
                this._renderedElement.classList.add(this.customCssSelector);
            }
            this._renderedElement.style.boxSizing = "border-box";
            this._defaultRenderedElementDisplayMode = this._renderedElement.style.display ? this._renderedElement.style.display : undefined;
            this.adjustRenderedElementSize(this._renderedElement);
            this.updateLayout(false);
        }
        else if (this.isDesignMode()) {
            this._renderedElement = this.createPlaceholderElement();
        }
        return this._renderedElement;
    };
    CardElement.prototype.updateLayout = function (processChildren) {
        if (processChildren === void 0) { processChildren = true; }
        this.updateRenderedElementVisibility();
        this.applyPadding();
    };
    CardElement.prototype.indexOf = function (cardElement) {
        return -1;
    };
    CardElement.prototype.isDesignMode = function () {
        var rootElement = this.getRootElement();
        return rootElement instanceof AdaptiveCard && rootElement.designMode;
    };
    CardElement.prototype.isFirstElement = function (element) {
        return true;
    };
    CardElement.prototype.isLastElement = function (element) {
        return true;
    };
    CardElement.prototype.isAtTheVeryLeft = function () {
        return this.parent ? this.parent.isLeftMostElement(this) && this.parent.isAtTheVeryLeft() : true;
    };
    CardElement.prototype.isAtTheVeryRight = function () {
        return this.parent ? this.parent.isRightMostElement(this) && this.parent.isAtTheVeryRight() : true;
    };
    CardElement.prototype.isAtTheVeryTop = function () {
        return this.parent ? this.parent.isFirstElement(this) && this.parent.isAtTheVeryTop() : true;
    };
    CardElement.prototype.isAtTheVeryBottom = function () {
        return this.parent ? this.parent.isLastElement(this) && this.parent.isAtTheVeryBottom() : true;
    };
    CardElement.prototype.isBleedingAtTop = function () {
        return false;
    };
    CardElement.prototype.isBleedingAtBottom = function () {
        return false;
    };
    CardElement.prototype.isLeftMostElement = function (element) {
        return true;
    };
    CardElement.prototype.isRightMostElement = function (element) {
        return true;
    };
    CardElement.prototype.isTopElement = function (element) {
        return this.isFirstElement(element);
    };
    CardElement.prototype.isBottomElement = function (element) {
        return this.isLastElement(element);
    };
    CardElement.prototype.isHiddenDueToOverflow = function () {
        return this._renderedElement !== undefined && this._renderedElement.style.visibility == 'hidden';
    };
    CardElement.prototype.getRootElement = function () {
        return this.getRootObject();
    };
    CardElement.prototype.getParentContainer = function () {
        var currentElement = this.parent;
        while (currentElement) {
            if (currentElement instanceof Container) {
                return currentElement;
            }
            currentElement = currentElement.parent;
        }
        return undefined;
    };
    CardElement.prototype.getAllInputs = function () {
        return [];
    };
    CardElement.prototype.getResourceInformation = function () {
        return [];
    };
    CardElement.prototype.getElementById = function (id) {
        return this.id === id ? this : undefined;
    };
    CardElement.prototype.getActionById = function (id) {
        return undefined;
    };
    CardElement.prototype.getEffectivePadding = function () {
        var padding = this.getPadding();
        return (padding && this.allowCustomPadding) ? padding : this.getDefaultPadding();
    };
    Object.defineProperty(CardElement.prototype, "hostConfig", {
        get: function () {
            if (this._hostConfig) {
                return this._hostConfig;
            }
            else {
                if (this.parent) {
                    return this.parent.hostConfig;
                }
                else {
                    return host_config_1.defaultHostConfig;
                }
            }
        },
        set: function (value) {
            this._hostConfig = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CardElement.prototype, "index", {
        get: function () {
            if (this.parent) {
                return this.parent.indexOf(this);
            }
            else {
                return 0;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CardElement.prototype, "isInteractive", {
        get: function () {
            return false;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CardElement.prototype, "isStandalone", {
        get: function () {
            return true;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CardElement.prototype, "isInline", {
        get: function () {
            return false;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CardElement.prototype, "hasVisibleSeparator", {
        get: function () {
            if (this.parent && this.separatorElement) {
                return !this.parent.isFirstElement(this) && (this.isVisible || this.isDesignMode());
            }
            else {
                return false;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CardElement.prototype, "separatorElement", {
        get: function () {
            return this._separatorElement;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CardElement.prototype, "parent", {
        get: function () {
            return this._parent;
        },
        enumerable: true,
        configurable: true
    });
    CardElement.langProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_1, "lang", true, /^[a-z]{2,3}$/ig);
    CardElement.isVisibleProperty = new serialization_1.BoolProperty(serialization_1.Versions.v1_2, "isVisible", true);
    CardElement.separatorProperty = new serialization_1.BoolProperty(serialization_1.Versions.v1_0, "separator", false);
    CardElement.heightProperty = new serialization_1.ValueSetProperty(serialization_1.Versions.v1_1, "height", [
        { value: "auto" },
        { value: "stretch" }
    ], "auto");
    CardElement.horizontalAlignmentProperty = new serialization_1.EnumProperty(serialization_1.Versions.v1_0, "horizontalAlignment", Enums.HorizontalAlignment, Enums.HorizontalAlignment.Left);
    CardElement.spacingProperty = new serialization_1.EnumProperty(serialization_1.Versions.v1_0, "spacing", Enums.Spacing, Enums.Spacing.Default);
    __decorate([
        serialization_1.property(CardElement.horizontalAlignmentProperty)
    ], CardElement.prototype, "horizontalAlignment", void 0);
    __decorate([
        serialization_1.property(CardElement.spacingProperty)
    ], CardElement.prototype, "spacing", void 0);
    __decorate([
        serialization_1.property(CardElement.separatorProperty)
    ], CardElement.prototype, "separator", void 0);
    __decorate([
        serialization_1.property(CardElement.heightProperty)
    ], CardElement.prototype, "height", void 0);
    __decorate([
        serialization_1.property(CardElement.langProperty)
    ], CardElement.prototype, "lang", null);
    __decorate([
        serialization_1.property(CardElement.isVisibleProperty)
    ], CardElement.prototype, "isVisible", null);
    return CardElement;
}(card_object_1.CardObject));
exports.CardElement = CardElement;
var ActionProperty = /** @class */ (function (_super) {
    __extends(ActionProperty, _super);
    function ActionProperty(targetVersion, name, forbiddenActionTypes) {
        if (forbiddenActionTypes === void 0) { forbiddenActionTypes = []; }
        var _this = _super.call(this, targetVersion, name, undefined) || this;
        _this.targetVersion = targetVersion;
        _this.name = name;
        _this.forbiddenActionTypes = forbiddenActionTypes;
        return _this;
    }
    ActionProperty.prototype.parse = function (sender, source, context) {
        var parent = sender;
        return context.parseAction(parent, source[this.name], this.forbiddenActionTypes, parent.isDesignMode());
    };
    ActionProperty.prototype.toJSON = function (sender, target, value, context) {
        context.serializeValue(target, this.name, value ? value.toJSON(context) : undefined);
    };
    return ActionProperty;
}(serialization_1.PropertyDefinition));
exports.ActionProperty = ActionProperty;
var BaseTextBlock = /** @class */ (function (_super) {
    __extends(BaseTextBlock, _super);
    function BaseTextBlock() {
        //#region Schema
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.size = Enums.TextSize.Default;
        _this.weight = Enums.TextWeight.Default;
        _this.color = Enums.TextColor.Default;
        _this.isSubtle = false;
        return _this;
    }
    BaseTextBlock.prototype.populateSchema = function (schema) {
        _super.prototype.populateSchema.call(this, schema);
        // selectAction is declared on BaseTextBlock but is only exposed on TextRun,
        // so the property is removed from the BaseTextBlock schema.
        schema.remove(BaseTextBlock.selectActionProperty);
    };
    Object.defineProperty(BaseTextBlock.prototype, "text", {
        get: function () {
            return this.getValue(BaseTextBlock.textProperty);
        },
        set: function (value) {
            this.setText(value);
        },
        enumerable: true,
        configurable: true
    });
    //#endregion
    BaseTextBlock.prototype.getFontSize = function (fontType) {
        switch (this.size) {
            case Enums.TextSize.Small:
                return fontType.fontSizes.small;
            case Enums.TextSize.Medium:
                return fontType.fontSizes.medium;
            case Enums.TextSize.Large:
                return fontType.fontSizes.large;
            case Enums.TextSize.ExtraLarge:
                return fontType.fontSizes.extraLarge;
            default:
                return fontType.fontSizes.default;
        }
    };
    BaseTextBlock.prototype.getColorDefinition = function (colorSet, color) {
        switch (color) {
            case Enums.TextColor.Accent:
                return colorSet.accent;
            case Enums.TextColor.Dark:
                return colorSet.dark;
            case Enums.TextColor.Light:
                return colorSet.light;
            case Enums.TextColor.Good:
                return colorSet.good;
            case Enums.TextColor.Warning:
                return colorSet.warning;
            case Enums.TextColor.Attention:
                return colorSet.attention;
            default:
                return colorSet.default;
        }
    };
    BaseTextBlock.prototype.setText = function (value) {
        this.setValue(BaseTextBlock.textProperty, value);
    };
    BaseTextBlock.prototype.asString = function () {
        return this.text;
    };
    BaseTextBlock.prototype.applyStylesTo = function (targetElement) {
        var fontType = this.hostConfig.getFontTypeDefinition(this.fontType);
        if (fontType.fontFamily) {
            targetElement.style.fontFamily = fontType.fontFamily;
        }
        var fontSize;
        switch (this.size) {
            case Enums.TextSize.Small:
                fontSize = fontType.fontSizes.small;
                break;
            case Enums.TextSize.Medium:
                fontSize = fontType.fontSizes.medium;
                break;
            case Enums.TextSize.Large:
                fontSize = fontType.fontSizes.large;
                break;
            case Enums.TextSize.ExtraLarge:
                fontSize = fontType.fontSizes.extraLarge;
                break;
            default:
                fontSize = fontType.fontSizes.default;
                break;
        }
        targetElement.style.fontSize = fontSize + "px";
        var colorDefinition = this.getColorDefinition(this.getEffectiveStyleDefinition().foregroundColors, this.effectiveColor);
        targetElement.style.color = Utils.stringToCssColor(this.isSubtle ? colorDefinition.subtle : colorDefinition.default);
        var fontWeight;
        switch (this.weight) {
            case Enums.TextWeight.Lighter:
                fontWeight = fontType.fontWeights.lighter;
                break;
            case Enums.TextWeight.Bolder:
                fontWeight = fontType.fontWeights.bolder;
                break;
            default:
                fontWeight = fontType.fontWeights.default;
                break;
        }
        targetElement.style.fontWeight = fontWeight.toString();
    };
    Object.defineProperty(BaseTextBlock.prototype, "effectiveColor", {
        get: function () {
            return this.color ? this.color : Enums.TextColor.Default;
        },
        enumerable: true,
        configurable: true
    });
    BaseTextBlock.textProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_0, "text", true);
    BaseTextBlock.sizeProperty = new serialization_1.EnumProperty(serialization_1.Versions.v1_0, "size", Enums.TextSize, Enums.TextSize.Default);
    BaseTextBlock.weightProperty = new serialization_1.EnumProperty(serialization_1.Versions.v1_0, "weight", Enums.TextWeight, Enums.TextWeight.Default);
    BaseTextBlock.colorProperty = new serialization_1.EnumProperty(serialization_1.Versions.v1_0, "color", Enums.TextColor, Enums.TextColor.Default);
    BaseTextBlock.isSubtleProperty = new serialization_1.BoolProperty(serialization_1.Versions.v1_0, "isSubtle", false);
    BaseTextBlock.fontTypeProperty = new serialization_1.EnumProperty(serialization_1.Versions.v1_2, "fontType", Enums.FontType);
    BaseTextBlock.selectActionProperty = new ActionProperty(serialization_1.Versions.v1_0, "selectAction", ["Action.ShowCard"]);
    __decorate([
        serialization_1.property(BaseTextBlock.sizeProperty)
    ], BaseTextBlock.prototype, "size", void 0);
    __decorate([
        serialization_1.property(BaseTextBlock.weightProperty)
    ], BaseTextBlock.prototype, "weight", void 0);
    __decorate([
        serialization_1.property(BaseTextBlock.colorProperty)
    ], BaseTextBlock.prototype, "color", void 0);
    __decorate([
        serialization_1.property(BaseTextBlock.fontTypeProperty)
    ], BaseTextBlock.prototype, "fontType", void 0);
    __decorate([
        serialization_1.property(BaseTextBlock.isSubtleProperty)
    ], BaseTextBlock.prototype, "isSubtle", void 0);
    __decorate([
        serialization_1.property(BaseTextBlock.textProperty)
    ], BaseTextBlock.prototype, "text", null);
    __decorate([
        serialization_1.property(BaseTextBlock.selectActionProperty)
    ], BaseTextBlock.prototype, "selectAction", void 0);
    return BaseTextBlock;
}(CardElement));
exports.BaseTextBlock = BaseTextBlock;
var TextBlock = /** @class */ (function (_super) {
    __extends(TextBlock, _super);
    function TextBlock() {
        //#region Schema
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.wrap = false;
        _this._treatAsPlainText = true;
        _this.useMarkdown = true;
        return _this;
    }
    TextBlock.prototype.restoreOriginalContent = function () {
        if (this.renderedElement !== undefined) {
            if (this.maxLines && this.maxLines > 0) {
                this.renderedElement.style.maxHeight = this._computedLineHeight * this.maxLines + "px";
            }
            this.renderedElement.innerHTML = this._originalInnerHtml;
        }
    };
    TextBlock.prototype.truncateIfSupported = function (maxHeight) {
        if (this.renderedElement !== undefined) {
            // For now, only truncate TextBlocks that contain just a single
            // paragraph -- since the maxLines calculation doesn't take into
            // account Markdown lists
            var children = this.renderedElement.children;
            var isTextOnly = !children.length;
            var truncationSupported = isTextOnly || children.length == 1 && children[0].tagName.toLowerCase() == 'p';
            if (truncationSupported) {
                var element = isTextOnly ? this.renderedElement : children[0];
                Utils.truncate(element, maxHeight, this._computedLineHeight);
                return true;
            }
        }
        return false;
    };
    TextBlock.prototype.setText = function (value) {
        _super.prototype.setText.call(this, value);
        this._processedText = undefined;
    };
    TextBlock.prototype.getRenderedDomElementType = function () {
        return "div";
    };
    TextBlock.prototype.internalRender = function () {
        var _this = this;
        this._processedText = undefined;
        if (this.text) {
            var preProcessedText = this.preProcessPropertyValue(BaseTextBlock.textProperty);
            var hostConfig = this.hostConfig;
            var element = document.createElement(this.getRenderedDomElementType());
            element.classList.add(hostConfig.makeCssClassName("ac-textBlock"));
            element.style.overflow = "hidden";
            this.applyStylesTo(element);
            if (this.selectAction) {
                element.onclick = function (e) {
                    e.preventDefault();
                    e.cancelBubble = true;
                    if (_this.selectAction) {
                        _this.selectAction.execute();
                    }
                };
                if (hostConfig.supportsInteractivity) {
                    element.tabIndex = 0;
                    element.setAttribute("role", "button");
                    if (this.selectAction.title) {
                        element.setAttribute("aria-label", this.selectAction.title);
                    }
                    element.classList.add(hostConfig.makeCssClassName("ac-selectable"));
                }
            }
            if (!this._processedText) {
                this._treatAsPlainText = true;
                var formattedText = TextFormatters.formatText(this.lang, preProcessedText);
                if (this.useMarkdown && formattedText) {
                    if (shared_1.GlobalSettings.allowMarkForTextHighlighting) {
                        formattedText = formattedText.replace(/<mark>/g, "===").replace(/<\/mark>/g, "/==");
                    }
                    var markdownProcessingResult = AdaptiveCard.applyMarkdown(formattedText);
                    if (markdownProcessingResult.didProcess && markdownProcessingResult.outputHtml) {
                        this._processedText = markdownProcessingResult.outputHtml;
                        this._treatAsPlainText = false;
                        // Only process <mark> tag if markdown processing was applied because
                        // markdown processing is also responsible for sanitizing the input string
                        if (shared_1.GlobalSettings.allowMarkForTextHighlighting && this._processedText) {
                            var markStyle = "";
                            var effectiveStyle = this.getEffectiveStyleDefinition();
                            if (effectiveStyle.highlightBackgroundColor) {
                                markStyle += "background-color: " + effectiveStyle.highlightBackgroundColor + ";";
                            }
                            if (effectiveStyle.highlightForegroundColor) {
                                markStyle += "color: " + effectiveStyle.highlightForegroundColor + ";";
                            }
                            if (markStyle) {
                                markStyle = 'style="' + markStyle + '"';
                            }
                            this._processedText = this._processedText.replace(/===/g, "<mark " + markStyle + ">").replace(/\/==/g, "</mark>");
                        }
                    }
                    else {
                        this._processedText = formattedText;
                        this._treatAsPlainText = true;
                    }
                }
                else {
                    this._processedText = formattedText;
                    this._treatAsPlainText = true;
                }
            }
            if (!this._processedText) {
                this._processedText = "";
            }
            if (this._treatAsPlainText) {
                element.innerText = this._processedText;
            }
            else {
                element.innerHTML = this._processedText;
            }
            if (element.firstElementChild instanceof HTMLElement) {
                var firstElementChild = element.firstElementChild;
                firstElementChild.style.marginTop = "0px";
                firstElementChild.style.width = "100%";
                if (!this.wrap) {
                    firstElementChild.style.overflow = "hidden";
                    firstElementChild.style.textOverflow = "ellipsis";
                }
            }
            if (element.lastElementChild instanceof HTMLElement) {
                element.lastElementChild.style.marginBottom = "0px";
            }
            var anchors = element.getElementsByTagName("a");
            for (var i = 0; i < anchors.length; i++) {
                var anchor = anchors[i];
                anchor.classList.add(hostConfig.makeCssClassName("ac-anchor"));
                anchor.target = "_blank";
                anchor.onclick = function (e) {
                    if (raiseAnchorClickedEvent(_this, e.target)) {
                        e.preventDefault();
                        e.cancelBubble = true;
                    }
                };
            }
            if (this.wrap) {
                element.style.wordWrap = "break-word";
                if (this.maxLines && this.maxLines > 0) {
                    element.style.maxHeight = (this._computedLineHeight * this.maxLines) + "px";
                    element.style.overflow = "hidden";
                }
            }
            else {
                element.style.whiteSpace = "nowrap";
                element.style.textOverflow = "ellipsis";
            }
            if (shared_1.GlobalSettings.useAdvancedTextBlockTruncation || shared_1.GlobalSettings.useAdvancedCardBottomTruncation) {
                this._originalInnerHtml = element.innerHTML;
            }
            return element;
        }
        else {
            return undefined;
        }
    };
    TextBlock.prototype.truncateOverflow = function (maxHeight) {
        if (maxHeight >= this._computedLineHeight) {
            return this.truncateIfSupported(maxHeight);
        }
        return false;
    };
    TextBlock.prototype.undoOverflowTruncation = function () {
        this.restoreOriginalContent();
        if (shared_1.GlobalSettings.useAdvancedTextBlockTruncation && this.maxLines) {
            var maxHeight = this._computedLineHeight * this.maxLines;
            this.truncateIfSupported(maxHeight);
        }
    };
    TextBlock.prototype.applyStylesTo = function (targetElement) {
        _super.prototype.applyStylesTo.call(this, targetElement);
        var parentContainer = this.getParentContainer();
        var isRtl = parentContainer ? parentContainer.isRtl() : false;
        switch (this.horizontalAlignment) {
            case Enums.HorizontalAlignment.Center:
                targetElement.style.textAlign = "center";
                break;
            case Enums.HorizontalAlignment.Right:
                targetElement.style.textAlign = isRtl ? "left" : "right";
                break;
            default:
                targetElement.style.textAlign = isRtl ? "right" : "left";
                break;
        }
        var lineHeights = this.hostConfig.lineHeights;
        if (lineHeights) {
            switch (this.size) {
                case Enums.TextSize.Small:
                    this._computedLineHeight = lineHeights.small;
                    break;
                case Enums.TextSize.Medium:
                    this._computedLineHeight = lineHeights.medium;
                    break;
                case Enums.TextSize.Large:
                    this._computedLineHeight = lineHeights.large;
                    break;
                case Enums.TextSize.ExtraLarge:
                    this._computedLineHeight = lineHeights.extraLarge;
                    break;
                default:
                    this._computedLineHeight = lineHeights.default;
                    break;
            }
        }
        else {
            // Looks like 1.33 is the magic number to compute line-height
            // from font size.
            this._computedLineHeight = this.getFontSize(this.hostConfig.getFontTypeDefinition(this.fontType)) * 1.33;
        }
        targetElement.style.lineHeight = this._computedLineHeight + "px";
    };
    TextBlock.prototype.getJsonTypeName = function () {
        return "TextBlock";
    };
    TextBlock.prototype.updateLayout = function (processChildren) {
        if (processChildren === void 0) { processChildren = false; }
        _super.prototype.updateLayout.call(this, processChildren);
        if (shared_1.GlobalSettings.useAdvancedTextBlockTruncation && this.maxLines && this.isDisplayed()) {
            // Reset the element's innerHTML in case the available room for
            // content has increased
            this.restoreOriginalContent();
            this.truncateIfSupported(this._computedLineHeight * this.maxLines);
        }
    };
    TextBlock.wrapProperty = new serialization_1.BoolProperty(serialization_1.Versions.v1_0, "wrap", false);
    TextBlock.maxLinesProperty = new serialization_1.NumProperty(serialization_1.Versions.v1_0, "maxLines");
    __decorate([
        serialization_1.property(TextBlock.wrapProperty)
    ], TextBlock.prototype, "wrap", void 0);
    __decorate([
        serialization_1.property(TextBlock.maxLinesProperty)
    ], TextBlock.prototype, "maxLines", void 0);
    return TextBlock;
}(BaseTextBlock));
exports.TextBlock = TextBlock;
var Label = /** @class */ (function (_super) {
    __extends(Label, _super);
    function Label() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Label.prototype.getRenderedDomElementType = function () {
        return "label";
    };
    Label.prototype.internalRender = function () {
        var renderedElement = _super.prototype.internalRender.call(this);
        if (renderedElement && this.forElementId) {
            renderedElement.htmlFor = this.forElementId;
        }
        return renderedElement;
    };
    return Label;
}(TextBlock));
var TextRun = /** @class */ (function (_super) {
    __extends(TextRun, _super);
    function TextRun() {
        //#region Schema
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.italic = false;
        _this.strikethrough = false;
        _this.highlight = false;
        return _this;
    }
    TextRun.prototype.populateSchema = function (schema) {
        _super.prototype.populateSchema.call(this, schema);
        schema.add(BaseTextBlock.selectActionProperty);
    };
    //#endregion
    TextRun.prototype.internalRender = function () {
        var _this = this;
        if (this.text) {
            var preProcessedText = this.preProcessPropertyValue(BaseTextBlock.textProperty);
            var hostConfig = this.hostConfig;
            var formattedText = TextFormatters.formatText(this.lang, preProcessedText);
            if (!formattedText) {
                formattedText = "";
            }
            var element = document.createElement("span");
            element.classList.add(hostConfig.makeCssClassName("ac-textRun"));
            this.applyStylesTo(element);
            if (this.selectAction && hostConfig.supportsInteractivity) {
                var anchor = document.createElement("a");
                anchor.classList.add(hostConfig.makeCssClassName("ac-anchor"));
                var href = this.selectAction.getHref();
                anchor.href = href ? href : "";
                anchor.target = "_blank";
                anchor.onclick = function (e) {
                    e.preventDefault();
                    e.cancelBubble = true;
                    if (_this.selectAction) {
                        _this.selectAction.execute();
                    }
                };
                anchor.innerText = formattedText;
                element.appendChild(anchor);
            }
            else {
                element.innerText = formattedText;
            }
            return element;
        }
        else {
            return undefined;
        }
    };
    TextRun.prototype.applyStylesTo = function (targetElement) {
        _super.prototype.applyStylesTo.call(this, targetElement);
        if (this.italic) {
            targetElement.style.fontStyle = "italic";
        }
        if (this.strikethrough) {
            targetElement.style.textDecoration = "line-through";
        }
        if (this.highlight) {
            var colorDefinition = this.getColorDefinition(this.getEffectiveStyleDefinition().foregroundColors, this.effectiveColor);
            targetElement.style.backgroundColor = Utils.stringToCssColor(this.isSubtle ? colorDefinition.highlightColors.subtle : colorDefinition.highlightColors.default);
        }
    };
    TextRun.prototype.getJsonTypeName = function () {
        return "TextRun";
    };
    Object.defineProperty(TextRun.prototype, "isStandalone", {
        get: function () {
            return false;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(TextRun.prototype, "isInline", {
        get: function () {
            return true;
        },
        enumerable: true,
        configurable: true
    });
    TextRun.italicProperty = new serialization_1.BoolProperty(serialization_1.Versions.v1_2, "italic", false);
    TextRun.strikethroughProperty = new serialization_1.BoolProperty(serialization_1.Versions.v1_2, "strikethrough", false);
    TextRun.highlightProperty = new serialization_1.BoolProperty(serialization_1.Versions.v1_2, "highlight", false);
    __decorate([
        serialization_1.property(TextRun.italicProperty)
    ], TextRun.prototype, "italic", void 0);
    __decorate([
        serialization_1.property(TextRun.strikethroughProperty)
    ], TextRun.prototype, "strikethrough", void 0);
    __decorate([
        serialization_1.property(TextRun.highlightProperty)
    ], TextRun.prototype, "highlight", void 0);
    return TextRun;
}(BaseTextBlock));
exports.TextRun = TextRun;
var RichTextBlock = /** @class */ (function (_super) {
    __extends(RichTextBlock, _super);
    function RichTextBlock() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this._inlines = [];
        return _this;
    }
    RichTextBlock.prototype.internalAddInline = function (inline, forceAdd) {
        if (forceAdd === void 0) { forceAdd = false; }
        if (!inline.isInline) {
            throw new Error("RichTextBlock.addInline: the specified card element cannot be used as a RichTextBlock inline.");
        }
        var doAdd = inline.parent === undefined || forceAdd;
        if (!doAdd && inline.parent != this) {
            throw new Error("RichTextBlock.addInline: the specified inline already belongs to another RichTextBlock.");
        }
        else {
            inline.setParent(this);
            this._inlines.push(inline);
        }
    };
    RichTextBlock.prototype.internalParse = function (source, context) {
        _super.prototype.internalParse.call(this, source, context);
        this._inlines = [];
        if (Array.isArray(source["inlines"])) {
            for (var _i = 0, _a = source["inlines"]; _i < _a.length; _i++) {
                var jsonInline = _a[_i];
                var inline = void 0;
                if (typeof jsonInline === "string") {
                    var textRun = new TextRun();
                    textRun.text = jsonInline;
                    inline = textRun;
                }
                else {
                    // No fallback for inlines in 1.2
                    inline = context.parseElement(this, jsonInline, false);
                }
                if (inline) {
                    this.internalAddInline(inline, true);
                }
            }
        }
    };
    RichTextBlock.prototype.internalToJSON = function (target, context) {
        _super.prototype.internalToJSON.call(this, target, context);
        if (this._inlines.length > 0) {
            var jsonInlines = [];
            for (var _i = 0, _a = this._inlines; _i < _a.length; _i++) {
                var inline = _a[_i];
                jsonInlines.push(inline.toJSON(context));
            }
            context.serializeValue(target, "inlines", jsonInlines);
        }
    };
    RichTextBlock.prototype.internalRender = function () {
        if (this._inlines.length > 0) {
            var element = document.createElement("div");
            element.className = this.hostConfig.makeCssClassName("ac-richTextBlock");
            var parentContainer = this.getParentContainer();
            var isRtl = parentContainer ? parentContainer.isRtl() : false;
            switch (this.horizontalAlignment) {
                case Enums.HorizontalAlignment.Center:
                    element.style.textAlign = "center";
                    break;
                case Enums.HorizontalAlignment.Right:
                    element.style.textAlign = isRtl ? "left" : "right";
                    break;
                default:
                    element.style.textAlign = isRtl ? "right" : "left";
                    break;
            }
            var renderedInlines = 0;
            for (var _i = 0, _a = this._inlines; _i < _a.length; _i++) {
                var inline = _a[_i];
                var renderedInline = inline.render();
                if (renderedInline) {
                    element.appendChild(renderedInline);
                    renderedInlines++;
                }
            }
            if (renderedInlines > 0) {
                return element;
            }
        }
        return undefined;
    };
    RichTextBlock.prototype.asString = function () {
        var result = "";
        for (var _i = 0, _a = this._inlines; _i < _a.length; _i++) {
            var inline = _a[_i];
            result += inline.asString();
        }
        return result;
    };
    RichTextBlock.prototype.getJsonTypeName = function () {
        return "RichTextBlock";
    };
    RichTextBlock.prototype.getInlineCount = function () {
        return this._inlines.length;
    };
    RichTextBlock.prototype.getInlineAt = function (index) {
        if (index >= 0 && index < this._inlines.length) {
            return this._inlines[index];
        }
        else {
            throw new Error("RichTextBlock.getInlineAt: Index out of range (" + index + ")");
        }
    };
    RichTextBlock.prototype.addInline = function (inline) {
        this.internalAddInline(inline);
    };
    RichTextBlock.prototype.removeInline = function (inline) {
        var index = this._inlines.indexOf(inline);
        if (index >= 0) {
            this._inlines[index].setParent(undefined);
            this._inlines.splice(index, 1);
            return true;
        }
        return false;
    };
    return RichTextBlock;
}(CardElement));
exports.RichTextBlock = RichTextBlock;
var Fact = /** @class */ (function (_super) {
    __extends(Fact, _super);
    function Fact(name, value) {
        var _this = _super.call(this) || this;
        _this.name = name;
        _this.value = value;
        return _this;
    }
    //#endregion
    Fact.prototype.getSchemaKey = function () {
        return "Fact";
    };
    //#region Schema
    Fact.titleProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_0, "title");
    Fact.valueProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_0, "value");
    __decorate([
        serialization_1.property(Fact.titleProperty)
    ], Fact.prototype, "name", void 0);
    __decorate([
        serialization_1.property(Fact.valueProperty)
    ], Fact.prototype, "value", void 0);
    return Fact;
}(serialization_1.SerializableObject));
exports.Fact = Fact;
var FactSet = /** @class */ (function (_super) {
    __extends(FactSet, _super);
    function FactSet() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Object.defineProperty(FactSet.prototype, "useDefaultSizing", {
        //#endregion
        get: function () {
            return false;
        },
        enumerable: true,
        configurable: true
    });
    FactSet.prototype.internalRender = function () {
        var element = undefined;
        var hostConfig = this.hostConfig;
        if (this.facts.length > 0) {
            element = document.createElement("table");
            element.style.borderWidth = "0px";
            element.style.borderSpacing = "0px";
            element.style.borderStyle = "none";
            element.style.borderCollapse = "collapse";
            element.style.display = "block";
            element.style.overflow = "hidden";
            element.classList.add(hostConfig.makeCssClassName("ac-factset"));
            for (var i = 0; i < this.facts.length; i++) {
                var trElement = document.createElement("tr");
                if (i > 0) {
                    trElement.style.marginTop = hostConfig.factSet.spacing + "px";
                }
                // Title column
                var tdElement = document.createElement("td");
                tdElement.style.padding = "0";
                tdElement.classList.add(hostConfig.makeCssClassName("ac-fact-title"));
                if (hostConfig.factSet.title.maxWidth) {
                    tdElement.style.maxWidth = hostConfig.factSet.title.maxWidth + "px";
                }
                tdElement.style.verticalAlign = "top";
                var textBlock = new TextBlock();
                textBlock.setParent(this);
                textBlock.text = (!this.facts[i].name && this.isDesignMode()) ? "Title" : this.facts[i].name;
                textBlock.size = hostConfig.factSet.title.size;
                textBlock.color = hostConfig.factSet.title.color;
                textBlock.isSubtle = hostConfig.factSet.title.isSubtle;
                textBlock.weight = hostConfig.factSet.title.weight;
                textBlock.wrap = hostConfig.factSet.title.wrap;
                textBlock.spacing = Enums.Spacing.None;
                Utils.appendChild(tdElement, textBlock.render());
                Utils.appendChild(trElement, tdElement);
                // Spacer column
                tdElement = document.createElement("td");
                tdElement.style.width = "10px";
                Utils.appendChild(trElement, tdElement);
                // Value column
                tdElement = document.createElement("td");
                tdElement.style.padding = "0";
                tdElement.style.verticalAlign = "top";
                tdElement.classList.add(hostConfig.makeCssClassName("ac-fact-value"));
                textBlock = new TextBlock();
                textBlock.setParent(this);
                textBlock.text = this.facts[i].value;
                textBlock.size = hostConfig.factSet.value.size;
                textBlock.color = hostConfig.factSet.value.color;
                textBlock.isSubtle = hostConfig.factSet.value.isSubtle;
                textBlock.weight = hostConfig.factSet.value.weight;
                textBlock.wrap = hostConfig.factSet.value.wrap;
                textBlock.spacing = Enums.Spacing.None;
                Utils.appendChild(tdElement, textBlock.render());
                Utils.appendChild(trElement, tdElement);
                Utils.appendChild(element, trElement);
            }
        }
        return element;
    };
    FactSet.prototype.getJsonTypeName = function () {
        return "FactSet";
    };
    //#region Schema
    FactSet.factsProperty = new serialization_1.SerializableObjectCollectionProperty(serialization_1.Versions.v1_0, "facts", Fact);
    __decorate([
        serialization_1.property(FactSet.factsProperty)
    ], FactSet.prototype, "facts", void 0);
    return FactSet;
}(CardElement));
exports.FactSet = FactSet;
var ImageDimensionProperty = /** @class */ (function (_super) {
    __extends(ImageDimensionProperty, _super);
    function ImageDimensionProperty(targetVersion, name, internalName) {
        var _this = _super.call(this, targetVersion, name) || this;
        _this.targetVersion = targetVersion;
        _this.name = name;
        _this.internalName = internalName;
        return _this;
    }
    ImageDimensionProperty.prototype.getInternalName = function () {
        return this.internalName;
    };
    ImageDimensionProperty.prototype.parse = function (sender, source, context) {
        var result = undefined;
        var sourceValue = source[this.name];
        if (sourceValue === undefined) {
            return this.defaultValue;
        }
        var isValid = false;
        if (typeof sourceValue === "string") {
            try {
                var size = shared_1.SizeAndUnit.parse(sourceValue, true);
                if (size.unit == Enums.SizeUnit.Pixel) {
                    result = size.physicalSize;
                    isValid = true;
                }
            }
            catch (_a) {
                // Do nothing. A parse error is emitted below
            }
        }
        if (!isValid) {
            context.logParseEvent(6 /* InvalidPropertyValue */, "Invalid " + this.name + " value: " + sourceValue, sender);
        }
        return result;
    };
    ImageDimensionProperty.prototype.toJSON = function (sender, target, value, context) {
        context.serializeValue(target, this.name, typeof value === "number" && !isNaN(value) ? value + "px" : undefined);
    };
    return ImageDimensionProperty;
}(serialization_1.PropertyDefinition));
var Image = /** @class */ (function (_super) {
    __extends(Image, _super);
    function Image() {
        //#region Schema
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.size = Enums.Size.Auto;
        _this.style = Enums.ImageStyle.Default;
        return _this;
    }
    Image.prototype.populateSchema = function (schema) {
        _super.prototype.populateSchema.call(this, schema);
        schema.remove(CardElement.heightProperty);
    };
    //#endregion
    Image.prototype.applySize = function (element) {
        if (this.pixelWidth || this.pixelHeight) {
            if (this.pixelWidth) {
                element.style.width = this.pixelWidth + "px";
            }
            if (this.pixelHeight) {
                element.style.height = this.pixelHeight + "px";
            }
        }
        else {
            switch (this.size) {
                case Enums.Size.Stretch:
                    element.style.width = "100%";
                    break;
                case Enums.Size.Auto:
                    element.style.maxWidth = "100%";
                    break;
                case Enums.Size.Small:
                    element.style.width = this.hostConfig.imageSizes.small + "px";
                    break;
                case Enums.Size.Large:
                    element.style.width = this.hostConfig.imageSizes.large + "px";
                    break;
                case Enums.Size.Medium:
                    element.style.width = this.hostConfig.imageSizes.medium + "px";
                    break;
            }
        }
    };
    Object.defineProperty(Image.prototype, "useDefaultSizing", {
        get: function () {
            return false;
        },
        enumerable: true,
        configurable: true
    });
    Image.prototype.internalRender = function () {
        var _this = this;
        var element = undefined;
        if (this.url) {
            element = document.createElement("div");
            element.style.display = "flex";
            element.style.alignItems = "flex-start";
            element.onkeypress = function (e) {
                if (_this.selectAction && (e.keyCode == 13 || e.keyCode == 32)) { // enter or space pressed
                    e.preventDefault();
                    e.cancelBubble = true;
                    _this.selectAction.execute();
                }
            };
            element.onclick = function (e) {
                if (_this.selectAction) {
                    e.preventDefault();
                    e.cancelBubble = true;
                    _this.selectAction.execute();
                }
            };
            switch (this.horizontalAlignment) {
                case Enums.HorizontalAlignment.Center:
                    element.style.justifyContent = "center";
                    break;
                case Enums.HorizontalAlignment.Right:
                    element.style.justifyContent = "flex-end";
                    break;
                default:
                    element.style.justifyContent = "flex-start";
                    break;
            }
            // Cache hostConfig to avoid walking the parent hierarchy multiple times
            var hostConfig = this.hostConfig;
            var imageElement = document.createElement("img");
            imageElement.onload = function (e) {
                raiseImageLoadedEvent(_this);
            };
            imageElement.onerror = function (e) {
                if (_this.renderedElement) {
                    var card = _this.getRootElement();
                    _this.renderedElement.innerHTML = "";
                    if (card && card.designMode) {
                        var errorElement = document.createElement("div");
                        errorElement.style.display = "flex";
                        errorElement.style.alignItems = "center";
                        errorElement.style.justifyContent = "center";
                        errorElement.style.backgroundColor = "#EEEEEE";
                        errorElement.style.color = "black";
                        errorElement.innerText = ":-(";
                        errorElement.style.padding = "10px";
                        _this.applySize(errorElement);
                        _this.renderedElement.appendChild(errorElement);
                    }
                }
                raiseImageLoadedEvent(_this);
            };
            imageElement.style.maxHeight = "100%";
            imageElement.style.minWidth = "0";
            imageElement.classList.add(hostConfig.makeCssClassName("ac-image"));
            if (this.selectAction !== undefined && hostConfig.supportsInteractivity) {
                imageElement.tabIndex = 0;
                imageElement.setAttribute("role", "button");
                if (this.selectAction.title) {
                    imageElement.setAttribute("aria-label", this.selectAction.title);
                }
                imageElement.classList.add(hostConfig.makeCssClassName("ac-selectable"));
            }
            this.applySize(imageElement);
            if (this.style === Enums.ImageStyle.Person) {
                imageElement.style.borderRadius = "50%";
                imageElement.style.backgroundPosition = "50% 50%";
                imageElement.style.backgroundRepeat = "no-repeat";
            }
            imageElement.style.backgroundColor = Utils.stringToCssColor(this.backgroundColor);
            imageElement.src = this.preProcessPropertyValue(Image.urlProperty);
            imageElement.alt = this.preProcessPropertyValue(Image.altTextProperty);
            element.appendChild(imageElement);
        }
        return element;
    };
    Image.prototype.getJsonTypeName = function () {
        return "Image";
    };
    Image.prototype.getActionById = function (id) {
        var result = _super.prototype.getActionById.call(this, id);
        if (!result && this.selectAction) {
            result = this.selectAction.getActionById(id);
        }
        return result;
    };
    Image.prototype.getResourceInformation = function () {
        return this.url ? [{ url: this.url, mimeType: "image" }] : [];
    };
    Image.urlProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_0, "url");
    Image.altTextProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_0, "altText");
    Image.backgroundColorProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_1, "backgroundColor");
    Image.styleProperty = new serialization_1.EnumProperty(serialization_1.Versions.v1_0, "style", Enums.ImageStyle, Enums.ImageStyle.Default);
    Image.sizeProperty = new serialization_1.EnumProperty(serialization_1.Versions.v1_0, "size", Enums.Size, Enums.Size.Auto);
    Image.pixelWidthProperty = new ImageDimensionProperty(serialization_1.Versions.v1_1, "width", "pixelWidth");
    Image.pixelHeightProperty = new ImageDimensionProperty(serialization_1.Versions.v1_1, "height", "pixelHeight");
    Image.selectActionProperty = new ActionProperty(serialization_1.Versions.v1_0, "selectAction", ["Action.ShowCard"]);
    __decorate([
        serialization_1.property(Image.urlProperty)
    ], Image.prototype, "url", void 0);
    __decorate([
        serialization_1.property(Image.altTextProperty)
    ], Image.prototype, "altText", void 0);
    __decorate([
        serialization_1.property(Image.backgroundColorProperty)
    ], Image.prototype, "backgroundColor", void 0);
    __decorate([
        serialization_1.property(Image.sizeProperty)
    ], Image.prototype, "size", void 0);
    __decorate([
        serialization_1.property(Image.styleProperty)
    ], Image.prototype, "style", void 0);
    __decorate([
        serialization_1.property(Image.pixelWidthProperty)
    ], Image.prototype, "pixelWidth", void 0);
    __decorate([
        serialization_1.property(Image.pixelHeightProperty)
    ], Image.prototype, "pixelHeight", void 0);
    __decorate([
        serialization_1.property(Image.selectActionProperty)
    ], Image.prototype, "selectAction", void 0);
    return Image;
}(CardElement));
exports.Image = Image;
var CardElementContainer = /** @class */ (function (_super) {
    __extends(CardElementContainer, _super);
    function CardElementContainer() {
        //#region Schema
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.allowVerticalOverflow = false;
        return _this;
    }
    CardElementContainer.prototype.populateSchema = function (schema) {
        _super.prototype.populateSchema.call(this, schema);
        if (!this.isSelectable) {
            schema.remove(CardElementContainer.selectActionProperty);
        }
    };
    //#endregion
    CardElementContainer.prototype.isElementAllowed = function (element) {
        return this.hostConfig.supportsInteractivity || !element.isInteractive;
    };
    CardElementContainer.prototype.applyPadding = function () {
        _super.prototype.applyPadding.call(this);
        if (!this.renderedElement) {
            return;
        }
        var physicalPadding = new shared_1.SpacingDefinition();
        if (this.getEffectivePadding()) {
            physicalPadding = this.hostConfig.paddingDefinitionToSpacingDefinition(this.getEffectivePadding());
        }
        this.renderedElement.style.paddingTop = physicalPadding.top + "px";
        this.renderedElement.style.paddingRight = physicalPadding.right + "px";
        this.renderedElement.style.paddingBottom = physicalPadding.bottom + "px";
        this.renderedElement.style.paddingLeft = physicalPadding.left + "px";
        this.renderedElement.style.marginRight = "0";
        this.renderedElement.style.marginLeft = "0";
    };
    Object.defineProperty(CardElementContainer.prototype, "isSelectable", {
        get: function () {
            return false;
        },
        enumerable: true,
        configurable: true
    });
    CardElementContainer.prototype.internalValidateProperties = function (context) {
        _super.prototype.internalValidateProperties.call(this, context);
        for (var i = 0; i < this.getItemCount(); i++) {
            var item = this.getItemAt(i);
            if (!this.hostConfig.supportsInteractivity && item.isInteractive) {
                context.addFailure(this, 5 /* InteractivityNotAllowed */, "Interactivity is not allowed.");
            }
            if (!this.isElementAllowed(item)) {
                context.addFailure(this, 5 /* InteractivityNotAllowed */, "Elements of type " + item.getJsonTypeName() + " are not allowed in this container.");
            }
            item.internalValidateProperties(context);
        }
        if (this._selectAction) {
            this._selectAction.internalValidateProperties(context);
        }
    };
    CardElementContainer.prototype.render = function () {
        var _this = this;
        var element = _super.prototype.render.call(this);
        if (element) {
            var hostConfig = this.hostConfig;
            if (this.allowVerticalOverflow) {
                element.style.overflowX = "hidden";
                element.style.overflowY = "auto";
            }
            if (element && this.isSelectable && this._selectAction && hostConfig.supportsInteractivity) {
                element.classList.add(hostConfig.makeCssClassName("ac-selectable"));
                element.tabIndex = 0;
                element.setAttribute("role", "button");
                if (this._selectAction.title) {
                    element.setAttribute("aria-label", this._selectAction.title);
                }
                element.onclick = function (e) {
                    if (_this._selectAction !== undefined) {
                        e.preventDefault();
                        e.cancelBubble = true;
                        _this._selectAction.execute();
                    }
                };
                element.onkeypress = function (e) {
                    if (_this._selectAction !== undefined && (e.keyCode == 13 || e.keyCode == 32)) {
                        // Enter or space pressed
                        e.preventDefault();
                        e.cancelBubble = true;
                        _this._selectAction.execute();
                    }
                };
            }
        }
        return element;
    };
    CardElementContainer.prototype.updateLayout = function (processChildren) {
        if (processChildren === void 0) { processChildren = true; }
        _super.prototype.updateLayout.call(this, processChildren);
        if (processChildren) {
            for (var i = 0; i < this.getItemCount(); i++) {
                this.getItemAt(i).updateLayout();
            }
        }
    };
    CardElementContainer.prototype.getAllInputs = function () {
        var result = [];
        for (var i = 0; i < this.getItemCount(); i++) {
            result = result.concat(this.getItemAt(i).getAllInputs());
        }
        return result;
    };
    CardElementContainer.prototype.getResourceInformation = function () {
        var result = [];
        for (var i = 0; i < this.getItemCount(); i++) {
            result = result.concat(this.getItemAt(i).getResourceInformation());
        }
        return result;
    };
    CardElementContainer.prototype.getElementById = function (id) {
        var result = _super.prototype.getElementById.call(this, id);
        if (!result) {
            for (var i = 0; i < this.getItemCount(); i++) {
                result = this.getItemAt(i).getElementById(id);
                if (result) {
                    break;
                }
            }
        }
        return result;
    };
    CardElementContainer.selectActionProperty = new ActionProperty(serialization_1.Versions.v1_0, "selectAction", ["Action.ShowCard"]);
    __decorate([
        serialization_1.property(CardElementContainer.selectActionProperty)
    ], CardElementContainer.prototype, "_selectAction", void 0);
    return CardElementContainer;
}(CardElement));
exports.CardElementContainer = CardElementContainer;
var ImageSet = /** @class */ (function (_super) {
    __extends(ImageSet, _super);
    function ImageSet() {
        //#region Schema
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this._images = [];
        _this.imageSize = Enums.Size.Medium;
        return _this;
    }
    //#endregion
    ImageSet.prototype.internalRender = function () {
        var element = undefined;
        if (this._images.length > 0) {
            element = document.createElement("div");
            element.style.display = "flex";
            element.style.flexWrap = "wrap";
            for (var _i = 0, _a = this._images; _i < _a.length; _i++) {
                var image = _a[_i];
                image.size = this.imageSize;
                var renderedImage = image.render();
                if (renderedImage) {
                    renderedImage.style.display = "inline-flex";
                    renderedImage.style.margin = "0px";
                    renderedImage.style.marginRight = "10px";
                    renderedImage.style.maxHeight = this.hostConfig.imageSet.maxImageHeight + "px";
                    Utils.appendChild(element, renderedImage);
                }
            }
        }
        return element;
    };
    ImageSet.prototype.getItemCount = function () {
        return this._images.length;
    };
    ImageSet.prototype.getItemAt = function (index) {
        return this._images[index];
    };
    ImageSet.prototype.getFirstVisibleRenderedItem = function () {
        return this._images && this._images.length > 0 ? this._images[0] : undefined;
    };
    ImageSet.prototype.getLastVisibleRenderedItem = function () {
        return this._images && this._images.length > 0 ? this._images[this._images.length - 1] : undefined;
    };
    ImageSet.prototype.removeItem = function (item) {
        if (item instanceof Image) {
            var itemIndex = this._images.indexOf(item);
            if (itemIndex >= 0) {
                this._images.splice(itemIndex, 1);
                item.setParent(undefined);
                this.updateLayout();
                return true;
            }
        }
        return false;
    };
    ImageSet.prototype.getJsonTypeName = function () {
        return "ImageSet";
    };
    ImageSet.prototype.addImage = function (image) {
        if (!image.parent) {
            this._images.push(image);
            image.setParent(this);
        }
        else {
            throw new Error("This image already belongs to another ImageSet");
        }
    };
    ImageSet.prototype.indexOf = function (cardElement) {
        return cardElement instanceof Image ? this._images.indexOf(cardElement) : -1;
    };
    ImageSet.imagesProperty = new serialization_1.SerializableObjectCollectionProperty(serialization_1.Versions.v1_0, "images", Image, function (sender, item) { item.setParent(sender); });
    ImageSet.imageSizeProperty = new serialization_1.EnumProperty(serialization_1.Versions.v1_0, "imageSize", Enums.Size, Enums.Size.Medium);
    __decorate([
        serialization_1.property(ImageSet.imagesProperty)
    ], ImageSet.prototype, "_images", void 0);
    __decorate([
        serialization_1.property(ImageSet.imageSizeProperty)
    ], ImageSet.prototype, "imageSize", void 0);
    return ImageSet;
}(CardElementContainer));
exports.ImageSet = ImageSet;
var MediaSource = /** @class */ (function (_super) {
    __extends(MediaSource, _super);
    function MediaSource(url, mimeType) {
        var _this = _super.call(this) || this;
        _this.url = url;
        _this.mimeType = mimeType;
        return _this;
    }
    //#endregion
    MediaSource.prototype.getSchemaKey = function () {
        return "MediaSource";
    };
    MediaSource.prototype.isValid = function () {
        return this.mimeType && this.url ? true : false;
    };
    MediaSource.prototype.render = function () {
        var result = undefined;
        if (this.isValid()) {
            result = document.createElement("source");
            result.src = this.url;
            result.type = this.mimeType;
        }
        return result;
    };
    //#region Schema
    MediaSource.mimeTypeProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_1, "mimeType");
    MediaSource.urlProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_1, "url");
    __decorate([
        serialization_1.property(MediaSource.mimeTypeProperty)
    ], MediaSource.prototype, "mimeType", void 0);
    __decorate([
        serialization_1.property(MediaSource.urlProperty)
    ], MediaSource.prototype, "url", void 0);
    return MediaSource;
}(serialization_1.SerializableObject));
exports.MediaSource = MediaSource;
var Media = /** @class */ (function (_super) {
    __extends(Media, _super);
    function Media() {
        //#region Schema
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.sources = [];
        return _this;
    }
    Media.prototype.getPosterUrl = function () {
        return this.poster ? this.poster : this.hostConfig.media.defaultPoster;
    };
    Media.prototype.processSources = function () {
        this._selectedSources = [];
        this._selectedMediaType = undefined;
        for (var _i = 0, _a = this.sources; _i < _a.length; _i++) {
            var source = _a[_i];
            var mimeComponents = source.mimeType ? source.mimeType.split('/') : [];
            if (mimeComponents.length == 2) {
                if (!this._selectedMediaType) {
                    var index = Media.supportedMediaTypes.indexOf(mimeComponents[0]);
                    if (index >= 0) {
                        this._selectedMediaType = Media.supportedMediaTypes[index];
                    }
                }
                if (mimeComponents[0] == this._selectedMediaType) {
                    this._selectedSources.push(source);
                }
            }
        }
    };
    Media.prototype.renderPoster = function () {
        var _this = this;
        var playButtonArrowWidth = 12;
        var playButtonArrowHeight = 15;
        var posterRootElement = document.createElement("div");
        posterRootElement.className = this.hostConfig.makeCssClassName("ac-media-poster");
        posterRootElement.setAttribute("role", "contentinfo");
        posterRootElement.setAttribute("aria-label", this.altText ? this.altText : "Media content");
        posterRootElement.style.position = "relative";
        posterRootElement.style.display = "flex";
        var posterUrl = this.getPosterUrl();
        if (posterUrl) {
            var posterImageElement_1 = document.createElement("img");
            posterImageElement_1.style.width = "100%";
            posterImageElement_1.style.height = "100%";
            posterImageElement_1.onerror = function (e) {
                if (posterImageElement_1.parentNode) {
                    posterImageElement_1.parentNode.removeChild(posterImageElement_1);
                }
                posterRootElement.classList.add("empty");
                posterRootElement.style.minHeight = "150px";
            };
            posterImageElement_1.src = posterUrl;
            posterRootElement.appendChild(posterImageElement_1);
        }
        else {
            posterRootElement.classList.add("empty");
            posterRootElement.style.minHeight = "150px";
        }
        if (this.hostConfig.supportsInteractivity && this._selectedSources.length > 0) {
            var playButtonOuterElement = document.createElement("div");
            playButtonOuterElement.setAttribute("role", "button");
            playButtonOuterElement.setAttribute("aria-label", "Play media");
            playButtonOuterElement.className = this.hostConfig.makeCssClassName("ac-media-playButton");
            playButtonOuterElement.style.display = "flex";
            playButtonOuterElement.style.alignItems = "center";
            playButtonOuterElement.style.justifyContent = "center";
            playButtonOuterElement.onclick = function (e) {
                if (_this.hostConfig.media.allowInlinePlayback) {
                    e.preventDefault();
                    e.cancelBubble = true;
                    if (_this.renderedElement) {
                        var mediaPlayerElement = _this.renderMediaPlayer();
                        _this.renderedElement.innerHTML = "";
                        _this.renderedElement.appendChild(mediaPlayerElement);
                        mediaPlayerElement.play();
                    }
                }
                else {
                    if (Media.onPlay) {
                        e.preventDefault();
                        e.cancelBubble = true;
                        Media.onPlay(_this);
                    }
                }
            };
            var playButtonInnerElement = document.createElement("div");
            playButtonInnerElement.className = this.hostConfig.makeCssClassName("ac-media-playButton-arrow");
            playButtonInnerElement.style.width = playButtonArrowWidth + "px";
            playButtonInnerElement.style.height = playButtonArrowHeight + "px";
            playButtonInnerElement.style.borderTopWidth = (playButtonArrowHeight / 2) + "px";
            playButtonInnerElement.style.borderBottomWidth = (playButtonArrowHeight / 2) + "px";
            playButtonInnerElement.style.borderLeftWidth = playButtonArrowWidth + "px";
            playButtonInnerElement.style.borderRightWidth = "0";
            playButtonInnerElement.style.borderStyle = "solid";
            playButtonInnerElement.style.borderTopColor = "transparent";
            playButtonInnerElement.style.borderRightColor = "transparent";
            playButtonInnerElement.style.borderBottomColor = "transparent";
            playButtonInnerElement.style.transform = "translate(" + (playButtonArrowWidth / 10) + "px,0px)";
            playButtonOuterElement.appendChild(playButtonInnerElement);
            var playButtonContainer = document.createElement("div");
            playButtonContainer.style.position = "absolute";
            playButtonContainer.style.left = "0";
            playButtonContainer.style.top = "0";
            playButtonContainer.style.width = "100%";
            playButtonContainer.style.height = "100%";
            playButtonContainer.style.display = "flex";
            playButtonContainer.style.justifyContent = "center";
            playButtonContainer.style.alignItems = "center";
            playButtonContainer.appendChild(playButtonOuterElement);
            posterRootElement.appendChild(playButtonContainer);
        }
        return posterRootElement;
    };
    Media.prototype.renderMediaPlayer = function () {
        var mediaElement;
        if (this._selectedMediaType == "video") {
            var videoPlayer = document.createElement("video");
            var posterUrl = this.getPosterUrl();
            if (posterUrl) {
                videoPlayer.poster = posterUrl;
            }
            mediaElement = videoPlayer;
        }
        else {
            mediaElement = document.createElement("audio");
        }
        mediaElement.controls = true;
        mediaElement.preload = "none";
        mediaElement.style.width = "100%";
        for (var _i = 0, _a = this.sources; _i < _a.length; _i++) {
            var source = _a[_i];
            var renderedSource = source.render();
            Utils.appendChild(mediaElement, renderedSource);
        }
        return mediaElement;
    };
    Media.prototype.internalRender = function () {
        var element = document.createElement("div");
        element.className = this.hostConfig.makeCssClassName("ac-media");
        this.processSources();
        element.appendChild(this.renderPoster());
        return element;
    };
    Media.prototype.getJsonTypeName = function () {
        return "Media";
    };
    Media.prototype.getResourceInformation = function () {
        var result = [];
        var posterUrl = this.getPosterUrl();
        if (posterUrl) {
            result.push({ url: posterUrl, mimeType: "image" });
        }
        for (var _i = 0, _a = this.sources; _i < _a.length; _i++) {
            var mediaSource = _a[_i];
            if (mediaSource.isValid()) {
                result.push({
                    url: mediaSource.url,
                    mimeType: mediaSource.mimeType
                });
            }
        }
        return result;
    };
    Object.defineProperty(Media.prototype, "selectedMediaType", {
        get: function () {
            return this._selectedMediaType;
        },
        enumerable: true,
        configurable: true
    });
    Media.sourcesProperty = new serialization_1.SerializableObjectCollectionProperty(serialization_1.Versions.v1_1, "sources", MediaSource);
    Media.posterProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_1, "poster");
    Media.altTextProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_1, "altText");
    //#endregion
    Media.supportedMediaTypes = ["audio", "video"];
    __decorate([
        serialization_1.property(Media.sourcesProperty)
    ], Media.prototype, "sources", void 0);
    __decorate([
        serialization_1.property(Media.posterProperty)
    ], Media.prototype, "poster", void 0);
    __decorate([
        serialization_1.property(Media.altTextProperty)
    ], Media.prototype, "altText", void 0);
    return Media;
}(CardElement));
exports.Media = Media;
var InputValidationOptions = /** @class */ (function (_super) {
    __extends(InputValidationOptions, _super);
    function InputValidationOptions() {
        //#region Schema
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.necessity = Enums.InputValidationNecessity.Optional;
        return _this;
    }
    InputValidationOptions.prototype.getSchemaKey = function () {
        return "InputValidationOptions";
    };
    //#endregion
    InputValidationOptions.prototype.internalToJSON = function (target, context) {
        return this.hasAllDefaultValues() ? undefined : _super.prototype.internalToJSON.call(this, target, context);
    };
    InputValidationOptions.necessityProperty = new serialization_1.EnumProperty(serialization_1.Versions.vNext, "necessity", Enums.InputValidationNecessity, Enums.InputValidationNecessity.Optional);
    InputValidationOptions.errorMessageProperty = new serialization_1.StringProperty(serialization_1.Versions.vNext, "errorMessagwe");
    __decorate([
        serialization_1.property(InputValidationOptions.necessityProperty)
    ], InputValidationOptions.prototype, "necessity", void 0);
    __decorate([
        serialization_1.property(InputValidationOptions.errorMessageProperty)
    ], InputValidationOptions.prototype, "errorMessage", void 0);
    return InputValidationOptions;
}(serialization_1.SerializableObject));
exports.InputValidationOptions = InputValidationOptions;
var Input = /** @class */ (function (_super) {
    __extends(Input, _super);
    function Input() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Input.prototype.populateSchema = function (schema) {
        _super.prototype.populateSchema.call(this, schema);
        if (!shared_1.GlobalSettings.useBuiltInInputValidation) {
            schema.remove(Input.validationProperty);
        }
    };
    Object.defineProperty(Input.prototype, "validation", {
        get: function () {
            return this.getValue(Input.validationProperty);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Input.prototype, "isNullable", {
        get: function () {
            return true;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Input.prototype, "renderedInputControlElement", {
        get: function () {
            return this._renderedInputControlElement;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Input.prototype, "inputControlContainerElement", {
        get: function () {
            return this._inputControlContainerElement;
        },
        enumerable: true,
        configurable: true
    });
    Input.prototype.overrideInternalRender = function () {
        var hostConfig = this.hostConfig;
        this._outerContainerElement = document.createElement("div");
        this._outerContainerElement.style.display = "flex";
        this._outerContainerElement.style.flexDirection = "column";
        this._inputControlContainerElement = document.createElement("div");
        this._inputControlContainerElement.className = hostConfig.makeCssClassName("ac-input-container");
        this._inputControlContainerElement.style.display = "flex";
        var renderedInputControlElement = this.internalRender();
        if (renderedInputControlElement) {
            this._renderedInputControlElement = renderedInputControlElement;
            this._renderedInputControlElement.style.minWidth = "0px";
            if (shared_1.GlobalSettings.useBuiltInInputValidation && this.isNullable && this.validation.necessity == Enums.InputValidationNecessity.RequiredWithVisualCue) {
                this._renderedInputControlElement.classList.add(hostConfig.makeCssClassName("ac-input-required"));
            }
            this._inputControlContainerElement.appendChild(this._renderedInputControlElement);
            this._outerContainerElement.appendChild(this._inputControlContainerElement);
            return this._outerContainerElement;
        }
        return undefined;
    };
    Input.prototype.valueChanged = function () {
        this.resetValidationFailureCue();
        if (this.onValueChanged) {
            this.onValueChanged(this);
        }
        raiseInputValueChangedEvent(this);
    };
    Input.prototype.resetValidationFailureCue = function () {
        if (shared_1.GlobalSettings.useBuiltInInputValidation && this.renderedElement) {
            this._renderedInputControlElement.classList.remove(this.hostConfig.makeCssClassName("ac-input-validation-failed"));
            if (this._errorMessageElement) {
                this._outerContainerElement.removeChild(this._errorMessageElement);
                this._errorMessageElement = undefined;
            }
        }
    };
    Input.prototype.showValidationErrorMessage = function () {
        if (this.renderedElement && shared_1.GlobalSettings.useBuiltInInputValidation && shared_1.GlobalSettings.displayInputValidationErrors && this.validation.errorMessage) {
            this._errorMessageElement = document.createElement("span");
            this._errorMessageElement.className = this.hostConfig.makeCssClassName("ac-input-validation-error-message");
            this._errorMessageElement.textContent = this.validation.errorMessage;
            this._outerContainerElement.appendChild(this._errorMessageElement);
        }
    };
    Input.prototype.internalValidateProperties = function (context) {
        _super.prototype.internalValidateProperties.call(this, context);
        if (!this.id) {
            context.addFailure(this, 8 /* PropertyCantBeNull */, "All inputs must have a unique Id");
        }
    };
    Input.prototype.validateValue = function () {
        if (shared_1.GlobalSettings.useBuiltInInputValidation) {
            this.resetValidationFailureCue();
            var result = this.validation.necessity != Enums.InputValidationNecessity.Optional ? this.isSet() : true;
            if (!result && this.renderedElement) {
                this._renderedInputControlElement.classList.add(this.hostConfig.makeCssClassName("ac-input-validation-failed"));
                this.showValidationErrorMessage();
            }
            return result;
        }
        else {
            return true;
        }
    };
    Input.prototype.getAllInputs = function () {
        return [this];
    };
    Object.defineProperty(Input.prototype, "isInteractive", {
        get: function () {
            return true;
        },
        enumerable: true,
        configurable: true
    });
    //#region Schema
    Input.validationProperty = new serialization_1.SerializableObjectProperty(serialization_1.Versions.vNext, "validation", InputValidationOptions);
    __decorate([
        serialization_1.property(Input.validationProperty)
    ], Input.prototype, "validation", null);
    return Input;
}(CardElement));
exports.Input = Input;
var TextInput = /** @class */ (function (_super) {
    __extends(TextInput, _super);
    function TextInput() {
        //#region Schema
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.isMultiline = false;
        _this.style = Enums.InputTextStyle.Text;
        return _this;
    }
    //#endregion
    TextInput.prototype.setupInput = function (input) {
        var _this = this;
        input.style.flex = "1 1 auto";
        input.tabIndex = 0;
        if (this.placeholder) {
            input.placeholder = this.placeholder;
            input.setAttribute("aria-label", this.placeholder);
        }
        if (this.defaultValue) {
            input.value = this.defaultValue;
        }
        if (this.maxLength && this.maxLength > 0) {
            input.maxLength = this.maxLength;
        }
        input.oninput = function () { _this.valueChanged(); };
        input.onkeypress = function (e) {
            // Ctrl+Enter pressed
            if (e.keyCode == 10 && _this.inlineAction) {
                _this.inlineAction.execute();
            }
        };
    };
    TextInput.prototype.internalRender = function () {
        var result;
        if (this.isMultiline) {
            result = document.createElement("textarea");
            result.className = this.hostConfig.makeCssClassName("ac-input", "ac-textInput", "ac-multiline");
        }
        else {
            result = document.createElement("input");
            result.className = this.hostConfig.makeCssClassName("ac-input", "ac-textInput");
            result.type = Enums.InputTextStyle[this.style].toLowerCase();
        }
        this.setupInput(result);
        return result;
    };
    TextInput.prototype.overrideInternalRender = function () {
        var _this = this;
        var renderedInputControl = _super.prototype.overrideInternalRender.call(this);
        if (this.inlineAction) {
            var button_1 = document.createElement("button");
            button_1.className = this.hostConfig.makeCssClassName("ac-inlineActionButton");
            button_1.onclick = function (e) {
                e.preventDefault();
                e.cancelBubble = true;
                if (_this.inlineAction) {
                    _this.inlineAction.execute();
                }
            };
            if (this.inlineAction.iconUrl) {
                button_1.classList.add("iconOnly");
                var icon_1 = document.createElement("img");
                icon_1.style.height = "100%";
                // The below trick is necessary as a workaround in Chrome where the icon is initially displayed
                // at its native size then resized to 100% of the button's height. This cfreates an unpleasant
                // flicker. On top of that, Chrome's flex implementation fails to prperly re-layout the button
                // after the image has loaded and been gicven its final size. The below trick also fixes that.
                icon_1.style.display = "none";
                icon_1.onload = function () {
                    icon_1.style.removeProperty("display");
                };
                icon_1.onerror = function () {
                    button_1.removeChild(icon_1);
                    button_1.classList.remove("iconOnly");
                    button_1.classList.add("textOnly");
                    if (_this.inlineAction) {
                        button_1.textContent = _this.inlineAction.title ? _this.inlineAction.title : "Title";
                    }
                    else {
                        button_1.textContent = "Title";
                    }
                };
                icon_1.src = this.inlineAction.iconUrl;
                button_1.appendChild(icon_1);
                if (this.inlineAction.title) {
                    button_1.title = this.inlineAction.title;
                }
            }
            else {
                button_1.classList.add("textOnly");
                button_1.textContent = this.inlineAction.title ? this.inlineAction.title : "Title";
            }
            button_1.style.marginLeft = "8px";
            this.inputControlContainerElement.appendChild(button_1);
        }
        return renderedInputControl;
    };
    TextInput.prototype.getJsonTypeName = function () {
        return "Input.Text";
    };
    TextInput.prototype.getActionById = function (id) {
        var result = _super.prototype.getActionById.call(this, id);
        if (!result && this.inlineAction) {
            result = this.inlineAction.getActionById(id);
        }
        return result;
    };
    TextInput.prototype.isSet = function () {
        return this.value ? true : false;
    };
    Object.defineProperty(TextInput.prototype, "value", {
        get: function () {
            if (this.renderedInputControlElement) {
                if (this.isMultiline) {
                    return this.renderedInputControlElement.value;
                }
                else {
                    return this.renderedInputControlElement.value;
                }
            }
            else {
                return undefined;
            }
        },
        enumerable: true,
        configurable: true
    });
    TextInput.valueProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_0, "value");
    TextInput.maxLengthProperty = new serialization_1.NumProperty(serialization_1.Versions.v1_0, "maxLength");
    TextInput.isMultilineProperty = new serialization_1.BoolProperty(serialization_1.Versions.v1_0, "isMultiline", false);
    TextInput.placeholderProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_0, "placeholder");
    TextInput.styleProperty = new serialization_1.EnumProperty(serialization_1.Versions.v1_0, "style", Enums.InputTextStyle, Enums.InputTextStyle.Text);
    TextInput.inlineActionProperty = new ActionProperty(serialization_1.Versions.v1_0, "inlineAction", ["Action.ShowCard"]);
    __decorate([
        serialization_1.property(TextInput.valueProperty)
    ], TextInput.prototype, "defaultValue", void 0);
    __decorate([
        serialization_1.property(TextInput.maxLengthProperty)
    ], TextInput.prototype, "maxLength", void 0);
    __decorate([
        serialization_1.property(TextInput.isMultilineProperty)
    ], TextInput.prototype, "isMultiline", void 0);
    __decorate([
        serialization_1.property(TextInput.placeholderProperty)
    ], TextInput.prototype, "placeholder", void 0);
    __decorate([
        serialization_1.property(TextInput.styleProperty)
    ], TextInput.prototype, "style", void 0);
    __decorate([
        serialization_1.property(TextInput.inlineActionProperty)
    ], TextInput.prototype, "inlineAction", void 0);
    return TextInput;
}(Input));
exports.TextInput = TextInput;
var ToggleInput = /** @class */ (function (_super) {
    __extends(ToggleInput, _super);
    function ToggleInput() {
        //#region Schema
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.valueOn = "true";
        _this.valueOff = "false";
        _this.wrap = false;
        return _this;
    }
    ToggleInput.prototype.internalRender = function () {
        var _this = this;
        var element = document.createElement("div");
        element.className = this.hostConfig.makeCssClassName("ac-input", "ac-toggleInput");
        element.style.width = "100%";
        element.style.display = "flex";
        element.style.alignItems = "center";
        this._checkboxInputElement = document.createElement("input");
        this._checkboxInputElement.id = Utils.generateUniqueId();
        this._checkboxInputElement.type = "checkbox";
        this._checkboxInputElement.style.display = "inline-block";
        this._checkboxInputElement.style.verticalAlign = "middle";
        this._checkboxInputElement.style.margin = "0";
        this._checkboxInputElement.style.flex = "0 0 auto";
        if (this.title) {
            this._checkboxInputElement.setAttribute("aria-label", this.title);
        }
        this._checkboxInputElement.tabIndex = 0;
        if (this.defaultValue == this.valueOn) {
            this._checkboxInputElement.checked = true;
        }
        this._checkboxInputElement.onchange = function () { _this.valueChanged(); };
        Utils.appendChild(element, this._checkboxInputElement);
        if (this.title || this.isDesignMode()) {
            var label = new Label();
            label.setParent(this);
            label.forElementId = this._checkboxInputElement.id;
            label.hostConfig = this.hostConfig;
            label.text = !this.title ? this.getJsonTypeName() : this.title;
            label.useMarkdown = shared_1.GlobalSettings.useMarkdownInRadioButtonAndCheckbox;
            label.wrap = this.wrap;
            var labelElement = label.render();
            if (labelElement) {
                labelElement.style.display = "inline-block";
                labelElement.style.flex = "1 1 auto";
                labelElement.style.marginLeft = "6px";
                labelElement.style.verticalAlign = "middle";
                var spacerElement = document.createElement("div");
                spacerElement.style.width = "6px";
                Utils.appendChild(element, spacerElement);
                Utils.appendChild(element, labelElement);
            }
        }
        return element;
    };
    Object.defineProperty(ToggleInput.prototype, "isNullable", {
        get: function () {
            return false;
        },
        enumerable: true,
        configurable: true
    });
    ToggleInput.prototype.getJsonTypeName = function () {
        return "Input.Toggle";
    };
    ToggleInput.prototype.isSet = function () {
        return this.value ? true : false;
    };
    Object.defineProperty(ToggleInput.prototype, "value", {
        get: function () {
            if (this._checkboxInputElement) {
                return this._checkboxInputElement.checked ? this.valueOn : this.valueOff;
            }
            else {
                return undefined;
            }
        },
        enumerable: true,
        configurable: true
    });
    ToggleInput.valueProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_0, "value");
    ToggleInput.titleProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_0, "title");
    ToggleInput.valueOnProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_0, "valueOn", true, undefined, "true", function (sender) { return "true"; });
    ToggleInput.valueOffProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_0, "valueOff", true, undefined, "false", function (sender) { return "false"; });
    ToggleInput.wrapProperty = new serialization_1.BoolProperty(serialization_1.Versions.v1_2, "wrap", false);
    __decorate([
        serialization_1.property(ToggleInput.valueProperty)
    ], ToggleInput.prototype, "defaultValue", void 0);
    __decorate([
        serialization_1.property(ToggleInput.titleProperty)
    ], ToggleInput.prototype, "title", void 0);
    __decorate([
        serialization_1.property(ToggleInput.valueOnProperty)
    ], ToggleInput.prototype, "valueOn", void 0);
    __decorate([
        serialization_1.property(ToggleInput.valueOffProperty)
    ], ToggleInput.prototype, "valueOff", void 0);
    __decorate([
        serialization_1.property(ToggleInput.wrapProperty)
    ], ToggleInput.prototype, "wrap", void 0);
    return ToggleInput;
}(Input));
exports.ToggleInput = ToggleInput;
var Choice = /** @class */ (function (_super) {
    __extends(Choice, _super);
    function Choice(title, value) {
        var _this = _super.call(this) || this;
        _this.title = title;
        _this.value = value;
        return _this;
    }
    //#endregion
    Choice.prototype.getSchemaKey = function () {
        return "Choice";
    };
    //#region Schema
    Choice.titleProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_0, "title");
    Choice.valueProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_0, "value");
    __decorate([
        serialization_1.property(Choice.titleProperty)
    ], Choice.prototype, "title", void 0);
    __decorate([
        serialization_1.property(Choice.valueProperty)
    ], Choice.prototype, "value", void 0);
    return Choice;
}(serialization_1.SerializableObject));
exports.Choice = Choice;
var ChoiceSetInput = /** @class */ (function (_super) {
    __extends(ChoiceSetInput, _super);
    function ChoiceSetInput() {
        //#region Schema
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.isMultiSelect = false;
        _this.wrap = false;
        _this.choices = [];
        return _this;
    }
    Object.defineProperty(ChoiceSetInput.prototype, "isCompact", {
        get: function () {
            return this.style !== "expanded";
        },
        set: function (value) {
            this.style = value ? undefined : "expanded";
        },
        enumerable: true,
        configurable: true
    });
    ChoiceSetInput.getUniqueCategoryName = function () {
        var uniqueCwtegoryName = "__ac-category" + ChoiceSetInput.uniqueCategoryCounter;
        ChoiceSetInput.uniqueCategoryCounter++;
        return uniqueCwtegoryName;
    };
    ChoiceSetInput.prototype.renderCompundInput = function (cssClassName, type, defaultValues) {
        var _this = this;
        var element = document.createElement("div");
        element.className = this.hostConfig.makeCssClassName("ac-input", cssClassName);
        element.style.width = "100%";
        this._toggleInputs = [];
        for (var _i = 0, _a = this.choices; _i < _a.length; _i++) {
            var choice = _a[_i];
            var input = document.createElement("input");
            input.id = Utils.generateUniqueId();
            input.type = type;
            input.style.margin = "0";
            input.style.display = "inline-block";
            input.style.verticalAlign = "middle";
            input.style.flex = "0 0 auto";
            input.name = this.id ? this.id : this._uniqueCategoryName;
            if (choice.value) {
                input.value = choice.value;
            }
            if (choice.title) {
                input.setAttribute("aria-label", choice.title);
            }
            if (defaultValues && choice.value) {
                if (defaultValues.indexOf(choice.value) >= 0) {
                    input.checked = true;
                }
            }
            input.onchange = function () { _this.valueChanged(); };
            this._toggleInputs.push(input);
            var compoundInput = document.createElement("div");
            compoundInput.style.display = "flex";
            compoundInput.style.alignItems = "center";
            Utils.appendChild(compoundInput, input);
            var label = new Label();
            label.setParent(this);
            label.forElementId = input.id;
            label.hostConfig = this.hostConfig;
            label.text = choice.title ? choice.title : "Choice " + this._toggleInputs.length;
            label.useMarkdown = shared_1.GlobalSettings.useMarkdownInRadioButtonAndCheckbox;
            label.wrap = this.wrap;
            var labelElement = label.render();
            if (labelElement) {
                labelElement.style.display = "inline-block";
                labelElement.style.flex = "1 1 auto";
                labelElement.style.marginLeft = "6px";
                labelElement.style.verticalAlign = "middle";
                var spacerElement = document.createElement("div");
                spacerElement.style.width = "6px";
                Utils.appendChild(compoundInput, spacerElement);
                Utils.appendChild(compoundInput, labelElement);
            }
            Utils.appendChild(element, compoundInput);
        }
        return element;
    };
    ChoiceSetInput.prototype.internalRender = function () {
        var _this = this;
        this._uniqueCategoryName = ChoiceSetInput.getUniqueCategoryName();
        if (this.isMultiSelect) {
            // Render as a list of toggle inputs
            return this.renderCompundInput("ac-choiceSetInput-multiSelect", "checkbox", this.defaultValue ? this.defaultValue.split(this.hostConfig.choiceSetInputValueSeparator) : undefined);
        }
        else {
            if (this.style === "expanded") {
                // Render as a series of radio buttons
                return this.renderCompundInput("ac-choiceSetInput-expanded", "radio", this.defaultValue ? [this.defaultValue] : undefined);
            }
            else {
                // Render as a combo box
                this._selectElement = document.createElement("select");
                this._selectElement.className = this.hostConfig.makeCssClassName("ac-input", "ac-multichoiceInput", "ac-choiceSetInput-compact");
                this._selectElement.style.width = "100%";
                var option = document.createElement("option");
                option.selected = true;
                option.disabled = true;
                option.hidden = true;
                option.value = "";
                if (this.placeholder) {
                    option.text = this.placeholder;
                }
                Utils.appendChild(this._selectElement, option);
                for (var _i = 0, _a = this.choices; _i < _a.length; _i++) {
                    var choice = _a[_i];
                    var option_1 = document.createElement("option");
                    option_1.value = choice.value;
                    option_1.text = choice.title;
                    option_1.setAttribute("aria-label", choice.title);
                    if (choice.value == this.defaultValue) {
                        option_1.selected = true;
                    }
                    Utils.appendChild(this._selectElement, option_1);
                }
                this._selectElement.onchange = function () { _this.valueChanged(); };
                return this._selectElement;
            }
        }
    };
    ChoiceSetInput.prototype.getJsonTypeName = function () {
        return "Input.ChoiceSet";
    };
    ChoiceSetInput.prototype.internalValidateProperties = function (context) {
        _super.prototype.internalValidateProperties.call(this, context);
        if (this.choices.length == 0) {
            context.addFailure(this, 2 /* CollectionCantBeEmpty */, "An Input.ChoiceSet must have at least one choice defined.");
        }
        for (var _i = 0, _a = this.choices; _i < _a.length; _i++) {
            var choice = _a[_i];
            if (!choice.title || !choice.value) {
                context.addFailure(this, 8 /* PropertyCantBeNull */, "All choices in an Input.ChoiceSet must have their title and value properties set.");
            }
        }
    };
    ChoiceSetInput.prototype.isSet = function () {
        return this.value ? true : false;
    };
    Object.defineProperty(ChoiceSetInput.prototype, "value", {
        get: function () {
            if (!this.isMultiSelect) {
                if (this.isCompact) {
                    if (this._selectElement) {
                        return this._selectElement.selectedIndex > 0 ? this._selectElement.value : undefined;
                    }
                    return undefined;
                }
                else {
                    if (!this._toggleInputs || this._toggleInputs.length == 0) {
                        return undefined;
                    }
                    for (var _i = 0, _a = this._toggleInputs; _i < _a.length; _i++) {
                        var toggleInput = _a[_i];
                        if (toggleInput.checked) {
                            return toggleInput.value;
                        }
                    }
                    return undefined;
                }
            }
            else {
                if (!this._toggleInputs || this._toggleInputs.length == 0) {
                    return undefined;
                }
                var result = "";
                for (var _b = 0, _c = this._toggleInputs; _b < _c.length; _b++) {
                    var toggleInput = _c[_b];
                    if (toggleInput.checked) {
                        if (result != "") {
                            result += this.hostConfig.choiceSetInputValueSeparator;
                        }
                        result += toggleInput.value;
                    }
                }
                return result ? result : undefined;
            }
        },
        enumerable: true,
        configurable: true
    });
    ChoiceSetInput.valueProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_0, "value");
    ChoiceSetInput.choicesProperty = new serialization_1.SerializableObjectCollectionProperty(serialization_1.Versions.v1_0, "choices", Choice);
    ChoiceSetInput.styleProperty = new serialization_1.ValueSetProperty(serialization_1.Versions.v1_0, "style", [
        { value: "compact" },
        { value: "expanded" }
    ], "compact");
    ChoiceSetInput.isMultiSelectProperty = new serialization_1.BoolProperty(serialization_1.Versions.v1_0, "isMultiSelect", false);
    ChoiceSetInput.placeholderProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_0, "placeholder");
    ChoiceSetInput.wrapProperty = new serialization_1.BoolProperty(serialization_1.Versions.v1_2, "wrap", false);
    //#endregion
    ChoiceSetInput.uniqueCategoryCounter = 0;
    __decorate([
        serialization_1.property(ChoiceSetInput.valueProperty)
    ], ChoiceSetInput.prototype, "defaultValue", void 0);
    __decorate([
        serialization_1.property(ChoiceSetInput.styleProperty)
    ], ChoiceSetInput.prototype, "style", void 0);
    __decorate([
        serialization_1.property(ChoiceSetInput.isMultiSelectProperty)
    ], ChoiceSetInput.prototype, "isMultiSelect", void 0);
    __decorate([
        serialization_1.property(ChoiceSetInput.placeholderProperty)
    ], ChoiceSetInput.prototype, "placeholder", void 0);
    __decorate([
        serialization_1.property(ChoiceSetInput.wrapProperty)
    ], ChoiceSetInput.prototype, "wrap", void 0);
    __decorate([
        serialization_1.property(ChoiceSetInput.choicesProperty)
    ], ChoiceSetInput.prototype, "choices", void 0);
    return ChoiceSetInput;
}(Input));
exports.ChoiceSetInput = ChoiceSetInput;
var NumberInput = /** @class */ (function (_super) {
    __extends(NumberInput, _super);
    function NumberInput() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    NumberInput.prototype.internalRender = function () {
        var _this = this;
        this._numberInputElement = document.createElement("input");
        this._numberInputElement.setAttribute("type", "number");
        if (this.min) {
            this._numberInputElement.setAttribute("min", this.min.toString());
        }
        if (this.max) {
            this._numberInputElement.setAttribute("max", this.max.toString());
        }
        this._numberInputElement.className = this.hostConfig.makeCssClassName("ac-input", "ac-numberInput");
        this._numberInputElement.style.width = "100%";
        this._numberInputElement.tabIndex = 0;
        if (this.defaultValue !== undefined) {
            this._numberInputElement.valueAsNumber = this.defaultValue;
        }
        if (this.placeholder) {
            this._numberInputElement.placeholder = this.placeholder;
            this._numberInputElement.setAttribute("aria-label", this.placeholder);
        }
        this._numberInputElement.oninput = function () { _this.valueChanged(); };
        return this._numberInputElement;
    };
    NumberInput.prototype.getJsonTypeName = function () {
        return "Input.Number";
    };
    NumberInput.prototype.isSet = function () {
        return this.value !== undefined && !isNaN(this.value);
    };
    Object.defineProperty(NumberInput.prototype, "value", {
        get: function () {
            return this._numberInputElement ? this._numberInputElement.valueAsNumber : undefined;
        },
        enumerable: true,
        configurable: true
    });
    //#region Schema
    NumberInput.valueProperty = new serialization_1.NumProperty(serialization_1.Versions.v1_0, "value");
    NumberInput.placeholderProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_0, "placeholder");
    NumberInput.minProperty = new serialization_1.NumProperty(serialization_1.Versions.v1_0, "min");
    NumberInput.maxProperty = new serialization_1.NumProperty(serialization_1.Versions.v1_0, "max");
    __decorate([
        serialization_1.property(NumberInput.valueProperty)
    ], NumberInput.prototype, "defaultValue", void 0);
    __decorate([
        serialization_1.property(NumberInput.minProperty)
    ], NumberInput.prototype, "min", void 0);
    __decorate([
        serialization_1.property(NumberInput.maxProperty)
    ], NumberInput.prototype, "max", void 0);
    __decorate([
        serialization_1.property(NumberInput.placeholderProperty)
    ], NumberInput.prototype, "placeholder", void 0);
    return NumberInput;
}(Input));
exports.NumberInput = NumberInput;
var DateInput = /** @class */ (function (_super) {
    __extends(DateInput, _super);
    function DateInput() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    DateInput.prototype.internalRender = function () {
        var _this = this;
        this._dateInputElement = document.createElement("input");
        this._dateInputElement.setAttribute("type", "date");
        if (this.min) {
            this._dateInputElement.setAttribute("min", this.min);
        }
        if (this.max) {
            this._dateInputElement.setAttribute("max", this.max);
        }
        if (this.placeholder) {
            this._dateInputElement.placeholder = this.placeholder;
            this._dateInputElement.setAttribute("aria-label", this.placeholder);
        }
        this._dateInputElement.className = this.hostConfig.makeCssClassName("ac-input", "ac-dateInput");
        this._dateInputElement.style.width = "100%";
        this._dateInputElement.oninput = function () { _this.valueChanged(); };
        if (this.defaultValue) {
            this._dateInputElement.value = this.defaultValue;
        }
        return this._dateInputElement;
    };
    DateInput.prototype.getJsonTypeName = function () {
        return "Input.Date";
    };
    DateInput.prototype.isSet = function () {
        return this.value ? true : false;
    };
    Object.defineProperty(DateInput.prototype, "value", {
        get: function () {
            return this._dateInputElement ? this._dateInputElement.value : undefined;
        },
        enumerable: true,
        configurable: true
    });
    //#region Schema
    DateInput.valueProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_0, "value");
    DateInput.placeholderProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_0, "placeholder");
    DateInput.minProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_0, "min");
    DateInput.maxProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_0, "max");
    __decorate([
        serialization_1.property(DateInput.valueProperty)
    ], DateInput.prototype, "defaultValue", void 0);
    __decorate([
        serialization_1.property(DateInput.minProperty)
    ], DateInput.prototype, "min", void 0);
    __decorate([
        serialization_1.property(DateInput.maxProperty)
    ], DateInput.prototype, "max", void 0);
    __decorate([
        serialization_1.property(DateInput.placeholderProperty)
    ], DateInput.prototype, "placeholder", void 0);
    return DateInput;
}(Input));
exports.DateInput = DateInput;
var TimeProperty = /** @class */ (function (_super) {
    __extends(TimeProperty, _super);
    function TimeProperty(targetVersion, name) {
        var _this = _super.call(this, targetVersion, name, function (sender, property, source, context) {
            var value = source[property.name];
            if (typeof value === "string" && value && /^[0-9]{2}:[0-9]{2}$/.test(value)) {
                return value;
            }
            return undefined;
        }, function (sender, property, target, value, context) {
            context.serializeValue(target, property.name, value);
        }) || this;
        _this.targetVersion = targetVersion;
        _this.name = name;
        return _this;
    }
    return TimeProperty;
}(serialization_1.CustomProperty));
exports.TimeProperty = TimeProperty;
var TimeInput = /** @class */ (function (_super) {
    __extends(TimeInput, _super);
    function TimeInput() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    TimeInput.prototype.internalRender = function () {
        var _this = this;
        this._timeInputElement = document.createElement("input");
        this._timeInputElement.setAttribute("type", "time");
        this._timeInputElement.setAttribute("min", this.min);
        this._timeInputElement.setAttribute("max", this.max);
        this._timeInputElement.className = this.hostConfig.makeCssClassName("ac-input", "ac-timeInput");
        this._timeInputElement.style.width = "100%";
        this._timeInputElement.oninput = function () { _this.valueChanged(); };
        if (this.placeholder) {
            this._timeInputElement.placeholder = this.placeholder;
            this._timeInputElement.setAttribute("aria-label", this.placeholder);
        }
        if (this.defaultValue) {
            this._timeInputElement.value = this.defaultValue;
        }
        return this._timeInputElement;
    };
    TimeInput.prototype.getJsonTypeName = function () {
        return "Input.Time";
    };
    TimeInput.prototype.isSet = function () {
        return this.value ? true : false;
    };
    Object.defineProperty(TimeInput.prototype, "value", {
        get: function () {
            return this._timeInputElement ? this._timeInputElement.value : undefined;
        },
        enumerable: true,
        configurable: true
    });
    //#region Schema
    TimeInput.valueProperty = new TimeProperty(serialization_1.Versions.v1_0, "value");
    TimeInput.placeholderProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_0, "placeholder");
    TimeInput.minProperty = new TimeProperty(serialization_1.Versions.v1_0, "min");
    TimeInput.maxProperty = new TimeProperty(serialization_1.Versions.v1_0, "max");
    __decorate([
        serialization_1.property(TimeInput.valueProperty)
    ], TimeInput.prototype, "defaultValue", void 0);
    __decorate([
        serialization_1.property(TimeInput.minProperty)
    ], TimeInput.prototype, "min", void 0);
    __decorate([
        serialization_1.property(TimeInput.maxProperty)
    ], TimeInput.prototype, "max", void 0);
    __decorate([
        serialization_1.property(TimeInput.placeholderProperty)
    ], TimeInput.prototype, "placeholder", void 0);
    return TimeInput;
}(Input));
exports.TimeInput = TimeInput;
var ActionButton = /** @class */ (function () {
    function ActionButton(action, parentContainerStyle) {
        this._state = 0 /* Normal */;
        this.action = action;
        this._parentContainerStyle = parentContainerStyle;
    }
    ActionButton.prototype.updateCssStyle = function () {
        var _a, _b;
        if (this.action.parent && this.action.renderedElement) {
            var hostConfig = this.action.parent.hostConfig;
            this.action.renderedElement.className = hostConfig.makeCssClassName("ac-pushButton");
            if (this._parentContainerStyle) {
                this.action.renderedElement.classList.add("style-" + this._parentContainerStyle);
            }
            this.action.updateActionButtonCssStyle(this.action.renderedElement);
            this.action.renderedElement.classList.remove(hostConfig.makeCssClassName("expanded"));
            this.action.renderedElement.classList.remove(hostConfig.makeCssClassName("subdued"));
            switch (this._state) {
                case 1 /* Expanded */:
                    this.action.renderedElement.classList.add(hostConfig.makeCssClassName("expanded"));
                    break;
                case 2 /* Subdued */:
                    this.action.renderedElement.classList.add(hostConfig.makeCssClassName("subdued"));
                    break;
            }
            if (this.action.style) {
                if (this.action.style === Enums.ActionStyle.Positive) {
                    (_a = this.action.renderedElement.classList).add.apply(_a, hostConfig.makeCssClassNames("primary", "style-positive"));
                }
                else {
                    (_b = this.action.renderedElement.classList).add.apply(_b, hostConfig.makeCssClassNames("style-" + this.action.style.toLowerCase()));
                }
            }
        }
    };
    ActionButton.prototype.render = function () {
        var _this = this;
        this.action.render();
        if (this.action.renderedElement) {
            this.action.renderedElement.onclick = function (e) {
                e.preventDefault();
                e.cancelBubble = true;
                _this.click();
            };
            this.updateCssStyle();
        }
    };
    ActionButton.prototype.click = function () {
        if (this.onClick !== undefined) {
            this.onClick(this);
        }
    };
    Object.defineProperty(ActionButton.prototype, "state", {
        get: function () {
            return this._state;
        },
        set: function (value) {
            this._state = value;
            this.updateCssStyle();
        },
        enumerable: true,
        configurable: true
    });
    return ActionButton;
}());
var Action = /** @class */ (function (_super) {
    __extends(Action, _super);
    function Action() {
        //#region Schema
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.style = Enums.ActionStyle.Default;
        return _this;
    }
    Action.prototype.addCssClasses = function (element) {
        // Do nothing in base implementation
    };
    Action.prototype.internalGetReferencedInputs = function (allInputs) {
        return {};
    };
    Action.prototype.internalPrepareForExecution = function (inputs) {
        // Do nothing in base implementation
    };
    Action.prototype.internalValidateInputs = function (referencedInputs) {
        var result = [];
        if (shared_1.GlobalSettings.useBuiltInInputValidation && !this.ignoreInputValidation && referencedInputs) {
            for (var _i = 0, _a = Object.keys(referencedInputs); _i < _a.length; _i++) {
                var key = _a[_i];
                var input = referencedInputs[key];
                if (!input.validateValue()) {
                    result.push(input);
                }
            }
        }
        return result;
    };
    Action.prototype.getHref = function () {
        return "";
    };
    Action.prototype.updateActionButtonCssStyle = function (actionButtonElement) {
        // Do nothing in base implementation
    };
    Action.prototype.parse = function (source, context) {
        return _super.prototype.parse.call(this, source, context ? context : new SerializationContext());
    };
    Action.prototype.toJSON = function (context) {
        return _super.prototype.toJSON.call(this, context ? context : new SerializationContext());
    };
    Action.prototype.render = function (baseCssClass) {
        if (baseCssClass === void 0) { baseCssClass = "ac-pushButton"; }
        // Cache hostConfig for perf
        var hostConfig = this.hostConfig;
        var buttonElement = document.createElement("button");
        this.addCssClasses(buttonElement);
        if (this.title) {
            buttonElement.setAttribute("aria-label", this.title);
        }
        buttonElement.type = "button";
        buttonElement.style.display = "flex";
        buttonElement.style.alignItems = "center";
        buttonElement.style.justifyContent = "center";
        var titleElement = document.createElement("div");
        titleElement.style.overflow = "hidden";
        titleElement.style.textOverflow = "ellipsis";
        if (!(hostConfig.actions.iconPlacement == Enums.ActionIconPlacement.AboveTitle || hostConfig.actions.allowTitleToWrap)) {
            titleElement.style.whiteSpace = "nowrap";
        }
        if (this.title) {
            titleElement.innerText = this.title;
        }
        if (!this.iconUrl) {
            buttonElement.classList.add("noIcon");
            buttonElement.appendChild(titleElement);
        }
        else {
            var iconElement = document.createElement("img");
            iconElement.src = this.iconUrl;
            iconElement.style.width = hostConfig.actions.iconSize + "px";
            iconElement.style.height = hostConfig.actions.iconSize + "px";
            iconElement.style.flex = "0 0 auto";
            if (hostConfig.actions.iconPlacement == Enums.ActionIconPlacement.AboveTitle) {
                buttonElement.classList.add("iconAbove");
                buttonElement.style.flexDirection = "column";
                if (this.title) {
                    iconElement.style.marginBottom = "6px";
                }
            }
            else {
                buttonElement.classList.add("iconLeft");
                iconElement.style.maxHeight = "100%";
                if (this.title) {
                    iconElement.style.marginRight = "6px";
                }
            }
            buttonElement.appendChild(iconElement);
            buttonElement.appendChild(titleElement);
        }
        this._renderedElement = buttonElement;
    };
    Action.prototype.execute = function () {
        if (this.onExecute) {
            this.onExecute(this);
        }
        raiseExecuteActionEvent(this);
    };
    Action.prototype.prepareForExecution = function () {
        var referencedInputs = this.getReferencedInputs();
        if (this.internalValidateInputs(referencedInputs).length > 0) {
            return false;
        }
        this.internalPrepareForExecution(referencedInputs);
        return true;
    };
    ;
    Action.prototype.remove = function () {
        if (this._actionCollection) {
            return this._actionCollection.removeAction(this);
        }
        return false;
    };
    Action.prototype.getAllInputs = function () {
        return [];
    };
    Action.prototype.getResourceInformation = function () {
        return this.iconUrl ? [{ url: this.iconUrl, mimeType: "image" }] : [];
    };
    Action.prototype.getActionById = function (id) {
        return this.id === id ? this : undefined;
    };
    Action.prototype.getReferencedInputs = function () {
        return this.parent ? this.internalGetReferencedInputs(this.parent.getRootElement().getAllInputs()) : undefined;
    };
    Action.prototype.validateInputs = function () {
        return this.internalValidateInputs(this.getReferencedInputs());
    };
    Object.defineProperty(Action.prototype, "isPrimary", {
        get: function () {
            return this.style == Enums.ActionStyle.Positive;
        },
        set: function (value) {
            if (value) {
                this.style = Enums.ActionStyle.Positive;
            }
            else {
                if (this.style == Enums.ActionStyle.Positive) {
                    this.style = Enums.ActionStyle.Default;
                }
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Action.prototype, "ignoreInputValidation", {
        get: function () {
            return true;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Action.prototype, "hostConfig", {
        get: function () {
            return this.parent ? this.parent.hostConfig : host_config_1.defaultHostConfig;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Action.prototype, "parent", {
        get: function () {
            return this._parent;
        },
        enumerable: true,
        configurable: true
    });
    Action.titleProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_0, "title");
    Action.iconUrlProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_1, "iconUrl");
    Action.styleProperty = new serialization_1.ValueSetProperty(serialization_1.Versions.v1_2, "style", [
        { value: Enums.ActionStyle.Default },
        { value: Enums.ActionStyle.Positive },
        { value: Enums.ActionStyle.Destructive }
    ], Enums.ActionStyle.Default);
    // TODO: Revise this when finalizing input validation
    Action.ignoreInputValidationProperty = new serialization_1.BoolProperty(serialization_1.Versions.vNext, "ignoreInputValidation", false);
    __decorate([
        serialization_1.property(Action.titleProperty)
    ], Action.prototype, "title", void 0);
    __decorate([
        serialization_1.property(Action.iconUrlProperty)
    ], Action.prototype, "iconUrl", void 0);
    __decorate([
        serialization_1.property(Action.styleProperty)
    ], Action.prototype, "style", void 0);
    return Action;
}(card_object_1.CardObject));
exports.Action = Action;
var SubmitAction = /** @class */ (function (_super) {
    __extends(SubmitAction, _super);
    function SubmitAction() {
        //#region Schema
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this._ignoreInputValidation = false;
        _this._isPrepared = false;
        return _this;
    }
    SubmitAction.prototype.internalGetReferencedInputs = function (allInputs) {
        var result = {};
        for (var _i = 0, allInputs_1 = allInputs; _i < allInputs_1.length; _i++) {
            var input = allInputs_1[_i];
            if (input.id) {
                result[input.id] = input;
            }
        }
        return result;
    };
    SubmitAction.prototype.internalPrepareForExecution = function (inputs) {
        if (this._originalData) {
            this._processedData = JSON.parse(JSON.stringify(this._originalData));
        }
        else {
            this._processedData = {};
        }
        if (this._processedData && inputs) {
            for (var _i = 0, _a = Object.keys(inputs); _i < _a.length; _i++) {
                var key = _a[_i];
                var input = inputs[key];
                if (input.id) {
                    this._processedData[input.id] = input.value;
                }
            }
        }
        this._isPrepared = true;
    };
    SubmitAction.prototype.getJsonTypeName = function () {
        return SubmitAction.JsonTypeName;
    };
    Object.defineProperty(SubmitAction.prototype, "ignoreInputValidation", {
        get: function () {
            return this._ignoreInputValidation;
        },
        set: function (value) {
            this._ignoreInputValidation = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SubmitAction.prototype, "data", {
        get: function () {
            return this._isPrepared ? this._processedData : this._originalData;
        },
        set: function (value) {
            this._originalData = value;
            this._isPrepared = false;
        },
        enumerable: true,
        configurable: true
    });
    SubmitAction.dataProperty = new serialization_1.PropertyDefinition(serialization_1.Versions.v1_0, "data");
    //#endregion
    // Note the "weird" way this field is declared is to work around a breaking
    // change introduced in TS 3.1 wrt d.ts generation. DO NOT CHANGE
    SubmitAction.JsonTypeName = "Action.Submit";
    __decorate([
        serialization_1.property(SubmitAction.dataProperty)
    ], SubmitAction.prototype, "_originalData", void 0);
    __decorate([
        serialization_1.property(Action.ignoreInputValidationProperty)
    ], SubmitAction.prototype, "_ignoreInputValidation", void 0);
    return SubmitAction;
}(Action));
exports.SubmitAction = SubmitAction;
var OpenUrlAction = /** @class */ (function (_super) {
    __extends(OpenUrlAction, _super);
    function OpenUrlAction() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    OpenUrlAction.prototype.getJsonTypeName = function () {
        return OpenUrlAction.JsonTypeName;
    };
    OpenUrlAction.prototype.internalValidateProperties = function (context) {
        _super.prototype.internalValidateProperties.call(this, context);
        if (!this.url) {
            context.addFailure(this, 8 /* PropertyCantBeNull */, "An Action.OpenUrl must have its url property set.");
        }
    };
    OpenUrlAction.prototype.getHref = function () {
        return this.url;
    };
    //#region Schema
    OpenUrlAction.urlProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_0, "url");
    //#endregion
    // Note the "weird" way this field is declared is to work around a breaking
    // change introduced in TS 3.1 wrt d.ts generation. DO NOT CHANGE
    OpenUrlAction.JsonTypeName = "Action.OpenUrl";
    __decorate([
        serialization_1.property(OpenUrlAction.urlProperty)
    ], OpenUrlAction.prototype, "url", void 0);
    return OpenUrlAction;
}(Action));
exports.OpenUrlAction = OpenUrlAction;
var ToggleVisibilityAction = /** @class */ (function (_super) {
    __extends(ToggleVisibilityAction, _super);
    function ToggleVisibilityAction() {
        //#region Schema
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.targetElements = {};
        return _this;
    }
    ToggleVisibilityAction.prototype.getJsonTypeName = function () {
        return ToggleVisibilityAction.JsonTypeName;
    };
    ToggleVisibilityAction.prototype.execute = function () {
        if (this.parent) {
            for (var _i = 0, _a = Object.keys(this.targetElements); _i < _a.length; _i++) {
                var elementId = _a[_i];
                var targetElement = this.parent.getRootElement().getElementById(elementId);
                if (targetElement) {
                    if (typeof this.targetElements[elementId] === "boolean") {
                        targetElement.isVisible = this.targetElements[elementId];
                    }
                    else {
                        targetElement.isVisible = !targetElement.isVisible;
                    }
                }
            }
        }
    };
    ToggleVisibilityAction.prototype.addTargetElement = function (elementId, isVisible) {
        if (isVisible === void 0) { isVisible = undefined; }
        this.targetElements[elementId] = isVisible;
    };
    ToggleVisibilityAction.prototype.removeTargetElement = function (elementId) {
        delete this.targetElements[elementId];
    };
    ToggleVisibilityAction.targetElementsProperty = new serialization_1.CustomProperty(serialization_1.Versions.v1_2, "targetElements", function (sender, property, source, context) {
        var result = {};
        if (Array.isArray(source[property.name])) {
            for (var _i = 0, _a = source[property.name]; _i < _a.length; _i++) {
                var item = _a[_i];
                if (typeof item === "string") {
                    result[item] = undefined;
                }
                else if (typeof item === "object") {
                    var elementId = item["elementId"];
                    if (typeof elementId === "string") {
                        result[elementId] = Utils.parseBool(item["isVisible"]);
                    }
                }
            }
        }
        return result;
    }, function (sender, property, target, value, context) {
        var targetElements = [];
        for (var _i = 0, _a = Object.keys(value); _i < _a.length; _i++) {
            var id = _a[_i];
            if (typeof value[id] === "boolean") {
                targetElements.push({
                    elementId: id,
                    isVisible: value[id]
                });
            }
            else {
                targetElements.push(id);
            }
        }
        context.serializeArray(target, property.name, targetElements);
    }, {}, function (sender) { return {}; });
    //#endregion
    // Note the "weird" way this field is declared is to work around a breaking
    // change introduced in TS 3.1 wrt d.ts generation. DO NOT CHANGE
    ToggleVisibilityAction.JsonTypeName = "Action.ToggleVisibility";
    __decorate([
        serialization_1.property(ToggleVisibilityAction.targetElementsProperty)
    ], ToggleVisibilityAction.prototype, "targetElements", void 0);
    return ToggleVisibilityAction;
}(Action));
exports.ToggleVisibilityAction = ToggleVisibilityAction;
var StringWithSubstitutionProperty = /** @class */ (function (_super) {
    __extends(StringWithSubstitutionProperty, _super);
    function StringWithSubstitutionProperty(targetVersion, name) {
        var _this = _super.call(this, targetVersion, name, undefined, function () { return new shared_1.StringWithSubstitutions(); }) || this;
        _this.targetVersion = targetVersion;
        _this.name = name;
        return _this;
    }
    StringWithSubstitutionProperty.prototype.parse = function (sender, source, context) {
        var result = new shared_1.StringWithSubstitutions();
        result.set(Utils.parseString(source[this.name]));
        return result;
    };
    StringWithSubstitutionProperty.prototype.toJSON = function (sender, target, value, context) {
        context.serializeValue(target, this.name, value.getOriginal());
    };
    return StringWithSubstitutionProperty;
}(serialization_1.PropertyDefinition));
var HttpHeader = /** @class */ (function (_super) {
    __extends(HttpHeader, _super);
    //#endregion
    function HttpHeader(name, value) {
        if (name === void 0) { name = ""; }
        if (value === void 0) { value = ""; }
        var _this = _super.call(this) || this;
        _this.name = name;
        _this.value = value;
        return _this;
    }
    HttpHeader.prototype.getSchemaKey = function () {
        return "HttpHeader";
    };
    HttpHeader.prototype.getReferencedInputs = function (inputs, referencedInputs) {
        this._value.getReferencedInputs(inputs, referencedInputs);
    };
    HttpHeader.prototype.prepareForExecution = function (inputs) {
        this._value.substituteInputValues(inputs, shared_1.ContentTypes.applicationXWwwFormUrlencoded);
    };
    Object.defineProperty(HttpHeader.prototype, "value", {
        get: function () {
            return this._value.get();
        },
        set: function (newValue) {
            this._value.set(newValue);
        },
        enumerable: true,
        configurable: true
    });
    //#region Schema
    HttpHeader.nameProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_0, "name");
    HttpHeader.valueProperty = new StringWithSubstitutionProperty(serialization_1.Versions.v1_0, "value");
    __decorate([
        serialization_1.property(HttpHeader.nameProperty)
    ], HttpHeader.prototype, "name", void 0);
    __decorate([
        serialization_1.property(HttpHeader.valueProperty)
    ], HttpHeader.prototype, "_value", void 0);
    return HttpHeader;
}(serialization_1.SerializableObject));
exports.HttpHeader = HttpHeader;
var HttpAction = /** @class */ (function (_super) {
    __extends(HttpAction, _super);
    function HttpAction() {
        //#region Schema
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this._ignoreInputValidation = false;
        return _this;
    }
    HttpAction.prototype.populateSchema = function (schema) {
        _super.prototype.populateSchema.call(this, schema);
        schema.add(Action.ignoreInputValidationProperty);
    };
    HttpAction.prototype.internalGetReferencedInputs = function (allInputs) {
        var result = {};
        this._url.getReferencedInputs(allInputs, result);
        for (var _i = 0, _a = this.headers; _i < _a.length; _i++) {
            var header = _a[_i];
            header.getReferencedInputs(allInputs, result);
        }
        this._body.getReferencedInputs(allInputs, result);
        return result;
    };
    HttpAction.prototype.internalPrepareForExecution = function (inputs) {
        if (inputs) {
            this._url.substituteInputValues(inputs, shared_1.ContentTypes.applicationXWwwFormUrlencoded);
            var contentType = shared_1.ContentTypes.applicationJson;
            for (var _i = 0, _a = this.headers; _i < _a.length; _i++) {
                var header = _a[_i];
                header.prepareForExecution(inputs);
                if (header.name && header.name.toLowerCase() == "content-type") {
                    contentType = header.value;
                }
            }
            this._body.substituteInputValues(inputs, contentType);
        }
    };
    ;
    HttpAction.prototype.getJsonTypeName = function () {
        return HttpAction.JsonTypeName;
    };
    HttpAction.prototype.internalValidateProperties = function (context) {
        _super.prototype.internalValidateProperties.call(this, context);
        if (!this.url) {
            context.addFailure(this, 8 /* PropertyCantBeNull */, "An Action.Http must have its url property set.");
        }
        if (this.headers.length > 0) {
            for (var _i = 0, _a = this.headers; _i < _a.length; _i++) {
                var header = _a[_i];
                if (!header.name) {
                    context.addFailure(this, 8 /* PropertyCantBeNull */, "All headers of an Action.Http must have their name and value properties set.");
                }
            }
        }
    };
    Object.defineProperty(HttpAction.prototype, "ignoreInputValidation", {
        get: function () {
            return this._ignoreInputValidation;
        },
        set: function (value) {
            this._ignoreInputValidation = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(HttpAction.prototype, "url", {
        get: function () {
            return this._url.get();
        },
        set: function (value) {
            this._url.set(value);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(HttpAction.prototype, "body", {
        get: function () {
            return this._body.get();
        },
        set: function (value) {
            this._body.set(value);
        },
        enumerable: true,
        configurable: true
    });
    HttpAction.urlProperty = new StringWithSubstitutionProperty(serialization_1.Versions.v1_0, "url");
    HttpAction.bodyProperty = new StringWithSubstitutionProperty(serialization_1.Versions.v1_0, "body");
    HttpAction.methodProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_0, "method");
    HttpAction.headersProperty = new serialization_1.SerializableObjectCollectionProperty(serialization_1.Versions.v1_0, "headers", HttpHeader);
    //#endregion
    // Note the "weird" way this field is declared is to work around a breaking
    // change introduced in TS 3.1 wrt d.ts generation. DO NOT CHANGE
    HttpAction.JsonTypeName = "Action.Http";
    __decorate([
        serialization_1.property(HttpAction.urlProperty)
    ], HttpAction.prototype, "_url", void 0);
    __decorate([
        serialization_1.property(HttpAction.bodyProperty)
    ], HttpAction.prototype, "_body", void 0);
    __decorate([
        serialization_1.property(HttpAction.bodyProperty)
    ], HttpAction.prototype, "method", void 0);
    __decorate([
        serialization_1.property(HttpAction.headersProperty)
    ], HttpAction.prototype, "headers", void 0);
    __decorate([
        serialization_1.property(Action.ignoreInputValidationProperty)
    ], HttpAction.prototype, "_ignoreInputValidation", void 0);
    return HttpAction;
}(Action));
exports.HttpAction = HttpAction;
var ShowCardAction = /** @class */ (function (_super) {
    __extends(ShowCardAction, _super);
    function ShowCardAction() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.card = new InlineAdaptiveCard();
        return _this;
    }
    ShowCardAction.prototype.internalParse = function (source, context) {
        _super.prototype.internalParse.call(this, source, context);
        var jsonCard = source["card"];
        if (jsonCard) {
            this.card.parse(jsonCard, context);
        }
        else {
            context.logParseEvent(8 /* PropertyCantBeNull */, "An Action.ShowCard must have its \"card\" property set to a valid AdaptiveCard object.", this);
        }
    };
    ShowCardAction.prototype.internalToJSON = function (target, context) {
        _super.prototype.internalToJSON.call(this, target, context);
        if (this.card) {
            context.serializeValue(target, "card", this.card.toJSON(context));
        }
    };
    ShowCardAction.prototype.addCssClasses = function (element) {
        _super.prototype.addCssClasses.call(this, element);
        if (this.parent) {
            element.classList.add(this.parent.hostConfig.makeCssClassName("expandable"));
        }
    };
    ShowCardAction.prototype.getJsonTypeName = function () {
        return ShowCardAction.JsonTypeName;
    };
    ShowCardAction.prototype.internalValidateProperties = function (context) {
        _super.prototype.internalValidateProperties.call(this, context);
        this.card.internalValidateProperties(context);
    };
    ShowCardAction.prototype.updateActionButtonCssStyle = function (actionButtonElement) {
        _super.prototype.updateActionButtonCssStyle.call(this, actionButtonElement);
        if (this.parent) {
            actionButtonElement.classList.add(this.parent.hostConfig.makeCssClassName("expandable"));
        }
    };
    ShowCardAction.prototype.setParent = function (value) {
        _super.prototype.setParent.call(this, value);
        this.card.setParent(value);
    };
    ShowCardAction.prototype.getAllInputs = function () {
        return this.card.getAllInputs();
    };
    ShowCardAction.prototype.getResourceInformation = function () {
        return _super.prototype.getResourceInformation.call(this).concat(this.card.getResourceInformation());
    };
    ShowCardAction.prototype.getActionById = function (id) {
        var result = _super.prototype.getActionById.call(this, id);
        if (!result) {
            result = this.card.getActionById(id);
        }
        return result;
    };
    // Note the "weird" way this field is declared is to work around a breaking
    // change introduced in TS 3.1 wrt d.ts generation. DO NOT CHANGE
    ShowCardAction.JsonTypeName = "Action.ShowCard";
    return ShowCardAction;
}(Action));
exports.ShowCardAction = ShowCardAction;
var ActionCollection = /** @class */ (function () {
    function ActionCollection(owner) {
        this._renderedActionCount = 0;
        this.items = [];
        this.buttons = [];
        this._owner = owner;
    }
    ActionCollection.prototype.isActionAllowed = function (action) {
        var forbiddenTypes = this._owner.getForbiddenActionTypes();
        if (forbiddenTypes) {
            for (var _i = 0, forbiddenTypes_1 = forbiddenTypes; _i < forbiddenTypes_1.length; _i++) {
                var forbiddenType = forbiddenTypes_1[_i];
                if (action.constructor === forbiddenType) {
                    return false;
                }
            }
        }
        return true;
    };
    ActionCollection.prototype.refreshContainer = function () {
        this._actionCardContainer.innerHTML = "";
        if (!this._actionCard) {
            this._actionCardContainer.style.marginTop = "0px";
            return;
        }
        this._actionCardContainer.style.marginTop = this._renderedActionCount > 0 ? this._owner.hostConfig.actions.showCard.inlineTopMargin + "px" : "0px";
        var padding = this._owner.getEffectivePadding();
        this._owner.getImmediateSurroundingPadding(padding);
        var physicalPadding = this._owner.hostConfig.paddingDefinitionToSpacingDefinition(padding);
        if (this._actionCard) {
            this._actionCard.style.paddingLeft = physicalPadding.left + "px";
            this._actionCard.style.paddingRight = physicalPadding.right + "px";
            this._actionCard.style.marginLeft = "-" + physicalPadding.left + "px";
            this._actionCard.style.marginRight = "-" + physicalPadding.right + "px";
            if (physicalPadding.bottom != 0 && !this._owner.isDesignMode()) {
                this._actionCard.style.paddingBottom = physicalPadding.bottom + "px";
                this._actionCard.style.marginBottom = "-" + physicalPadding.bottom + "px";
            }
            Utils.appendChild(this._actionCardContainer, this._actionCard);
        }
    };
    ActionCollection.prototype.layoutChanged = function () {
        this._owner.getRootElement().updateLayout();
    };
    ActionCollection.prototype.hideActionCard = function () {
        var previouslyExpandedAction = this._expandedAction;
        this._expandedAction = undefined;
        this._actionCard = undefined;
        this.refreshContainer();
        if (previouslyExpandedAction) {
            this.layoutChanged();
            raiseInlineCardExpandedEvent(previouslyExpandedAction, false);
        }
    };
    ActionCollection.prototype.showActionCard = function (action, suppressStyle, raiseEvent) {
        if (suppressStyle === void 0) { suppressStyle = false; }
        if (raiseEvent === void 0) { raiseEvent = true; }
        action.card.suppressStyle = suppressStyle;
        // Always re-render a ShowCard action in design mode; reuse already rendered ShowCard (if available) otherwise
        var renderedCard = action.card.renderedElement && !this._owner.isDesignMode() ? action.card.renderedElement : action.card.render();
        this._actionCard = renderedCard;
        this._expandedAction = action;
        this.refreshContainer();
        if (raiseEvent) {
            this.layoutChanged();
            raiseInlineCardExpandedEvent(action, true);
        }
    };
    ActionCollection.prototype.collapseExpandedAction = function () {
        for (var _i = 0, _a = this.buttons; _i < _a.length; _i++) {
            var button = _a[_i];
            button.state = 0 /* Normal */;
        }
        this.hideActionCard();
    };
    ActionCollection.prototype.expandShowCardAction = function (action, raiseEvent) {
        for (var _i = 0, _a = this.buttons; _i < _a.length; _i++) {
            var button = _a[_i];
            if (button.action !== action) {
                button.state = 2 /* Subdued */;
            }
            else {
                button.state = 1 /* Expanded */;
            }
        }
        this.showActionCard(action, !(this._owner.isAtTheVeryLeft() && this._owner.isAtTheVeryRight()), raiseEvent);
    };
    ActionCollection.prototype.actionClicked = function (actionButton) {
        if (!(actionButton.action instanceof ShowCardAction)) {
            for (var _i = 0, _a = this.buttons; _i < _a.length; _i++) {
                var button = _a[_i];
                button.state = 0 /* Normal */;
            }
            this.hideActionCard();
            actionButton.action.execute();
        }
        else {
            if (this._owner.hostConfig.actions.showCard.actionMode === Enums.ShowCardActionMode.Popup) {
                actionButton.action.execute();
            }
            else if (actionButton.action === this._expandedAction) {
                this.collapseExpandedAction();
            }
            else {
                this.expandShowCardAction(actionButton.action, true);
            }
        }
    };
    ActionCollection.prototype.getParentContainer = function () {
        if (this._owner instanceof Container) {
            return this._owner;
        }
        else {
            return this._owner.getParentContainer();
        }
    };
    ActionCollection.prototype.findActionButton = function (action) {
        for (var _i = 0, _a = this.buttons; _i < _a.length; _i++) {
            var actionButton = _a[_i];
            if (actionButton.action == action) {
                return actionButton;
            }
        }
        return undefined;
    };
    ActionCollection.prototype.parse = function (source, context) {
        this.clear();
        if (Array.isArray(source)) {
            for (var _i = 0, source_1 = source; _i < source_1.length; _i++) {
                var jsonAction = source_1[_i];
                var action = context.parseAction(this._owner, jsonAction, [], !this._owner.isDesignMode());
                if (action) {
                    this.addAction(action);
                }
            }
        }
    };
    ActionCollection.prototype.toJSON = function (target, propertyName, context) {
        context.serializeArray(target, propertyName, this.items);
    };
    ActionCollection.prototype.getActionById = function (id) {
        var result = undefined;
        for (var _i = 0, _a = this.items; _i < _a.length; _i++) {
            var item = _a[_i];
            result = item.getActionById(id);
            if (result) {
                break;
            }
        }
        return result;
    };
    ActionCollection.prototype.validateProperties = function (context) {
        if (this._owner.hostConfig.actions.maxActions && this.items.length > this._owner.hostConfig.actions.maxActions) {
            context.addFailure(this._owner, 9 /* TooManyActions */, "A maximum of " + this._owner.hostConfig.actions.maxActions + " actions are allowed.");
        }
        if (this.items.length > 0 && !this._owner.hostConfig.supportsInteractivity) {
            context.addFailure(this._owner, 5 /* InteractivityNotAllowed */, "Interactivity is not allowed.");
        }
        for (var _i = 0, _a = this.items; _i < _a.length; _i++) {
            var item = _a[_i];
            if (!this.isActionAllowed(item)) {
                context.addFailure(this._owner, 1 /* ActionTypeNotAllowed */, "Actions of type " + item.getJsonTypeName() + " are not allowed in this context.");
            }
            item.internalValidateProperties(context);
        }
    };
    ActionCollection.prototype.render = function (orientation, isDesignMode) {
        var _this = this;
        // Cache hostConfig for better perf
        var hostConfig = this._owner.hostConfig;
        if (!hostConfig.supportsInteractivity) {
            return undefined;
        }
        var element = document.createElement("div");
        var maxActions = hostConfig.actions.maxActions ? Math.min(hostConfig.actions.maxActions, this.items.length) : this.items.length;
        this._actionCardContainer = document.createElement("div");
        this._renderedActionCount = 0;
        if (hostConfig.actions.preExpandSingleShowCardAction && maxActions == 1 && this.items[0] instanceof ShowCardAction && this.isActionAllowed(this.items[0])) {
            this.showActionCard(this.items[0], true);
            this._renderedActionCount = 1;
        }
        else {
            var buttonStrip = document.createElement("div");
            buttonStrip.className = hostConfig.makeCssClassName("ac-actionSet");
            buttonStrip.style.display = "flex";
            if (orientation == Enums.Orientation.Horizontal) {
                buttonStrip.style.flexDirection = "row";
                if (this._owner.horizontalAlignment && hostConfig.actions.actionAlignment != Enums.ActionAlignment.Stretch) {
                    switch (this._owner.horizontalAlignment) {
                        case Enums.HorizontalAlignment.Center:
                            buttonStrip.style.justifyContent = "center";
                            break;
                        case Enums.HorizontalAlignment.Right:
                            buttonStrip.style.justifyContent = "flex-end";
                            break;
                        default:
                            buttonStrip.style.justifyContent = "flex-start";
                            break;
                    }
                }
                else {
                    switch (hostConfig.actions.actionAlignment) {
                        case Enums.ActionAlignment.Center:
                            buttonStrip.style.justifyContent = "center";
                            break;
                        case Enums.ActionAlignment.Right:
                            buttonStrip.style.justifyContent = "flex-end";
                            break;
                        default:
                            buttonStrip.style.justifyContent = "flex-start";
                            break;
                    }
                }
            }
            else {
                buttonStrip.style.flexDirection = "column";
                if (this._owner.horizontalAlignment && hostConfig.actions.actionAlignment != Enums.ActionAlignment.Stretch) {
                    switch (this._owner.horizontalAlignment) {
                        case Enums.HorizontalAlignment.Center:
                            buttonStrip.style.alignItems = "center";
                            break;
                        case Enums.HorizontalAlignment.Right:
                            buttonStrip.style.alignItems = "flex-end";
                            break;
                        default:
                            buttonStrip.style.alignItems = "flex-start";
                            break;
                    }
                }
                else {
                    switch (hostConfig.actions.actionAlignment) {
                        case Enums.ActionAlignment.Center:
                            buttonStrip.style.alignItems = "center";
                            break;
                        case Enums.ActionAlignment.Right:
                            buttonStrip.style.alignItems = "flex-end";
                            break;
                        case Enums.ActionAlignment.Stretch:
                            buttonStrip.style.alignItems = "stretch";
                            break;
                        default:
                            buttonStrip.style.alignItems = "flex-start";
                            break;
                    }
                }
            }
            var parentContainer = this.getParentContainer();
            if (parentContainer) {
                var parentContainerStyle = parentContainer.getEffectiveStyle();
                for (var i = 0; i < this.items.length; i++) {
                    if (this.isActionAllowed(this.items[i])) {
                        var actionButton = this.findActionButton(this.items[i]);
                        if (!actionButton) {
                            actionButton = new ActionButton(this.items[i], parentContainerStyle);
                            actionButton.onClick = function (ab) { _this.actionClicked(ab); };
                            this.buttons.push(actionButton);
                        }
                        actionButton.render();
                        if (actionButton.action.renderedElement) {
                            if (hostConfig.actions.actionsOrientation == Enums.Orientation.Horizontal && hostConfig.actions.actionAlignment == Enums.ActionAlignment.Stretch) {
                                actionButton.action.renderedElement.style.flex = "0 1 100%";
                            }
                            else {
                                actionButton.action.renderedElement.style.flex = "0 1 auto";
                            }
                            buttonStrip.appendChild(actionButton.action.renderedElement);
                            this._renderedActionCount++;
                            if (this._renderedActionCount >= hostConfig.actions.maxActions || i == this.items.length - 1) {
                                break;
                            }
                            else if (hostConfig.actions.buttonSpacing > 0) {
                                var spacer = document.createElement("div");
                                if (orientation === Enums.Orientation.Horizontal) {
                                    spacer.style.flex = "0 0 auto";
                                    spacer.style.width = hostConfig.actions.buttonSpacing + "px";
                                }
                                else {
                                    spacer.style.height = hostConfig.actions.buttonSpacing + "px";
                                }
                                Utils.appendChild(buttonStrip, spacer);
                            }
                        }
                    }
                }
            }
            var buttonStripContainer = document.createElement("div");
            buttonStripContainer.style.overflow = "hidden";
            buttonStripContainer.appendChild(buttonStrip);
            Utils.appendChild(element, buttonStripContainer);
        }
        Utils.appendChild(element, this._actionCardContainer);
        for (var _i = 0, _a = this.buttons; _i < _a.length; _i++) {
            var button = _a[_i];
            if (button.state == 1 /* Expanded */) {
                this.expandShowCardAction(button.action, false);
                break;
            }
        }
        return this._renderedActionCount > 0 ? element : undefined;
    };
    ActionCollection.prototype.addAction = function (action) {
        if (!action) {
            throw new Error("The action parameter cannot be null.");
        }
        if ((!action.parent || action.parent === this._owner) && this.items.indexOf(action) < 0) {
            this.items.push(action);
            if (!action.parent) {
                action.setParent(this._owner);
            }
            action["_actionCollection"] = this;
        }
        else {
            throw new Error("The action already belongs to another element.");
        }
    };
    ActionCollection.prototype.removeAction = function (action) {
        if (this.expandedAction && this._expandedAction == action) {
            this.collapseExpandedAction();
        }
        var actionIndex = this.items.indexOf(action);
        if (actionIndex >= 0) {
            this.items.splice(actionIndex, 1);
            action.setParent(undefined);
            action["_actionCollection"] = undefined;
            for (var i = 0; i < this.buttons.length; i++) {
                if (this.buttons[i].action == action) {
                    this.buttons.splice(i, 1);
                    break;
                }
            }
            return true;
        }
        return false;
    };
    ActionCollection.prototype.clear = function () {
        this.items = [];
        this.buttons = [];
        this._expandedAction = undefined;
        this._renderedActionCount = 0;
    };
    ActionCollection.prototype.getAllInputs = function () {
        var result = [];
        for (var _i = 0, _a = this.items; _i < _a.length; _i++) {
            var action = _a[_i];
            result = result.concat(action.getAllInputs());
        }
        return result;
    };
    ActionCollection.prototype.getResourceInformation = function () {
        var result = [];
        for (var _i = 0, _a = this.items; _i < _a.length; _i++) {
            var action = _a[_i];
            result = result.concat(action.getResourceInformation());
        }
        return result;
    };
    Object.defineProperty(ActionCollection.prototype, "renderedActionCount", {
        get: function () {
            return this._renderedActionCount;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ActionCollection.prototype, "expandedAction", {
        get: function () {
            return this._expandedAction;
        },
        enumerable: true,
        configurable: true
    });
    return ActionCollection;
}());
var ActionSet = /** @class */ (function (_super) {
    __extends(ActionSet, _super);
    function ActionSet() {
        var _this = _super.call(this) || this;
        _this._actionCollection = new ActionCollection(_this);
        return _this;
    }
    ActionSet.prototype.internalParse = function (source, context) {
        _super.prototype.internalParse.call(this, source, context);
        this._actionCollection.parse(source["actions"], context);
    };
    ActionSet.prototype.internalToJSON = function (target, context) {
        _super.prototype.internalToJSON.call(this, target, context);
        this._actionCollection.toJSON(target, "actions", context);
    };
    ActionSet.prototype.internalRender = function () {
        return this._actionCollection.render(this.orientation !== undefined ? this.orientation : this.hostConfig.actions.actionsOrientation, this.isDesignMode());
    };
    ActionSet.prototype.isBleedingAtBottom = function () {
        if (this._actionCollection.renderedActionCount == 0) {
            return _super.prototype.isBleedingAtBottom.call(this);
        }
        else {
            if (this._actionCollection.items.length == 1) {
                return this._actionCollection.expandedAction !== undefined && !this.hostConfig.actions.preExpandSingleShowCardAction;
            }
            else {
                return this._actionCollection.expandedAction !== undefined;
            }
        }
    };
    ActionSet.prototype.getJsonTypeName = function () {
        return "ActionSet";
    };
    ActionSet.prototype.getActionCount = function () {
        return this._actionCollection.items.length;
    };
    ActionSet.prototype.getActionAt = function (index) {
        if (index >= 0 && index < this.getActionCount()) {
            return this._actionCollection.items[index];
        }
        else {
            return _super.prototype.getActionAt.call(this, index);
        }
    };
    ActionSet.prototype.internalValidateProperties = function (context) {
        _super.prototype.internalValidateProperties.call(this, context);
        this._actionCollection.validateProperties(context);
    };
    ActionSet.prototype.addAction = function (action) {
        this._actionCollection.addAction(action);
    };
    ActionSet.prototype.getAllInputs = function () {
        return this._actionCollection.getAllInputs();
    };
    ActionSet.prototype.getResourceInformation = function () {
        return this._actionCollection.getResourceInformation();
    };
    Object.defineProperty(ActionSet.prototype, "isInteractive", {
        get: function () {
            return true;
        },
        enumerable: true,
        configurable: true
    });
    //#region Schema
    ActionSet.orientationProperty = new serialization_1.EnumProperty(serialization_1.Versions.v1_1, "orientation", Enums.Orientation);
    __decorate([
        serialization_1.property(ActionSet.orientationProperty)
    ], ActionSet.prototype, "orientation", void 0);
    return ActionSet;
}(CardElement));
exports.ActionSet = ActionSet;
var StylableCardElementContainer = /** @class */ (function (_super) {
    __extends(StylableCardElementContainer, _super);
    function StylableCardElementContainer() {
        //#region Schema
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this._bleed = false;
        return _this;
    }
    Object.defineProperty(StylableCardElementContainer.prototype, "style", {
        get: function () {
            if (this.allowCustomStyle) {
                var style = this.getValue(StylableCardElementContainer.styleProperty);
                if (style && this.hostConfig.containerStyles.getStyleByName(style)) {
                    return style;
                }
            }
            return undefined;
        },
        set: function (value) {
            this.setValue(StylableCardElementContainer.styleProperty, value);
        },
        enumerable: true,
        configurable: true
    });
    //#endregion
    StylableCardElementContainer.prototype.adjustRenderedElementSize = function (renderedElement) {
        _super.prototype.adjustRenderedElementSize.call(this, renderedElement);
        if (this.minPixelHeight) {
            renderedElement.style.minHeight = this.minPixelHeight + "px";
        }
    };
    StylableCardElementContainer.prototype.applyBackground = function () {
        if (this.renderedElement) {
            var styleDefinition = this.hostConfig.containerStyles.getStyleByName(this.style, this.hostConfig.containerStyles.getStyleByName(this.defaultStyle));
            if (styleDefinition.backgroundColor) {
                this.renderedElement.style.backgroundColor = Utils.stringToCssColor(styleDefinition.backgroundColor);
            }
        }
    };
    StylableCardElementContainer.prototype.applyPadding = function () {
        _super.prototype.applyPadding.call(this);
        if (!this.renderedElement) {
            return;
        }
        var physicalPadding = new shared_1.SpacingDefinition();
        if (this.getEffectivePadding()) {
            physicalPadding = this.hostConfig.paddingDefinitionToSpacingDefinition(this.getEffectivePadding());
        }
        this.renderedElement.style.paddingTop = physicalPadding.top + "px";
        this.renderedElement.style.paddingRight = physicalPadding.right + "px";
        this.renderedElement.style.paddingBottom = physicalPadding.bottom + "px";
        this.renderedElement.style.paddingLeft = physicalPadding.left + "px";
        if (this.isBleeding()) {
            // Bleed into the first parent that does have padding
            var padding = new shared_1.PaddingDefinition();
            this.getImmediateSurroundingPadding(padding);
            var surroundingPadding = this.hostConfig.paddingDefinitionToSpacingDefinition(padding);
            this.renderedElement.style.marginRight = "-" + surroundingPadding.right + "px";
            this.renderedElement.style.marginLeft = "-" + surroundingPadding.left + "px";
            if (!this.isDesignMode()) {
                this.renderedElement.style.marginTop = "-" + surroundingPadding.top + "px";
                this.renderedElement.style.marginBottom = "-" + surroundingPadding.bottom + "px";
            }
            if (this.separatorElement && this.separatorOrientation == Enums.Orientation.Horizontal) {
                this.separatorElement.style.marginLeft = "-" + surroundingPadding.left + "px";
                this.separatorElement.style.marginRight = "-" + surroundingPadding.right + "px";
            }
        }
        else {
            this.renderedElement.style.marginRight = "0";
            this.renderedElement.style.marginLeft = "0";
            this.renderedElement.style.marginTop = "0";
            this.renderedElement.style.marginBottom = "0";
            if (this.separatorElement) {
                this.separatorElement.style.marginRight = "0";
                this.separatorElement.style.marginLeft = "0";
            }
        }
    };
    StylableCardElementContainer.prototype.getHasBackground = function () {
        var currentElement = this.parent;
        while (currentElement) {
            var currentElementHasBackgroundImage = currentElement instanceof Container ? currentElement.backgroundImage.isValid() : false;
            if (currentElement instanceof StylableCardElementContainer) {
                if (this.hasExplicitStyle && (currentElement.getEffectiveStyle() != this.getEffectiveStyle() || currentElementHasBackgroundImage)) {
                    return true;
                }
            }
            currentElement = currentElement.parent;
        }
        return false;
    };
    StylableCardElementContainer.prototype.getDefaultPadding = function () {
        return this.getHasBackground() ?
            new shared_1.PaddingDefinition(Enums.Spacing.Padding, Enums.Spacing.Padding, Enums.Spacing.Padding, Enums.Spacing.Padding) : _super.prototype.getDefaultPadding.call(this);
    };
    StylableCardElementContainer.prototype.getHasExpandedAction = function () {
        return false;
    };
    StylableCardElementContainer.prototype.getBleed = function () {
        return this._bleed;
    };
    StylableCardElementContainer.prototype.setBleed = function (value) {
        this._bleed = value;
    };
    Object.defineProperty(StylableCardElementContainer.prototype, "renderedActionCount", {
        get: function () {
            return 0;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StylableCardElementContainer.prototype, "hasExplicitStyle", {
        get: function () {
            return this.getValue(StylableCardElementContainer.styleProperty) !== undefined;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(StylableCardElementContainer.prototype, "allowCustomStyle", {
        get: function () {
            return true;
        },
        enumerable: true,
        configurable: true
    });
    StylableCardElementContainer.prototype.isBleeding = function () {
        return (this.getHasBackground() || this.hostConfig.alwaysAllowBleed) && this.getBleed();
    };
    StylableCardElementContainer.prototype.internalValidateProperties = function (context) {
        _super.prototype.internalValidateProperties.call(this, context);
        var explicitStyle = this.getValue(StylableCardElementContainer.styleProperty);
        if (explicitStyle !== undefined) {
            var styleDefinition = this.hostConfig.containerStyles.getStyleByName(explicitStyle);
            if (!styleDefinition) {
                context.addFailure(this, 6 /* InvalidPropertyValue */, "Unknown container style: " + explicitStyle);
            }
        }
    };
    StylableCardElementContainer.prototype.render = function () {
        var renderedElement = _super.prototype.render.call(this);
        if (renderedElement && this.getHasBackground()) {
            this.applyBackground();
        }
        return renderedElement;
    };
    StylableCardElementContainer.prototype.getEffectiveStyle = function () {
        var effectiveStyle = this.style;
        return effectiveStyle ? effectiveStyle : _super.prototype.getEffectiveStyle.call(this);
    };
    StylableCardElementContainer.styleProperty = new serialization_1.ValueSetProperty(serialization_1.Versions.v1_0, "style", [
        { value: Enums.ContainerStyle.Default },
        { value: Enums.ContainerStyle.Emphasis },
        { targetVersion: serialization_1.Versions.v1_2, value: Enums.ContainerStyle.Accent },
        { targetVersion: serialization_1.Versions.v1_2, value: Enums.ContainerStyle.Good },
        { targetVersion: serialization_1.Versions.v1_2, value: Enums.ContainerStyle.Attention },
        { targetVersion: serialization_1.Versions.v1_2, value: Enums.ContainerStyle.Warning }
    ]);
    StylableCardElementContainer.bleedProperty = new serialization_1.BoolProperty(serialization_1.Versions.v1_2, "bleed", false);
    StylableCardElementContainer.minHeightProperty = new serialization_1.PixelSizeProperty(serialization_1.Versions.v1_2, "minHeight");
    __decorate([
        serialization_1.property(StylableCardElementContainer.styleProperty)
    ], StylableCardElementContainer.prototype, "style", null);
    __decorate([
        serialization_1.property(StylableCardElementContainer.bleedProperty)
    ], StylableCardElementContainer.prototype, "_bleed", void 0);
    __decorate([
        serialization_1.property(StylableCardElementContainer.minHeightProperty)
    ], StylableCardElementContainer.prototype, "minPixelHeight", void 0);
    return StylableCardElementContainer;
}(CardElementContainer));
exports.StylableCardElementContainer = StylableCardElementContainer;
var BackgroundImage = /** @class */ (function (_super) {
    __extends(BackgroundImage, _super);
    function BackgroundImage() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    //#endregion
    BackgroundImage.prototype.getSchemaKey = function () {
        return "BackgroundImage";
    };
    BackgroundImage.prototype.internalParse = function (source, context) {
        if (typeof source === "string") {
            this.resetDefaultValues();
            this.url = source;
        }
        else {
            return _super.prototype.internalParse.call(this, source, context);
        }
    };
    BackgroundImage.prototype.apply = function (element) {
        if (this.url && element.renderedElement) {
            element.renderedElement.style.backgroundImage = "url('" + element.preProcessPropertyValue(BackgroundImage.urlProperty, this.url) + "')";
            switch (this.fillMode) {
                case Enums.FillMode.Repeat:
                    element.renderedElement.style.backgroundRepeat = "repeat";
                    break;
                case Enums.FillMode.RepeatHorizontally:
                    element.renderedElement.style.backgroundRepeat = "repeat-x";
                    break;
                case Enums.FillMode.RepeatVertically:
                    element.renderedElement.style.backgroundRepeat = "repeat-y";
                    break;
                case Enums.FillMode.Cover:
                default:
                    element.renderedElement.style.backgroundRepeat = "no-repeat";
                    element.renderedElement.style.backgroundSize = "cover";
                    break;
            }
            switch (this.horizontalAlignment) {
                case Enums.HorizontalAlignment.Center:
                    element.renderedElement.style.backgroundPositionX = "center";
                    break;
                case Enums.HorizontalAlignment.Right:
                    element.renderedElement.style.backgroundPositionX = "right";
                    break;
            }
            switch (this.verticalAlignment) {
                case Enums.VerticalAlignment.Center:
                    element.renderedElement.style.backgroundPositionY = "center";
                    break;
                case Enums.VerticalAlignment.Bottom:
                    element.renderedElement.style.backgroundPositionY = "bottom";
                    break;
            }
        }
    };
    BackgroundImage.prototype.isValid = function () {
        return this.url ? true : false;
    };
    //#region Schema
    BackgroundImage.urlProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_0, "url");
    BackgroundImage.fillModeProperty = new serialization_1.EnumProperty(serialization_1.Versions.v1_2, "fillMode", Enums.FillMode, Enums.FillMode.Cover);
    BackgroundImage.horizontalAlignmentProperty = new serialization_1.EnumProperty(serialization_1.Versions.v1_2, "horizontalAlignment", Enums.HorizontalAlignment, Enums.HorizontalAlignment.Left);
    BackgroundImage.verticalAlignmentProperty = new serialization_1.EnumProperty(serialization_1.Versions.v1_2, "verticalAlignment", Enums.VerticalAlignment, Enums.VerticalAlignment.Top);
    __decorate([
        serialization_1.property(BackgroundImage.urlProperty)
    ], BackgroundImage.prototype, "url", void 0);
    __decorate([
        serialization_1.property(BackgroundImage.fillModeProperty)
    ], BackgroundImage.prototype, "fillMode", void 0);
    __decorate([
        serialization_1.property(BackgroundImage.horizontalAlignmentProperty)
    ], BackgroundImage.prototype, "horizontalAlignment", void 0);
    __decorate([
        serialization_1.property(BackgroundImage.verticalAlignmentProperty)
    ], BackgroundImage.prototype, "verticalAlignment", void 0);
    return BackgroundImage;
}(serialization_1.SerializableObject));
exports.BackgroundImage = BackgroundImage;
var Container = /** @class */ (function (_super) {
    __extends(Container, _super);
    function Container() {
        //#region Schema
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.verticalContentAlignment = Enums.VerticalAlignment.Top;
        //#endregion
        _this._items = [];
        _this._renderedItems = [];
        return _this;
    }
    Object.defineProperty(Container.prototype, "backgroundImage", {
        get: function () {
            return this.getValue(Container.backgroundImageProperty);
        },
        enumerable: true,
        configurable: true
    });
    Container.prototype.insertItemAt = function (item, index, forceInsert) {
        if (!item.parent || forceInsert) {
            if (item.isStandalone) {
                if (index < 0 || index >= this._items.length) {
                    this._items.push(item);
                }
                else {
                    this._items.splice(index, 0, item);
                }
                item.setParent(this);
            }
            else {
                throw new Error("Elements of type " + item.getJsonTypeName() + " cannot be used as standalone elements.");
            }
        }
        else {
            throw new Error("The element already belongs to another container.");
        }
    };
    Container.prototype.supportsExcplitiHeight = function () {
        return true;
    };
    Container.prototype.getItemsCollectionPropertyName = function () {
        return "items";
    };
    Container.prototype.applyBackground = function () {
        if (this.backgroundImage.isValid() && this.renderedElement) {
            this.backgroundImage.apply(this);
        }
        _super.prototype.applyBackground.call(this);
    };
    Container.prototype.internalRender = function () {
        this._renderedItems = [];
        // Cache hostConfig to avoid walking the parent hierarchy several times
        var hostConfig = this.hostConfig;
        var element = document.createElement("div");
        if (this.rtl !== undefined && this.rtl) {
            element.dir = "rtl";
        }
        element.classList.add(hostConfig.makeCssClassName("ac-container"));
        element.style.display = "flex";
        element.style.flexDirection = "column";
        if (shared_1.GlobalSettings.useAdvancedCardBottomTruncation) {
            // Forces the container to be at least as tall as its content.
            //
            // Fixes a quirk in Chrome where, for nested flex elements, the
            // inner element's height would never exceed the outer element's
            // height. This caused overflow truncation to break -- containers
            // would always be measured as not overflowing, since their heights
            // were constrained by their parents as opposed to truly reflecting
            // the height of their content.
            //
            // See the "Browser Rendering Notes" section of this answer:
            // https://stackoverflow.com/questions/36247140/why-doesnt-flex-item-shrink-past-content-size
            element.style.minHeight = '-webkit-min-content';
        }
        switch (this.verticalContentAlignment) {
            case Enums.VerticalAlignment.Center:
                element.style.justifyContent = "center";
                break;
            case Enums.VerticalAlignment.Bottom:
                element.style.justifyContent = "flex-end";
                break;
            default:
                element.style.justifyContent = "flex-start";
                break;
        }
        if (this._items.length > 0) {
            for (var _i = 0, _a = this._items; _i < _a.length; _i++) {
                var item = _a[_i];
                var renderedItem = this.isElementAllowed(item) ? item.render() : undefined;
                if (renderedItem) {
                    if (this._renderedItems.length > 0 && item.separatorElement) {
                        item.separatorElement.style.flex = "0 0 auto";
                        Utils.appendChild(element, item.separatorElement);
                    }
                    Utils.appendChild(element, renderedItem);
                    this._renderedItems.push(item);
                }
            }
        }
        else {
            if (this.isDesignMode()) {
                var placeholderElement = this.createPlaceholderElement();
                placeholderElement.style.width = "100%";
                placeholderElement.style.height = "100%";
                element.appendChild(placeholderElement);
            }
        }
        return element;
    };
    Container.prototype.truncateOverflow = function (maxHeight) {
        if (this.renderedElement) {
            // Add 1 to account for rounding differences between browsers
            var boundary_1 = this.renderedElement.offsetTop + maxHeight + 1;
            var handleElement_1 = function (cardElement) {
                var elt = cardElement.renderedElement;
                if (elt) {
                    switch (Utils.getFitStatus(elt, boundary_1)) {
                        case 0 /* FullyInContainer */:
                            var sizeChanged = cardElement['resetOverflow']();
                            // If the element's size changed after resetting content,
                            // we have to check if it still fits fully in the card
                            if (sizeChanged) {
                                handleElement_1(cardElement);
                            }
                            break;
                        case 1 /* Overflowing */:
                            var maxHeight_1 = boundary_1 - elt.offsetTop;
                            cardElement['handleOverflow'](maxHeight_1);
                            break;
                        case 2 /* FullyOutOfContainer */:
                            cardElement['handleOverflow'](0);
                            break;
                    }
                }
            };
            for (var _i = 0, _a = this._items; _i < _a.length; _i++) {
                var item = _a[_i];
                handleElement_1(item);
            }
            return true;
        }
        return false;
    };
    Container.prototype.undoOverflowTruncation = function () {
        for (var _i = 0, _a = this._items; _i < _a.length; _i++) {
            var item = _a[_i];
            item['resetOverflow']();
        }
    };
    Container.prototype.getHasBackground = function () {
        return this.backgroundImage.isValid() || _super.prototype.getHasBackground.call(this);
    };
    Container.prototype.internalParse = function (source, context) {
        _super.prototype.internalParse.call(this, source, context);
        this.clear();
        this.setShouldFallback(false);
        var jsonItems = source[this.getItemsCollectionPropertyName()];
        if (Array.isArray(jsonItems)) {
            for (var _i = 0, jsonItems_1 = jsonItems; _i < jsonItems_1.length; _i++) {
                var item = jsonItems_1[_i];
                var element = context.parseElement(this, item, !this.isDesignMode());
                if (element) {
                    this.insertItemAt(element, -1, true);
                }
            }
        }
    };
    Container.prototype.internalToJSON = function (target, context) {
        _super.prototype.internalToJSON.call(this, target, context);
        context.serializeArray(target, this.getItemsCollectionPropertyName(), this._items);
    };
    Object.defineProperty(Container.prototype, "isSelectable", {
        get: function () {
            return true;
        },
        enumerable: true,
        configurable: true
    });
    Container.prototype.getItemCount = function () {
        return this._items.length;
    };
    Container.prototype.getItemAt = function (index) {
        return this._items[index];
    };
    Container.prototype.getFirstVisibleRenderedItem = function () {
        if (this.renderedElement && this._renderedItems && this._renderedItems.length > 0) {
            for (var _i = 0, _a = this._renderedItems; _i < _a.length; _i++) {
                var item = _a[_i];
                if (item.isVisible) {
                    return item;
                }
            }
            ;
        }
        return undefined;
    };
    Container.prototype.getLastVisibleRenderedItem = function () {
        if (this.renderedElement && this._renderedItems && this._renderedItems.length > 0) {
            for (var i = this._renderedItems.length - 1; i >= 0; i--) {
                if (this._renderedItems[i].isVisible) {
                    return this._renderedItems[i];
                }
            }
        }
        return undefined;
    };
    Container.prototype.getJsonTypeName = function () {
        return "Container";
    };
    Container.prototype.isFirstElement = function (element) {
        var designMode = this.isDesignMode();
        for (var _i = 0, _a = this._items; _i < _a.length; _i++) {
            var item = _a[_i];
            if (item.isVisible || designMode) {
                return item == element;
            }
        }
        return false;
    };
    Container.prototype.isLastElement = function (element) {
        var designMode = this.isDesignMode();
        for (var i = this._items.length - 1; i >= 0; i--) {
            if (this._items[i].isVisible || designMode) {
                return this._items[i] == element;
            }
        }
        return false;
    };
    Container.prototype.isRtl = function () {
        if (this.rtl !== undefined) {
            return this.rtl;
        }
        else {
            var parentContainer = this.getParentContainer();
            return parentContainer ? parentContainer.isRtl() : false;
        }
    };
    Container.prototype.isBleedingAtTop = function () {
        var firstRenderedItem = this.getFirstVisibleRenderedItem();
        return this.isBleeding() || (firstRenderedItem ? firstRenderedItem.isBleedingAtTop() : false);
    };
    Container.prototype.isBleedingAtBottom = function () {
        var lastRenderedItem = this.getLastVisibleRenderedItem();
        return this.isBleeding() || (lastRenderedItem ? lastRenderedItem.isBleedingAtBottom() && lastRenderedItem.getEffectiveStyle() == this.getEffectiveStyle() : false);
    };
    Container.prototype.indexOf = function (cardElement) {
        return this._items.indexOf(cardElement);
    };
    Container.prototype.addItem = function (item) {
        this.insertItemAt(item, -1, false);
    };
    Container.prototype.insertItemBefore = function (item, insertBefore) {
        this.insertItemAt(item, this._items.indexOf(insertBefore), false);
    };
    Container.prototype.insertItemAfter = function (item, insertAfter) {
        this.insertItemAt(item, this._items.indexOf(insertAfter) + 1, false);
    };
    Container.prototype.removeItem = function (item) {
        var itemIndex = this._items.indexOf(item);
        if (itemIndex >= 0) {
            this._items.splice(itemIndex, 1);
            item.setParent(undefined);
            this.updateLayout();
            return true;
        }
        return false;
    };
    Container.prototype.clear = function () {
        this._items = [];
        this._renderedItems = [];
    };
    Container.prototype.getResourceInformation = function () {
        var result = _super.prototype.getResourceInformation.call(this);
        if (this.backgroundImage.isValid()) {
            result.push({
                url: this.backgroundImage.url,
                mimeType: "image"
            });
        }
        return result;
    };
    Container.prototype.getActionById = function (id) {
        var result = _super.prototype.getActionById.call(this, id);
        if (!result) {
            if (this.selectAction) {
                result = this.selectAction.getActionById(id);
            }
            if (!result) {
                for (var _i = 0, _a = this._items; _i < _a.length; _i++) {
                    var item = _a[_i];
                    result = item.getActionById(id);
                    if (result) {
                        break;
                    }
                }
            }
        }
        return result;
    };
    Object.defineProperty(Container.prototype, "padding", {
        get: function () {
            return this.getPadding();
        },
        set: function (value) {
            this.setPadding(value);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Container.prototype, "selectAction", {
        get: function () {
            return this._selectAction;
        },
        set: function (value) {
            this._selectAction = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Container.prototype, "bleed", {
        get: function () {
            return this.getBleed();
        },
        set: function (value) {
            this.setBleed(value);
        },
        enumerable: true,
        configurable: true
    });
    Container.backgroundImageProperty = new serialization_1.SerializableObjectProperty(serialization_1.Versions.v1_0, "backgroundImage", BackgroundImage);
    Container.verticalContentAlignmentProperty = new serialization_1.EnumProperty(serialization_1.Versions.v1_1, "verticalContentAlignment", Enums.VerticalAlignment, Enums.VerticalAlignment.Top);
    Container.rtlProperty = new serialization_1.BoolProperty(serialization_1.Versions.v1_0, "rtl");
    __decorate([
        serialization_1.property(Container.backgroundImageProperty)
    ], Container.prototype, "backgroundImage", null);
    __decorate([
        serialization_1.property(Container.verticalContentAlignmentProperty)
    ], Container.prototype, "verticalContentAlignment", void 0);
    __decorate([
        serialization_1.property(Container.rtlProperty)
    ], Container.prototype, "rtl", void 0);
    return Container;
}(StylableCardElementContainer));
exports.Container = Container;
var Column = /** @class */ (function (_super) {
    __extends(Column, _super);
    function Column(width) {
        if (width === void 0) { width = "stretch"; }
        var _this = _super.call(this) || this;
        _this.width = "stretch";
        //#endregion
        _this._computedWeight = 0;
        _this.width = width;
        return _this;
    }
    Column.prototype.adjustRenderedElementSize = function (renderedElement) {
        var minDesignTimeColumnHeight = 20;
        if (this.isDesignMode()) {
            renderedElement.style.minWidth = "20px";
            renderedElement.style.minHeight = (!this.minPixelHeight ? minDesignTimeColumnHeight : Math.max(this.minPixelHeight, minDesignTimeColumnHeight)) + "px";
        }
        else {
            renderedElement.style.minWidth = "0";
            if (this.minPixelHeight) {
                renderedElement.style.minHeight = this.minPixelHeight + "px";
            }
        }
        if (this.width === "auto") {
            renderedElement.style.flex = "0 1 auto";
        }
        else if (this.width === "stretch") {
            renderedElement.style.flex = "1 1 50px";
        }
        else if (this.width instanceof shared_1.SizeAndUnit) {
            if (this.width.unit == Enums.SizeUnit.Pixel) {
                renderedElement.style.flex = "0 0 auto";
                renderedElement.style.width = this.width.physicalSize + "px";
            }
            else {
                renderedElement.style.flex = "1 1 " + (this._computedWeight > 0 ? this._computedWeight : this.width.physicalSize) + "%";
            }
        }
    };
    Object.defineProperty(Column.prototype, "separatorOrientation", {
        get: function () {
            return Enums.Orientation.Vertical;
        },
        enumerable: true,
        configurable: true
    });
    Column.prototype.getJsonTypeName = function () {
        return "Column";
    };
    Object.defineProperty(Column.prototype, "hasVisibleSeparator", {
        get: function () {
            if (this.parent && this.parent instanceof ColumnSet) {
                return this.separatorElement !== undefined && !this.parent.isLeftMostElement(this);
            }
            else {
                return false;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Column.prototype, "isStandalone", {
        get: function () {
            return false;
        },
        enumerable: true,
        configurable: true
    });
    //#region Schema
    Column.widthProperty = new serialization_1.CustomProperty(serialization_1.Versions.v1_0, "width", function (sender, property, source, context) {
        var result = property.defaultValue;
        var value = source[property.name];
        var invalidWidth = false;
        if (typeof value === "number" && !isNaN(value)) {
            result = new shared_1.SizeAndUnit(value, Enums.SizeUnit.Weight);
        }
        else if (value === "auto" || value === "stretch") {
            result = value;
        }
        else if (typeof value === "string") {
            try {
                result = shared_1.SizeAndUnit.parse(value);
                if (result.unit === Enums.SizeUnit.Pixel && property.targetVersion.compareTo(context.targetVersion) > 0) {
                    invalidWidth = true;
                }
            }
            catch (e) {
                invalidWidth = true;
            }
        }
        else {
            invalidWidth = true;
        }
        if (invalidWidth) {
            context.logParseEvent(6 /* InvalidPropertyValue */, "Invalid column width:" + value + " - defaulting to \"auto\"", sender);
            result = "auto";
        }
        return result;
    }, function (sender, property, target, value, context) {
        if (value instanceof shared_1.SizeAndUnit) {
            if (value.unit === Enums.SizeUnit.Pixel) {
                context.serializeValue(target, "width", value.physicalSize + "px");
            }
            else {
                context.serializeNumber(target, "width", value.physicalSize);
            }
        }
        else {
            context.serializeValue(target, "width", value);
        }
    }, "stretch");
    __decorate([
        serialization_1.property(Column.widthProperty)
    ], Column.prototype, "width", void 0);
    return Column;
}(Container));
exports.Column = Column;
var ColumnSet = /** @class */ (function (_super) {
    __extends(ColumnSet, _super);
    function ColumnSet() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this._columns = [];
        return _this;
    }
    ColumnSet.prototype.createColumnInstance = function (source, context) {
        return context.parseCardObject(this, source, [], // Forbidden types not supported for elements for now
        !this.isDesignMode(), function (typeName) {
            return !typeName || typeName === "Column" ? new Column() : undefined;
        }, function (typeName, errorType) {
            return {
                error: 4 /* ElementTypeNotAllowed */,
                message: "Invalid element type " + typeName + ". Only Column elements are allowed in a ColumnSet."
            };
        });
    };
    ColumnSet.prototype.internalRender = function () {
        this._renderedColumns = [];
        if (this._columns.length > 0) {
            // Cache hostConfig to avoid walking the parent hierarchy several times
            var hostConfig = this.hostConfig;
            var element = document.createElement("div");
            element.className = hostConfig.makeCssClassName("ac-columnSet");
            element.style.display = "flex";
            if (shared_1.GlobalSettings.useAdvancedCardBottomTruncation) {
                // See comment in Container.internalRender()
                element.style.minHeight = '-webkit-min-content';
            }
            switch (this.horizontalAlignment) {
                case Enums.HorizontalAlignment.Center:
                    element.style.justifyContent = "center";
                    break;
                case Enums.HorizontalAlignment.Right:
                    element.style.justifyContent = "flex-end";
                    break;
                default:
                    element.style.justifyContent = "flex-start";
                    break;
            }
            var totalWeight = 0;
            for (var _i = 0, _a = this._columns; _i < _a.length; _i++) {
                var column = _a[_i];
                if (column.width instanceof shared_1.SizeAndUnit && (column.width.unit == Enums.SizeUnit.Weight)) {
                    totalWeight += column.width.physicalSize;
                }
            }
            for (var _b = 0, _c = this._columns; _b < _c.length; _b++) {
                var column = _c[_b];
                if (column.width instanceof shared_1.SizeAndUnit && column.width.unit == Enums.SizeUnit.Weight && totalWeight > 0) {
                    var computedWeight = 100 / totalWeight * column.width.physicalSize;
                    // Best way to emulate "internal" access I know of
                    column["_computedWeight"] = computedWeight;
                }
                var renderedColumn = column.render();
                if (renderedColumn) {
                    if (this._renderedColumns.length > 0 && column.separatorElement) {
                        column.separatorElement.style.flex = "0 0 auto";
                        Utils.appendChild(element, column.separatorElement);
                    }
                    Utils.appendChild(element, renderedColumn);
                    this._renderedColumns.push(column);
                }
            }
            return this._renderedColumns.length > 0 ? element : undefined;
        }
        else {
            return undefined;
        }
    };
    ColumnSet.prototype.truncateOverflow = function (maxHeight) {
        for (var _i = 0, _a = this._columns; _i < _a.length; _i++) {
            var column = _a[_i];
            column['handleOverflow'](maxHeight);
        }
        return true;
    };
    ColumnSet.prototype.undoOverflowTruncation = function () {
        for (var _i = 0, _a = this._columns; _i < _a.length; _i++) {
            var column = _a[_i];
            column['resetOverflow']();
        }
    };
    Object.defineProperty(ColumnSet.prototype, "isSelectable", {
        get: function () {
            return true;
        },
        enumerable: true,
        configurable: true
    });
    ColumnSet.prototype.internalParse = function (source, context) {
        _super.prototype.internalParse.call(this, source, context);
        this._columns = [];
        this._renderedColumns = [];
        var jsonColumns = source["columns"];
        if (Array.isArray(jsonColumns)) {
            for (var _i = 0, jsonColumns_1 = jsonColumns; _i < jsonColumns_1.length; _i++) {
                var item = jsonColumns_1[_i];
                var column = this.createColumnInstance(item, context);
                if (column) {
                    this._columns.push(column);
                }
            }
        }
    };
    ColumnSet.prototype.internalToJSON = function (target, context) {
        _super.prototype.internalToJSON.call(this, target, context);
        context.serializeArray(target, "columns", this._columns);
    };
    ColumnSet.prototype.isFirstElement = function (element) {
        for (var _i = 0, _a = this._columns; _i < _a.length; _i++) {
            var column = _a[_i];
            if (column.isVisible) {
                return column == element;
            }
        }
        return false;
    };
    ColumnSet.prototype.isBleedingAtTop = function () {
        if (this.isBleeding()) {
            return true;
        }
        if (this._renderedColumns && this._renderedColumns.length > 0) {
            for (var _i = 0, _a = this._columns; _i < _a.length; _i++) {
                var column = _a[_i];
                if (column.isBleedingAtTop()) {
                    return true;
                }
            }
        }
        return false;
    };
    ColumnSet.prototype.isBleedingAtBottom = function () {
        if (this.isBleeding()) {
            return true;
        }
        if (this._renderedColumns && this._renderedColumns.length > 0) {
            for (var _i = 0, _a = this._columns; _i < _a.length; _i++) {
                var column = _a[_i];
                if (column.isBleedingAtBottom()) {
                    return true;
                }
            }
        }
        return false;
    };
    ColumnSet.prototype.getItemCount = function () {
        return this._columns.length;
    };
    ColumnSet.prototype.getFirstVisibleRenderedItem = function () {
        if (this.renderedElement && this._renderedColumns && this._renderedColumns.length > 0) {
            return this._renderedColumns[0];
        }
        else {
            return undefined;
        }
    };
    ColumnSet.prototype.getLastVisibleRenderedItem = function () {
        if (this.renderedElement && this._renderedColumns && this._renderedColumns.length > 0) {
            return this._renderedColumns[this._renderedColumns.length - 1];
        }
        else {
            return undefined;
        }
    };
    ColumnSet.prototype.getColumnAt = function (index) {
        return this._columns[index];
    };
    ColumnSet.prototype.getItemAt = function (index) {
        return this.getColumnAt(index);
    };
    ColumnSet.prototype.getJsonTypeName = function () {
        return "ColumnSet";
    };
    ColumnSet.prototype.internalValidateProperties = function (context) {
        _super.prototype.internalValidateProperties.call(this, context);
        var weightedColumns = 0;
        var stretchedColumns = 0;
        for (var _i = 0, _a = this._columns; _i < _a.length; _i++) {
            var column = _a[_i];
            if (typeof column.width === "number") {
                weightedColumns++;
            }
            else if (column.width === "stretch") {
                stretchedColumns++;
            }
        }
        if (weightedColumns > 0 && stretchedColumns > 0) {
            context.addFailure(this, 0 /* Hint */, "It is not recommended to use weighted and stretched columns in the same ColumnSet, because in such a situation stretched columns will always get the minimum amount of space.");
        }
    };
    ColumnSet.prototype.addColumn = function (column) {
        if (!column.parent) {
            this._columns.push(column);
            column.setParent(this);
        }
        else {
            throw new Error("This column already belongs to another ColumnSet.");
        }
    };
    ColumnSet.prototype.removeItem = function (item) {
        if (item instanceof Column) {
            var itemIndex = this._columns.indexOf(item);
            if (itemIndex >= 0) {
                this._columns.splice(itemIndex, 1);
                item.setParent(undefined);
                this.updateLayout();
                return true;
            }
        }
        return false;
    };
    ColumnSet.prototype.indexOf = function (cardElement) {
        return cardElement instanceof Column ? this._columns.indexOf(cardElement) : -1;
    };
    ColumnSet.prototype.isLeftMostElement = function (element) {
        return this._columns.indexOf(element) == 0;
    };
    ColumnSet.prototype.isRightMostElement = function (element) {
        return this._columns.indexOf(element) == this._columns.length - 1;
    };
    ColumnSet.prototype.isTopElement = function (element) {
        return this._columns.indexOf(element) >= 0;
    };
    ColumnSet.prototype.isBottomElement = function (element) {
        return this._columns.indexOf(element) >= 0;
    };
    ColumnSet.prototype.getActionById = function (id) {
        var result = undefined;
        for (var _i = 0, _a = this._columns; _i < _a.length; _i++) {
            var column = _a[_i];
            result = column.getActionById(id);
            if (result) {
                break;
            }
        }
        return result;
    };
    Object.defineProperty(ColumnSet.prototype, "bleed", {
        get: function () {
            return this.getBleed();
        },
        set: function (value) {
            this.setBleed(value);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ColumnSet.prototype, "padding", {
        get: function () {
            return this.getPadding();
        },
        set: function (value) {
            this.setPadding(value);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ColumnSet.prototype, "selectAction", {
        get: function () {
            return this._selectAction;
        },
        set: function (value) {
            this._selectAction = value;
        },
        enumerable: true,
        configurable: true
    });
    return ColumnSet;
}(StylableCardElementContainer));
exports.ColumnSet = ColumnSet;
function raiseImageLoadedEvent(image) {
    var card = image.getRootElement();
    var onImageLoadedHandler = (card && card.onImageLoaded) ? card.onImageLoaded : AdaptiveCard.onImageLoaded;
    if (onImageLoadedHandler) {
        onImageLoadedHandler(image);
    }
}
function raiseAnchorClickedEvent(element, anchor) {
    var card = element.getRootElement();
    var onAnchorClickedHandler = (card && card.onAnchorClicked) ? card.onAnchorClicked : AdaptiveCard.onAnchorClicked;
    return onAnchorClickedHandler !== undefined ? onAnchorClickedHandler(element, anchor) : false;
}
function raiseExecuteActionEvent(action) {
    var card = action.parent ? action.parent.getRootElement() : undefined;
    var onExecuteActionHandler = (card && card.onExecuteAction) ? card.onExecuteAction : AdaptiveCard.onExecuteAction;
    if (action.prepareForExecution() && onExecuteActionHandler) {
        onExecuteActionHandler(action);
    }
}
function raiseInlineCardExpandedEvent(action, isExpanded) {
    var card = action.parent ? action.parent.getRootElement() : undefined;
    var onInlineCardExpandedHandler = (card && card.onInlineCardExpanded) ? card.onInlineCardExpanded : AdaptiveCard.onInlineCardExpanded;
    if (onInlineCardExpandedHandler) {
        onInlineCardExpandedHandler(action, isExpanded);
    }
}
function raiseInputValueChangedEvent(input) {
    var card = input.getRootElement();
    var onInputValueChangedHandler = (card && card.onInputValueChanged) ? card.onInputValueChanged : AdaptiveCard.onInputValueChanged;
    if (onInputValueChangedHandler) {
        onInputValueChangedHandler(input);
    }
}
function raiseElementVisibilityChangedEvent(element, shouldUpdateLayout) {
    if (shouldUpdateLayout === void 0) { shouldUpdateLayout = true; }
    var rootElement = element.getRootElement();
    if (shouldUpdateLayout) {
        rootElement.updateLayout();
    }
    var card = rootElement;
    var onElementVisibilityChangedHandler = (card && card.onElementVisibilityChanged) ? card.onElementVisibilityChanged : AdaptiveCard.onElementVisibilityChanged;
    if (onElementVisibilityChangedHandler !== undefined) {
        onElementVisibilityChangedHandler(element);
    }
}
var ContainerWithActions = /** @class */ (function (_super) {
    __extends(ContainerWithActions, _super);
    function ContainerWithActions() {
        var _this = _super.call(this) || this;
        _this._actionCollection = new ActionCollection(_this);
        return _this;
    }
    ContainerWithActions.prototype.internalParse = function (source, context) {
        _super.prototype.internalParse.call(this, source, context);
        this._actionCollection.parse(source["actions"], context);
    };
    ContainerWithActions.prototype.internalToJSON = function (target, context) {
        _super.prototype.internalToJSON.call(this, target, context);
        this._actionCollection.toJSON(target, "actions", context);
    };
    ContainerWithActions.prototype.internalRender = function () {
        var element = _super.prototype.internalRender.call(this);
        if (element) {
            var renderedActions = this._actionCollection.render(this.hostConfig.actions.actionsOrientation, false);
            if (renderedActions) {
                Utils.appendChild(element, Utils.renderSeparation(this.hostConfig, {
                    spacing: this.hostConfig.getEffectiveSpacing(this.hostConfig.actions.spacing)
                }, Enums.Orientation.Horizontal));
                Utils.appendChild(element, renderedActions);
            }
            if (this.renderIfEmpty) {
                return element;
            }
            else {
                return element.children.length > 0 ? element : undefined;
            }
        }
        else {
            return undefined;
        }
    };
    ContainerWithActions.prototype.getHasExpandedAction = function () {
        if (this.renderedActionCount == 0) {
            return false;
        }
        else if (this.renderedActionCount == 1) {
            return this._actionCollection.expandedAction !== undefined && !this.hostConfig.actions.preExpandSingleShowCardAction;
        }
        else {
            return this._actionCollection.expandedAction !== undefined;
        }
    };
    Object.defineProperty(ContainerWithActions.prototype, "renderedActionCount", {
        get: function () {
            return this._actionCollection.renderedActionCount;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ContainerWithActions.prototype, "renderIfEmpty", {
        get: function () {
            return false;
        },
        enumerable: true,
        configurable: true
    });
    ContainerWithActions.prototype.getActionCount = function () {
        return this._actionCollection.items.length;
    };
    ContainerWithActions.prototype.getActionAt = function (index) {
        if (index >= 0 && index < this.getActionCount()) {
            return this._actionCollection.items[index];
        }
        else {
            return _super.prototype.getActionAt.call(this, index);
        }
    };
    ContainerWithActions.prototype.getActionById = function (id) {
        var result = this._actionCollection.getActionById(id);
        return result ? result : _super.prototype.getActionById.call(this, id);
    };
    ContainerWithActions.prototype.internalValidateProperties = function (context) {
        _super.prototype.internalValidateProperties.call(this, context);
        if (this._actionCollection) {
            this._actionCollection.validateProperties(context);
        }
    };
    ContainerWithActions.prototype.isLastElement = function (element) {
        return _super.prototype.isLastElement.call(this, element) && this._actionCollection.items.length == 0;
    };
    ContainerWithActions.prototype.addAction = function (action) {
        this._actionCollection.addAction(action);
    };
    ContainerWithActions.prototype.clear = function () {
        _super.prototype.clear.call(this);
        this._actionCollection.clear();
    };
    ContainerWithActions.prototype.getAllInputs = function () {
        return _super.prototype.getAllInputs.call(this).concat(this._actionCollection.getAllInputs());
    };
    ContainerWithActions.prototype.getResourceInformation = function () {
        return _super.prototype.getResourceInformation.call(this).concat(this._actionCollection.getResourceInformation());
    };
    ContainerWithActions.prototype.isBleedingAtBottom = function () {
        if (this._actionCollection.renderedActionCount == 0) {
            return _super.prototype.isBleedingAtBottom.call(this);
        }
        else {
            if (this._actionCollection.items.length == 1) {
                return this._actionCollection.expandedAction !== undefined && !this.hostConfig.actions.preExpandSingleShowCardAction;
            }
            else {
                return this._actionCollection.expandedAction !== undefined;
            }
        }
    };
    Object.defineProperty(ContainerWithActions.prototype, "isStandalone", {
        get: function () {
            return false;
        },
        enumerable: true,
        configurable: true
    });
    return ContainerWithActions;
}(Container));
exports.ContainerWithActions = ContainerWithActions;
// @dynamic
var AdaptiveCard = /** @class */ (function (_super) {
    __extends(AdaptiveCard, _super);
    function AdaptiveCard() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.designMode = false;
        return _this;
    }
    Object.defineProperty(AdaptiveCard, "processMarkdown", {
        get: function () {
            throw new Error("The processMarkdown event has been removed. Please update your code and set onProcessMarkdown instead.");
        },
        set: function (value) {
            throw new Error("The processMarkdown event has been removed. Please update your code and set onProcessMarkdown instead.");
        },
        enumerable: true,
        configurable: true
    });
    AdaptiveCard.applyMarkdown = function (text) {
        var result = {
            didProcess: false
        };
        if (AdaptiveCard.onProcessMarkdown) {
            AdaptiveCard.onProcessMarkdown(text, result);
        }
        else if (window.markdownit) {
            // Check for markdownit
            var markdownIt = window.markdownit;
            result.outputHtml = markdownIt().render(text);
            result.didProcess = true;
        }
        else {
            console.warn("Markdown processing isn't enabled. Please see https://www.npmjs.com/package/adaptivecards#supporting-markdown");
        }
        return result;
    };
    AdaptiveCard.prototype.isVersionSupported = function () {
        if (this.bypassVersionCheck) {
            return true;
        }
        else {
            var unsupportedVersion = !this.version ||
                !this.version.isValid ||
                (this.maxVersion.major < this.version.major) ||
                (this.maxVersion.major == this.version.major && this.maxVersion.minor < this.version.minor);
            return !unsupportedVersion;
        }
    };
    AdaptiveCard.prototype.getItemsCollectionPropertyName = function () {
        return "body";
    };
    AdaptiveCard.prototype.internalParse = function (source, context) {
        this._fallbackCard = undefined;
        var fallbackElement = context.parseElement(undefined, source["fallback"], !this.isDesignMode());
        if (fallbackElement) {
            this._fallbackCard = new AdaptiveCard();
            this._fallbackCard.addItem(fallbackElement);
        }
        _super.prototype.internalParse.call(this, source, context);
    };
    AdaptiveCard.prototype.internalToJSON = function (target, context) {
        this.setValue(AdaptiveCard.versionProperty, context.targetVersion);
        _super.prototype.internalToJSON.call(this, target, context);
    };
    AdaptiveCard.prototype.internalRender = function () {
        var renderedElement = _super.prototype.internalRender.call(this);
        if (shared_1.GlobalSettings.useAdvancedCardBottomTruncation && renderedElement) {
            // Unlike containers, the root card element should be allowed to
            // be shorter than its content (otherwise the overflow truncation
            // logic would never get triggered)
            renderedElement.style.removeProperty("minHeight");
        }
        return renderedElement;
    };
    AdaptiveCard.prototype.getHasBackground = function () {
        return true;
    };
    AdaptiveCard.prototype.getDefaultPadding = function () {
        return new shared_1.PaddingDefinition(Enums.Spacing.Padding, Enums.Spacing.Padding, Enums.Spacing.Padding, Enums.Spacing.Padding);
    };
    Object.defineProperty(AdaptiveCard.prototype, "renderIfEmpty", {
        get: function () {
            return true;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(AdaptiveCard.prototype, "bypassVersionCheck", {
        get: function () {
            return false;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(AdaptiveCard.prototype, "allowCustomStyle", {
        get: function () {
            return this.hostConfig.adaptiveCard && this.hostConfig.adaptiveCard.allowCustomStyle;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(AdaptiveCard.prototype, "hasBackground", {
        get: function () {
            return true;
        },
        enumerable: true,
        configurable: true
    });
    AdaptiveCard.prototype.getJsonTypeName = function () {
        return "AdaptiveCard";
    };
    AdaptiveCard.prototype.internalValidateProperties = function (context) {
        _super.prototype.internalValidateProperties.call(this, context);
        if (this.getValue(CardElement.typeNameProperty) !== "AdaptiveCard") {
            context.addFailure(this, 7 /* MissingCardType */, "Invalid or missing card type. Make sure the card's type property is set to \"AdaptiveCard\".");
        }
        if (!this.bypassVersionCheck && !this.version) {
            context.addFailure(this, 8 /* PropertyCantBeNull */, "The version property must be specified.");
        }
        else if (!this.isVersionSupported()) {
            context.addFailure(this, 12 /* UnsupportedCardVersion */, "The specified card version (" + this.version.toString() + ") is not supported. The maximum supported card version is " + this.maxVersion.toString());
        }
    };
    AdaptiveCard.prototype.render = function (target) {
        var renderedCard;
        if (this.shouldFallback() && this._fallbackCard) {
            this._fallbackCard.hostConfig = this.hostConfig;
            renderedCard = this._fallbackCard.render();
        }
        else {
            renderedCard = _super.prototype.render.call(this);
            if (renderedCard) {
                renderedCard.classList.add(this.hostConfig.makeCssClassName("ac-adaptiveCard"));
                renderedCard.tabIndex = 0;
                if (this.speak) {
                    renderedCard.setAttribute("aria-label", this.speak);
                }
            }
        }
        if (target) {
            Utils.appendChild(target, renderedCard);
            this.updateLayout();
        }
        return renderedCard;
    };
    AdaptiveCard.prototype.updateLayout = function (processChildren) {
        if (processChildren === void 0) { processChildren = true; }
        _super.prototype.updateLayout.call(this, processChildren);
        if (shared_1.GlobalSettings.useAdvancedCardBottomTruncation && this.isDisplayed()) {
            var padding = this.hostConfig.getEffectiveSpacing(Enums.Spacing.Default);
            this['handleOverflow'](this.renderedElement.offsetHeight - padding);
        }
    };
    AdaptiveCard.prototype.shouldFallback = function () {
        return _super.prototype.shouldFallback.call(this) || !this.isVersionSupported();
    };
    Object.defineProperty(AdaptiveCard.prototype, "hasVisibleSeparator", {
        get: function () {
            return false;
        },
        enumerable: true,
        configurable: true
    });
    AdaptiveCard.schemaUrl = "http://adaptivecards.io/schemas/adaptive-card.json";
    //#region Schema
    AdaptiveCard.$schemaProperty = new serialization_1.CustomProperty(serialization_1.Versions.v1_0, "$schema", function (sender, property, source, context) {
        return AdaptiveCard.schemaUrl;
    }, function (sender, property, target, value, context) {
        context.serializeValue(target, property.name, AdaptiveCard.schemaUrl);
    });
    AdaptiveCard.versionProperty = new serialization_1.CustomProperty(serialization_1.Versions.v1_0, "version", function (sender, property, source, context) {
        var version = serialization_1.Version.parse(source[property.name], context);
        if (version === undefined) {
            version = serialization_1.Versions.latest;
            context.logParseEvent(6 /* InvalidPropertyValue */, "Invalid card version. Defaulting to latest version (" + version.toString() + ")");
        }
        return version;
    }, function (sender, property, target, value, context) {
        if (value !== undefined) {
            context.serializeValue(target, property.name, value.toString());
        }
    }, serialization_1.Versions.v1_0);
    AdaptiveCard.fallbackTextProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_0, "fallbackText");
    AdaptiveCard.speakProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_0, "speak");
    __decorate([
        serialization_1.property(AdaptiveCard.versionProperty)
    ], AdaptiveCard.prototype, "version", void 0);
    __decorate([
        serialization_1.property(AdaptiveCard.fallbackTextProperty)
    ], AdaptiveCard.prototype, "fallbackText", void 0);
    __decorate([
        serialization_1.property(AdaptiveCard.speakProperty)
    ], AdaptiveCard.prototype, "speak", void 0);
    return AdaptiveCard;
}(ContainerWithActions));
exports.AdaptiveCard = AdaptiveCard;
var InlineAdaptiveCard = /** @class */ (function (_super) {
    __extends(InlineAdaptiveCard, _super);
    function InlineAdaptiveCard() {
        //#region Schema
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.suppressStyle = false;
        return _this;
    }
    InlineAdaptiveCard.prototype.getSchemaKey = function () {
        return "InlineAdaptiveCard";
    };
    InlineAdaptiveCard.prototype.populateSchema = function (schema) {
        _super.prototype.populateSchema.call(this, schema);
        schema.remove(AdaptiveCard.$schemaProperty, AdaptiveCard.versionProperty);
    };
    //#endregion
    InlineAdaptiveCard.prototype.getDefaultPadding = function () {
        return new shared_1.PaddingDefinition(this.suppressStyle ? Enums.Spacing.None : Enums.Spacing.Padding, Enums.Spacing.Padding, this.suppressStyle ? Enums.Spacing.None : Enums.Spacing.Padding, Enums.Spacing.Padding);
    };
    Object.defineProperty(InlineAdaptiveCard.prototype, "bypassVersionCheck", {
        get: function () {
            return true;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(InlineAdaptiveCard.prototype, "defaultStyle", {
        get: function () {
            if (this.suppressStyle) {
                return Enums.ContainerStyle.Default;
            }
            else {
                return this.hostConfig.actions.showCard.style ? this.hostConfig.actions.showCard.style : Enums.ContainerStyle.Emphasis;
            }
        },
        enumerable: true,
        configurable: true
    });
    InlineAdaptiveCard.prototype.render = function (target) {
        var renderedCard = _super.prototype.render.call(this, target);
        if (renderedCard) {
            renderedCard.setAttribute("aria-live", "polite");
            renderedCard.removeAttribute("tabindex");
        }
        return renderedCard;
    };
    InlineAdaptiveCard.prototype.getForbiddenActionTypes = function () {
        return [ShowCardAction];
    };
    return InlineAdaptiveCard;
}(AdaptiveCard));
var GlobalRegistry = /** @class */ (function () {
    function GlobalRegistry() {
    }
    GlobalRegistry.populateWithDefaultElements = function (registry) {
        registry.clear();
        registry.register("Container", Container);
        registry.register("TextBlock", TextBlock);
        registry.register("RichTextBlock", RichTextBlock, serialization_1.Versions.v1_2);
        registry.register("TextRun", TextRun, serialization_1.Versions.v1_2);
        registry.register("Image", Image);
        registry.register("ImageSet", ImageSet);
        registry.register("Media", Media, serialization_1.Versions.v1_1);
        registry.register("FactSet", FactSet);
        registry.register("ColumnSet", ColumnSet);
        registry.register("ActionSet", ActionSet, serialization_1.Versions.v1_2);
        registry.register("Input.Text", TextInput);
        registry.register("Input.Date", DateInput);
        registry.register("Input.Time", TimeInput);
        registry.register("Input.Number", NumberInput);
        registry.register("Input.ChoiceSet", ChoiceSetInput);
        registry.register("Input.Toggle", ToggleInput);
    };
    GlobalRegistry.populateWithDefaultActions = function (registry) {
        registry.clear();
        registry.register(OpenUrlAction.JsonTypeName, OpenUrlAction);
        registry.register(SubmitAction.JsonTypeName, SubmitAction);
        registry.register(ShowCardAction.JsonTypeName, ShowCardAction);
        registry.register(ToggleVisibilityAction.JsonTypeName, ToggleVisibilityAction, serialization_1.Versions.v1_2);
    };
    GlobalRegistry.reset = function () {
        GlobalRegistry.populateWithDefaultElements(GlobalRegistry.elements);
        GlobalRegistry.populateWithDefaultActions(GlobalRegistry.actions);
    };
    GlobalRegistry.elements = new registry_1.CardObjectRegistry();
    GlobalRegistry.actions = new registry_1.CardObjectRegistry();
    return GlobalRegistry;
}());
exports.GlobalRegistry = GlobalRegistry;
GlobalRegistry.reset();
var SerializationContext = /** @class */ (function (_super) {
    __extends(SerializationContext, _super);
    function SerializationContext() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    SerializationContext.prototype.internalParseCardObject = function (parent, source, forbiddenTypeNames, allowFallback, createInstanceCallback, logParseEvent) {
        var result = undefined;
        if (source && typeof source === "object") {
            var tryToFallback = false;
            var typeName = Utils.parseString(source["type"]);
            if (typeName) {
                if (forbiddenTypeNames.indexOf(typeName) >= 0) {
                    logParseEvent(typeName, 1 /* ForbiddenType */);
                }
                else {
                    result = createInstanceCallback(typeName);
                    if (!result) {
                        tryToFallback = allowFallback;
                        logParseEvent(typeName, 0 /* UnknownType */);
                    }
                    else {
                        result.setParent(parent);
                        result.parse(source, this);
                        tryToFallback = result.shouldFallback() && allowFallback;
                    }
                    if (tryToFallback) {
                        var fallback = source["fallback"];
                        if (!fallback && parent) {
                            parent.setShouldFallback(true);
                        }
                        if (typeof fallback === "string" && fallback.toLowerCase() === "drop") {
                            result = undefined;
                        }
                        else if (typeof fallback === "object") {
                            result = this.internalParseCardObject(parent, fallback, forbiddenTypeNames, true, createInstanceCallback, logParseEvent);
                        }
                    }
                }
            }
        }
        return result;
    };
    SerializationContext.prototype.cardObjectParsed = function (o, source) {
        if (o instanceof Action && this.onParseAction) {
            this.onParseAction(o, source, this);
        }
        else if (o instanceof CardElement && this.onParseElement) {
            this.onParseElement(o, source, this);
        }
    };
    SerializationContext.prototype.shouldSerialize = function (o) {
        if (o instanceof Action) {
            return this.actionRegistry.findByName(o.getJsonTypeName()) !== undefined;
        }
        else if (o instanceof CardElement) {
            return this.elementRegistry.findByName(o.getJsonTypeName()) !== undefined;
        }
        else {
            return true;
        }
    };
    SerializationContext.prototype.parseCardObject = function (parent, source, forbiddenTypeNames, allowFallback, createInstanceCallback, logParseEvent) {
        var result = this.internalParseCardObject(parent, source, forbiddenTypeNames, allowFallback, createInstanceCallback, logParseEvent);
        if (result !== undefined) {
            this.cardObjectParsed(result, source);
        }
        return result;
    };
    SerializationContext.prototype.parseElement = function (parent, source, allowFallback) {
        var _this = this;
        return this.parseCardObject(parent, source, [], // Forbidden types not supported for elements for now
        allowFallback, function (typeName) {
            return _this.elementRegistry.createInstance(typeName, _this.targetVersion);
        }, function (typeName, errorType) {
            if (errorType === 0 /* UnknownType */) {
                _this.logParseEvent(11 /* UnknownElementType */, "Unknown element type: " + typeName + ". Fallback will be used if present.");
            }
            else {
                _this.logParseEvent(4 /* ElementTypeNotAllowed */, "Element type " + typeName + " is not allowed in this context.");
            }
        });
    };
    SerializationContext.prototype.parseAction = function (parent, source, forbiddenActionTypes, allowFallback) {
        var _this = this;
        return this.parseCardObject(parent, source, forbiddenActionTypes, allowFallback, function (typeName) {
            return _this.actionRegistry.createInstance(typeName, _this.targetVersion);
        }, function (typeName, errorType) {
            if (errorType == 0 /* UnknownType */) {
                return {
                    error: 10 /* UnknownActionType */,
                    message: "Unknown action type: " + typeName + ". Fallback will be used if present."
                };
            }
            else {
                return {
                    error: 1 /* ActionTypeNotAllowed */,
                    message: "Action type " + typeName + " is not allowed in this context."
                };
            }
        });
    };
    Object.defineProperty(SerializationContext.prototype, "elementRegistry", {
        get: function () {
            return this._elementRegistry ? this._elementRegistry : GlobalRegistry.elements;
        },
        enumerable: true,
        configurable: true
    });
    // Not using a property setter here because the setter should accept "undefined"
    // whereas the getter should never return undefined.
    SerializationContext.prototype.setElementRegistry = function (value) {
        this._elementRegistry = value;
    };
    Object.defineProperty(SerializationContext.prototype, "actionRegistry", {
        get: function () {
            return this._actionRegistry ? this._actionRegistry : GlobalRegistry.actions;
        },
        enumerable: true,
        configurable: true
    });
    // Not using a property setter here because the setter should accept "undefined"
    // whereas the getter should never return undefined.
    SerializationContext.prototype.setActionRegistry = function (value) {
        this._actionRegistry = value;
    };
    return SerializationContext;
}(serialization_1.BaseSerializationContext));
exports.SerializationContext = SerializationContext;
//# sourceMappingURL=card-elements.js.map

/***/ }),

/***/ "../adaptivecards/lib/card-object.js":
/*!*******************************************!*\
  !*** ../adaptivecards/lib/card-object.js ***!
  \*******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
var shared_1 = __webpack_require__(/*! ./shared */ "../adaptivecards/lib/shared.js");
var host_capabilities_1 = __webpack_require__(/*! ./host-capabilities */ "../adaptivecards/lib/host-capabilities.js");
var serialization_1 = __webpack_require__(/*! ./serialization */ "../adaptivecards/lib/serialization.js");
var ValidationResults = /** @class */ (function () {
    function ValidationResults() {
        this.allIds = {};
        this.validationEvents = [];
    }
    ValidationResults.prototype.addFailure = function (cardObject, event, message) {
        this.validationEvents.push({
            phase: 2 /* Validation */,
            source: cardObject,
            event: event,
            message: message
        });
    };
    return ValidationResults;
}());
exports.ValidationResults = ValidationResults;
var CardObject = /** @class */ (function (_super) {
    __extends(CardObject, _super);
    function CardObject() {
        //#region Schema
        var _this = _super !== null && _super.apply(this, arguments) || this;
        //#endregion
        _this._shouldFallback = false;
        return _this;
    }
    CardObject.prototype.getSchemaKey = function () {
        return this.getJsonTypeName();
    };
    Object.defineProperty(CardObject.prototype, "requires", {
        get: function () {
            return this.getValue(CardObject.requiresProperty);
        },
        enumerable: true,
        configurable: true
    });
    CardObject.prototype.preProcessPropertyValue = function (property, propertyValue) {
        var value = propertyValue === undefined ? this.getValue(property) : propertyValue;
        if (shared_1.GlobalSettings.allowPreProcessingPropertyValues) {
            var currentObject = this;
            while (currentObject && !currentObject.onPreProcessPropertyValue) {
                currentObject = currentObject.parent;
            }
            if (currentObject && currentObject.onPreProcessPropertyValue) {
                return currentObject.onPreProcessPropertyValue(this, property, value);
            }
        }
        return value;
    };
    CardObject.prototype.setParent = function (value) {
        this._parent = value;
    };
    CardObject.prototype.setShouldFallback = function (value) {
        this._shouldFallback = value;
    };
    CardObject.prototype.shouldFallback = function () {
        return this._shouldFallback || !this.requires.areAllMet(this.hostConfig.hostCapabilities);
    };
    CardObject.prototype.getRootObject = function () {
        var rootObject = this;
        while (rootObject.parent) {
            rootObject = rootObject.parent;
        }
        return rootObject;
    };
    CardObject.prototype.internalValidateProperties = function (context) {
        if (this.id) {
            if (context.allIds.hasOwnProperty(this.id)) {
                if (context.allIds[this.id] == 1) {
                    context.addFailure(this, 13 /* DuplicateId */, "Duplicate Id: " + this.id);
                }
                context.allIds[this.id] += 1;
            }
            else {
                context.allIds[this.id] = 1;
            }
        }
    };
    CardObject.prototype.validateProperties = function () {
        var result = new ValidationResults();
        this.internalValidateProperties(result);
        return result;
    };
    Object.defineProperty(CardObject.prototype, "parent", {
        get: function () {
            return this._parent;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CardObject.prototype, "renderedElement", {
        get: function () {
            return this._renderedElement;
        },
        enumerable: true,
        configurable: true
    });
    CardObject.typeNameProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_0, "type", undefined, undefined, undefined, function (sender) {
        return sender.getJsonTypeName();
    });
    CardObject.idProperty = new serialization_1.StringProperty(serialization_1.Versions.v1_0, "id");
    CardObject.requiresProperty = new serialization_1.SerializableObjectProperty(serialization_1.Versions.v1_2, "requires", host_capabilities_1.HostCapabilities);
    __decorate([
        serialization_1.property(CardObject.idProperty)
    ], CardObject.prototype, "id", void 0);
    __decorate([
        serialization_1.property(CardObject.requiresProperty)
    ], CardObject.prototype, "requires", null);
    return CardObject;
}(serialization_1.SerializableObject));
exports.CardObject = CardObject;
//# sourceMappingURL=card-object.js.map

/***/ }),

/***/ "../adaptivecards/lib/enums.js":
/*!*************************************!*\
  !*** ../adaptivecards/lib/enums.js ***!
  \*************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
Object.defineProperty(exports, "__esModule", { value: true });
// Note the "weird" way these readonly fields are declared is to work around
// a breaking change introduced in TS 3.1 wrt d.ts generation. DO NOT CHANGE
// and adopt this syntax for all other static readonly fields.
var ActionStyle = /** @class */ (function () {
    function ActionStyle() {
    }
    ActionStyle.Default = "default";
    ActionStyle.Positive = "positive";
    ActionStyle.Destructive = "destructive";
    return ActionStyle;
}());
exports.ActionStyle = ActionStyle;
var Size;
(function (Size) {
    Size[Size["Auto"] = 0] = "Auto";
    Size[Size["Stretch"] = 1] = "Stretch";
    Size[Size["Small"] = 2] = "Small";
    Size[Size["Medium"] = 3] = "Medium";
    Size[Size["Large"] = 4] = "Large";
})(Size = exports.Size || (exports.Size = {}));
var SizeUnit;
(function (SizeUnit) {
    SizeUnit[SizeUnit["Weight"] = 0] = "Weight";
    SizeUnit[SizeUnit["Pixel"] = 1] = "Pixel";
})(SizeUnit = exports.SizeUnit || (exports.SizeUnit = {}));
var TextSize;
(function (TextSize) {
    TextSize[TextSize["Small"] = 0] = "Small";
    TextSize[TextSize["Default"] = 1] = "Default";
    TextSize[TextSize["Medium"] = 2] = "Medium";
    TextSize[TextSize["Large"] = 3] = "Large";
    TextSize[TextSize["ExtraLarge"] = 4] = "ExtraLarge";
})(TextSize = exports.TextSize || (exports.TextSize = {}));
var TextWeight;
(function (TextWeight) {
    TextWeight[TextWeight["Lighter"] = 0] = "Lighter";
    TextWeight[TextWeight["Default"] = 1] = "Default";
    TextWeight[TextWeight["Bolder"] = 2] = "Bolder";
})(TextWeight = exports.TextWeight || (exports.TextWeight = {}));
var FontType;
(function (FontType) {
    FontType[FontType["Default"] = 0] = "Default";
    FontType[FontType["Monospace"] = 1] = "Monospace";
})(FontType = exports.FontType || (exports.FontType = {}));
var Spacing;
(function (Spacing) {
    Spacing[Spacing["None"] = 0] = "None";
    Spacing[Spacing["Small"] = 1] = "Small";
    Spacing[Spacing["Default"] = 2] = "Default";
    Spacing[Spacing["Medium"] = 3] = "Medium";
    Spacing[Spacing["Large"] = 4] = "Large";
    Spacing[Spacing["ExtraLarge"] = 5] = "ExtraLarge";
    Spacing[Spacing["Padding"] = 6] = "Padding";
})(Spacing = exports.Spacing || (exports.Spacing = {}));
var TextColor;
(function (TextColor) {
    TextColor[TextColor["Default"] = 0] = "Default";
    TextColor[TextColor["Dark"] = 1] = "Dark";
    TextColor[TextColor["Light"] = 2] = "Light";
    TextColor[TextColor["Accent"] = 3] = "Accent";
    TextColor[TextColor["Good"] = 4] = "Good";
    TextColor[TextColor["Warning"] = 5] = "Warning";
    TextColor[TextColor["Attention"] = 6] = "Attention";
})(TextColor = exports.TextColor || (exports.TextColor = {}));
var HorizontalAlignment;
(function (HorizontalAlignment) {
    HorizontalAlignment[HorizontalAlignment["Left"] = 0] = "Left";
    HorizontalAlignment[HorizontalAlignment["Center"] = 1] = "Center";
    HorizontalAlignment[HorizontalAlignment["Right"] = 2] = "Right";
})(HorizontalAlignment = exports.HorizontalAlignment || (exports.HorizontalAlignment = {}));
var VerticalAlignment;
(function (VerticalAlignment) {
    VerticalAlignment[VerticalAlignment["Top"] = 0] = "Top";
    VerticalAlignment[VerticalAlignment["Center"] = 1] = "Center";
    VerticalAlignment[VerticalAlignment["Bottom"] = 2] = "Bottom";
})(VerticalAlignment = exports.VerticalAlignment || (exports.VerticalAlignment = {}));
var ActionAlignment;
(function (ActionAlignment) {
    ActionAlignment[ActionAlignment["Left"] = 0] = "Left";
    ActionAlignment[ActionAlignment["Center"] = 1] = "Center";
    ActionAlignment[ActionAlignment["Right"] = 2] = "Right";
    ActionAlignment[ActionAlignment["Stretch"] = 3] = "Stretch";
})(ActionAlignment = exports.ActionAlignment || (exports.ActionAlignment = {}));
var ImageStyle;
(function (ImageStyle) {
    ImageStyle[ImageStyle["Default"] = 0] = "Default";
    ImageStyle[ImageStyle["Person"] = 1] = "Person";
})(ImageStyle = exports.ImageStyle || (exports.ImageStyle = {}));
var ShowCardActionMode;
(function (ShowCardActionMode) {
    ShowCardActionMode[ShowCardActionMode["Inline"] = 0] = "Inline";
    ShowCardActionMode[ShowCardActionMode["Popup"] = 1] = "Popup";
})(ShowCardActionMode = exports.ShowCardActionMode || (exports.ShowCardActionMode = {}));
var Orientation;
(function (Orientation) {
    Orientation[Orientation["Horizontal"] = 0] = "Horizontal";
    Orientation[Orientation["Vertical"] = 1] = "Vertical";
})(Orientation = exports.Orientation || (exports.Orientation = {}));
var FillMode;
(function (FillMode) {
    FillMode[FillMode["Cover"] = 0] = "Cover";
    FillMode[FillMode["RepeatHorizontally"] = 1] = "RepeatHorizontally";
    FillMode[FillMode["RepeatVertically"] = 2] = "RepeatVertically";
    FillMode[FillMode["Repeat"] = 3] = "Repeat";
})(FillMode = exports.FillMode || (exports.FillMode = {}));
var ActionIconPlacement;
(function (ActionIconPlacement) {
    ActionIconPlacement[ActionIconPlacement["LeftOfTitle"] = 0] = "LeftOfTitle";
    ActionIconPlacement[ActionIconPlacement["AboveTitle"] = 1] = "AboveTitle";
})(ActionIconPlacement = exports.ActionIconPlacement || (exports.ActionIconPlacement = {}));
var InputTextStyle;
(function (InputTextStyle) {
    InputTextStyle[InputTextStyle["Text"] = 0] = "Text";
    InputTextStyle[InputTextStyle["Tel"] = 1] = "Tel";
    InputTextStyle[InputTextStyle["Url"] = 2] = "Url";
    InputTextStyle[InputTextStyle["Email"] = 3] = "Email";
})(InputTextStyle = exports.InputTextStyle || (exports.InputTextStyle = {}));
var InputValidationNecessity;
(function (InputValidationNecessity) {
    InputValidationNecessity[InputValidationNecessity["Optional"] = 0] = "Optional";
    InputValidationNecessity[InputValidationNecessity["Required"] = 1] = "Required";
    InputValidationNecessity[InputValidationNecessity["RequiredWithVisualCue"] = 2] = "RequiredWithVisualCue";
})(InputValidationNecessity = exports.InputValidationNecessity || (exports.InputValidationNecessity = {}));
/*
    This should really be a string enum, e.g.

        export enum ContainerStyle {
            Default = "default",
            Emphasis = "emphasis"
        }

    However, some hosts do not use a version of TypeScript
    recent enough to understand string enums. This is
    a compatible construct that does not require using
    a more recent version of TypeScript.

    Also note the "weird" way these readonly fields are declared is to work around
    a breaking change introduced in TS 3.1 wrt d.ts generation. DO NOT CHANGE
    and adopt this syntax for all other static readonly fields.
*/
var ContainerStyle = /** @class */ (function () {
    function ContainerStyle() {
    }
    ContainerStyle.Default = "default";
    ContainerStyle.Emphasis = "emphasis";
    ContainerStyle.Accent = "accent";
    ContainerStyle.Good = "good";
    ContainerStyle.Attention = "attention";
    ContainerStyle.Warning = "warning";
    return ContainerStyle;
}());
exports.ContainerStyle = ContainerStyle;
//# sourceMappingURL=enums.js.map

/***/ }),

/***/ "../adaptivecards/lib/host-capabilities.js":
/*!*************************************************!*\
  !*** ../adaptivecards/lib/host-capabilities.js ***!
  \*************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
var serialization_1 = __webpack_require__(/*! ./serialization */ "../adaptivecards/lib/serialization.js");
var HostCapabilities = /** @class */ (function (_super) {
    __extends(HostCapabilities, _super);
    function HostCapabilities() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this._capabilities = {};
        return _this;
    }
    HostCapabilities.prototype.getSchemaKey = function () {
        return "HostCapabilities";
    };
    HostCapabilities.prototype.internalParse = function (source, context) {
        _super.prototype.internalParse.call(this, source, context);
        if (source) {
            for (var name_1 in source) {
                var jsonVersion = source[name_1];
                if (typeof jsonVersion === "string") {
                    if (jsonVersion == "*") {
                        this.addCapability(name_1, "*");
                    }
                    else {
                        var version = serialization_1.Version.parse(jsonVersion, context);
                        if (version && version.isValid) {
                            this.addCapability(name_1, version);
                        }
                    }
                }
            }
        }
    };
    HostCapabilities.prototype.internalToJSON = function (target, context) {
        _super.prototype.internalToJSON.call(this, target, context);
        for (var key in this._capabilities) {
            target[key] = this._capabilities[key];
        }
    };
    HostCapabilities.prototype.addCapability = function (name, version) {
        this._capabilities[name] = version;
    };
    HostCapabilities.prototype.removeCapability = function (name) {
        delete this._capabilities[name];
    };
    HostCapabilities.prototype.clear = function () {
        this._capabilities = {};
    };
    HostCapabilities.prototype.hasCapability = function (name, version) {
        if (this._capabilities.hasOwnProperty(name)) {
            if (version == "*" || this._capabilities[name] == "*") {
                return true;
            }
            return version.compareTo(this._capabilities[name]) <= 0;
        }
        return false;
    };
    HostCapabilities.prototype.areAllMet = function (hostCapabilities) {
        for (var capabilityName in this._capabilities) {
            if (!hostCapabilities.hasCapability(capabilityName, this._capabilities[capabilityName])) {
                return false;
            }
        }
        return true;
    };
    return HostCapabilities;
}(serialization_1.SerializableObject));
exports.HostCapabilities = HostCapabilities;
//# sourceMappingURL=host-capabilities.js.map

/***/ }),

/***/ "../adaptivecards/lib/host-config.js":
/*!*******************************************!*\
  !*** ../adaptivecards/lib/host-config.js ***!
  \*******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
var Enums = __webpack_require__(/*! ./enums */ "../adaptivecards/lib/enums.js");
var Utils = __webpack_require__(/*! ./utils */ "../adaptivecards/lib/utils.js");
var Shared = __webpack_require__(/*! ./shared */ "../adaptivecards/lib/shared.js");
var host_capabilities_1 = __webpack_require__(/*! ./host-capabilities */ "../adaptivecards/lib/host-capabilities.js");
function parseHostConfigEnum(targetEnum, value, defaultValue) {
    if (typeof value === "string") {
        var parsedValue = Utils.parseEnum(targetEnum, value, defaultValue);
        return parsedValue !== undefined ? parsedValue : defaultValue;
    }
    else if (typeof value === "number") {
        return value;
    }
    else {
        return defaultValue;
    }
}
var ColorDefinition = /** @class */ (function () {
    function ColorDefinition(defaultColor, subtleColor) {
        this.default = "#000000";
        this.subtle = "#666666";
        if (defaultColor) {
            this.default = defaultColor;
        }
        if (subtleColor) {
            this.subtle = subtleColor;
        }
    }
    ColorDefinition.prototype.parse = function (obj) {
        if (obj) {
            this.default = obj["default"] || this.default;
            this.subtle = obj["subtle"] || this.subtle;
        }
    };
    return ColorDefinition;
}());
exports.ColorDefinition = ColorDefinition;
var TextColorDefinition = /** @class */ (function (_super) {
    __extends(TextColorDefinition, _super);
    function TextColorDefinition() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.highlightColors = new ColorDefinition("#22000000", "#11000000");
        return _this;
    }
    TextColorDefinition.prototype.parse = function (obj) {
        _super.prototype.parse.call(this, obj);
        if (obj) {
            this.highlightColors.parse(obj["highlightColors"]);
        }
    };
    return TextColorDefinition;
}(ColorDefinition));
exports.TextColorDefinition = TextColorDefinition;
var AdaptiveCardConfig = /** @class */ (function () {
    function AdaptiveCardConfig(obj) {
        this.allowCustomStyle = false;
        if (obj) {
            this.allowCustomStyle = obj["allowCustomStyle"] || this.allowCustomStyle;
        }
    }
    return AdaptiveCardConfig;
}());
exports.AdaptiveCardConfig = AdaptiveCardConfig;
var ImageSetConfig = /** @class */ (function () {
    function ImageSetConfig(obj) {
        this.imageSize = Enums.Size.Medium;
        this.maxImageHeight = 100;
        if (obj) {
            this.imageSize = obj["imageSize"] != null ? obj["imageSize"] : this.imageSize;
            this.maxImageHeight = Utils.parseNumber(obj["maxImageHeight"], 100);
        }
    }
    ImageSetConfig.prototype.toJSON = function () {
        return {
            imageSize: Enums.Size[this.imageSize],
            maxImageHeight: this.maxImageHeight
        };
    };
    return ImageSetConfig;
}());
exports.ImageSetConfig = ImageSetConfig;
var MediaConfig = /** @class */ (function () {
    function MediaConfig(obj) {
        this.allowInlinePlayback = true;
        if (obj) {
            this.defaultPoster = obj["defaultPoster"];
            this.allowInlinePlayback = obj["allowInlinePlayback"] || this.allowInlinePlayback;
        }
    }
    MediaConfig.prototype.toJSON = function () {
        return {
            defaultPoster: this.defaultPoster,
            allowInlinePlayback: this.allowInlinePlayback
        };
    };
    return MediaConfig;
}());
exports.MediaConfig = MediaConfig;
var FactTextDefinition = /** @class */ (function () {
    function FactTextDefinition(obj) {
        this.size = Enums.TextSize.Default;
        this.color = Enums.TextColor.Default;
        this.isSubtle = false;
        this.weight = Enums.TextWeight.Default;
        this.wrap = true;
        if (obj) {
            this.size = parseHostConfigEnum(Enums.TextSize, obj["size"], Enums.TextSize.Default);
            this.color = parseHostConfigEnum(Enums.TextColor, obj["color"], Enums.TextColor.Default);
            this.isSubtle = obj["isSubtle"] || this.isSubtle;
            this.weight = parseHostConfigEnum(Enums.TextWeight, obj["weight"], this.getDefaultWeight());
            this.wrap = obj["wrap"] != null ? obj["wrap"] : this.wrap;
        }
    }
    ;
    FactTextDefinition.prototype.getDefaultWeight = function () {
        return Enums.TextWeight.Default;
    };
    FactTextDefinition.prototype.toJSON = function () {
        return {
            size: Enums.TextSize[this.size],
            color: Enums.TextColor[this.color],
            isSubtle: this.isSubtle,
            weight: Enums.TextWeight[this.weight],
            wrap: this.wrap
        };
    };
    return FactTextDefinition;
}());
exports.FactTextDefinition = FactTextDefinition;
var FactTitleDefinition = /** @class */ (function (_super) {
    __extends(FactTitleDefinition, _super);
    function FactTitleDefinition(obj) {
        var _this = _super.call(this, obj) || this;
        _this.maxWidth = 150;
        _this.weight = Enums.TextWeight.Bolder;
        if (obj) {
            _this.maxWidth = obj["maxWidth"] != null ? obj["maxWidth"] : _this.maxWidth;
            _this.weight = parseHostConfigEnum(Enums.TextWeight, obj["weight"], Enums.TextWeight.Bolder);
        }
        return _this;
    }
    FactTitleDefinition.prototype.getDefaultWeight = function () {
        return Enums.TextWeight.Bolder;
    };
    return FactTitleDefinition;
}(FactTextDefinition));
exports.FactTitleDefinition = FactTitleDefinition;
var FactSetConfig = /** @class */ (function () {
    function FactSetConfig(obj) {
        this.title = new FactTitleDefinition();
        this.value = new FactTextDefinition();
        this.spacing = 10;
        if (obj) {
            this.title = new FactTitleDefinition(obj["title"]);
            this.value = new FactTextDefinition(obj["value"]);
            this.spacing = obj.spacing && obj.spacing != null ? obj.spacing && obj.spacing : this.spacing;
        }
    }
    return FactSetConfig;
}());
exports.FactSetConfig = FactSetConfig;
var ShowCardActionConfig = /** @class */ (function () {
    function ShowCardActionConfig(obj) {
        this.actionMode = Enums.ShowCardActionMode.Inline;
        this.inlineTopMargin = 16;
        this.style = Enums.ContainerStyle.Emphasis;
        if (obj) {
            this.actionMode = parseHostConfigEnum(Enums.ShowCardActionMode, obj["actionMode"], Enums.ShowCardActionMode.Inline);
            this.inlineTopMargin = obj["inlineTopMargin"] != null ? obj["inlineTopMargin"] : this.inlineTopMargin;
            this.style = obj["style"] && typeof obj["style"] === "string" ? obj["style"] : Enums.ContainerStyle.Emphasis;
        }
    }
    ShowCardActionConfig.prototype.toJSON = function () {
        return {
            actionMode: Enums.ShowCardActionMode[this.actionMode],
            inlineTopMargin: this.inlineTopMargin,
            style: this.style
        };
    };
    return ShowCardActionConfig;
}());
exports.ShowCardActionConfig = ShowCardActionConfig;
var ActionsConfig = /** @class */ (function () {
    function ActionsConfig(obj) {
        this.maxActions = 5;
        this.spacing = Enums.Spacing.Default;
        this.buttonSpacing = 20;
        this.showCard = new ShowCardActionConfig();
        this.preExpandSingleShowCardAction = false;
        this.actionsOrientation = Enums.Orientation.Horizontal;
        this.actionAlignment = Enums.ActionAlignment.Left;
        this.iconPlacement = Enums.ActionIconPlacement.LeftOfTitle;
        this.allowTitleToWrap = false;
        this.iconSize = 16;
        if (obj) {
            this.maxActions = obj["maxActions"] != null ? obj["maxActions"] : this.maxActions;
            this.spacing = parseHostConfigEnum(Enums.Spacing, obj.spacing && obj.spacing, Enums.Spacing.Default);
            this.buttonSpacing = obj["buttonSpacing"] != null ? obj["buttonSpacing"] : this.buttonSpacing;
            this.showCard = new ShowCardActionConfig(obj["showCard"]);
            this.preExpandSingleShowCardAction = Utils.parseBool(obj["preExpandSingleShowCardAction"], false);
            this.actionsOrientation = parseHostConfigEnum(Enums.Orientation, obj["actionsOrientation"], Enums.Orientation.Horizontal);
            this.actionAlignment = parseHostConfigEnum(Enums.ActionAlignment, obj["actionAlignment"], Enums.ActionAlignment.Left);
            this.iconPlacement = parseHostConfigEnum(Enums.ActionIconPlacement, obj["iconPlacement"], Enums.ActionIconPlacement.LeftOfTitle);
            this.allowTitleToWrap = obj["allowTitleToWrap"] != null ? obj["allowTitleToWrap"] : this.allowTitleToWrap;
            try {
                var sizeAndUnit = Shared.SizeAndUnit.parse(obj["iconSize"]);
                if (sizeAndUnit.unit == Enums.SizeUnit.Pixel) {
                    this.iconSize = sizeAndUnit.physicalSize;
                }
            }
            catch (e) {
                // Swallow this, keep default icon size
            }
        }
    }
    ActionsConfig.prototype.toJSON = function () {
        return {
            maxActions: this.maxActions,
            spacing: Enums.Spacing[this.spacing],
            buttonSpacing: this.buttonSpacing,
            showCard: this.showCard,
            preExpandSingleShowCardAction: this.preExpandSingleShowCardAction,
            actionsOrientation: Enums.Orientation[this.actionsOrientation],
            actionAlignment: Enums.ActionAlignment[this.actionAlignment]
        };
    };
    return ActionsConfig;
}());
exports.ActionsConfig = ActionsConfig;
var ColorSetDefinition = /** @class */ (function () {
    function ColorSetDefinition(obj) {
        this.default = new TextColorDefinition();
        this.dark = new TextColorDefinition();
        this.light = new TextColorDefinition();
        this.accent = new TextColorDefinition();
        this.good = new TextColorDefinition();
        this.warning = new TextColorDefinition();
        this.attention = new TextColorDefinition();
        this.parse(obj);
    }
    ColorSetDefinition.prototype.parseSingleColor = function (obj, propertyName) {
        if (obj) {
            this[propertyName].parse(obj[propertyName]);
        }
    };
    ColorSetDefinition.prototype.parse = function (obj) {
        if (obj) {
            this.parseSingleColor(obj, "default");
            this.parseSingleColor(obj, "dark");
            this.parseSingleColor(obj, "light");
            this.parseSingleColor(obj, "accent");
            this.parseSingleColor(obj, "good");
            this.parseSingleColor(obj, "warning");
            this.parseSingleColor(obj, "attention");
        }
    };
    return ColorSetDefinition;
}());
exports.ColorSetDefinition = ColorSetDefinition;
var ContainerStyleDefinition = /** @class */ (function () {
    function ContainerStyleDefinition(obj) {
        this.foregroundColors = new ColorSetDefinition({
            "default": { default: "#333333", subtle: "#EE333333" },
            "dark": { default: "#000000", subtle: "#66000000" },
            "light": { default: "#FFFFFF", subtle: "#33000000" },
            "accent": { default: "#2E89FC", subtle: "#882E89FC" },
            "good": { default: "#54A254", subtle: "#DD54A254" },
            "warning": { default: "#E69500", subtle: "#DDE69500" },
            "attention": { default: "#CC3300", subtle: "#DDCC3300" }
        });
        this.parse(obj);
    }
    ContainerStyleDefinition.prototype.parse = function (obj) {
        if (obj) {
            this.backgroundColor = obj["backgroundColor"];
            this.foregroundColors.parse(obj["foregroundColors"]);
            this.highlightBackgroundColor = obj["highlightBackgroundColor"];
            this.highlightForegroundColor = obj["highlightForegroundColor"];
        }
    };
    Object.defineProperty(ContainerStyleDefinition.prototype, "isBuiltIn", {
        get: function () {
            return false;
        },
        enumerable: true,
        configurable: true
    });
    return ContainerStyleDefinition;
}());
exports.ContainerStyleDefinition = ContainerStyleDefinition;
var BuiltInContainerStyleDefinition = /** @class */ (function (_super) {
    __extends(BuiltInContainerStyleDefinition, _super);
    function BuiltInContainerStyleDefinition() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Object.defineProperty(BuiltInContainerStyleDefinition.prototype, "isBuiltIn", {
        get: function () {
            return true;
        },
        enumerable: true,
        configurable: true
    });
    return BuiltInContainerStyleDefinition;
}(ContainerStyleDefinition));
var ContainerStyleSet = /** @class */ (function () {
    function ContainerStyleSet(obj) {
        this._allStyles = {};
        this._allStyles[Enums.ContainerStyle.Default] = new BuiltInContainerStyleDefinition();
        this._allStyles[Enums.ContainerStyle.Emphasis] = new BuiltInContainerStyleDefinition();
        this._allStyles[Enums.ContainerStyle.Accent] = new BuiltInContainerStyleDefinition();
        this._allStyles[Enums.ContainerStyle.Good] = new BuiltInContainerStyleDefinition();
        this._allStyles[Enums.ContainerStyle.Attention] = new BuiltInContainerStyleDefinition();
        this._allStyles[Enums.ContainerStyle.Warning] = new BuiltInContainerStyleDefinition();
        if (obj) {
            this._allStyles[Enums.ContainerStyle.Default].parse(obj[Enums.ContainerStyle.Default]);
            this._allStyles[Enums.ContainerStyle.Emphasis].parse(obj[Enums.ContainerStyle.Emphasis]);
            this._allStyles[Enums.ContainerStyle.Accent].parse(obj[Enums.ContainerStyle.Accent]);
            this._allStyles[Enums.ContainerStyle.Good].parse(obj[Enums.ContainerStyle.Good]);
            this._allStyles[Enums.ContainerStyle.Attention].parse(obj[Enums.ContainerStyle.Attention]);
            this._allStyles[Enums.ContainerStyle.Warning].parse(obj[Enums.ContainerStyle.Warning]);
            var customStyleArray = obj["customStyles"];
            if (customStyleArray && Array.isArray(customStyleArray)) {
                for (var _i = 0, customStyleArray_1 = customStyleArray; _i < customStyleArray_1.length; _i++) {
                    var customStyle = customStyleArray_1[_i];
                    if (customStyle) {
                        var styleName = customStyle["name"];
                        if (styleName && typeof styleName === "string") {
                            if (this._allStyles.hasOwnProperty(styleName)) {
                                this._allStyles[styleName].parse(customStyle["style"]);
                            }
                            else {
                                this._allStyles[styleName] = new ContainerStyleDefinition(customStyle["style"]);
                            }
                        }
                    }
                }
            }
        }
    }
    ContainerStyleSet.prototype.toJSON = function () {
        var _this = this;
        var customStyleArray = [];
        Object.keys(this._allStyles).forEach(function (key) {
            if (!_this._allStyles[key].isBuiltIn) {
                customStyleArray.push({
                    name: key,
                    style: _this._allStyles[key]
                });
            }
        });
        var result = {
            default: this.default,
            emphasis: this.emphasis
        };
        if (customStyleArray.length > 0) {
            result.customStyles = customStyleArray;
        }
        return result;
    };
    ContainerStyleSet.prototype.getStyleByName = function (name, defaultValue) {
        if (name && this._allStyles.hasOwnProperty(name)) {
            return this._allStyles[name];
        }
        else {
            return defaultValue ? defaultValue : this._allStyles[Enums.ContainerStyle.Default];
        }
    };
    Object.defineProperty(ContainerStyleSet.prototype, "default", {
        get: function () {
            return this._allStyles[Enums.ContainerStyle.Default];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ContainerStyleSet.prototype, "emphasis", {
        get: function () {
            return this._allStyles[Enums.ContainerStyle.Emphasis];
        },
        enumerable: true,
        configurable: true
    });
    return ContainerStyleSet;
}());
exports.ContainerStyleSet = ContainerStyleSet;
var FontTypeDefinition = /** @class */ (function () {
    function FontTypeDefinition(fontFamily) {
        this.fontFamily = "Segoe UI,Segoe,Segoe WP,Helvetica Neue,Helvetica,sans-serif";
        this.fontSizes = {
            small: 12,
            default: 14,
            medium: 17,
            large: 21,
            extraLarge: 26
        };
        this.fontWeights = {
            lighter: 200,
            default: 400,
            bolder: 600
        };
        if (fontFamily) {
            this.fontFamily = fontFamily;
        }
    }
    FontTypeDefinition.prototype.parse = function (obj) {
        this.fontFamily = obj["fontFamily"] || this.fontFamily;
        this.fontSizes = {
            small: obj.fontSizes && obj.fontSizes["small"] || this.fontSizes.small,
            default: obj.fontSizes && obj.fontSizes["default"] || this.fontSizes.default,
            medium: obj.fontSizes && obj.fontSizes["medium"] || this.fontSizes.medium,
            large: obj.fontSizes && obj.fontSizes["large"] || this.fontSizes.large,
            extraLarge: obj.fontSizes && obj.fontSizes["extraLarge"] || this.fontSizes.extraLarge
        };
        this.fontWeights = {
            lighter: obj.fontWeights && obj.fontWeights["lighter"] || this.fontWeights.lighter,
            default: obj.fontWeights && obj.fontWeights["default"] || this.fontWeights.default,
            bolder: obj.fontWeights && obj.fontWeights["bolder"] || this.fontWeights.bolder
        };
    };
    FontTypeDefinition.monospace = new FontTypeDefinition("'Courier New', Courier, monospace");
    return FontTypeDefinition;
}());
exports.FontTypeDefinition = FontTypeDefinition;
var FontTypeSet = /** @class */ (function () {
    function FontTypeSet(obj) {
        this.default = new FontTypeDefinition();
        this.monospace = new FontTypeDefinition("'Courier New', Courier, monospace");
        if (obj) {
            this.default.parse(obj["default"]);
            this.monospace.parse(obj["monospace"]);
        }
    }
    FontTypeSet.prototype.getStyleDefinition = function (style) {
        switch (style) {
            case Enums.FontType.Monospace:
                return this.monospace;
            case Enums.FontType.Default:
            default:
                return this.default;
        }
    };
    return FontTypeSet;
}());
exports.FontTypeSet = FontTypeSet;
var HostConfig = /** @class */ (function () {
    function HostConfig(obj) {
        this.hostCapabilities = new host_capabilities_1.HostCapabilities();
        this.choiceSetInputValueSeparator = ",";
        this.supportsInteractivity = true;
        this.spacing = {
            small: 3,
            default: 8,
            medium: 20,
            large: 30,
            extraLarge: 40,
            padding: 15
        };
        this.separator = {
            lineThickness: 1,
            lineColor: "#EEEEEE"
        };
        this.imageSizes = {
            small: 40,
            medium: 80,
            large: 160
        };
        this.containerStyles = new ContainerStyleSet();
        this.actions = new ActionsConfig();
        this.adaptiveCard = new AdaptiveCardConfig();
        this.imageSet = new ImageSetConfig();
        this.media = new MediaConfig();
        this.factSet = new FactSetConfig();
        this.alwaysAllowBleed = false;
        if (obj) {
            if (typeof obj === "string" || obj instanceof String) {
                obj = JSON.parse(obj);
            }
            this.choiceSetInputValueSeparator = (obj && typeof obj["choiceSetInputValueSeparator"] === "string") ? obj["choiceSetInputValueSeparator"] : this.choiceSetInputValueSeparator;
            this.supportsInteractivity = (obj && typeof obj["supportsInteractivity"] === "boolean") ? obj["supportsInteractivity"] : this.supportsInteractivity;
            this._legacyFontType = new FontTypeDefinition();
            this._legacyFontType.parse(obj);
            if (obj.fontTypes) {
                this.fontTypes = new FontTypeSet(obj.fontTypes);
            }
            if (obj.lineHeights) {
                this.lineHeights = {
                    small: obj.lineHeights["small"],
                    default: obj.lineHeights["default"],
                    medium: obj.lineHeights["medium"],
                    large: obj.lineHeights["large"],
                    extraLarge: obj.lineHeights["extraLarge"]
                };
            }
            ;
            this.imageSizes = {
                small: obj.imageSizes && obj.imageSizes["small"] || this.imageSizes.small,
                medium: obj.imageSizes && obj.imageSizes["medium"] || this.imageSizes.medium,
                large: obj.imageSizes && obj.imageSizes["large"] || this.imageSizes.large,
            };
            this.containerStyles = new ContainerStyleSet(obj["containerStyles"]);
            this.spacing = {
                small: obj.spacing && obj.spacing["small"] || this.spacing.small,
                default: obj.spacing && obj.spacing["default"] || this.spacing.default,
                medium: obj.spacing && obj.spacing["medium"] || this.spacing.medium,
                large: obj.spacing && obj.spacing["large"] || this.spacing.large,
                extraLarge: obj.spacing && obj.spacing["extraLarge"] || this.spacing.extraLarge,
                padding: obj.spacing && obj.spacing["padding"] || this.spacing.padding
            };
            this.separator = {
                lineThickness: obj.separator && obj.separator["lineThickness"] || this.separator.lineThickness,
                lineColor: obj.separator && obj.separator["lineColor"] || this.separator.lineColor
            };
            this.actions = new ActionsConfig(obj.actions || this.actions);
            this.adaptiveCard = new AdaptiveCardConfig(obj.adaptiveCard || this.adaptiveCard);
            this.imageSet = new ImageSetConfig(obj["imageSet"]);
            this.factSet = new FactSetConfig(obj["factSet"]);
        }
    }
    HostConfig.prototype.getFontTypeDefinition = function (style) {
        if (this.fontTypes) {
            return this.fontTypes.getStyleDefinition(style);
        }
        else {
            return style == Enums.FontType.Monospace ? FontTypeDefinition.monospace : this._legacyFontType;
        }
    };
    HostConfig.prototype.getEffectiveSpacing = function (spacing) {
        switch (spacing) {
            case Enums.Spacing.Small:
                return this.spacing.small;
            case Enums.Spacing.Default:
                return this.spacing.default;
            case Enums.Spacing.Medium:
                return this.spacing.medium;
            case Enums.Spacing.Large:
                return this.spacing.large;
            case Enums.Spacing.ExtraLarge:
                return this.spacing.extraLarge;
            case Enums.Spacing.Padding:
                return this.spacing.padding;
            default:
                return 0;
        }
    };
    HostConfig.prototype.paddingDefinitionToSpacingDefinition = function (paddingDefinition) {
        return new Shared.SpacingDefinition(this.getEffectiveSpacing(paddingDefinition.top), this.getEffectiveSpacing(paddingDefinition.right), this.getEffectiveSpacing(paddingDefinition.bottom), this.getEffectiveSpacing(paddingDefinition.left));
    };
    HostConfig.prototype.makeCssClassNames = function () {
        var classNames = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            classNames[_i] = arguments[_i];
        }
        var result = [];
        for (var _a = 0, classNames_1 = classNames; _a < classNames_1.length; _a++) {
            var className = classNames_1[_a];
            result.push((this.cssClassNamePrefix ? this.cssClassNamePrefix + "-" : "") + className);
        }
        return result;
    };
    HostConfig.prototype.makeCssClassName = function () {
        var classNames = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            classNames[_i] = arguments[_i];
        }
        var result = this.makeCssClassNames.apply(this, classNames).join(" ");
        return result ? result : "";
    };
    Object.defineProperty(HostConfig.prototype, "fontFamily", {
        get: function () {
            return this._legacyFontType.fontFamily;
        },
        set: function (value) {
            this._legacyFontType.fontFamily = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(HostConfig.prototype, "fontSizes", {
        get: function () {
            return this._legacyFontType.fontSizes;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(HostConfig.prototype, "fontWeights", {
        get: function () {
            return this._legacyFontType.fontWeights;
        },
        enumerable: true,
        configurable: true
    });
    return HostConfig;
}());
exports.HostConfig = HostConfig;
exports.defaultHostConfig = new HostConfig({
    supportsInteractivity: true,
    spacing: {
        small: 10,
        default: 20,
        medium: 30,
        large: 40,
        extraLarge: 50,
        padding: 20
    },
    separator: {
        lineThickness: 1,
        lineColor: "#EEEEEE"
    },
    fontTypes: {
        default: {
            fontFamily: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",
            fontSizes: {
                small: 12,
                default: 14,
                medium: 17,
                large: 21,
                extraLarge: 26
            },
            fontWeights: {
                lighter: 200,
                default: 400,
                bolder: 600
            }
        },
        monospace: {
            fontFamily: "'Courier New', Courier, monospace",
            fontSizes: {
                small: 12,
                default: 14,
                medium: 17,
                large: 21,
                extraLarge: 26
            },
            fontWeights: {
                lighter: 200,
                default: 400,
                bolder: 600
            }
        }
    },
    imageSizes: {
        small: 40,
        medium: 80,
        large: 160
    },
    containerStyles: {
        default: {
            backgroundColor: "#FFFFFF",
            foregroundColors: {
                default: {
                    default: "#333333",
                    subtle: "#EE333333"
                },
                dark: {
                    default: "#000000",
                    subtle: "#66000000"
                },
                light: {
                    default: "#FFFFFF",
                    subtle: "#33000000"
                },
                accent: {
                    default: "#2E89FC",
                    subtle: "#882E89FC"
                },
                attention: {
                    default: "#cc3300",
                    subtle: "#DDcc3300"
                },
                good: {
                    default: "#54a254",
                    subtle: "#DD54a254"
                },
                warning: {
                    default: "#e69500",
                    subtle: "#DDe69500"
                }
            }
        },
        emphasis: {
            backgroundColor: "#08000000",
            foregroundColors: {
                default: {
                    default: "#333333",
                    subtle: "#EE333333"
                },
                dark: {
                    default: "#000000",
                    subtle: "#66000000"
                },
                light: {
                    default: "#FFFFFF",
                    subtle: "#33000000"
                },
                accent: {
                    default: "#2E89FC",
                    subtle: "#882E89FC"
                },
                attention: {
                    default: "#cc3300",
                    subtle: "#DDcc3300"
                },
                good: {
                    default: "#54a254",
                    subtle: "#DD54a254"
                },
                warning: {
                    default: "#e69500",
                    subtle: "#DDe69500"
                }
            }
        },
        accent: {
            backgroundColor: "#C7DEF9",
            foregroundColors: {
                default: {
                    default: "#333333",
                    subtle: "#EE333333"
                },
                dark: {
                    default: "#000000",
                    subtle: "#66000000"
                },
                light: {
                    default: "#FFFFFF",
                    subtle: "#33000000"
                },
                accent: {
                    default: "#2E89FC",
                    subtle: "#882E89FC"
                },
                attention: {
                    default: "#cc3300",
                    subtle: "#DDcc3300"
                },
                good: {
                    default: "#54a254",
                    subtle: "#DD54a254"
                },
                warning: {
                    default: "#e69500",
                    subtle: "#DDe69500"
                }
            }
        },
        good: {
            backgroundColor: "#CCFFCC",
            foregroundColors: {
                default: {
                    default: "#333333",
                    subtle: "#EE333333"
                },
                dark: {
                    default: "#000000",
                    subtle: "#66000000"
                },
                light: {
                    default: "#FFFFFF",
                    subtle: "#33000000"
                },
                accent: {
                    default: "#2E89FC",
                    subtle: "#882E89FC"
                },
                attention: {
                    default: "#cc3300",
                    subtle: "#DDcc3300"
                },
                good: {
                    default: "#54a254",
                    subtle: "#DD54a254"
                },
                warning: {
                    default: "#e69500",
                    subtle: "#DDe69500"
                }
            }
        },
        attention: {
            backgroundColor: "#FFC5B2",
            foregroundColors: {
                default: {
                    default: "#333333",
                    subtle: "#EE333333"
                },
                dark: {
                    default: "#000000",
                    subtle: "#66000000"
                },
                light: {
                    default: "#FFFFFF",
                    subtle: "#33000000"
                },
                accent: {
                    default: "#2E89FC",
                    subtle: "#882E89FC"
                },
                attention: {
                    default: "#cc3300",
                    subtle: "#DDcc3300"
                },
                good: {
                    default: "#54a254",
                    subtle: "#DD54a254"
                },
                warning: {
                    default: "#e69500",
                    subtle: "#DDe69500"
                }
            }
        },
        warning: {
            backgroundColor: "#FFE2B2",
            foregroundColors: {
                default: {
                    default: "#333333",
                    subtle: "#EE333333"
                },
                dark: {
                    default: "#000000",
                    subtle: "#66000000"
                },
                light: {
                    default: "#FFFFFF",
                    subtle: "#33000000"
                },
                accent: {
                    default: "#2E89FC",
                    subtle: "#882E89FC"
                },
                attention: {
                    default: "#cc3300",
                    subtle: "#DDcc3300"
                },
                good: {
                    default: "#54a254",
                    subtle: "#DD54a254"
                },
                warning: {
                    default: "#e69500",
                    subtle: "#DDe69500"
                }
            }
        }
    },
    actions: {
        maxActions: 5,
        spacing: Enums.Spacing.Default,
        buttonSpacing: 10,
        showCard: {
            actionMode: Enums.ShowCardActionMode.Inline,
            inlineTopMargin: 16
        },
        actionsOrientation: Enums.Orientation.Horizontal,
        actionAlignment: Enums.ActionAlignment.Left
    },
    adaptiveCard: {
        allowCustomStyle: false
    },
    imageSet: {
        imageSize: Enums.Size.Medium,
        maxImageHeight: 100
    },
    factSet: {
        title: {
            color: Enums.TextColor.Default,
            size: Enums.TextSize.Default,
            isSubtle: false,
            weight: Enums.TextWeight.Bolder,
            wrap: true,
            maxWidth: 150,
        },
        value: {
            color: Enums.TextColor.Default,
            size: Enums.TextSize.Default,
            isSubtle: false,
            weight: Enums.TextWeight.Default,
            wrap: true,
        },
        spacing: 10
    }
});
//# sourceMappingURL=host-config.js.map

/***/ }),

/***/ "../adaptivecards/lib/registry.js":
/*!****************************************!*\
  !*** ../adaptivecards/lib/registry.js ***!
  \****************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
var serialization_1 = __webpack_require__(/*! ./serialization */ "../adaptivecards/lib/serialization.js");
var CardObjectRegistry = /** @class */ (function () {
    function CardObjectRegistry() {
        this._items = {};
    }
    CardObjectRegistry.prototype.findByName = function (typeName) {
        return this._items.hasOwnProperty(typeName) ? this._items[typeName] : undefined;
    };
    CardObjectRegistry.prototype.clear = function () {
        this._items = {};
    };
    CardObjectRegistry.prototype.register = function (typeName, objectType, schemaVersion) {
        if (schemaVersion === void 0) { schemaVersion = serialization_1.Versions.v1_0; }
        var registrationInfo = this.findByName(typeName);
        if (registrationInfo !== undefined) {
            registrationInfo.objectType = objectType;
        }
        else {
            registrationInfo = {
                typeName: typeName,
                objectType: objectType,
                schemaVersion: schemaVersion
            };
        }
        this._items[typeName] = registrationInfo;
    };
    CardObjectRegistry.prototype.unregister = function (typeName) {
        delete this._items[typeName];
    };
    CardObjectRegistry.prototype.createInstance = function (typeName, targetVersion) {
        var registrationInfo = this.findByName(typeName);
        return (registrationInfo && registrationInfo.schemaVersion.compareTo(targetVersion) <= 0) ? new registrationInfo.objectType() : undefined;
    };
    CardObjectRegistry.prototype.getItemCount = function () {
        return Object.keys(this._items).length;
    };
    CardObjectRegistry.prototype.getItemAt = function (index) {
        return Object.values(this._items)[index];
    };
    return CardObjectRegistry;
}());
exports.CardObjectRegistry = CardObjectRegistry;
//# sourceMappingURL=registry.js.map

/***/ }),

/***/ "../adaptivecards/lib/serialization.js":
/*!*********************************************!*\
  !*** ../adaptivecards/lib/serialization.js ***!
  \*********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
var shared_1 = __webpack_require__(/*! ./shared */ "../adaptivecards/lib/shared.js");
var Utils = __webpack_require__(/*! ./utils */ "../adaptivecards/lib/utils.js");
var Enums = __webpack_require__(/*! ./enums */ "../adaptivecards/lib/enums.js");
var Version = /** @class */ (function () {
    function Version(major, minor, label) {
        if (major === void 0) { major = 1; }
        if (minor === void 0) { minor = 1; }
        this._isValid = true;
        this._major = major;
        this._minor = minor;
        this._label = label;
    }
    Version.parse = function (versionString, context) {
        if (!versionString) {
            return undefined;
        }
        var result = new Version();
        result._versionString = versionString;
        var regEx = /(\d+).(\d+)/gi;
        var matches = regEx.exec(versionString);
        if (matches != null && matches.length == 3) {
            result._major = parseInt(matches[1]);
            result._minor = parseInt(matches[2]);
        }
        else {
            result._isValid = false;
        }
        if (!result._isValid) {
            context.logParseEvent(6 /* InvalidPropertyValue */, "Invalid version string: " + result._versionString);
        }
        return result;
    };
    Version.prototype.toString = function () {
        return !this._isValid ? this._versionString : this._major + "." + this._minor;
    };
    Version.prototype.toJSON = function () {
        return this.toString();
    };
    Version.prototype.compareTo = function (otherVersion) {
        if (!this.isValid || !otherVersion.isValid) {
            throw new Error("Cannot compare invalid version.");
        }
        if (this.major > otherVersion.major) {
            return 1;
        }
        else if (this.major < otherVersion.major) {
            return -1;
        }
        else if (this.minor > otherVersion.minor) {
            return 1;
        }
        else if (this.minor < otherVersion.minor) {
            return -1;
        }
        return 0;
    };
    Object.defineProperty(Version.prototype, "label", {
        get: function () {
            return this._label ? this._label : this.toString();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Version.prototype, "major", {
        get: function () {
            return this._major;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Version.prototype, "minor", {
        get: function () {
            return this._minor;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Version.prototype, "isValid", {
        get: function () {
            return this._isValid;
        },
        enumerable: true,
        configurable: true
    });
    return Version;
}());
exports.Version = Version;
var Versions = /** @class */ (function () {
    function Versions() {
    }
    Versions.v1_0 = new Version(1, 0);
    Versions.v1_1 = new Version(1, 1);
    Versions.v1_2 = new Version(1, 2);
    Versions.latest = Versions.v1_2;
    Versions.vNext = new Version(1000, 0, "vNext");
    return Versions;
}());
exports.Versions = Versions;
function isVersionLessOrEqual(version, targetVersion) {
    if (version instanceof Version) {
        if (targetVersion instanceof Version) {
            return targetVersion.compareTo(version) >= 0;
        }
        else {
            // Target version is *
            return true;
        }
    }
    else {
        // Version is *
        return true;
    }
}
exports.isVersionLessOrEqual = isVersionLessOrEqual;
var BaseSerializationContext = /** @class */ (function () {
    function BaseSerializationContext(targetVersion) {
        if (targetVersion === void 0) { targetVersion = Versions.latest; }
        this.targetVersion = targetVersion;
        this._validationEvents = [];
    }
    BaseSerializationContext.prototype.serializeValue = function (target, propertyName, propertyValue, defaultValue) {
        if (defaultValue === void 0) { defaultValue = undefined; }
        if (propertyValue === null || propertyValue === undefined || propertyValue === defaultValue) {
            delete target[propertyName];
        }
        else {
            target[propertyName] = propertyValue;
        }
    };
    BaseSerializationContext.prototype.serializeNumber = function (target, propertyName, propertyValue, defaultValue) {
        if (defaultValue === void 0) { defaultValue = undefined; }
        if (propertyValue === null || propertyValue === undefined || propertyValue === defaultValue || isNaN(propertyValue)) {
            delete target[propertyName];
        }
        else {
            target[propertyName] = propertyValue;
        }
    };
    BaseSerializationContext.prototype.serializeEnum = function (enumType, target, propertyName, propertyValue, defaultValue) {
        if (defaultValue === void 0) { defaultValue = undefined; }
        var targetValue = target[propertyName];
        var canDeleteTarget = targetValue == undefined ? true : enumType[targetValue] !== undefined;
        if (propertyValue == defaultValue) {
            if (canDeleteTarget) {
                delete target[propertyName];
            }
        }
        else {
            if (propertyValue == undefined) {
                if (canDeleteTarget) {
                    delete target[propertyName];
                }
            }
            else {
                target[propertyName] = enumType[propertyValue];
            }
        }
    };
    BaseSerializationContext.prototype.serializeArray = function (target, propertyName, propertyValue) {
        var items = [];
        if (propertyValue) {
            for (var _i = 0, propertyValue_1 = propertyValue; _i < propertyValue_1.length; _i++) {
                var item = propertyValue_1[_i];
                var serializedItem = undefined;
                if (item instanceof SerializableObject) {
                    serializedItem = item.toJSON(this);
                }
                else if (item.toJSON) {
                    serializedItem = item.toJSON();
                }
                else {
                    serializedItem = item;
                }
                if (serializedItem !== undefined) {
                    items.push(serializedItem);
                }
            }
        }
        if (items.length == 0) {
            if (target.hasOwnProperty(propertyName) && Array.isArray(target[propertyName])) {
                delete target[propertyName];
            }
        }
        else {
            this.serializeValue(target, propertyName, items);
        }
    };
    BaseSerializationContext.prototype.clearEvents = function () {
        this._validationEvents = [];
    };
    BaseSerializationContext.prototype.logEvent = function (phase, event, message, source) {
        this._validationEvents.push({
            phase: phase,
            event: event,
            message: message
        });
    };
    BaseSerializationContext.prototype.logParseEvent = function (event, message, source) {
        this.logEvent(0 /* Parse */, event, message, source);
    };
    BaseSerializationContext.prototype.getEventAt = function (index) {
        return this._validationEvents[index];
    };
    BaseSerializationContext.prototype.shouldSerialize = function (o) {
        return true;
    };
    Object.defineProperty(BaseSerializationContext.prototype, "eventCount", {
        get: function () {
            return this._validationEvents.length;
        },
        enumerable: true,
        configurable: true
    });
    return BaseSerializationContext;
}());
exports.BaseSerializationContext = BaseSerializationContext;
var SimpleSerializationContext = /** @class */ (function (_super) {
    __extends(SimpleSerializationContext, _super);
    function SimpleSerializationContext() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return SimpleSerializationContext;
}(BaseSerializationContext));
var PropertyDefinition = /** @class */ (function () {
    function PropertyDefinition(targetVersion, name, defaultValue, onGetInitialValue) {
        this.targetVersion = targetVersion;
        this.name = name;
        this.defaultValue = defaultValue;
        this.onGetInitialValue = onGetInitialValue;
    }
    PropertyDefinition.prototype.getInternalName = function () {
        return this.name;
    };
    PropertyDefinition.prototype.parse = function (sender, source, context) {
        return source[this.name];
    };
    PropertyDefinition.prototype.toJSON = function (sender, target, value, context) {
        context.serializeValue(target, this.name, value, this.defaultValue);
    };
    return PropertyDefinition;
}());
exports.PropertyDefinition = PropertyDefinition;
var StringProperty = /** @class */ (function (_super) {
    __extends(StringProperty, _super);
    function StringProperty(targetVersion, name, treatEmptyAsUndefined, regEx, defaultValue, onGetInitialValue) {
        if (treatEmptyAsUndefined === void 0) { treatEmptyAsUndefined = true; }
        var _this = _super.call(this, targetVersion, name, defaultValue, onGetInitialValue) || this;
        _this.targetVersion = targetVersion;
        _this.name = name;
        _this.treatEmptyAsUndefined = treatEmptyAsUndefined;
        _this.regEx = regEx;
        _this.defaultValue = defaultValue;
        _this.onGetInitialValue = onGetInitialValue;
        return _this;
    }
    StringProperty.prototype.parse = function (sender, source, context) {
        var parsedValue = Utils.parseString(source[this.name], this.defaultValue);
        var isUndefined = parsedValue === undefined || (parsedValue === "" && this.treatEmptyAsUndefined);
        if (!isUndefined && this.regEx !== undefined) {
            var matches = this.regEx.exec(parsedValue);
            if (!matches) {
                context.logParseEvent(6 /* InvalidPropertyValue */, "Invalid \"" + this.name + "\" value \"" + parsedValue + "\"", sender);
                return undefined;
            }
        }
        return parsedValue;
    };
    StringProperty.prototype.toJSON = function (sender, target, value, context) {
        context.serializeValue(target, this.name, value === "" && this.treatEmptyAsUndefined ? undefined : value, this.defaultValue);
    };
    return StringProperty;
}(PropertyDefinition));
exports.StringProperty = StringProperty;
var BoolProperty = /** @class */ (function (_super) {
    __extends(BoolProperty, _super);
    function BoolProperty() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    BoolProperty.prototype.parse = function (sender, source, context) {
        return Utils.parseBool(source[this.name], this.defaultValue);
    };
    BoolProperty.prototype.toJSON = function (sender, target, value, context) {
        context.serializeValue(target, this.name, value, this.defaultValue);
    };
    return BoolProperty;
}(PropertyDefinition));
exports.BoolProperty = BoolProperty;
var NumProperty = /** @class */ (function (_super) {
    __extends(NumProperty, _super);
    function NumProperty() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    NumProperty.prototype.parse = function (sender, source, context) {
        return Utils.parseNumber(source[this.name], this.defaultValue);
    };
    NumProperty.prototype.toJSON = function (sender, target, value, context) {
        context.serializeNumber(target, this.name, value, this.defaultValue);
    };
    return NumProperty;
}(PropertyDefinition));
exports.NumProperty = NumProperty;
var PixelSizeProperty = /** @class */ (function (_super) {
    __extends(PixelSizeProperty, _super);
    function PixelSizeProperty() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    PixelSizeProperty.prototype.parse = function (sender, source, context) {
        var result = undefined;
        var value = source[this.name];
        if (typeof value === "string") {
            var isValid = false;
            try {
                var size = shared_1.SizeAndUnit.parse(value, true);
                if (size.unit == Enums.SizeUnit.Pixel) {
                    result = size.physicalSize;
                    isValid = true;
                }
            }
            catch (_a) {
                // Do nothing. A parse error is emitted below
            }
            if (!isValid) {
                context.logParseEvent(6 /* InvalidPropertyValue */, "Invalid \"minHeight\" value: " + source[this.name], sender);
            }
        }
        return result;
    };
    PixelSizeProperty.prototype.toJSON = function (sender, target, value, context) {
        context.serializeValue(target, this.name, typeof value === "number" && !isNaN(value) ? value + "px" : undefined);
    };
    return PixelSizeProperty;
}(PropertyDefinition));
exports.PixelSizeProperty = PixelSizeProperty;
var StringArrayProperty = /** @class */ (function (_super) {
    __extends(StringArrayProperty, _super);
    function StringArrayProperty(targetVersion, name, defaultValue, onGetInitialValue) {
        var _this = _super.call(this, targetVersion, name, defaultValue, onGetInitialValue) || this;
        _this.targetVersion = targetVersion;
        _this.name = name;
        _this.defaultValue = defaultValue;
        _this.onGetInitialValue = onGetInitialValue;
        return _this;
    }
    StringArrayProperty.prototype.parse = function (sender, source, context) {
        var sourceValue = source[this.name];
        if (sourceValue === undefined || !Array.isArray(sourceValue)) {
            return this.defaultValue;
        }
        var result = [];
        for (var _i = 0, sourceValue_1 = sourceValue; _i < sourceValue_1.length; _i++) {
            var value = sourceValue_1[_i];
            if (typeof value === "string") {
                result.push(value);
            }
            else {
                context.logParseEvent(6 /* InvalidPropertyValue */, "Invalid array value \"" + value + "\" of type \"" + typeof value + "\" ignored for \"" + this.name + "\".", sender);
            }
        }
        return result;
    };
    StringArrayProperty.prototype.toJSON = function (sender, target, value, context) {
        context.serializeArray(target, this.name, value);
    };
    return StringArrayProperty;
}(PropertyDefinition));
exports.StringArrayProperty = StringArrayProperty;
var ValueSetProperty = /** @class */ (function (_super) {
    __extends(ValueSetProperty, _super);
    function ValueSetProperty(targetVersion, name, values, defaultValue, onGetInitialValue) {
        var _this = _super.call(this, targetVersion, name, defaultValue, onGetInitialValue) || this;
        _this.targetVersion = targetVersion;
        _this.name = name;
        _this.values = values;
        _this.defaultValue = defaultValue;
        _this.onGetInitialValue = onGetInitialValue;
        return _this;
    }
    ValueSetProperty.prototype.parse = function (sender, source, context) {
        var sourceValue = source[this.name];
        if (sourceValue === undefined) {
            return this.defaultValue;
        }
        if (typeof sourceValue === "string") {
            for (var _i = 0, _a = this.values; _i < _a.length; _i++) {
                var versionedValue = _a[_i];
                if (sourceValue.toLowerCase() === versionedValue.value.toLowerCase()) {
                    var targetVersion = versionedValue.targetVersion ? versionedValue.targetVersion : this.targetVersion;
                    if (targetVersion.compareTo(context.targetVersion) <= 0) {
                        return versionedValue.value;
                    }
                    else {
                        context.logParseEvent(6 /* InvalidPropertyValue */, "\"" + this.name + "\" value \"" + sourceValue + "\" is supported in version " + targetVersion.toString() + ", but you are using version " + context.targetVersion.toString(), sender);
                        return this.defaultValue;
                    }
                }
            }
        }
        context.logParseEvent(6 /* InvalidPropertyValue */, "Invalid \"" + this.name + "\" value \"" + sourceValue + "\"", sender);
        return this.defaultValue;
    };
    ValueSetProperty.prototype.toJSON = function (sender, target, value, context) {
        var valueFound = false;
        for (var _i = 0, _a = this.values; _i < _a.length; _i++) {
            var versionedValue = _a[_i];
            if (versionedValue.value === value) {
                var targetVersion = versionedValue.targetVersion ? versionedValue.targetVersion : this.targetVersion;
                if (targetVersion.compareTo(context.targetVersion) <= 0) {
                    valueFound = true;
                    break;
                }
                else {
                    context.logEvent(1 /* ToJSON */, 6 /* InvalidPropertyValue */, "\"" + this.name + "\" value \"" + value + "\" is supported in version " + targetVersion.toString() + ", but you are using version " + context.targetVersion.toString(), sender);
                }
            }
        }
        context.serializeValue(target, this.name, valueFound ? value : undefined, this.defaultValue);
    };
    return ValueSetProperty;
}(PropertyDefinition));
exports.ValueSetProperty = ValueSetProperty;
var EnumProperty = /** @class */ (function (_super) {
    __extends(EnumProperty, _super);
    function EnumProperty(targetVersion, name, enumType, defaultValue, values, onGetInitialValue) {
        var _this = _super.call(this, targetVersion, name, defaultValue, onGetInitialValue) || this;
        _this.targetVersion = targetVersion;
        _this.name = name;
        _this.enumType = enumType;
        _this.defaultValue = defaultValue;
        _this.onGetInitialValue = onGetInitialValue;
        _this._values = [];
        if (!values) {
            for (var key in enumType) {
                var keyAsNumber = parseInt(key, 10);
                if (keyAsNumber >= 0) {
                    _this._values.push({ value: keyAsNumber });
                }
            }
        }
        else {
            _this._values = values;
        }
        return _this;
    }
    EnumProperty.prototype.parse = function (sender, source, context) {
        var sourceValue = source[this.name];
        if (typeof sourceValue !== "string") {
            return this.defaultValue;
        }
        var enumValue = Utils.getEnumValueByName(this.enumType, sourceValue);
        if (enumValue !== undefined) {
            for (var _i = 0, _a = this.values; _i < _a.length; _i++) {
                var versionedValue = _a[_i];
                if (versionedValue.value === enumValue) {
                    var targetVersion = versionedValue.targetVersion ? versionedValue.targetVersion : this.targetVersion;
                    if (targetVersion.compareTo(context.targetVersion) <= 0) {
                        return enumValue;
                    }
                    else {
                        context.logParseEvent(6 /* InvalidPropertyValue */, "\"" + this.name + "\" value \"" + sourceValue + "\" is supported in version " + targetVersion.toString() + ", but you are using version " + context.targetVersion.toString(), sender);
                        return this.defaultValue;
                    }
                }
            }
        }
        context.logParseEvent(6 /* InvalidPropertyValue */, "Invalid \"" + this.name + "\" value \"" + sourceValue + "\"", sender);
        return this.defaultValue;
    };
    EnumProperty.prototype.toJSON = function (sender, target, value, context) {
        if (value !== undefined) {
            var valueFound = false;
            for (var _i = 0, _a = this.values; _i < _a.length; _i++) {
                var versionedValue = _a[_i];
                if (versionedValue.value === value) {
                    var targetVersion = versionedValue.targetVersion ? versionedValue.targetVersion : this.targetVersion;
                    if (targetVersion.compareTo(context.targetVersion) <= 0) {
                        valueFound = true;
                        break;
                    }
                    else {
                        context.logEvent(1 /* ToJSON */, 6 /* InvalidPropertyValue */, "Invalid \"" + this.name + "\" value \"" + value + "\"", sender);
                    }
                }
            }
            if (valueFound) {
                context.serializeEnum(this.enumType, target, this.name, value, this.defaultValue);
            }
        }
    };
    Object.defineProperty(EnumProperty.prototype, "values", {
        get: function () {
            return this._values;
        },
        enumerable: true,
        configurable: true
    });
    return EnumProperty;
}(PropertyDefinition));
exports.EnumProperty = EnumProperty;
var SerializableObjectProperty = /** @class */ (function (_super) {
    __extends(SerializableObjectProperty, _super);
    function SerializableObjectProperty(targetVersion, name, objectType, nullable) {
        if (nullable === void 0) { nullable = false; }
        var _this = _super.call(this, targetVersion, name, undefined, function (sender) { return _this.nullable ? undefined : new _this.objectType(); }) || this;
        _this.targetVersion = targetVersion;
        _this.name = name;
        _this.objectType = objectType;
        _this.nullable = nullable;
        return _this;
    }
    SerializableObjectProperty.prototype.parse = function (sender, source, context) {
        var sourceValue = source[this.name];
        if (sourceValue === undefined) {
            return this.onGetInitialValue ? this.onGetInitialValue(sender) : this.defaultValue;
        }
        var result = new this.objectType();
        result.parse(sourceValue, context);
        return result;
    };
    SerializableObjectProperty.prototype.toJSON = function (sender, target, value, context) {
        var serializedValue = value !== undefined ? value.toJSON(context) : value;
        if (typeof serializedValue === "object" && Object.keys(serializedValue).length === 0) {
            serializedValue = undefined;
        }
        _super.prototype.toJSON.call(this, sender, target, serializedValue, context);
    };
    return SerializableObjectProperty;
}(PropertyDefinition));
exports.SerializableObjectProperty = SerializableObjectProperty;
var SerializableObjectCollectionProperty = /** @class */ (function (_super) {
    __extends(SerializableObjectCollectionProperty, _super);
    function SerializableObjectCollectionProperty(targetVersion, name, objectType, onItemAdded) {
        var _this = _super.call(this, targetVersion, name, undefined, function (sender) { return []; }) || this;
        _this.targetVersion = targetVersion;
        _this.name = name;
        _this.objectType = objectType;
        _this.onItemAdded = onItemAdded;
        return _this;
    }
    SerializableObjectCollectionProperty.prototype.parse = function (sender, source, context) {
        var result = [];
        var sourceCollection = source[this.name];
        if (Array.isArray(sourceCollection)) {
            for (var _i = 0, sourceCollection_1 = sourceCollection; _i < sourceCollection_1.length; _i++) {
                var sourceItem = sourceCollection_1[_i];
                var item = new this.objectType();
                item.parse(sourceItem, context);
                result.push(item);
                if (this.onItemAdded) {
                    this.onItemAdded(sender, item);
                }
            }
        }
        return result.length > 0 ? result : (this.onGetInitialValue ? this.onGetInitialValue(sender) : undefined);
    };
    SerializableObjectCollectionProperty.prototype.toJSON = function (sender, target, value, context) {
        context.serializeArray(target, this.name, value);
    };
    return SerializableObjectCollectionProperty;
}(PropertyDefinition));
exports.SerializableObjectCollectionProperty = SerializableObjectCollectionProperty;
var CustomProperty = /** @class */ (function (_super) {
    __extends(CustomProperty, _super);
    function CustomProperty(targetVersion, name, onParse, onToJSON, defaultValue, onGetInitialValue) {
        var _this = _super.call(this, targetVersion, name, defaultValue, onGetInitialValue) || this;
        _this.targetVersion = targetVersion;
        _this.name = name;
        _this.onParse = onParse;
        _this.onToJSON = onToJSON;
        _this.defaultValue = defaultValue;
        _this.onGetInitialValue = onGetInitialValue;
        if (!_this.onParse) {
            throw new Error("CustomPropertyDefinition instances must have an onParse handler.");
        }
        if (!_this.onToJSON) {
            throw new Error("CustomPropertyDefinition instances must have an onToJSON handler.");
        }
        return _this;
    }
    CustomProperty.prototype.parse = function (sender, source, context) {
        return this.onParse(sender, this, source, context);
    };
    CustomProperty.prototype.toJSON = function (sender, target, value, context) {
        this.onToJSON(sender, this, target, value, context);
    };
    return CustomProperty;
}(PropertyDefinition));
exports.CustomProperty = CustomProperty;
var SerializableObjectSchema = /** @class */ (function () {
    function SerializableObjectSchema() {
        this._properties = [];
    }
    SerializableObjectSchema.prototype.indexOf = function (property) {
        for (var i = 0; i < this._properties.length; i++) {
            if (this._properties[i] === property) {
                return i;
            }
        }
        return -1;
    };
    SerializableObjectSchema.prototype.add = function () {
        var properties = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            properties[_i] = arguments[_i];
        }
        for (var i = 0; i < properties.length; i++) {
            if (this.indexOf(properties[i]) === -1) {
                this._properties.push(properties[i]);
            }
        }
    };
    SerializableObjectSchema.prototype.remove = function () {
        var properties = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            properties[_i] = arguments[_i];
        }
        for (var _a = 0, properties_1 = properties; _a < properties_1.length; _a++) {
            var property_1 = properties_1[_a];
            while (true) {
                var index = this.indexOf(property_1);
                if (index >= 0) {
                    this._properties.splice(index, 1);
                }
                else {
                    break;
                }
            }
        }
    };
    SerializableObjectSchema.prototype.getItemAt = function (index) {
        return this._properties[index];
    };
    SerializableObjectSchema.prototype.getCount = function () {
        return this._properties.length;
    };
    return SerializableObjectSchema;
}());
exports.SerializableObjectSchema = SerializableObjectSchema;
// This is a decorator function, used to map SerializableObject descendant class members to
// schema properties
function property(property) {
    return function (target, propertyKey) {
        var descriptor = Object.getOwnPropertyDescriptor(target, propertyKey) || {};
        if (!descriptor.get && !descriptor.set) {
            descriptor.get = function () { return this.getValue(property); };
            descriptor.set = function (value) { this.setValue(property, value); };
            Object.defineProperty(target, propertyKey, descriptor);
        }
    };
}
exports.property = property;
var SerializableObject = /** @class */ (function () {
    function SerializableObject() {
        this._propertyBag = {};
        this._rawProperties = {};
        this.maxVersion = Versions.latest;
        var s = this.getSchema();
        for (var i = 0; i < s.getCount(); i++) {
            var property_2 = s.getItemAt(i);
            if (property_2.onGetInitialValue) {
                this.setValue(property_2, property_2.onGetInitialValue(this));
            }
        }
    }
    SerializableObject.prototype.populateSchema = function (schema) {
        var ctor = this.constructor;
        for (var propertyName in ctor) {
            try {
                var propertyValue = ctor[propertyName];
                if (propertyValue instanceof PropertyDefinition) {
                    schema.add(propertyValue);
                }
            }
            catch (_a) {
                // If a property happens to have a getter function and
                // it throws an exception, we need to catch it here
            }
        }
        if (SerializableObject.onRegisterCustomProperties) {
            SerializableObject.onRegisterCustomProperties(this, schema);
        }
    };
    SerializableObject.prototype.getValue = function (property) {
        return this._propertyBag.hasOwnProperty(property.getInternalName()) ? this._propertyBag[property.getInternalName()] : property.defaultValue;
    };
    SerializableObject.prototype.setValue = function (property, value) {
        if (value === undefined || value === null) {
            delete this._propertyBag[property.getInternalName()];
        }
        else {
            this._propertyBag[property.getInternalName()] = value;
        }
    };
    SerializableObject.prototype.internalParse = function (source, context) {
        this._propertyBag = {};
        this._rawProperties = shared_1.GlobalSettings.enableFullJsonRoundTrip ? (source ? source : {}) : {};
        if (source) {
            var s = this.getSchema();
            for (var i = 0; i < s.getCount(); i++) {
                var property_3 = s.getItemAt(i);
                var propertyValue = property_3.onGetInitialValue ? property_3.onGetInitialValue(this) : undefined;
                if (source.hasOwnProperty(property_3.name)) {
                    if (property_3.targetVersion.compareTo(context.targetVersion) <= 0) {
                        propertyValue = property_3.parse(this, source, context);
                    }
                    else {
                        context.logParseEvent(14 /* UnsupportedProperty */, "Property \"" + property_3.name + "\" is supported in version " + property_3.targetVersion.toString() + ", but you are using version " + context.targetVersion.toString(), this);
                    }
                }
                this.setValue(property_3, propertyValue);
            }
        }
        else {
            this.resetDefaultValues();
        }
    };
    SerializableObject.prototype.internalToJSON = function (target, context) {
        var s = this.getSchema();
        var serializedProperties = [];
        for (var i = 0; i < s.getCount(); i++) {
            var property_4 = s.getItemAt(i);
            // Avoid serializing the same property multiple times. This is necessary
            // because some property definitions map to the same underlying schema
            // property
            if (property_4.targetVersion.compareTo(context.targetVersion) <= 0 && serializedProperties.indexOf(property_4.name) === -1) {
                property_4.toJSON(this, target, this.getValue(property_4), context);
                serializedProperties.push(property_4.name);
            }
        }
    };
    SerializableObject.prototype.parse = function (source, context) {
        this.internalParse(source, context ? context : new SimpleSerializationContext());
    };
    SerializableObject.prototype.toJSON = function (context) {
        var effectiveContext = context ? context : new SimpleSerializationContext();
        if (effectiveContext.shouldSerialize(this)) {
            var result = void 0;
            if (shared_1.GlobalSettings.enableFullJsonRoundTrip && this._rawProperties && typeof this._rawProperties === "object") {
                result = this._rawProperties;
            }
            else {
                result = {};
            }
            this.internalToJSON(result, effectiveContext);
            return result;
        }
        else {
            return undefined;
        }
    };
    SerializableObject.prototype.hasDefaultValue = function (property) {
        return this.getValue(property) === property.defaultValue;
    };
    SerializableObject.prototype.hasAllDefaultValues = function () {
        var s = this.getSchema();
        for (var i = 0; i < s.getCount(); i++) {
            var property_5 = s.getItemAt(i);
            if (!this.hasDefaultValue(property_5)) {
                return false;
            }
        }
        return true;
    };
    SerializableObject.prototype.resetDefaultValues = function () {
        var s = this.getSchema();
        for (var i = 0; i < s.getCount(); i++) {
            var property_6 = s.getItemAt(i);
            this.setValue(property_6, property_6.defaultValue);
        }
    };
    SerializableObject.prototype.setCustomProperty = function (name, value) {
        var shouldDeleteProperty = (typeof value === "string" && !value) || value === undefined || value === null;
        if (shouldDeleteProperty) {
            delete this._rawProperties[name];
        }
        else {
            this._rawProperties[name] = value;
        }
    };
    SerializableObject.prototype.getCustomProperty = function (name) {
        return this._rawProperties[name];
    };
    SerializableObject.prototype.getSchema = function () {
        var schema = SerializableObject._schemaCache[this.getSchemaKey()];
        if (!schema) {
            schema = new SerializableObjectSchema();
            this.populateSchema(schema);
            SerializableObject._schemaCache[this.getSchemaKey()] = schema;
        }
        return schema;
    };
    SerializableObject._schemaCache = {};
    return SerializableObject;
}());
exports.SerializableObject = SerializableObject;
//# sourceMappingURL=serialization.js.map

/***/ }),

/***/ "../adaptivecards/lib/shared.js":
/*!**************************************!*\
  !*** ../adaptivecards/lib/shared.js ***!
  \**************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
var Enums = __webpack_require__(/*! ./enums */ "../adaptivecards/lib/enums.js");
var GlobalSettings = /** @class */ (function () {
    function GlobalSettings() {
    }
    GlobalSettings.useAdvancedTextBlockTruncation = true;
    GlobalSettings.useAdvancedCardBottomTruncation = false;
    GlobalSettings.useMarkdownInRadioButtonAndCheckbox = true;
    GlobalSettings.allowMarkForTextHighlighting = false;
    GlobalSettings.alwaysBleedSeparators = false;
    GlobalSettings.enableFullJsonRoundTrip = false;
    GlobalSettings.useBuiltInInputValidation = true;
    GlobalSettings.displayInputValidationErrors = true;
    GlobalSettings.allowPreProcessingPropertyValues = false;
    return GlobalSettings;
}());
exports.GlobalSettings = GlobalSettings;
exports.ContentTypes = {
    applicationJson: "application/json",
    applicationXWwwFormUrlencoded: "application/x-www-form-urlencoded"
};
var StringWithSubstitutions = /** @class */ (function () {
    function StringWithSubstitutions() {
        this._isProcessed = false;
    }
    StringWithSubstitutions.prototype.getReferencedInputs = function (inputs, referencedInputs) {
        if (!referencedInputs) {
            throw new Error("The referencedInputs parameter cannot be null.");
        }
        for (var _i = 0, inputs_1 = inputs; _i < inputs_1.length; _i++) {
            var input = inputs_1[_i];
            var matches = new RegExp("\\{{2}(" + input.id + ").value\\}{2}", "gi").exec(this._original);
            if (matches != null && input.id) {
                referencedInputs[input.id] = input;
            }
        }
    };
    StringWithSubstitutions.prototype.substituteInputValues = function (inputs, contentType) {
        this._processed = this._original;
        if (this._original) {
            var regEx = /\{{2}([a-z0-9_$@]+).value\}{2}/gi;
            var matches = void 0;
            while ((matches = regEx.exec(this._original)) !== null) {
                for (var _i = 0, _a = Object.keys(inputs); _i < _a.length; _i++) {
                    var key = _a[_i];
                    if (key.toLowerCase() == matches[1].toLowerCase()) {
                        var matchedInput = inputs[key];
                        var valueForReplace = "";
                        if (matchedInput.value) {
                            valueForReplace = matchedInput.value;
                        }
                        if (contentType === exports.ContentTypes.applicationJson) {
                            valueForReplace = JSON.stringify(valueForReplace);
                            valueForReplace = valueForReplace.slice(1, -1);
                        }
                        else if (contentType === exports.ContentTypes.applicationXWwwFormUrlencoded) {
                            valueForReplace = encodeURIComponent(valueForReplace);
                        }
                        this._processed = this._processed.replace(matches[0], valueForReplace);
                        break;
                    }
                }
            }
        }
        this._isProcessed = true;
    };
    StringWithSubstitutions.prototype.getOriginal = function () {
        return this._original;
    };
    StringWithSubstitutions.prototype.get = function () {
        if (!this._isProcessed) {
            return this._original;
        }
        else {
            return this._processed;
        }
    };
    StringWithSubstitutions.prototype.set = function (value) {
        this._original = value;
        this._isProcessed = false;
    };
    return StringWithSubstitutions;
}());
exports.StringWithSubstitutions = StringWithSubstitutions;
var SpacingDefinition = /** @class */ (function () {
    function SpacingDefinition(top, right, bottom, left) {
        if (top === void 0) { top = 0; }
        if (right === void 0) { right = 0; }
        if (bottom === void 0) { bottom = 0; }
        if (left === void 0) { left = 0; }
        this.left = 0;
        this.top = 0;
        this.right = 0;
        this.bottom = 0;
        this.top = top;
        this.right = right;
        this.bottom = bottom;
        this.left = left;
    }
    return SpacingDefinition;
}());
exports.SpacingDefinition = SpacingDefinition;
var PaddingDefinition = /** @class */ (function () {
    function PaddingDefinition(top, right, bottom, left) {
        if (top === void 0) { top = Enums.Spacing.None; }
        if (right === void 0) { right = Enums.Spacing.None; }
        if (bottom === void 0) { bottom = Enums.Spacing.None; }
        if (left === void 0) { left = Enums.Spacing.None; }
        this.top = Enums.Spacing.None;
        this.right = Enums.Spacing.None;
        this.bottom = Enums.Spacing.None;
        this.left = Enums.Spacing.None;
        this.top = top;
        this.right = right;
        this.bottom = bottom;
        this.left = left;
    }
    return PaddingDefinition;
}());
exports.PaddingDefinition = PaddingDefinition;
var SizeAndUnit = /** @class */ (function () {
    function SizeAndUnit(physicalSize, unit) {
        this.physicalSize = physicalSize;
        this.unit = unit;
    }
    SizeAndUnit.parse = function (input, requireUnitSpecifier) {
        if (requireUnitSpecifier === void 0) { requireUnitSpecifier = false; }
        var result = new SizeAndUnit(0, Enums.SizeUnit.Weight);
        if (typeof input === "number") {
            result.physicalSize = input;
            return result;
        }
        else if (typeof input === "string") {
            var regExp = /^([0-9]+)(px|\*)?$/g;
            var matches = regExp.exec(input);
            var expectedMatchCount = requireUnitSpecifier ? 3 : 2;
            if (matches && matches.length >= expectedMatchCount) {
                result.physicalSize = parseInt(matches[1]);
                if (matches.length == 3) {
                    if (matches[2] == "px") {
                        result.unit = Enums.SizeUnit.Pixel;
                    }
                }
                return result;
            }
        }
        throw new Error("Invalid size: " + input);
    };
    return SizeAndUnit;
}());
exports.SizeAndUnit = SizeAndUnit;
/**
 * Fast UUID generator, RFC4122 version 4 compliant.
 * @author Jeff Ward (jcward.com).
 * @license MIT license
 * @link http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript/21963136#21963136
 **/
var UUID = /** @class */ (function () {
    function UUID() {
    }
    UUID.generate = function () {
        var d0 = Math.random() * 0xffffffff | 0;
        var d1 = Math.random() * 0xffffffff | 0;
        var d2 = Math.random() * 0xffffffff | 0;
        var d3 = Math.random() * 0xffffffff | 0;
        return UUID.lut[d0 & 0xff] + UUID.lut[d0 >> 8 & 0xff] + UUID.lut[d0 >> 16 & 0xff] + UUID.lut[d0 >> 24 & 0xff] + '-' +
            UUID.lut[d1 & 0xff] + UUID.lut[d1 >> 8 & 0xff] + '-' + UUID.lut[d1 >> 16 & 0x0f | 0x40] + UUID.lut[d1 >> 24 & 0xff] + '-' +
            UUID.lut[d2 & 0x3f | 0x80] + UUID.lut[d2 >> 8 & 0xff] + '-' + UUID.lut[d2 >> 16 & 0xff] + UUID.lut[d2 >> 24 & 0xff] +
            UUID.lut[d3 & 0xff] + UUID.lut[d3 >> 8 & 0xff] + UUID.lut[d3 >> 16 & 0xff] + UUID.lut[d3 >> 24 & 0xff];
    };
    UUID.initialize = function () {
        for (var i = 0; i < 256; i++) {
            UUID.lut[i] = (i < 16 ? '0' : '') + i.toString(16);
        }
    };
    UUID.lut = [];
    return UUID;
}());
exports.UUID = UUID;
UUID.initialize();
//# sourceMappingURL=shared.js.map

/***/ }),

/***/ "../adaptivecards/lib/text-formatters.js":
/*!***********************************************!*\
  !*** ../adaptivecards/lib/text-formatters.js ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
var AbstractTextFormatter = /** @class */ (function () {
    function AbstractTextFormatter(regularExpression) {
        this._regularExpression = regularExpression;
    }
    AbstractTextFormatter.prototype.format = function (lang, input) {
        var matches;
        if (input) {
            var result = input;
            while ((matches = this._regularExpression.exec(input)) != null) {
                result = result.replace(matches[0], this.internalFormat(lang, matches));
            }
            ;
            return result;
        }
        else {
            return input;
        }
    };
    return AbstractTextFormatter;
}());
var DateFormatter = /** @class */ (function (_super) {
    __extends(DateFormatter, _super);
    function DateFormatter() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    DateFormatter.prototype.internalFormat = function (lang, matches) {
        var date = new Date(Date.parse(matches[1]));
        var format = matches[2] != undefined ? matches[2].toLowerCase() : "compact";
        if (format != "compact") {
            return date.toLocaleDateString(lang, { day: "numeric", weekday: format, month: format, year: "numeric" });
        }
        else {
            return date.toLocaleDateString();
        }
    };
    return DateFormatter;
}(AbstractTextFormatter));
var TimeFormatter = /** @class */ (function (_super) {
    __extends(TimeFormatter, _super);
    function TimeFormatter() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    TimeFormatter.prototype.internalFormat = function (lang, matches) {
        var date = new Date(Date.parse(matches[1]));
        return date.toLocaleTimeString(lang, { hour: 'numeric', minute: '2-digit' });
    };
    return TimeFormatter;
}(AbstractTextFormatter));
function formatText(lang, text) {
    var formatters = [
        new DateFormatter(/\{{2}DATE\((\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:Z|(?:(?:-|\+)\d{2}:\d{2})))(?:, ?(COMPACT|LONG|SHORT))?\)\}{2}/g),
        new TimeFormatter(/\{{2}TIME\((\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:Z|(?:(?:-|\+)\d{2}:\d{2})))\)\}{2}/g)
    ];
    var result = text;
    for (var _i = 0, formatters_1 = formatters; _i < formatters_1.length; _i++) {
        var formatter = formatters_1[_i];
        result = formatter.format(lang, result);
    }
    return result;
}
exports.formatText = formatText;
//# sourceMappingURL=text-formatters.js.map

/***/ }),

/***/ "../adaptivecards/lib/utils.js":
/*!*************************************!*\
  !*** ../adaptivecards/lib/utils.js ***!
  \*************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
var Enums = __webpack_require__(/*! ./enums */ "../adaptivecards/lib/enums.js");
var Shared = __webpack_require__(/*! ./shared */ "../adaptivecards/lib/shared.js");
function generateUniqueId() {
    return "__ac-" + Shared.UUID.generate();
}
exports.generateUniqueId = generateUniqueId;
function appendChild(node, child) {
    if (child) {
        node.appendChild(child);
    }
}
exports.appendChild = appendChild;
function parseString(obj, defaultValue) {
    return typeof obj === "string" ? obj : defaultValue;
}
exports.parseString = parseString;
function parseNumber(obj, defaultValue) {
    return typeof obj === "number" ? obj : defaultValue;
}
exports.parseNumber = parseNumber;
function parseBool(value, defaultValue) {
    if (typeof value === "boolean") {
        return value;
    }
    else if (typeof value === "string") {
        switch (value.toLowerCase()) {
            case "true":
                return true;
            case "false":
                return false;
            default:
                return defaultValue;
        }
    }
    return defaultValue;
}
exports.parseBool = parseBool;
function getEnumValueByName(enumType, name) {
    for (var key in enumType) {
        var keyAsNumber = parseInt(key, 10);
        if (keyAsNumber >= 0) {
            var value = enumType[key];
            if (value && typeof value === "string" && value.toLowerCase() === name.toLowerCase()) {
                return keyAsNumber;
            }
        }
    }
    return undefined;
}
exports.getEnumValueByName = getEnumValueByName;
function parseEnum(enumType, name, defaultValue) {
    if (!name) {
        return defaultValue;
    }
    var enumValue = getEnumValueByName(enumType, name);
    return enumValue !== undefined ? enumValue : defaultValue;
}
exports.parseEnum = parseEnum;
function renderSeparation(hostConfig, separationDefinition, orientation) {
    if (separationDefinition.spacing > 0 || (separationDefinition.lineThickness && separationDefinition.lineThickness > 0)) {
        var separator = document.createElement("div");
        separator.className = hostConfig.makeCssClassName("ac-" + (orientation == Enums.Orientation.Horizontal ? "horizontal" : "vertical") + "-separator");
        var color = separationDefinition.lineColor ? stringToCssColor(separationDefinition.lineColor) : "";
        if (orientation == Enums.Orientation.Horizontal) {
            if (separationDefinition.lineThickness) {
                separator.style.paddingTop = (separationDefinition.spacing / 2) + "px";
                separator.style.marginBottom = (separationDefinition.spacing / 2) + "px";
                separator.style.borderBottom = separationDefinition.lineThickness + "px solid " + color;
            }
            else {
                separator.style.height = separationDefinition.spacing + "px";
            }
        }
        else {
            if (separationDefinition.lineThickness) {
                separator.style.paddingLeft = (separationDefinition.spacing / 2) + "px";
                separator.style.marginRight = (separationDefinition.spacing / 2) + "px";
                separator.style.borderRight = separationDefinition.lineThickness + "px solid " + color;
            }
            else {
                separator.style.width = separationDefinition.spacing + "px";
            }
        }
        separator.style.overflow = "hidden";
        separator.style.flex = "0 0 auto";
        return separator;
    }
    else {
        return undefined;
    }
}
exports.renderSeparation = renderSeparation;
function stringToCssColor(color) {
    if (color) {
        var regEx = /#([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})([0-9A-F]{2})?/gi;
        var matches = regEx.exec(color);
        if (matches && matches[4]) {
            var a = parseInt(matches[1], 16) / 255;
            var r = parseInt(matches[2], 16);
            var g = parseInt(matches[3], 16);
            var b = parseInt(matches[4], 16);
            return "rgba(" + r + "," + g + "," + b + "," + a + ")";
        }
    }
    return color;
}
exports.stringToCssColor = stringToCssColor;
function truncate(element, maxHeight, lineHeight) {
    var fits = function () {
        // Allow a one pixel overflow to account for rounding differences
        // between browsers
        return maxHeight - element.scrollHeight >= -1.0;
    };
    if (fits())
        return;
    var fullText = element.innerHTML;
    var truncateAt = function (idx) {
        element.innerHTML = fullText.substring(0, idx) + '...';
    };
    var breakableIndices = findBreakableIndices(fullText);
    var lo = 0;
    var hi = breakableIndices.length;
    var bestBreakIdx = 0;
    // Do a binary search for the longest string that fits
    while (lo < hi) {
        var mid = Math.floor((lo + hi) / 2);
        truncateAt(breakableIndices[mid]);
        if (fits()) {
            bestBreakIdx = breakableIndices[mid];
            lo = mid + 1;
        }
        else {
            hi = mid;
        }
    }
    truncateAt(bestBreakIdx);
    // If we have extra room, try to expand the string letter by letter
    // (covers the case where we have to break in the middle of a long word)
    if (lineHeight && maxHeight - element.scrollHeight >= lineHeight - 1.0) {
        var idx = findNextCharacter(fullText, bestBreakIdx);
        while (idx < fullText.length) {
            truncateAt(idx);
            if (fits()) {
                bestBreakIdx = idx;
                idx = findNextCharacter(fullText, idx);
            }
            else {
                break;
            }
        }
        truncateAt(bestBreakIdx);
    }
}
exports.truncate = truncate;
function findBreakableIndices(html) {
    var results = [];
    var idx = findNextCharacter(html, -1);
    while (idx < html.length) {
        if (html[idx] == ' ') {
            results.push(idx);
        }
        idx = findNextCharacter(html, idx);
    }
    return results;
}
function findNextCharacter(html, currIdx) {
    currIdx += 1;
    // If we found the start of an HTML tag, keep advancing until we get
    // past it, so we don't end up truncating in the middle of the tag
    while (currIdx < html.length && html[currIdx] == '<') {
        while (currIdx < html.length && html[currIdx++] != '>')
            ;
    }
    return currIdx;
}
function getFitStatus(element, containerEnd) {
    var start = element.offsetTop;
    var end = start + element.clientHeight;
    if (end <= containerEnd) {
        return 0 /* FullyInContainer */;
    }
    else if (start < containerEnd) {
        return 1 /* Overflowing */;
    }
    else {
        return 2 /* FullyOutOfContainer */;
    }
}
exports.getFitStatus = getFitStatus;
//# sourceMappingURL=utils.js.map

/***/ }),

/***/ "./node_modules/adaptivecards-templating/lib/adaptivecards-templating.js":
/*!*******************************************************************************!*\
  !*** ./node_modules/adaptivecards-templating/lib/adaptivecards-templating.js ***!
  \*******************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

function __export(m) {
    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];
}
Object.defineProperty(exports, "__esModule", { value: true });
// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
__export(__webpack_require__(/*! ./expression-parser */ "./node_modules/adaptivecards-templating/lib/expression-parser.js"));
__export(__webpack_require__(/*! ./template-engine */ "./node_modules/adaptivecards-templating/lib/template-engine.js"));
//# sourceMappingURL=adaptivecards-templating.js.map

/***/ }),

/***/ "./node_modules/adaptivecards-templating/lib/expression-parser.js":
/*!************************************************************************!*\
  !*** ./node_modules/adaptivecards-templating/lib/expression-parser.js ***!
  \************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var orderedOperators = [
    "/",
    "*",
    "-",
    "+",
    "==",
    "!=",
    "<",
    "<=",
    ">",
    ">="
];
var literals = [
    "identifier",
    "string",
    "number",
    "boolean"
];
var Tokenizer = /** @class */ (function () {
    function Tokenizer() {
    }
    Tokenizer.init = function () {
        Tokenizer.rules.push({ tokenType: undefined, regEx: /^\s/ }, { tokenType: "{", regEx: /^{/ }, { tokenType: "?#", regEx: /^\?#/ }, { tokenType: "}", regEx: /^}/ }, { tokenType: "[", regEx: /^\[/ }, { tokenType: "]", regEx: /^\]/ }, { tokenType: "(", regEx: /^\(/ }, { tokenType: ")", regEx: /^\)/ }, { tokenType: "boolean", regEx: /^true|^false/ }, { tokenType: "identifier", regEx: /^[$a-z_]+/i }, { tokenType: ".", regEx: /^\./ }, { tokenType: ",", regEx: /^,/ }, { tokenType: "+", regEx: /^\+/ }, { tokenType: "-", regEx: /^-/ }, { tokenType: "*", regEx: /^\*/ }, { tokenType: "/", regEx: /^\// }, { tokenType: "==", regEx: /^==/ }, { tokenType: "!=", regEx: /^!=/ }, { tokenType: "<=", regEx: /^<=/ }, { tokenType: "<", regEx: /^</ }, { tokenType: ">=", regEx: /^>=/ }, { tokenType: ">", regEx: /^>/ }, { tokenType: "string", regEx: /^"([^"]*)"/ }, { tokenType: "string", regEx: /^'([^']*)'/ }, { tokenType: "number", regEx: /^\d*\.?\d+/ });
    };
    Tokenizer.parse = function (expression) {
        var result = [];
        var i = 0;
        while (i < expression.length) {
            var subExpression = expression.substring(i);
            var matchFound = false;
            for (var _i = 0, _a = Tokenizer.rules; _i < _a.length; _i++) {
                var rule = _a[_i];
                var matches = rule.regEx.exec(subExpression);
                if (matches) {
                    if (matches.length > 2) {
                        throw new Error("A tokenizer rule matched more than one group.");
                    }
                    if (rule.tokenType != undefined) {
                        result.push({
                            type: rule.tokenType,
                            value: matches[matches.length == 1 ? 0 : 1],
                            originalPosition: i
                        });
                    }
                    i += matches[0].length;
                    matchFound = true;
                    break;
                }
            }
            if (!matchFound) {
                throw new Error("Unexpected character " + subExpression[0] + " at position " + i);
            }
        }
        return result;
    };
    Tokenizer.rules = [];
    return Tokenizer;
}());
Tokenizer.init();
function ensureValueType(value) {
    if (typeof value === "number" || typeof value === "string" || typeof value === "boolean") {
        return value;
    }
    throw new Error("Invalid value type: " + typeof value);
}
var EvaluationContext = /** @class */ (function () {
    function EvaluationContext() {
        this._functions = {};
        this._stateStack = [];
    }
    EvaluationContext.init = function () {
        EvaluationContext._builtInFunctions["substr"] = function (s, index, count) {
            if (typeof s === "string" && typeof index === "number" && typeof count === "number") {
                return (s.substr(index, count));
            }
            else {
                return "";
            }
        };
        EvaluationContext._builtInFunctions["JSON.parse"] = function (input) {
            return JSON.parse(input);
        };
        EvaluationContext._builtInFunctions["if"] = function (condition, ifTrue, ifFalse) {
            return condition ? ifTrue : ifFalse;
        };
        EvaluationContext._builtInFunctions["toUpper"] = function (input) {
            return typeof input === "string" ? input.toUpperCase() : input;
        };
        EvaluationContext._builtInFunctions["toLower"] = function (input) {
            return typeof input === "string" ? input.toLowerCase() : input;
        };
        EvaluationContext._builtInFunctions["Date.format"] = function (input, format) {
            var acceptedFormats = ["long", "short", "compact"];
            var inputAsNumber;
            if (typeof input === "string") {
                inputAsNumber = Date.parse(input);
            }
            else if (typeof input === "number") {
                inputAsNumber = input;
            }
            else {
                return input;
            }
            var date = new Date(inputAsNumber);
            var effectiveFormat = "compact";
            if (typeof format === "string") {
                effectiveFormat = format.toLowerCase();
                if (acceptedFormats.indexOf(effectiveFormat) < 0) {
                    effectiveFormat = "compact";
                }
            }
            return effectiveFormat === "compact" ? date.toLocaleDateString() : date.toLocaleDateString(undefined, { day: "numeric", weekday: effectiveFormat, month: effectiveFormat, year: "numeric" });
        };
        EvaluationContext._builtInFunctions["Time.format"] = function (input) {
            var inputAsNumber;
            if (typeof input === "string") {
                inputAsNumber = Date.parse(input);
            }
            else if (typeof input === "number") {
                inputAsNumber = input;
            }
            else {
                return input;
            }
            var date = new Date(inputAsNumber);
            return date.toLocaleTimeString(undefined, { hour: 'numeric', minute: '2-digit' });
        };
    };
    EvaluationContext.prototype.registerFunction = function (name, callback) {
        this._functions[name] = callback;
    };
    EvaluationContext.prototype.unregisterFunction = function (name) {
        delete this._functions[name];
    };
    EvaluationContext.prototype.getFunction = function (name) {
        var result = this._functions[name];
        if (result == undefined) {
            result = EvaluationContext._builtInFunctions[name];
        }
        return result;
    };
    EvaluationContext.prototype.isReservedField = function (name) {
        return EvaluationContext._reservedFields.indexOf(name) >= 0;
    };
    EvaluationContext.prototype.saveState = function () {
        this._stateStack.push({ $data: this.$data, $index: this.$index });
    };
    EvaluationContext.prototype.restoreLastState = function () {
        if (this._stateStack.length == 0) {
            throw new Error("There is no evaluation context state to restore.");
        }
        var savedContext = this._stateStack.pop();
        this.$data = savedContext.$data;
        this.$index = savedContext.$index;
    };
    Object.defineProperty(EvaluationContext.prototype, "currentDataContext", {
        get: function () {
            return this.$data != undefined ? this.$data : this.$root;
        },
        enumerable: true,
        configurable: true
    });
    EvaluationContext._reservedFields = ["$data", "$root", "$index"];
    EvaluationContext._builtInFunctions = {};
    return EvaluationContext;
}());
exports.EvaluationContext = EvaluationContext;
EvaluationContext.init();
var EvaluationNode = /** @class */ (function () {
    function EvaluationNode() {
    }
    return EvaluationNode;
}());
var ExpressionNode = /** @class */ (function (_super) {
    __extends(ExpressionNode, _super);
    function ExpressionNode() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.nodes = [];
        _this.allowNull = true;
        return _this;
    }
    ExpressionNode.prototype.evaluate = function (context) {
        var operatorPriorityGroups = [
            ["/", "*"],
            ["-", "+"],
            ["==", "!=", "<", "<=", ">", ">="]
        ];
        var nodesCopy = this.nodes;
        for (var _i = 0, operatorPriorityGroups_1 = operatorPriorityGroups; _i < operatorPriorityGroups_1.length; _i++) {
            var priorityGroup = operatorPriorityGroups_1[_i];
            var i = 0;
            while (i < nodesCopy.length) {
                var node = nodesCopy[i];
                if (node instanceof OperatorNode && priorityGroup.indexOf(node.operator) >= 0) {
                    var left = ensureValueType(nodesCopy[i - 1].evaluate(context));
                    var right = ensureValueType(nodesCopy[i + 1].evaluate(context));
                    if (typeof left !== typeof right) {
                        throw new Error("Incompatible operands " + left + " and " + right + " for operator " + node.operator);
                    }
                    var result = void 0;
                    if (typeof left === "number" && typeof right === "number") {
                        switch (node.operator) {
                            case "/":
                                result = left / right;
                                break;
                            case "*":
                                result = left * right;
                                break;
                            case "-":
                                result = left - right;
                                break;
                            case "+":
                                result = left + right;
                                break;
                        }
                    }
                    if (typeof left === "string" && typeof right === "string") {
                        switch (node.operator) {
                            case "+":
                                result = left + right;
                                break;
                        }
                    }
                    switch (node.operator) {
                        case "==":
                            result = left == right;
                            break;
                        case "!=":
                            result = left != right;
                            break;
                        case "<":
                            result = left < right;
                            break;
                        case "<=":
                            result = left <= right;
                            break;
                        case ">":
                            result = left > right;
                            break;
                        case ">=":
                            result = left >= right;
                            break;
                        default:
                        // This should never happen
                    }
                    nodesCopy.splice(i - 1, 3, new LiteralNode(result));
                    i--;
                }
                i++;
            }
            ;
        }
        return nodesCopy[0].evaluate(context);
    };
    return ExpressionNode;
}(EvaluationNode));
var IdentifierNode = /** @class */ (function (_super) {
    __extends(IdentifierNode, _super);
    function IdentifierNode() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    IdentifierNode.prototype.evaluate = function (context) {
        return this.identifier;
    };
    return IdentifierNode;
}(EvaluationNode));
var IndexerNode = /** @class */ (function (_super) {
    __extends(IndexerNode, _super);
    function IndexerNode() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    IndexerNode.prototype.evaluate = function (context) {
        return this.index.evaluate(context);
    };
    return IndexerNode;
}(EvaluationNode));
var FunctionCallNode = /** @class */ (function (_super) {
    __extends(FunctionCallNode, _super);
    function FunctionCallNode() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.functionName = null;
        _this.parameters = [];
        return _this;
    }
    FunctionCallNode.prototype.evaluate = function (context) {
        var callback = context.getFunction(this.functionName);
        if (callback != undefined) {
            var evaluatedParams = [];
            for (var _i = 0, _a = this.parameters; _i < _a.length; _i++) {
                var param = _a[_i];
                evaluatedParams.push(param.evaluate(context));
            }
            return callback.apply(void 0, evaluatedParams);
        }
        throw new Error("Undefined function: " + this.functionName);
    };
    return FunctionCallNode;
}(EvaluationNode));
var LiteralNode = /** @class */ (function (_super) {
    __extends(LiteralNode, _super);
    function LiteralNode(value) {
        var _this = _super.call(this) || this;
        _this.value = value;
        return _this;
    }
    LiteralNode.prototype.evaluate = function (context) {
        return this.value;
    };
    return LiteralNode;
}(EvaluationNode));
var OperatorNode = /** @class */ (function (_super) {
    __extends(OperatorNode, _super);
    function OperatorNode(operator) {
        var _this = _super.call(this) || this;
        _this.operator = operator;
        return _this;
    }
    OperatorNode.prototype.evaluate = function (context) {
        throw new Error("An operator cannot be evaluated on its own.");
    };
    return OperatorNode;
}(EvaluationNode));
var PathNode = /** @class */ (function (_super) {
    __extends(PathNode, _super);
    function PathNode() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.parts = [];
        return _this;
    }
    PathNode.prototype.evaluate = function (context) {
        var result = undefined;
        var index = 0;
        while (index < this.parts.length) {
            var part = this.parts[index];
            try {
                if (part instanceof IdentifierNode && index == 0) {
                    switch (part.identifier) {
                        case "$root":
                            result = context.$root;
                            break;
                        case "$data":
                            result = context.currentDataContext;
                            break;
                        case "$index":
                            result = context.$index;
                            break;
                        default:
                            result = context.currentDataContext[part.identifier];
                            break;
                    }
                }
                else {
                    var partValue = part.evaluate(context);
                    if (index == 0) {
                        result = partValue;
                    }
                    else {
                        result = typeof partValue !== "boolean" ? result[partValue] : result[partValue.toString()];
                    }
                }
            }
            catch (e) {
                return undefined;
            }
            index++;
        }
        return result;
    };
    return PathNode;
}(EvaluationNode));
var ExpressionParser = /** @class */ (function () {
    function ExpressionParser(tokens) {
        this._index = 0;
        this._tokens = tokens;
    }
    ExpressionParser.prototype.unexpectedToken = function () {
        throw new Error("Unexpected token " + this.current.value + " at position " + this.current.originalPosition + ".");
    };
    ExpressionParser.prototype.unexpectedEoe = function () {
        throw new Error("Unexpected end of expression.");
    };
    ExpressionParser.prototype.moveNext = function () {
        this._index++;
    };
    ExpressionParser.prototype.parseToken = function () {
        var expectedTokenTypes = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            expectedTokenTypes[_i] = arguments[_i];
        }
        if (this.eoe) {
            this.unexpectedEoe();
        }
        var currentToken = this.current;
        if (expectedTokenTypes.indexOf(this.current.type) < 0) {
            this.unexpectedToken();
        }
        this.moveNext();
        return currentToken;
    };
    ExpressionParser.prototype.parseOptionalToken = function () {
        var expectedTokenTypes = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            expectedTokenTypes[_i] = arguments[_i];
        }
        if (this.eoe) {
            this.unexpectedEoe();
        }
        else if (expectedTokenTypes.indexOf(this.current.type) < 0) {
            return false;
        }
        else {
            this.moveNext();
            return true;
        }
    };
    ExpressionParser.prototype.parseFunctionCall = function (functionName) {
        var result = new FunctionCallNode();
        result.functionName = functionName;
        this.parseToken("(");
        var firstParameter = this.parseExpression();
        var moreParameters = false;
        if (firstParameter) {
            result.parameters.push(firstParameter);
            do {
                moreParameters = this.parseOptionalToken(",");
                if (moreParameters) {
                    var parameter = this.parseExpression();
                    result.parameters.push(parameter);
                }
            } while (moreParameters);
        }
        this.parseToken(")");
        return result;
    };
    ExpressionParser.prototype.parseIdentifier = function () {
        var result = new IdentifierNode();
        result.identifier = this.current.value;
        this.moveNext();
        return result;
    };
    ExpressionParser.prototype.parseIndexer = function () {
        var result = new IndexerNode();
        this.parseToken("[");
        result.index = this.parseExpression();
        this.parseToken("]");
        return result;
    };
    ExpressionParser.prototype.parsePath = function () {
        var result = new PathNode();
        var expectedNextTokenTypes = ["identifier", "("];
        while (!this.eoe) {
            if (expectedNextTokenTypes.indexOf(this.current.type) < 0) {
                return result;
            }
            switch (this.current.type) {
                case "(":
                    if (result.parts.length == 0) {
                        this.moveNext();
                        result.parts.push(this.parseExpression());
                        this.parseToken(")");
                    }
                    else {
                        var functionName = "";
                        for (var _i = 0, _a = result.parts; _i < _a.length; _i++) {
                            var part = _a[_i];
                            if (!(part instanceof IdentifierNode)) {
                                this.unexpectedToken();
                            }
                            if (functionName != "") {
                                functionName += ".";
                            }
                            functionName += part.identifier;
                        }
                        result.parts = [];
                        result.parts.push(this.parseFunctionCall(functionName));
                    }
                    expectedNextTokenTypes = [".", "["];
                    break;
                case "[":
                    result.parts.push(this.parseIndexer());
                    expectedNextTokenTypes = [".", "(", "["];
                    break;
                case "identifier":
                    result.parts.push(this.parseIdentifier());
                    expectedNextTokenTypes = [".", "(", "["];
                    break;
                case ".":
                    this.moveNext();
                    expectedNextTokenTypes = ["identifier"];
                    break;
                default:
                    expectedNextTokenTypes = [];
                    break;
            }
        }
    };
    ExpressionParser.prototype.parseExpression = function () {
        var result = new ExpressionNode();
        var expectedNextTokenTypes = literals.concat("(", "+", "-");
        while (!this.eoe) {
            if (expectedNextTokenTypes.indexOf(this.current.type) < 0) {
                if (result.nodes.length == 0) {
                    this.unexpectedToken();
                }
                return result;
            }
            switch (this.current.type) {
                case "(":
                case "identifier":
                    result.nodes.push(this.parsePath());
                    expectedNextTokenTypes = orderedOperators;
                    break;
                case "string":
                case "number":
                case "boolean":
                    if (this.current.type == "string") {
                        result.nodes.push(new LiteralNode(this.current.value));
                    }
                    else if (this.current.type == "number") {
                        result.nodes.push(new LiteralNode(parseFloat(this.current.value)));
                    }
                    else {
                        result.nodes.push(new LiteralNode(this.current.value === "true"));
                    }
                    this.moveNext();
                    expectedNextTokenTypes = orderedOperators;
                    break;
                case "-":
                    if (result.nodes.length == 0) {
                        result.nodes.push(new LiteralNode(-1));
                        result.nodes.push(new OperatorNode("*"));
                        expectedNextTokenTypes = ["identifier", "number", "("];
                    }
                    else {
                        result.nodes.push(new OperatorNode(this.current.type));
                        expectedNextTokenTypes = literals.concat("(");
                    }
                    this.moveNext();
                    break;
                case "+":
                    if (result.nodes.length == 0) {
                        expectedNextTokenTypes = literals.concat("(");
                    }
                    else {
                        result.nodes.push(new OperatorNode(this.current.type));
                        expectedNextTokenTypes = literals.concat("(");
                    }
                    this.moveNext();
                    break;
                case "*":
                case "/":
                case "==":
                case "!=":
                case "<":
                case "<=":
                case ">":
                case ">=":
                    result.nodes.push(new OperatorNode(this.current.type));
                    this.moveNext();
                    expectedNextTokenTypes = literals.concat("(");
                    break;
                default:
                    expectedNextTokenTypes = [];
                    break;
            }
        }
    };
    Object.defineProperty(ExpressionParser.prototype, "eoe", {
        get: function () {
            return this._index >= this._tokens.length;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(ExpressionParser.prototype, "current", {
        get: function () {
            return this._tokens[this._index];
        },
        enumerable: true,
        configurable: true
    });
    ExpressionParser.parseBinding = function (bindingExpression) {
        var parser = new ExpressionParser(Tokenizer.parse(bindingExpression));
        parser.parseToken("{");
        var allowNull = !parser.parseOptionalToken("?#");
        var expression = parser.parseExpression();
        parser.parseToken("}");
        return new Binding(expression, allowNull);
    };
    return ExpressionParser;
}());
exports.ExpressionParser = ExpressionParser;
var Binding = /** @class */ (function () {
    function Binding(expression, allowNull) {
        if (allowNull === void 0) { allowNull = true; }
        this.expression = expression;
        this.allowNull = allowNull;
    }
    Binding.prototype.evaluate = function (context) {
        return this.expression.evaluate(context);
    };
    return Binding;
}());
exports.Binding = Binding;
//# sourceMappingURL=expression-parser.js.map

/***/ }),

/***/ "./node_modules/adaptivecards-templating/lib/template-engine.js":
/*!**********************************************************************!*\
  !*** ./node_modules/adaptivecards-templating/lib/template-engine.js ***!
  \**********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
var expression_parser_1 = __webpack_require__(/*! ./expression-parser */ "./node_modules/adaptivecards-templating/lib/expression-parser.js");
var TemplatizedString = /** @class */ (function () {
    function TemplatizedString() {
        this._parts = [];
        this._shouldDropOwner = false;
    }
    TemplatizedString.parse = function (s) {
        var result = new TemplatizedString();
        var i = 0;
        do {
            var expressionFound = false;
            var start = i;
            var loop = void 0;
            do {
                loop = false;
                start = s.indexOf("{", start);
                if (start >= 0) {
                    if (start + 1 < s.length && s[start + 1] == "{") {
                        start += 2;
                        loop = true;
                    }
                }
            } while (loop);
            if (start >= 0) {
                var end = s.indexOf("}", start);
                if (end >= 0) {
                    expressionFound = true;
                    if (start > i) {
                        result._parts.push(s.substring(i, start));
                    }
                    var bindngExpression = s.substring(start, end + 1);
                    var part = void 0;
                    try {
                        part = expression_parser_1.ExpressionParser.parseBinding(bindngExpression);
                    }
                    catch (e) {
                        part = bindngExpression;
                    }
                    result._parts.push(part);
                    i = end + 1;
                }
            }
            if (!expressionFound) {
                result._parts.push(s.substr(i));
                break;
            }
        } while (i < s.length);
        if (result._parts.length == 1 && typeof result._parts[0] === "string") {
            return result._parts[0];
        }
        else {
            return result;
        }
    };
    TemplatizedString.prototype.evalExpression = function (bindingExpression, context) {
        var result = bindingExpression.evaluate(context);
        if (result == undefined) {
            this._shouldDropOwner = this._shouldDropOwner || !bindingExpression.allowNull;
        }
        return result;
    };
    TemplatizedString.prototype.internalEvaluate = function (context) {
        if (this._parts.length == 0) {
            return undefined;
        }
        else if (this._parts.length == 1) {
            if (typeof this._parts[0] === "string") {
                return this._parts[0];
            }
            else {
                return this.evalExpression(this._parts[0], context);
            }
        }
        else {
            var s = "";
            for (var _i = 0, _a = this._parts; _i < _a.length; _i++) {
                var part = _a[_i];
                if (typeof part === "string") {
                    s += part;
                }
                else {
                    s += this.evalExpression(part, context);
                }
            }
            return s;
        }
    };
    TemplatizedString.prototype.evaluate = function (context) {
        this._shouldDropOwner = false;
        return this.internalEvaluate(context);
    };
    Object.defineProperty(TemplatizedString.prototype, "shouldDropOwner", {
        get: function () {
            return this._shouldDropOwner;
        },
        enumerable: true,
        configurable: true
    });
    return TemplatizedString;
}());
exports.TemplatizedString = TemplatizedString;
var Template = /** @class */ (function () {
    function Template(payload) {
        this.preparedPayload = Template.prepare(payload);
    }
    Template.prepare = function (node) {
        if (typeof node === "string") {
            return TemplatizedString.parse(node);
        }
        else if (typeof node === "object" && node != null) {
            if (Array.isArray(node)) {
                var result = [];
                for (var _i = 0, node_1 = node; _i < node_1.length; _i++) {
                    var item = node_1[_i];
                    result.push(Template.prepare(item));
                }
                return result;
            }
            else {
                var keys = Object.keys(node);
                var result = {};
                for (var _a = 0, keys_1 = keys; _a < keys_1.length; _a++) {
                    var key = keys_1[_a];
                    result[key] = Template.prepare(node[key]);
                }
                return result;
            }
        }
        else {
            return node;
        }
    };
    Template.prototype.expandSingleObject = function (node) {
        var result = {};
        var keys = Object.keys(node);
        for (var _i = 0, keys_2 = keys; _i < keys_2.length; _i++) {
            var key = keys_2[_i];
            if (!this._context.isReservedField(key)) {
                var value = this.internalExpand(node[key]);
                if (value != undefined) {
                    result[key] = value;
                }
            }
        }
        return result;
    };
    Template.prototype.internalExpand = function (node) {
        var result;
        this._context.saveState();
        if (Array.isArray(node)) {
            var itemArray = [];
            for (var _i = 0, node_2 = node; _i < node_2.length; _i++) {
                var item = node_2[_i];
                var expandedItem = this.internalExpand(item);
                if (expandedItem != null) {
                    if (Array.isArray(expandedItem)) {
                        itemArray = itemArray.concat(expandedItem);
                    }
                    else {
                        itemArray.push(expandedItem);
                    }
                }
            }
            result = itemArray;
        }
        else if (node instanceof TemplatizedString) {
            result = node.evaluate(this._context);
            if (node.shouldDropOwner) {
                result = null;
            }
        }
        else if (typeof node === "object" && node != null) {
            var dropObject = false;
            var when = node["$when"];
            if (when instanceof TemplatizedString) {
                var whenValue = when.evaluate(this._context);
                if (typeof whenValue === "boolean") {
                    dropObject = !whenValue;
                }
            }
            if (!dropObject) {
                var dataContext = node["$data"];
                if (dataContext != undefined) {
                    if (dataContext instanceof TemplatizedString) {
                        dataContext = dataContext.evaluate(this._context);
                    }
                    if (Array.isArray(dataContext)) {
                        result = [];
                        for (var i = 0; i < dataContext.length; i++) {
                            this._context.$data = dataContext[i];
                            this._context.$index = i;
                            var expandedObject = this.expandSingleObject(node);
                            if (expandedObject != null) {
                                result.push(expandedObject);
                            }
                        }
                    }
                    else {
                        this._context.$data = dataContext;
                        result = this.expandSingleObject(node);
                    }
                }
                else {
                    result = this.expandSingleObject(node);
                }
            }
            else {
                result = null;
            }
        }
        else {
            result = node;
        }
        this._context.restoreLastState();
        return result;
    };
    Template.prototype.expand = function (context) {
        this._context = context;
        return this.internalExpand(this.preparedPayload);
    };
    return Template;
}());
exports.Template = Template;
//# sourceMappingURL=template-engine.js.map

/***/ }),

/***/ "./src/aaf.ts":
/*!********************!*\
  !*** ./src/aaf.ts ***!
  \********************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

function __export(m) {
    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];
}
Object.defineProperty(exports, "__esModule", { value: true });
__export(__webpack_require__(/*! ./core */ "./src/core.ts"));
__export(__webpack_require__(/*! ./channel-adapter */ "./src/channel-adapter.ts"));
__export(__webpack_require__(/*! ./http-channel-adapter */ "./src/http-channel-adapter.ts"));
__export(__webpack_require__(/*! ./invoke-activity */ "./src/invoke-activity.ts"));


/***/ }),

/***/ "./src/channel-adapter.ts":
/*!********************************!*\
  !*** ./src/channel-adapter.ts ***!
  \********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var ChannelAdapter = /** @class */ (function () {
    function ChannelAdapter() {
    }
    return ChannelAdapter;
}());
exports.ChannelAdapter = ChannelAdapter;


/***/ }),

/***/ "./src/core.ts":
/*!*********************!*\
  !*** ./src/core.ts ***!
  \*********************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var Adaptive = __webpack_require__(/*! adaptivecards */ "../adaptivecards/lib/adaptivecards.js");
var Templating = __webpack_require__(/*! adaptivecards-templating */ "./node_modules/adaptivecards-templating/lib/adaptivecards-templating.js");
var invoke_activity_1 = __webpack_require__(/*! ./invoke-activity */ "./src/invoke-activity.ts");
var ExecuteAction = /** @class */ (function (_super) {
    __extends(ExecuteAction, _super);
    function ExecuteAction() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    //#endregion
    ExecuteAction.prototype.getJsonTypeName = function () {
        return "Action.Execute";
    };
    //#region Schema
    ExecuteAction.verbProperty = new Adaptive.StringProperty(Adaptive.Versions.v1_2, "verb");
    __decorate([
        Adaptive.property(ExecuteAction.verbProperty)
    ], ExecuteAction.prototype, "verb", void 0);
    return ExecuteAction;
}(Adaptive.SubmitAction));
exports.ExecuteAction = ExecuteAction;
var AutoRefreshActionProperty = /** @class */ (function (_super) {
    __extends(AutoRefreshActionProperty, _super);
    function AutoRefreshActionProperty(targetVersion, name) {
        var _this = _super.call(this, targetVersion, name, undefined) || this;
        _this.targetVersion = targetVersion;
        _this.name = name;
        return _this;
    }
    AutoRefreshActionProperty.prototype.parse = function (sender, source, context) {
        var action = context.parseAction(sender.parent, source[this.name], [], false);
        if (action && action instanceof ExecuteAction) {
            return action;
        }
        else {
            context.logParseEvent(1 /* ActionTypeNotAllowed */, "\"autoRefresh\" must have its \"action\" property defined as an Action.Execute object", sender);
            return undefined;
        }
    };
    AutoRefreshActionProperty.prototype.toJSON = function (sender, target, value, context) {
        context.serializeValue(target, this.name, value ? value.toJSON(context) : undefined);
    };
    return AutoRefreshActionProperty;
}(Adaptive.PropertyDefinition));
exports.AutoRefreshActionProperty = AutoRefreshActionProperty;
var AutoRefreshDefinition = /** @class */ (function (_super) {
    __extends(AutoRefreshDefinition, _super);
    function AutoRefreshDefinition() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Object.defineProperty(AutoRefreshDefinition.prototype, "action", {
        get: function () {
            return this.getValue(AutoRefreshDefinition.actionProperty);
        },
        set: function (value) {
            this.setValue(AutoRefreshDefinition.actionProperty, value);
            if (value) {
                value.setParent(this.parent);
            }
        },
        enumerable: true,
        configurable: true
    });
    AutoRefreshDefinition.prototype.getSchemaKey = function () {
        return "AutoRefreshDefinition";
    };
    //#region Schema
    AutoRefreshDefinition.userIdsProperty = new Adaptive.StringArrayProperty(Adaptive.Versions.v1_0, "userIds");
    AutoRefreshDefinition.displayCurrentCardWhileRefreshingProperty = new Adaptive.BoolProperty(Adaptive.Versions.v1_0, "displayCurrentCardWhileRefreshing", true);
    AutoRefreshDefinition.actionProperty = new AutoRefreshActionProperty(Adaptive.Versions.v1_0, "action");
    __decorate([
        Adaptive.property(AutoRefreshDefinition.userIdsProperty)
    ], AutoRefreshDefinition.prototype, "userIds", void 0);
    __decorate([
        Adaptive.property(AutoRefreshDefinition.displayCurrentCardWhileRefreshingProperty)
    ], AutoRefreshDefinition.prototype, "displayCurrentCardWhileRefreshing", void 0);
    __decorate([
        Adaptive.property(AutoRefreshDefinition.actionProperty)
    ], AutoRefreshDefinition.prototype, "action", null);
    return AutoRefreshDefinition;
}(Adaptive.SerializableObject));
exports.AutoRefreshDefinition = AutoRefreshDefinition;
var AdaptiveAppletCard = /** @class */ (function (_super) {
    __extends(AdaptiveAppletCard, _super);
    function AdaptiveAppletCard() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Object.defineProperty(AdaptiveAppletCard.prototype, "autoRefresh", {
        get: function () {
            return this.getValue(AdaptiveAppletCard.autoRefreshProperty);
        },
        set: function (value) {
            this.setValue(AdaptiveAppletCard.autoRefreshProperty, value);
            if (value) {
                value.parent = this;
            }
        },
        enumerable: true,
        configurable: true
    });
    AdaptiveAppletCard.prototype.getSchemaKey = function () {
        return "AdaptiveAppletCard";
    };
    //#region Schema
    AdaptiveAppletCard.appIdProperty = new Adaptive.StringProperty(Adaptive.Versions.v1_0, "appId", true);
    AdaptiveAppletCard.autoRefreshProperty = new Adaptive.SerializableObjectProperty(Adaptive.Versions.v1_0, "autoRefresh", AutoRefreshDefinition, true);
    __decorate([
        Adaptive.property(AdaptiveAppletCard.appIdProperty)
    ], AdaptiveAppletCard.prototype, "appId", void 0);
    __decorate([
        Adaptive.property(AdaptiveAppletCard.autoRefreshProperty)
    ], AdaptiveAppletCard.prototype, "autoRefresh", null);
    return AdaptiveAppletCard;
}(Adaptive.AdaptiveCard));
exports.AdaptiveAppletCard = AdaptiveAppletCard;
var AdaptiveApplet = /** @class */ (function () {
    function AdaptiveApplet() {
        this.channelAdapter = undefined;
        this.renderedElement = document.createElement("div");
        this.renderedElement.style.position = "relative";
    }
    AdaptiveApplet.initialize = function () {
        Adaptive.GlobalRegistry.populateWithDefaultElements(AdaptiveApplet._elementsRegistry);
        Adaptive.GlobalRegistry.populateWithDefaultActions(AdaptiveApplet._actionsRegistry);
        AdaptiveApplet._actionsRegistry.unregister("Action.Submit");
        AdaptiveApplet._actionsRegistry.register("Action.Execute", ExecuteAction, Adaptive.Versions.v1_2);
    };
    AdaptiveApplet.prototype.displayCard = function (card) {
        if (card.renderedElement) {
            while (this.renderedElement.firstChild) {
                this.renderedElement.removeChild(this.renderedElement.firstChild);
            }
            this.renderedElement.appendChild(card.renderedElement);
        }
        else {
            throw new Error("displayCard: undefined card.");
        }
    };
    AdaptiveApplet.prototype.createActivityRequest = function (action, context) {
        if (this.card) {
            var request = {
                context: context,
                activity: {
                    type: "invoke",
                    name: "adaptiveCard/action",
                    appId: this.card.appId,
                    localTimezone: "",
                    localTimestamp: "",
                    value: {
                        action: {
                            type: "Action.Execute",
                            id: action.id,
                            verb: action.verb,
                            data: action.data
                        }
                    }
                },
                attemptNumber: 0
            };
            var cancel = this.onPrepareActivityRequest ? !this.onPrepareActivityRequest(this, action, request) : false;
            return cancel ? undefined : request;
        }
        else {
            throw new Error("createActivityRequest: no card has been set.");
        }
    };
    AdaptiveApplet.prototype.createMagicCodeInputCard = function (attemptNumber) {
        var payload = {
            type: "AdaptiveCard",
            version: "1.0",
            body: [
                {
                    type: "TextBlock",
                    color: "attention",
                    text: attemptNumber === 0 ? undefined : "That didn't work... let's try again.",
                    wrap: true,
                    horizontalAlignment: "center"
                },
                {
                    type: "TextBlock",
                    text: "Please login in the popup. You will obtain a magic code. Paste that code below and select \"Submit\"",
                    wrap: true,
                    horizontalAlignment: "center"
                },
                {
                    type: "Input.Text",
                    id: "magicCode",
                    placeholder: "Enter magic code"
                },
                {
                    type: "ActionSet",
                    horizontalAlignment: "center",
                    actions: [
                        {
                            type: "Action.Submit",
                            id: "submitMagicCode",
                            title: "Submit"
                        },
                        {
                            type: "Action.Submit",
                            id: "cancel",
                            title: "Cancel"
                        },
                        {
                            type: "Action.Submit",
                            id: "wontWork",
                            title: "This won't work"
                        }
                    ]
                }
            ]
        };
        var card = new Adaptive.AdaptiveCard();
        card.parse(payload);
        return card;
    };
    AdaptiveApplet.prototype.internalExecuteAction = function (action, context) {
        if (this.channelAdapter) {
            if (action instanceof ExecuteAction) {
                var request = this.createActivityRequest(action, context);
                if (request) {
                    this.internalSendActivityRequestAsync(request);
                }
            }
            else {
                throw new Error("internalExecuteAction: Unsupported action type.");
            }
        }
        else {
            throw new Error("internalExecuteAction: No channel adapter set.");
        }
    };
    AdaptiveApplet.prototype.internalSendActivityRequestAsync = function (request) {
        return __awaiter(this, void 0, void 0, function () {
            var overlay, done, _loop_1, this_1;
            var _this = this;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!this.channelAdapter) {
                            throw new Error("internalSendActivityRequestAsync: channelAdapter is not set.");
                        }
                        overlay = this.createProgressOverlay(request.context);
                        this.renderedElement.appendChild(overlay);
                        done = false;
                        _loop_1 = function () {
                            var response, error_1, _a, parsedResult, loginUrl, magicCodeInputCard, left, top_1, retryIn_1;
                            return __generator(this, function (_b) {
                                switch (_b.label) {
                                    case 0:
                                        response = undefined;
                                        if (request.attemptNumber === 0) {
                                            console.log("Sending activity request to channel (attempt " + (request.attemptNumber + 1) + ")");
                                        }
                                        else {
                                            console.log("Re-sending activity request to channel (attempt " + (request.attemptNumber + 1) + ")");
                                        }
                                        _b.label = 1;
                                    case 1:
                                        _b.trys.push([1, 3, , 4]);
                                        return [4 /*yield*/, this_1.channelAdapter.sendRequestAsync(request)];
                                    case 2:
                                        response = _b.sent();
                                        return [3 /*break*/, 4];
                                    case 3:
                                        error_1 = _b.sent();
                                        console.error("Activity request failed: " + error_1);
                                        this_1.renderedElement.removeChild(overlay);
                                        done = true;
                                        alert("Something went wrong: " + error_1);
                                        return [3 /*break*/, 4];
                                    case 4:
                                        if (!response) return [3 /*break*/, 10];
                                        _a = response.status;
                                        switch (_a) {
                                            case invoke_activity_1.ActivityStatus.Success: return [3 /*break*/, 5];
                                            case invoke_activity_1.ActivityStatus.Failure: return [3 /*break*/, 6];
                                        }
                                        return [3 /*break*/, 6];
                                    case 5:
                                        this_1.renderedElement.removeChild(overlay);
                                        parsedResult = undefined;
                                        try {
                                            parsedResult = JSON.parse(response.content);
                                        }
                                        catch (_c) {
                                            parsedResult = response.content;
                                        }
                                        if (typeof parsedResult === "string") {
                                            console.log("The activity request returned a string after " + (request.attemptNumber + 1) + " attempt(s).");
                                            alert(parsedResult);
                                        }
                                        else if (typeof parsedResult === "object") {
                                            switch (parsedResult["type"]) {
                                                case "AdaptiveCard":
                                                    console.log("The activity request returned an Adaptive Card after " + (request.attemptNumber + 1) + " attempt(s).");
                                                    this_1.setCard(parsedResult);
                                                    break;
                                                case "Activity.InvocationError.Unauthorized":
                                                    console.log("The activity request returned Activity.InvocationError.Unauthorized after " + (request.attemptNumber + 1) + " attempt(s).");
                                                    if ((request.attemptNumber + 1) <= AdaptiveApplet.maximumRequestAttempts) {
                                                        loginUrl = void 0;
                                                        try {
                                                            loginUrl = new URL(parsedResult["loginUrl"]);
                                                        }
                                                        catch (e) {
                                                            console.error("Invalid loginUrl: " + parsedResult["loginUrl"]);
                                                            throw e;
                                                        }
                                                        console.log("Login required at " + loginUrl.toString());
                                                        magicCodeInputCard = this_1.createMagicCodeInputCard(request.attemptNumber);
                                                        magicCodeInputCard.render();
                                                        magicCodeInputCard.onExecuteAction = function (submitMagicCodeAction) {
                                                            if (_this.card && submitMagicCodeAction instanceof Adaptive.SubmitAction) {
                                                                switch (submitMagicCodeAction.id) {
                                                                    case "submitMagicCode":
                                                                        var magicCode = undefined;
                                                                        if (submitMagicCodeAction.data && typeof submitMagicCodeAction.data["magicCode"] === "string") {
                                                                            magicCode = submitMagicCodeAction.data["magicCode"];
                                                                        }
                                                                        if (magicCode) {
                                                                            _this.displayCard(_this.card);
                                                                            request.activity.value.magicCode = magicCode;
                                                                            request.attemptNumber++;
                                                                            _this.internalSendActivityRequestAsync(request);
                                                                        }
                                                                        else {
                                                                            alert("Please enter the magic code you received.");
                                                                        }
                                                                        break;
                                                                    case "cancel":
                                                                        console.warn("Authentication cancelled by user.");
                                                                        _this.displayCard(_this.card);
                                                                        break;
                                                                    default:
                                                                        console.error("Unespected action taken from magic code input card (id = " + submitMagicCodeAction.id + ")");
                                                                        alert("Something went wrong. This action can't be handled.");
                                                                        break;
                                                                }
                                                            }
                                                        };
                                                        this_1.displayCard(magicCodeInputCard);
                                                        left = window.screenX + (window.outerWidth - AdaptiveApplet.authPromptWidth) / 2;
                                                        top_1 = window.screenY + (window.outerHeight - AdaptiveApplet.authPromptHeight) / 2;
                                                        window.open(loginUrl.toString(), "Login", "width=" + AdaptiveApplet.authPromptWidth + ",height=" + AdaptiveApplet.authPromptHeight + ",left=" + left + ",top=" + top_1);
                                                    }
                                                    else {
                                                        console.error("Authentication failed. Giving up after " + (request.attemptNumber + 1) + " attempt(s)");
                                                        alert("Authentication failed.");
                                                    }
                                                    break;
                                                default:
                                                    throw new Error("internalSendActivityRequestAsync: Action.Execute result is of unsupported type (" + typeof parsedResult + ")");
                                            }
                                        }
                                        else {
                                            throw new Error("internalSendActivityRequestAsync: Action.Execute result is of unsupported type (" + typeof parsedResult + ")");
                                        }
                                        done = true;
                                        return [3 /*break*/, 10];
                                    case 6:
                                        retryIn_1 = this_1.onActivityRequestCompleted ? this_1.onActivityRequestCompleted(this_1, response) : AdaptiveApplet.defaultTimeBetweenAttempts;
                                        if (!(retryIn_1 >= 0 && (request.attemptNumber + 1) < AdaptiveApplet.maximumRequestAttempts)) return [3 /*break*/, 8];
                                        console.warn("Activity request failed. Retrying in " + retryIn_1 + "ms");
                                        request.attemptNumber++;
                                        return [4 /*yield*/, new Promise(function (resolve, reject) {
                                                window.setTimeout(function () { resolve(); }, retryIn_1);
                                            })];
                                    case 7:
                                        _b.sent();
                                        return [3 /*break*/, 9];
                                    case 8:
                                        console.error("Activity request failed. Giving up after " + (request.attemptNumber + 1) + " attempt(s)");
                                        this_1.renderedElement.removeChild(overlay);
                                        done = true;
                                        alert(response.content);
                                        _b.label = 9;
                                    case 9: return [3 /*break*/, 10];
                                    case 10: return [2 /*return*/];
                                }
                            });
                        };
                        this_1 = this;
                        _a.label = 1;
                    case 1:
                        if (!!done) return [3 /*break*/, 3];
                        return [5 /*yield**/, _loop_1()];
                    case 2:
                        _a.sent();
                        return [3 /*break*/, 1];
                    case 3: return [2 /*return*/];
                }
            });
        });
    };
    AdaptiveApplet.prototype.createProgressOverlay = function (context) {
        var overlay = undefined;
        if (this.onCreateProgressOverlay) {
            overlay = this.onCreateProgressOverlay(this, context);
        }
        if (!overlay) {
            overlay = document.createElement("div");
            overlay.className = "aaf-progress-overlay";
            var spinner = document.createElement("div");
            spinner.className = "aaf-spinner";
            spinner.style.width = "28px";
            spinner.style.height = "28px";
            overlay.appendChild(spinner);
        }
        return overlay;
    };
    AdaptiveApplet.prototype.setCard = function (payload) {
        var _this = this;
        if (typeof payload === "object") {
            if (payload["type"] === "AdaptiveCard") {
                if (payload["$data"] !== undefined) {
                    this._cardData = payload["$data"];
                    delete payload["$data"];
                }
                this._cardPayload = payload;
            }
            else {
                this._cardData = payload;
            }
        }
        if (this._cardPayload) {
            try {
                var card = new AdaptiveAppletCard();
                var serializationContext = new Adaptive.SerializationContext();
                serializationContext.setElementRegistry(AdaptiveApplet._elementsRegistry);
                serializationContext.setActionRegistry(AdaptiveApplet._actionsRegistry);
                if (this._cardData) {
                    var evaluationContext = new Templating.EvaluationContext();
                    evaluationContext.$root = this._cardData;
                    var template = new Templating.Template(this._cardPayload);
                    var expandedCardPayload = template.expand(evaluationContext);
                    card.parse(expandedCardPayload, serializationContext);
                }
                else {
                    card.parse(this._cardPayload, serializationContext);
                }
                if (!card.appId) {
                    throw new Error("Invalid card payload. The appId property is missing.");
                }
                var doChangeCard = this.onCardChanging ? this.onCardChanging(this, this._cardPayload) : true;
                if (doChangeCard) {
                    this._card = card;
                    this._card.onExecuteAction = function (action) {
                        _this.internalExecuteAction(action, invoke_activity_1.ActivityInvocationContext.UserInteraction);
                    };
                    this._card.render();
                    if (this._card.renderedElement) {
                        this.displayCard(this._card);
                        if (this.onCardChanged) {
                            this.onCardChanged(this);
                        }
                        if (this._card.autoRefresh) {
                            this.internalExecuteAction(this._card.autoRefresh.action, invoke_activity_1.ActivityInvocationContext.AutoRefresh);
                        }
                    }
                }
            }
            catch (error) {
                // Ignore all errors
                console.error("setCard: " + error);
            }
        }
    };
    Object.defineProperty(AdaptiveApplet.prototype, "card", {
        get: function () {
            return this._card;
        },
        enumerable: true,
        configurable: true
    });
    AdaptiveApplet._elementsRegistry = new Adaptive.CardObjectRegistry();
    AdaptiveApplet._actionsRegistry = new Adaptive.CardObjectRegistry();
    AdaptiveApplet.maximumRequestAttempts = 3;
    AdaptiveApplet.defaultTimeBetweenAttempts = 3000; // 3 seconds
    AdaptiveApplet.authPromptWidth = 400;
    AdaptiveApplet.authPromptHeight = 600;
    return AdaptiveApplet;
}());
exports.AdaptiveApplet = AdaptiveApplet;
AdaptiveApplet.initialize();


/***/ }),

/***/ "./src/http-channel-adapter.ts":
/*!*************************************!*\
  !*** ./src/http-channel-adapter.ts ***!
  \*************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
Object.defineProperty(exports, "__esModule", { value: true });
var channel_adapter_1 = __webpack_require__(/*! ./channel-adapter */ "./src/channel-adapter.ts");
var invoke_activity_1 = __webpack_require__(/*! ./invoke-activity */ "./src/invoke-activity.ts");
var HttpChannelAdapter = /** @class */ (function (_super) {
    __extends(HttpChannelAdapter, _super);
    function HttpChannelAdapter(url) {
        var _this = _super.call(this) || this;
        _this.url = url;
        return _this;
    }
    HttpChannelAdapter.prototype.sendRequestAsync = function (request) {
        return __awaiter(this, void 0, void 0, function () {
            var response, _a;
            return __generator(this, function (_b) {
                switch (_b.label) {
                    case 0: return [4 /*yield*/, fetch(this.url, {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify(request.activity)
                        })];
                    case 1:
                        response = _b.sent();
                        if (!(response.status === 200)) return [3 /*break*/, 3];
                        _a = {
                            request: request,
                            status: invoke_activity_1.ActivityStatus.Success
                        };
                        return [4 /*yield*/, response.text()];
                    case 2: return [2 /*return*/, (_a.content = _b.sent(),
                            _a)];
                    case 3: return [2 /*return*/, {
                            request: request,
                            status: invoke_activity_1.ActivityStatus.Failure,
                            content: response.statusText
                        }];
                }
            });
        });
    };
    return HttpChannelAdapter;
}(channel_adapter_1.ChannelAdapter));
exports.HttpChannelAdapter = HttpChannelAdapter;


/***/ }),

/***/ "./src/invoke-activity.ts":
/*!********************************!*\
  !*** ./src/invoke-activity.ts ***!
  \********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var ActivityInvocationContext;
(function (ActivityInvocationContext) {
    ActivityInvocationContext[ActivityInvocationContext["AutoRefresh"] = 0] = "AutoRefresh";
    ActivityInvocationContext[ActivityInvocationContext["UserInteraction"] = 1] = "UserInteraction";
})(ActivityInvocationContext = exports.ActivityInvocationContext || (exports.ActivityInvocationContext = {}));
var ActivityStatus;
(function (ActivityStatus) {
    ActivityStatus[ActivityStatus["Success"] = 0] = "Success";
    ActivityStatus[ActivityStatus["Failure"] = 1] = "Failure";
})(ActivityStatus = exports.ActivityStatus || (exports.ActivityStatus = {}));


/***/ })

/******/ });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9BQUZSdW50aW1lL3dlYnBhY2svdW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbiIsIndlYnBhY2s6Ly9BQUZSdW50aW1lL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL0FBRlJ1bnRpbWUvLi4vYWRhcHRpdmVjYXJkcy9saWIvYWRhcHRpdmVjYXJkcy5qcyIsIndlYnBhY2s6Ly9BQUZSdW50aW1lLy4uL2FkYXB0aXZlY2FyZHMvbGliL2NhcmQtZWxlbWVudHMuanMiLCJ3ZWJwYWNrOi8vQUFGUnVudGltZS8uLi9hZGFwdGl2ZWNhcmRzL2xpYi9jYXJkLW9iamVjdC5qcyIsIndlYnBhY2s6Ly9BQUZSdW50aW1lLy4uL2FkYXB0aXZlY2FyZHMvbGliL2VudW1zLmpzIiwid2VicGFjazovL0FBRlJ1bnRpbWUvLi4vYWRhcHRpdmVjYXJkcy9saWIvaG9zdC1jYXBhYmlsaXRpZXMuanMiLCJ3ZWJwYWNrOi8vQUFGUnVudGltZS8uLi9hZGFwdGl2ZWNhcmRzL2xpYi9ob3N0LWNvbmZpZy5qcyIsIndlYnBhY2s6Ly9BQUZSdW50aW1lLy4uL2FkYXB0aXZlY2FyZHMvbGliL3JlZ2lzdHJ5LmpzIiwid2VicGFjazovL0FBRlJ1bnRpbWUvLi4vYWRhcHRpdmVjYXJkcy9saWIvc2VyaWFsaXphdGlvbi5qcyIsIndlYnBhY2s6Ly9BQUZSdW50aW1lLy4uL2FkYXB0aXZlY2FyZHMvbGliL3NoYXJlZC5qcyIsIndlYnBhY2s6Ly9BQUZSdW50aW1lLy4uL2FkYXB0aXZlY2FyZHMvbGliL3RleHQtZm9ybWF0dGVycy5qcyIsIndlYnBhY2s6Ly9BQUZSdW50aW1lLy4uL2FkYXB0aXZlY2FyZHMvbGliL3V0aWxzLmpzIiwid2VicGFjazovL0FBRlJ1bnRpbWUvLi9ub2RlX21vZHVsZXMvYWRhcHRpdmVjYXJkcy10ZW1wbGF0aW5nL2xpYi9hZGFwdGl2ZWNhcmRzLXRlbXBsYXRpbmcuanMiLCJ3ZWJwYWNrOi8vQUFGUnVudGltZS8uL25vZGVfbW9kdWxlcy9hZGFwdGl2ZWNhcmRzLXRlbXBsYXRpbmcvbGliL2V4cHJlc3Npb24tcGFyc2VyLmpzIiwid2VicGFjazovL0FBRlJ1bnRpbWUvLi9ub2RlX21vZHVsZXMvYWRhcHRpdmVjYXJkcy10ZW1wbGF0aW5nL2xpYi90ZW1wbGF0ZS1lbmdpbmUuanMiLCJ3ZWJwYWNrOi8vQUFGUnVudGltZS8uL3NyYy9hYWYudHMiLCJ3ZWJwYWNrOi8vQUFGUnVudGltZS8uL3NyYy9jaGFubmVsLWFkYXB0ZXIudHMiLCJ3ZWJwYWNrOi8vQUFGUnVudGltZS8uL3NyYy9jb3JlLnRzIiwid2VicGFjazovL0FBRlJ1bnRpbWUvLi9zcmMvaHR0cC1jaGFubmVsLWFkYXB0ZXIudHMiLCJ3ZWJwYWNrOi8vQUFGUnVudGltZS8uL3NyYy9pbnZva2UtYWN0aXZpdHkudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNELE87UUNWQTtRQUNBOztRQUVBO1FBQ0E7O1FBRUE7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7O1FBRUE7UUFDQTs7UUFFQTtRQUNBOztRQUVBO1FBQ0E7UUFDQTs7O1FBR0E7UUFDQTs7UUFFQTtRQUNBOztRQUVBO1FBQ0E7UUFDQTtRQUNBLDBDQUEwQyxnQ0FBZ0M7UUFDMUU7UUFDQTs7UUFFQTtRQUNBO1FBQ0E7UUFDQSx3REFBd0Qsa0JBQWtCO1FBQzFFO1FBQ0EsaURBQWlELGNBQWM7UUFDL0Q7O1FBRUE7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBO1FBQ0E7UUFDQTtRQUNBLHlDQUF5QyxpQ0FBaUM7UUFDMUUsZ0hBQWdILG1CQUFtQixFQUFFO1FBQ3JJO1FBQ0E7O1FBRUE7UUFDQTtRQUNBO1FBQ0EsMkJBQTJCLDBCQUEwQixFQUFFO1FBQ3ZELGlDQUFpQyxlQUFlO1FBQ2hEO1FBQ0E7UUFDQTs7UUFFQTtRQUNBLHNEQUFzRCwrREFBK0Q7O1FBRXJIO1FBQ0E7OztRQUdBO1FBQ0E7Ozs7Ozs7Ozs7Ozs7QUNsRmE7QUFDYjtBQUNBO0FBQ0E7QUFDQSw4Q0FBOEMsY0FBYztBQUM1RDtBQUNBO0FBQ0EsU0FBUyxtQkFBTyxDQUFDLDhEQUFpQjtBQUNsQyxTQUFTLG1CQUFPLENBQUMsb0RBQVk7QUFDN0IsU0FBUyxtQkFBTyxDQUFDLDBEQUFlO0FBQ2hDLFNBQVMsbUJBQU8sQ0FBQyw4REFBaUI7QUFDbEMsU0FBUyxtQkFBTyxDQUFDLDhDQUFTO0FBQzFCLFNBQVMsbUJBQU8sQ0FBQywwREFBZTtBQUNoQyxTQUFTLG1CQUFPLENBQUMsZ0RBQVU7QUFDM0IsU0FBUyxtQkFBTyxDQUFDLDhDQUFTO0FBQzFCLHlDOzs7Ozs7Ozs7Ozs7QUNmYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGNBQWMsZ0JBQWdCLHNDQUFzQyxpQkFBaUIsRUFBRTtBQUN2Riw2QkFBNkIsdURBQXVEO0FBQ3BGO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLHNCQUFzQjtBQUM3QztBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLDRDQUE0QyxRQUFRO0FBQ3BEO0FBQ0E7QUFDQSw4Q0FBOEMsY0FBYztBQUM1RDtBQUNBO0FBQ0EsWUFBWSxtQkFBTyxDQUFDLDhDQUFTO0FBQzdCLGVBQWUsbUJBQU8sQ0FBQyxnREFBVTtBQUNqQyxZQUFZLG1CQUFPLENBQUMsOENBQVM7QUFDN0Isb0JBQW9CLG1CQUFPLENBQUMsMERBQWU7QUFDM0MscUJBQXFCLG1CQUFPLENBQUMsa0VBQW1CO0FBQ2hELG9CQUFvQixtQkFBTyxDQUFDLDBEQUFlO0FBQzNDLHNCQUFzQixtQkFBTyxDQUFDLDhEQUFpQjtBQUMvQyxpQkFBaUIsbUJBQU8sQ0FBQyxvREFBWTtBQUNyQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0VBQWdFO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLG1CQUFtQjtBQUN2RCxzQ0FBc0MscUJBQXFCO0FBQzNELHVDQUF1QyxzQkFBc0I7QUFDN0QscUNBQXFDLG9CQUFvQjtBQUN6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUNBQXlDLHdCQUF3QjtBQUNqRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTCx1SEFBdUgsSUFBSTtBQUMzSDtBQUNBO0FBQ0E7QUFDQSxTQUFTLGdCQUFnQjtBQUN6QixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4Q0FBOEMsMkJBQTJCO0FBQ3pFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdIQUFnSDtBQUNoSDtBQUNBO0FBQ0EscUdBQXFHO0FBQ3JHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixvQkFBb0I7QUFDL0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlDQUF5Qyx5QkFBeUI7QUFDbEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0Msa0JBQWtCO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0RBQW9ELGdCQUFnQjtBQUNwRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnREFBZ0QsZ0JBQWdCO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdEQUFnRCxnQkFBZ0I7QUFDaEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNENBQTRDLGdCQUFnQjtBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsdUJBQXVCO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlGQUFpRjtBQUNqRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLG1DQUFtQztBQUMvRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLHVCQUF1Qix5QkFBeUI7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5Q0FBeUMsd0JBQXdCO0FBQ2pFO0FBQ0E7QUFDQSwyQkFBMkIseUJBQXlCO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1Qix5QkFBeUI7QUFDaEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLHlCQUF5QjtBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQix5QkFBeUI7QUFDcEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtDQUErQyxnQkFBZ0I7QUFDL0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdLQUFnSyx3QkFBd0IsRUFBRTtBQUMxTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkNBQTJDLGdCQUFnQjtBQUMzRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQyxnQkFBZ0I7QUFDM0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlCQUF5QixvQ0FBb0M7QUFDN0Q7QUFDQSwyQ0FBMkMsZ0JBQWdCO0FBQzNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDQUFxQyxzQkFBc0I7QUFDM0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyREFBMkQsc0JBQXNCO0FBQ2pGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLDJKQUEySixlQUFlLEVBQUU7QUFDNUssOEpBQThKLGdCQUFnQixFQUFFO0FBQ2hMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkNBQTJDLGdCQUFnQjtBQUMzRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMENBQTBDLHNCQUFzQjtBQUNoRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbURBQW1ELGdCQUFnQjtBQUNuRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDREQUE0RCxzQkFBc0I7QUFDbEY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkNBQTJDLGdCQUFnQjtBQUMzRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZEQUE2RCxnQkFBZ0I7QUFDN0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5REFBeUQsZ0JBQWdCO0FBQ3pFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsU0FBUyxtQkFBbUI7QUFDNUIsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3REFBd0Qsc0JBQXNCO0FBQzlFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzREFBc0Qsc0JBQXNCO0FBQzVFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOERBQThELEVBQUUsT0FBTyxFQUFFO0FBQ3pFO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzREFBc0Qsc0JBQXNCO0FBQzVFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnRUFBZ0UsZ0JBQWdCO0FBQ2hGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDLGdDQUFnQztBQUN0RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLHVDQUF1QztBQUN2RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxTQUFTLG1DQUFtQztBQUM1QyxTQUFTLG9DQUFvQztBQUM3QyxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaURBQWlELHlCQUF5QjtBQUMxRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzREFBc0QsZ0JBQWdCO0FBQ3RFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUVBQW1FLGdCQUFnQjtBQUNuRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DLHVCQUF1QjtBQUMxRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0RBQXdELGdCQUFnQjtBQUN4RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLGlEQUFpRCxnQkFBZ0I7QUFDakU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLLElBQUkscUJBQXFCLFdBQVcsRUFBRTtBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUZBQW1GLCtDQUErQyxFQUFFO0FBQ3BJO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLFdBQVc7QUFDekMsK0JBQStCLFlBQVk7QUFDM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQ0FBMkMsZ0JBQWdCO0FBQzNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0NBQStDLGdCQUFnQjtBQUMvRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtDQUErQyxnQkFBZ0I7QUFDL0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtEQUErRCw4QkFBOEI7QUFDN0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVDQUF1Qyx1QkFBdUI7QUFDOUQsb0NBQW9DLG1CQUFtQjtBQUN2RDtBQUNBLDZEQUE2RDtBQUM3RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQyxnQkFBZ0I7QUFDM0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkNBQTJDLGdCQUFnQjtBQUMzRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBK0MsZ0JBQWdCO0FBQy9EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQyxnQkFBZ0I7QUFDM0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBK0Msc0JBQXNCO0FBQ3JFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUNBQXlDLGdCQUFnQjtBQUN6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5Q0FBeUMsZ0JBQWdCO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtCQUErQix1QkFBdUI7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrRUFBa0UseUJBQXlCO0FBQzNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQyxnQkFBZ0I7QUFDM0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQix5QkFBeUI7QUFDcEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlDQUF5QyxnQkFBZ0I7QUFDekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5Q0FBeUMsZ0JBQWdCO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUyxzQ0FBc0M7QUFDL0MsU0FBUyx1Q0FBdUM7QUFDaEQsU0FBUyxtRkFBbUY7QUFDNUYsU0FBUyxpRkFBaUY7QUFDMUYsU0FBUyxzRkFBc0Y7QUFDL0YsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhDQUE4QyxnQkFBZ0I7QUFDOUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOENBQThDLGdCQUFnQjtBQUM5RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMENBQTBDLGdCQUFnQjtBQUMxRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFEQUFxRCx5QkFBeUI7QUFDOUU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNEQUFzRCxnQkFBZ0I7QUFDdEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdEQUF3RCxRQUFRO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBDQUEwQyxnQkFBZ0I7QUFDMUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNENBQTRDLFFBQVE7QUFDcEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrREFBa0QsZ0JBQWdCO0FBQ2xFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsbUJBQW1CO0FBQ2xEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0RBQWdELGdCQUFnQjtBQUNoRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0RBQWdELGdCQUFnQjtBQUNoRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNENBQTRDLGdCQUFnQjtBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0Q0FBNEMsZ0JBQWdCO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseURBQXlELDJCQUEyQjtBQUNwRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRDQUE0QyxnQkFBZ0I7QUFDNUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0RBQWdELGdCQUFnQjtBQUNoRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdEQUFnRCxnQkFBZ0I7QUFDaEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0Q0FBNEMsZ0JBQWdCO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0Q0FBNEMsZ0JBQWdCO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDLDJCQUEyQjtBQUNuRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUNBQXlDLHdCQUF3QjtBQUNqRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLHlDOzs7Ozs7Ozs7Ozs7QUM1MEthO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsY0FBYyxnQkFBZ0Isc0NBQXNDLGlCQUFpQixFQUFFO0FBQ3ZGLDZCQUE2Qix1REFBdUQ7QUFDcEY7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsc0JBQXNCO0FBQzdDO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsNENBQTRDLFFBQVE7QUFDcEQ7QUFDQTtBQUNBLDhDQUE4QyxjQUFjO0FBQzVELGVBQWUsbUJBQU8sQ0FBQyxnREFBVTtBQUNqQywwQkFBMEIsbUJBQU8sQ0FBQyxzRUFBcUI7QUFDdkQsc0JBQXNCLG1CQUFPLENBQUMsOERBQWlCO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLHVDOzs7Ozs7Ozs7Ozs7QUN0SWE7QUFDYjtBQUNBO0FBQ0EsOENBQThDLGNBQWM7QUFDNUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsMkNBQTJDO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQyx1REFBdUQ7QUFDeEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLHVEQUF1RDtBQUN4RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQyw2REFBNkQ7QUFDOUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLHVEQUF1RDtBQUN4RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLG9EQUFvRDtBQUNyRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLDBEQUEwRDtBQUMzRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQyx3RkFBd0Y7QUFDekY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsa0ZBQWtGO0FBQ25GO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsNEVBQTRFO0FBQzdFO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQyw2REFBNkQ7QUFDOUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLHFGQUFxRjtBQUN0RjtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsZ0VBQWdFO0FBQ2pFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsdURBQXVEO0FBQ3hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQyx3RkFBd0Y7QUFDekY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQyx5RUFBeUU7QUFDMUU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsdUdBQXVHO0FBQ3hHO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLGlDOzs7Ozs7Ozs7Ozs7QUM1SmE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxjQUFjLGdCQUFnQixzQ0FBc0MsaUJBQWlCLEVBQUU7QUFDdkYsNkJBQTZCLHVEQUF1RDtBQUNwRjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixzQkFBc0I7QUFDN0M7QUFDQTtBQUNBLENBQUM7QUFDRCw4Q0FBOEMsY0FBYztBQUM1RDtBQUNBO0FBQ0Esc0JBQXNCLG1CQUFPLENBQUMsOERBQWlCO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSw2Qzs7Ozs7Ozs7Ozs7O0FDbEZhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsY0FBYyxnQkFBZ0Isc0NBQXNDLGlCQUFpQixFQUFFO0FBQ3ZGLDZCQUE2Qix1REFBdUQ7QUFDcEY7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsc0JBQXNCO0FBQzdDO0FBQ0E7QUFDQSxDQUFDO0FBQ0QsOENBQThDLGNBQWM7QUFDNUQ7QUFDQTtBQUNBLFlBQVksbUJBQU8sQ0FBQyw4Q0FBUztBQUM3QixZQUFZLG1CQUFPLENBQUMsOENBQVM7QUFDN0IsYUFBYSxtQkFBTyxDQUFDLGdEQUFVO0FBQy9CLDBCQUEwQixtQkFBTyxDQUFDLHNFQUFxQjtBQUN2RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QiwwQ0FBMEM7QUFDbEUscUJBQXFCLDBDQUEwQztBQUMvRCxzQkFBc0IsMENBQTBDO0FBQ2hFLHVCQUF1QiwwQ0FBMEM7QUFDakUscUJBQXFCLDBDQUEwQztBQUMvRCx3QkFBd0IsMENBQTBDO0FBQ2xFLDBCQUEwQjtBQUMxQixTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1RUFBdUUsZ0NBQWdDO0FBQ3ZHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3Qix1QkFBdUI7QUFDL0M7QUFDQTtBQUNBO0FBQ0EsbURBQW1ELDBCQUEwQjtBQUM3RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3Qix1QkFBdUI7QUFDL0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxDQUFDO0FBQ0QsdUM7Ozs7Ozs7Ozs7OztBQ2o0QmE7QUFDYiw4Q0FBOEMsY0FBYztBQUM1RDtBQUNBO0FBQ0Esc0JBQXNCLG1CQUFPLENBQUMsOERBQWlCO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUMsK0NBQStDO0FBQ3RGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLG9DOzs7Ozs7Ozs7Ozs7QUM5Q2E7QUFDYjtBQUNBO0FBQ0E7QUFDQSxjQUFjLGdCQUFnQixzQ0FBc0MsaUJBQWlCLEVBQUU7QUFDdkYsNkJBQTZCLHVEQUF1RDtBQUNwRjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixzQkFBc0I7QUFDN0M7QUFDQTtBQUNBLENBQUM7QUFDRCw4Q0FBOEMsY0FBYztBQUM1RDtBQUNBO0FBQ0EsZUFBZSxtQkFBTyxDQUFDLGdEQUFVO0FBQ2pDLFlBQVksbUJBQU8sQ0FBQyw4Q0FBUztBQUM3QixZQUFZLG1CQUFPLENBQUMsOENBQVM7QUFDN0I7QUFDQTtBQUNBLCtCQUErQixXQUFXO0FBQzFDLCtCQUErQixXQUFXO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUMsaUNBQWlDO0FBQ3hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDLDBCQUEwQjtBQUNoRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDLDBCQUEwQjtBQUNoRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0NBQXNDLDBCQUEwQjtBQUNoRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2REFBNkQsNkJBQTZCO0FBQzFGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBK0MsOEJBQThCO0FBQzdFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxREFBcUQsMkJBQTJCO0FBQ2hGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOENBQThDLGdCQUFnQjtBQUM5RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQ0FBMEMsZ0JBQWdCO0FBQzFEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3Q0FBd0MscUJBQXFCO0FBQzdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhDQUE4QyxnQkFBZ0I7QUFDOUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4Q0FBOEMsZ0JBQWdCO0FBQzlEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQyxrQkFBa0I7QUFDcEQseUZBQXlGLDREQUE0RCxFQUFFO0FBQ3ZKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5RkFBeUYsV0FBVyxFQUFFO0FBQ3RHO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUVBQW1FLGdDQUFnQztBQUNuRztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsNkJBQTZCO0FBQ3BEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsdUJBQXVCO0FBQy9DO0FBQ0E7QUFDQSx1QkFBdUIsdUJBQXVCO0FBQzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLHVCQUF1QjtBQUMvQztBQUNBO0FBQ0EsbURBQW1ELDBCQUEwQjtBQUM3RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBDQUEwQyxnQ0FBZ0M7QUFDMUUsK0NBQStDLGdDQUFnQztBQUMvRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLGtCQUFrQjtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFHQUFxRztBQUNyRztBQUNBO0FBQ0EsMkJBQTJCLGtCQUFrQjtBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLGtCQUFrQjtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLGtCQUFrQjtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsa0JBQWtCO0FBQ3pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLHlDOzs7Ozs7Ozs7Ozs7QUMzeUJhO0FBQ2IsOENBQThDLGNBQWM7QUFDNUQ7QUFDQTtBQUNBLFlBQVksbUJBQU8sQ0FBQyw4Q0FBUztBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJDQUEyQyxzQkFBc0I7QUFDakU7QUFDQSwwQ0FBMEMsRUFBRSw0QkFBNEIsRUFBRTtBQUMxRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLEVBQUUsdUJBQXVCLEVBQUU7QUFDdkQ7QUFDQTtBQUNBLDBEQUEwRCxnQkFBZ0I7QUFDMUU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSw2QkFBNkIsU0FBUztBQUN0QywrQkFBK0IsV0FBVztBQUMxQyxnQ0FBZ0MsWUFBWTtBQUM1Qyw4QkFBOEIsVUFBVTtBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSw2QkFBNkIsMEJBQTBCO0FBQ3ZELCtCQUErQiw0QkFBNEI7QUFDM0QsZ0NBQWdDLDZCQUE2QjtBQUM3RCw4QkFBOEIsMkJBQTJCO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOENBQThDLDhCQUE4QjtBQUM1RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsU0FBUztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQSxrQzs7Ozs7Ozs7Ozs7O0FDdkxhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsY0FBYyxnQkFBZ0Isc0NBQXNDLGlCQUFpQixFQUFFO0FBQ3ZGLDZCQUE2Qix1REFBdUQ7QUFDcEY7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsc0JBQXNCO0FBQzdDO0FBQ0E7QUFDQSxDQUFDO0FBQ0QsOENBQThDLGNBQWM7QUFDNUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtEQUFrRCxrRUFBa0U7QUFDcEg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOENBQThDLHFDQUFxQztBQUNuRjtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQSw4QkFBOEIsRUFBRSxVQUFVLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxtQkFBbUIsRUFBRSxJQUFJLEVBQUUsb0NBQW9DLEVBQUU7QUFDM0ksOEJBQThCLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsbUJBQW1CLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRTtBQUMvRztBQUNBO0FBQ0EsK0NBQStDLDBCQUEwQjtBQUN6RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQzs7Ozs7Ozs7Ozs7O0FDOUVhO0FBQ2IsOENBQThDLGNBQWM7QUFDNUQ7QUFDQTtBQUNBLFlBQVksbUJBQU8sQ0FBQyw4Q0FBUztBQUM3QixhQUFhLG1CQUFPLENBQUMsZ0RBQVU7QUFDL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdDQUFnQyxFQUFFLFdBQVcsRUFBRSxXQUFXLEVBQUUsV0FBVyxFQUFFO0FBQ3pFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUM7Ozs7Ozs7Ozs7OztBQ2pNYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLDhDQUE4QyxjQUFjO0FBQzVEO0FBQ0E7QUFDQSxTQUFTLG1CQUFPLENBQUMsNkZBQXFCO0FBQ3RDLFNBQVMsbUJBQU8sQ0FBQyx5RkFBbUI7QUFDcEMsb0Q7Ozs7Ozs7Ozs7OztBQ1RhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsY0FBYyxnQkFBZ0Isc0NBQXNDLGlCQUFpQixFQUFFO0FBQ3ZGLDZCQUE2Qix1REFBdUQ7QUFDcEY7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsc0JBQXNCO0FBQzdDO0FBQ0E7QUFDQSxDQUFDO0FBQ0QsOENBQThDLGNBQWM7QUFDNUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEIscUNBQXFDLEdBQUcsY0FBYyxhQUFhLEdBQUcsR0FBRyxpQ0FBaUMsR0FBRyxjQUFjLGFBQWEsR0FBRyxHQUFHLCtCQUErQixHQUFHLCtCQUErQixHQUFHLCtCQUErQixHQUFHLCtCQUErQixHQUFHLDhDQUE4QyxHQUFHLCtDQUErQyxHQUFHLCtCQUErQixHQUFHLDhCQUE4QixHQUFHLCtCQUErQixHQUFHLDhCQUE4QixHQUFHLCtCQUErQixHQUFHLCtCQUErQixHQUFHLGdDQUFnQyxHQUFHLGdDQUFnQyxHQUFHLGdDQUFnQyxHQUFHLDhCQUE4QixHQUFHLGdDQUFnQyxHQUFHLDhCQUE4QixHQUFHLDJDQUEyQyxHQUFHLDJDQUEyQyxHQUFHLDJDQUEyQztBQUN0N0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrREFBa0QsZ0JBQWdCO0FBQ2xFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUhBQW1ILG9GQUFvRjtBQUN2TTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVEQUF1RCxxQ0FBcUM7QUFDNUY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IseUNBQXlDO0FBQ3hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkVBQTJFLHNDQUFzQztBQUNqSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrREFBa0QsZ0JBQWdCO0FBQ2xFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsdUJBQXVCO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsdUJBQXVCO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyREFBMkQsZ0JBQWdCO0FBQzNFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLDRCQUE0QjtBQUM1QjtBQUNBO0FBQ0EsNEJBQTRCO0FBQzVCO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUMsa0JBQWtCO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0EsNkM7Ozs7Ozs7Ozs7OztBQzNtQmE7QUFDYiw4Q0FBOEMsY0FBYztBQUM1RDtBQUNBO0FBQ0EsMEJBQTBCLG1CQUFPLENBQUMsNkZBQXFCO0FBQ3ZEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0M7QUFDcEM7QUFDQSxrRUFBa0U7QUFDbEU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQSxzQ0FBc0M7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOENBQThDLGdCQUFnQjtBQUM5RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBK0Msb0JBQW9CO0FBQ25FO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQ0FBK0Msb0JBQW9CO0FBQ25FO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUNBQXVDLG9CQUFvQjtBQUMzRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQ0FBMkMsb0JBQW9CO0FBQy9EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVDQUF1Qyx3QkFBd0I7QUFDL0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLDJDOzs7Ozs7Ozs7Ozs7Ozs7OztBQ25PQSw2REFBdUI7QUFDdkIsbUZBQWtDO0FBQ2xDLDZGQUF1QztBQUN2QyxtRkFBaUM7Ozs7Ozs7Ozs7Ozs7OztBQ0RqQztJQUFBO0lBRUEsQ0FBQztJQUFELHFCQUFDO0FBQUQsQ0FBQztBQUZxQix3Q0FBYzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDRnBDLGlHQUEwQztBQUMxQyxnSkFBdUQ7QUFFdkQsaUdBQWlIO0FBRWpIO0lBQW1DLGlDQUFxQjtJQUF4RDs7SUFhQSxDQUFDO0lBTEcsWUFBWTtJQUVaLHVDQUFlLEdBQWY7UUFDSSxPQUFPLGdCQUFnQixDQUFDO0lBQzVCLENBQUM7SUFYRCxnQkFBZ0I7SUFFQSwwQkFBWSxHQUFHLElBQUksUUFBUSxDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztJQUczRjtRQURDLFFBQVEsQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLFlBQVksQ0FBQzsrQ0FDakM7SUFPakIsb0JBQUM7Q0FBQSxDQWJrQyxRQUFRLENBQUMsWUFBWSxHQWF2RDtBQWJZLHNDQUFhO0FBZTFCO0lBQStDLDZDQUEyQjtJQXlCdEUsbUNBQXFCLGFBQStCLEVBQVcsSUFBWTtRQUEzRSxZQUNJLGtCQUFNLGFBQWEsRUFBRSxJQUFJLEVBQUUsU0FBUyxDQUFDLFNBQ3hDO1FBRm9CLG1CQUFhLEdBQWIsYUFBYSxDQUFrQjtRQUFXLFVBQUksR0FBSixJQUFJLENBQVE7O0lBRTNFLENBQUM7SUExQkQseUNBQUssR0FBTCxVQUFNLE1BQTZCLEVBQUUsTUFBNEIsRUFBRSxPQUFzQztRQUNyRyxJQUFJLE1BQU0sR0FBRyxPQUFPLENBQUMsV0FBVyxDQUM1QixNQUFNLENBQUMsTUFBTSxFQUNiLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQ2pCLEVBQUUsRUFDRixLQUFLLENBQUMsQ0FBQztRQUVYLElBQUksTUFBTSxJQUFJLE1BQU0sWUFBWSxhQUFhLEVBQUU7WUFDM0MsT0FBTyxNQUFNLENBQUM7U0FDakI7YUFDSTtZQUNELE9BQU8sQ0FBQyxhQUFhLCtCQUVqQix1RkFBdUYsRUFDdkYsTUFBTSxDQUFDLENBQUM7WUFFWixPQUFPLFNBQVMsQ0FBQztTQUNwQjtJQUNMLENBQUM7SUFFRCwwQ0FBTSxHQUFOLFVBQU8sTUFBbUMsRUFBRSxNQUE0QixFQUFFLEtBQWdDLEVBQUUsT0FBc0M7UUFDOUksT0FBTyxDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQ3pGLENBQUM7SUFLTCxnQ0FBQztBQUFELENBQUMsQ0E1QjhDLFFBQVEsQ0FBQyxrQkFBa0IsR0E0QnpFO0FBNUJZLDhEQUF5QjtBQThCdEM7SUFBMkMseUNBQTJCO0lBQXRFOztJQWlDQSxDQUFDO0lBbkJHLHNCQUFJLHlDQUFNO2FBQVY7WUFDSSxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMscUJBQXFCLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDL0QsQ0FBQzthQUVELFVBQVcsS0FBb0I7WUFDM0IsSUFBSSxDQUFDLFFBQVEsQ0FBQyxxQkFBcUIsQ0FBQyxjQUFjLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFFM0QsSUFBSSxLQUFLLEVBQUU7Z0JBQ1AsS0FBSyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7YUFDaEM7UUFDTCxDQUFDOzs7T0FSQTtJQVVTLDRDQUFZLEdBQXRCO1FBQ0ksT0FBTyx1QkFBdUIsQ0FBQztJQUNuQyxDQUFDO0lBM0JELGdCQUFnQjtJQUVBLHFDQUFlLEdBQUcsSUFBSSxRQUFRLENBQUMsbUJBQW1CLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFDLENBQUM7SUFDdEYsK0RBQXlDLEdBQUcsSUFBSSxRQUFRLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLG1DQUFtQyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ3pJLG9DQUFjLEdBQUcsSUFBSSx5QkFBeUIsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxRQUFRLENBQUMsQ0FBQztJQUdqRztRQURDLFFBQVEsQ0FBQyxRQUFRLENBQUMscUJBQXFCLENBQUMsZUFBZSxDQUFDOzBEQUN2QztJQUdsQjtRQURDLFFBQVEsQ0FBQyxRQUFRLENBQUMscUJBQXFCLENBQUMseUNBQXlDLENBQUM7b0ZBQ3hDO0lBRzNDO1FBREMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxxQkFBcUIsQ0FBQyxjQUFjLENBQUM7dURBR3ZEO0lBaUJMLDRCQUFDO0NBQUEsQ0FqQzBDLFFBQVEsQ0FBQyxrQkFBa0IsR0FpQ3JFO0FBakNZLHNEQUFxQjtBQW1DbEM7SUFBd0Msc0NBQXFCO0lBQTdEOztJQTJCQSxDQUFDO0lBakJHLHNCQUFJLDJDQUFXO2FBQWY7WUFDSSxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsa0JBQWtCLENBQUMsbUJBQW1CLENBQUMsQ0FBQztRQUNqRSxDQUFDO2FBRUQsVUFBZ0IsS0FBd0M7WUFDcEQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxrQkFBa0IsQ0FBQyxtQkFBbUIsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUU3RCxJQUFJLEtBQUssRUFBRTtnQkFDUCxLQUFLLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQzthQUN2QjtRQUNMLENBQUM7OztPQVJBO0lBVVMseUNBQVksR0FBdEI7UUFDSSxPQUFPLG9CQUFvQixDQUFDO0lBQ2hDLENBQUM7SUF2QkQsZ0JBQWdCO0lBRUEsZ0NBQWEsR0FBRyxJQUFJLFFBQVEsQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ25GLHNDQUFtQixHQUFHLElBQUksUUFBUSxDQUFDLDBCQUEwQixDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLGFBQWEsRUFBRSxxQkFBcUIsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUdsSjtRQURDLFFBQVEsQ0FBQyxRQUFRLENBQUMsa0JBQWtCLENBQUMsYUFBYSxDQUFDO3FEQUN0QztJQUdkO1FBREMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxrQkFBa0IsQ0FBQyxtQkFBbUIsQ0FBQzt5REFHekQ7SUFlTCx5QkFBQztDQUFBLENBM0J1QyxRQUFRLENBQUMsWUFBWSxHQTJCNUQ7QUEzQlksZ0RBQWtCO0FBNkIvQjtJQTBWSTtRQVJBLG1CQUFjLEdBQStCLFNBQVMsQ0FBQztRQVNuRCxJQUFJLENBQUMsZUFBZSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDckQsSUFBSSxDQUFDLGVBQWUsQ0FBQyxLQUFLLENBQUMsUUFBUSxHQUFHLFVBQVUsQ0FBQztJQUNyRCxDQUFDO0lBcFZNLHlCQUFVLEdBQWpCO1FBQ0ksUUFBUSxDQUFDLGNBQWMsQ0FBQywyQkFBMkIsQ0FBQyxjQUFjLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUN0RixRQUFRLENBQUMsY0FBYyxDQUFDLDBCQUEwQixDQUFDLGNBQWMsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBRXBGLGNBQWMsQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUMsZUFBZSxDQUFDLENBQUM7UUFDNUQsY0FBYyxDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxnQkFBZ0IsRUFBRSxhQUFhLEVBQUUsUUFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUN0RyxDQUFDO0lBTU8sb0NBQVcsR0FBbkIsVUFBb0IsSUFBMkI7UUFDM0MsSUFBSSxJQUFJLENBQUMsZUFBZSxFQUFFO1lBQ3RCLE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQyxVQUFVLEVBQUU7Z0JBQ3BDLElBQUksQ0FBQyxlQUFlLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsVUFBVSxDQUFDLENBQUM7YUFDckU7WUFFRCxJQUFJLENBQUMsZUFBZSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUM7U0FDMUQ7YUFDSTtZQUNELE1BQU0sSUFBSSxLQUFLLENBQUMsOEJBQThCLENBQUMsQ0FBQztTQUNuRDtJQUNMLENBQUM7SUFFTyw4Q0FBcUIsR0FBN0IsVUFBOEIsTUFBcUIsRUFBRSxPQUFrQztRQUNuRixJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUU7WUFDWCxJQUFJLE9BQU8sR0FBb0I7Z0JBQzNCLE9BQU8sRUFBRSxPQUFPO2dCQUNoQixRQUFRLEVBQUU7b0JBQ04sSUFBSSxFQUFFLFFBQVE7b0JBQ2QsSUFBSSxFQUFFLHFCQUFxQjtvQkFDM0IsS0FBSyxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSztvQkFDdEIsYUFBYSxFQUFFLEVBQUU7b0JBQ2pCLGNBQWMsRUFBRSxFQUFFO29CQUNsQixLQUFLLEVBQUU7d0JBQ0gsTUFBTSxFQUFFOzRCQUNKLElBQUksRUFBRSxnQkFBZ0I7NEJBQ3RCLEVBQUUsRUFBRSxNQUFNLENBQUMsRUFBRTs0QkFDYixJQUFJLEVBQUUsTUFBTSxDQUFDLElBQUk7NEJBQ2pCLElBQUksRUFBRSxNQUFNLENBQUMsSUFBSTt5QkFDcEI7cUJBQ0o7aUJBQ0o7Z0JBQ0QsYUFBYSxFQUFFLENBQUM7YUFDbkIsQ0FBQztZQUVGLElBQUksTUFBTSxHQUFHLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsd0JBQXdCLENBQUMsSUFBSSxFQUFFLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO1lBRTNHLE9BQU8sTUFBTSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQztTQUN2QzthQUNJO1lBQ0QsTUFBTSxJQUFJLEtBQUssQ0FBQyw4Q0FBOEMsQ0FBQyxDQUFDO1NBQ25FO0lBQ0wsQ0FBQztJQUVPLGlEQUF3QixHQUFoQyxVQUFpQyxhQUFxQjtRQUNsRCxJQUFJLE9BQU8sR0FBRztZQUNWLElBQUksRUFBRSxjQUFjO1lBQ3BCLE9BQU8sRUFBRSxLQUFLO1lBQ2QsSUFBSSxFQUFFO2dCQUNGO29CQUNJLElBQUksRUFBRSxXQUFXO29CQUNqQixLQUFLLEVBQUUsV0FBVztvQkFDbEIsSUFBSSxFQUFFLGFBQWEsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsc0NBQXNDO29CQUM5RSxJQUFJLEVBQUUsSUFBSTtvQkFDVixtQkFBbUIsRUFBRSxRQUFRO2lCQUNoQztnQkFDRDtvQkFDSSxJQUFJLEVBQUUsV0FBVztvQkFDakIsSUFBSSxFQUFFLHNHQUFzRztvQkFDNUcsSUFBSSxFQUFFLElBQUk7b0JBQ1YsbUJBQW1CLEVBQUUsUUFBUTtpQkFDaEM7Z0JBQ0Q7b0JBQ0ksSUFBSSxFQUFFLFlBQVk7b0JBQ2xCLEVBQUUsRUFBRSxXQUFXO29CQUNmLFdBQVcsRUFBRSxrQkFBa0I7aUJBQ2xDO2dCQUNEO29CQUNJLElBQUksRUFBRSxXQUFXO29CQUNqQixtQkFBbUIsRUFBRSxRQUFRO29CQUM3QixPQUFPLEVBQUU7d0JBQ0w7NEJBQ0ksSUFBSSxFQUFFLGVBQWU7NEJBQ3JCLEVBQUUsRUFBRSxpQkFBaUI7NEJBQ3JCLEtBQUssRUFBRSxRQUFRO3lCQUNsQjt3QkFDRDs0QkFDSSxJQUFJLEVBQUUsZUFBZTs0QkFDckIsRUFBRSxFQUFFLFFBQVE7NEJBQ1osS0FBSyxFQUFFLFFBQVE7eUJBQ2xCO3dCQUNEOzRCQUNJLElBQUksRUFBRSxlQUFlOzRCQUNyQixFQUFFLEVBQUUsVUFBVTs0QkFDZCxLQUFLLEVBQUUsaUJBQWlCO3lCQUMzQjtxQkFDSjtpQkFDSjthQUNKO1NBQ0osQ0FBQztRQUVGLElBQUksSUFBSSxHQUFHLElBQUksUUFBUSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ3ZDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7UUFFcEIsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQztJQUVPLDhDQUFxQixHQUE3QixVQUE4QixNQUF1QixFQUFFLE9BQWtDO1FBQ3JGLElBQUksSUFBSSxDQUFDLGNBQWMsRUFBRTtZQUNyQixJQUFJLE1BQU0sWUFBWSxhQUFhLEVBQUU7Z0JBQ2pDLElBQUksT0FBTyxHQUFHLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUM7Z0JBRTFELElBQUksT0FBTyxFQUFFO29CQUNULElBQUksQ0FBQyxnQ0FBZ0MsQ0FBQyxPQUFPLENBQUMsQ0FBQztpQkFDbEQ7YUFDSjtpQkFDSTtnQkFDRCxNQUFNLElBQUksS0FBSyxDQUFDLGlEQUFpRCxDQUFDLENBQUM7YUFDdEU7U0FDSjthQUNJO1lBQ0QsTUFBTSxJQUFJLEtBQUssQ0FBQyxnREFBZ0QsQ0FBQyxDQUFDO1NBQ3JFO0lBQ0wsQ0FBQztJQUVhLHlEQUFnQyxHQUE5QyxVQUErQyxPQUF3Qjs7Ozs7Ozt3QkFDbkUsSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUU7NEJBQ3RCLE1BQU0sSUFBSSxLQUFLLENBQUMsOERBQThELENBQUM7eUJBQ2xGO3dCQUVHLE9BQU8sR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO3dCQUUxRCxJQUFJLENBQUMsZUFBZSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsQ0FBQzt3QkFFdEMsSUFBSSxHQUFHLEtBQUssQ0FBQzs7Ozs7O3dDQUdULFFBQVEsR0FBaUMsU0FBUyxDQUFDO3dDQUV2RCxJQUFJLE9BQU8sQ0FBQyxhQUFhLEtBQUssQ0FBQyxFQUFFOzRDQUM3QixPQUFPLENBQUMsR0FBRyxDQUFDLCtDQUErQyxHQUFHLENBQUMsT0FBTyxDQUFDLGFBQWEsR0FBRyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQzt5Q0FDcEc7NkNBQ0k7NENBQ0QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrREFBa0QsR0FBRyxDQUFDLE9BQU8sQ0FBQyxhQUFhLEdBQUcsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUM7eUNBQ3ZHOzs7O3dDQUdjLHFCQUFNLE9BQUssY0FBYyxDQUFDLGdCQUFnQixDQUFDLE9BQU8sQ0FBQzs7d0NBQTlELFFBQVEsR0FBRyxTQUFtRCxDQUFDOzs7O3dDQUcvRCxPQUFPLENBQUMsS0FBSyxDQUFDLDJCQUEyQixHQUFHLE9BQUssQ0FBQyxDQUFDO3dDQUVuRCxPQUFLLGVBQWUsQ0FBQyxXQUFXLENBQUMsT0FBTyxDQUFDLENBQUM7d0NBRTFDLElBQUksR0FBRyxJQUFJLENBQUM7d0NBRVosS0FBSyxDQUFDLHdCQUF3QixHQUFHLE9BQUssQ0FBQyxDQUFDOzs7NkNBR3hDLFFBQVEsRUFBUix5QkFBUTt3Q0FDQSxhQUFRLENBQUMsTUFBTTs7aURBQ2QsZ0NBQWMsQ0FBQyxPQUFPLENBQUMsQ0FBdkIsd0JBQXNCO2lEQTRHdEIsZ0NBQWMsQ0FBQyxPQUFPLENBQUMsQ0FBdkIsd0JBQXNCOzs7O3dDQTNHdkIsT0FBSyxlQUFlLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxDQUFDO3dDQUV0QyxZQUFZLEdBQVEsU0FBUyxDQUFDO3dDQUVsQyxJQUFJOzRDQUNBLFlBQVksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQzt5Q0FDL0M7d0NBQ0QsV0FBTTs0Q0FDRixZQUFZLEdBQUcsUUFBUSxDQUFDLE9BQU8sQ0FBQzt5Q0FDbkM7d0NBRUQsSUFBSSxPQUFPLFlBQVksS0FBSyxRQUFRLEVBQUU7NENBQ2xDLE9BQU8sQ0FBQyxHQUFHLENBQUMsK0NBQStDLEdBQUcsQ0FBQyxPQUFPLENBQUMsYUFBYSxHQUFHLENBQUMsQ0FBQyxHQUFHLGNBQWMsQ0FBQyxDQUFDOzRDQUU1RyxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUM7eUNBQ3ZCOzZDQUNJLElBQUksT0FBTyxZQUFZLEtBQUssUUFBUSxFQUFFOzRDQUN2QyxRQUFRLFlBQVksQ0FBQyxNQUFNLENBQUMsRUFBRTtnREFDMUIsS0FBSyxjQUFjO29EQUNmLE9BQU8sQ0FBQyxHQUFHLENBQUMsdURBQXVELEdBQUcsQ0FBQyxPQUFPLENBQUMsYUFBYSxHQUFHLENBQUMsQ0FBQyxHQUFHLGNBQWMsQ0FBQyxDQUFDO29EQUVwSCxPQUFLLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQztvREFFM0IsTUFBTTtnREFDVixLQUFLLHVDQUF1QztvREFDeEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyw0RUFBNEUsR0FBRyxDQUFDLE9BQU8sQ0FBQyxhQUFhLEdBQUcsQ0FBQyxDQUFDLEdBQUcsY0FBYyxDQUFDLENBQUM7b0RBRXpJLElBQUksQ0FBQyxPQUFPLENBQUMsYUFBYSxHQUFHLENBQUMsQ0FBQyxJQUFJLGNBQWMsQ0FBQyxzQkFBc0IsRUFBRTt3REFDbEUsUUFBUSxTQUFLLENBQUM7d0RBRWxCLElBQUk7NERBQ0EsUUFBUSxHQUFHLElBQUksR0FBRyxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO3lEQUNoRDt3REFDRCxPQUFPLENBQUMsRUFBRTs0REFDTixPQUFPLENBQUMsS0FBSyxDQUFDLG9CQUFvQixHQUFHLFlBQVksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDOzREQUUvRCxNQUFNLENBQUMsQ0FBQzt5REFDWDt3REFFRCxPQUFPLENBQUMsR0FBRyxDQUFDLG9CQUFvQixHQUFHLFFBQVEsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO3dEQUVwRCxrQkFBa0IsR0FBRyxPQUFLLHdCQUF3QixDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQzt3REFDOUUsa0JBQWtCLENBQUMsTUFBTSxFQUFFLENBQUM7d0RBQzVCLGtCQUFrQixDQUFDLGVBQWUsR0FBRyxVQUFDLHFCQUFzQzs0REFDeEUsSUFBSSxLQUFJLENBQUMsSUFBSSxJQUFJLHFCQUFxQixZQUFZLFFBQVEsQ0FBQyxZQUFZLEVBQUU7Z0VBQ3JFLFFBQVEscUJBQXFCLENBQUMsRUFBRSxFQUFFO29FQUM5QixLQUFLLGlCQUFpQjt3RUFDbEIsSUFBSSxTQUFTLEdBQXVCLFNBQVMsQ0FBQzt3RUFFOUMsSUFBSSxxQkFBcUIsQ0FBQyxJQUFJLElBQUksT0FBYSxxQkFBcUIsQ0FBQyxJQUFLLENBQUMsV0FBVyxDQUFDLEtBQUssUUFBUSxFQUFFOzRFQUNsRyxTQUFTLEdBQVMscUJBQXFCLENBQUMsSUFBSyxDQUFDLFdBQVcsQ0FBQyxDQUFDO3lFQUM5RDt3RUFFRCxJQUFJLFNBQVMsRUFBRTs0RUFDWCxLQUFJLENBQUMsV0FBVyxDQUFDLEtBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQzs0RUFFNUIsT0FBTyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsU0FBUyxHQUFHLFNBQVMsQ0FBQzs0RUFDN0MsT0FBTyxDQUFDLGFBQWEsRUFBRSxDQUFDOzRFQUV4QixLQUFJLENBQUMsZ0NBQWdDLENBQUMsT0FBTyxDQUFDLENBQUM7eUVBQ2xEOzZFQUNJOzRFQUNELEtBQUssQ0FBQywyQ0FBMkMsQ0FBQyxDQUFDO3lFQUN0RDt3RUFFRCxNQUFNO29FQUNWLEtBQUssUUFBUTt3RUFDVCxPQUFPLENBQUMsSUFBSSxDQUFDLG1DQUFtQyxDQUFDLENBQUM7d0VBRWxELEtBQUksQ0FBQyxXQUFXLENBQUMsS0FBSSxDQUFDLElBQUksQ0FBQyxDQUFDO3dFQUU1QixNQUFNO29FQUNWO3dFQUNJLE9BQU8sQ0FBQyxLQUFLLENBQUMsMkRBQTJELEdBQUcscUJBQXFCLENBQUMsRUFBRSxHQUFHLEdBQUcsQ0FBQyxDQUFDO3dFQUU1RyxLQUFLLENBQUMscURBQXFELENBQUMsQ0FBQzt3RUFFN0QsTUFBTTtpRUFDYjs2REFDSjt3REFDTCxDQUFDO3dEQUVELE9BQUssV0FBVyxDQUFDLGtCQUFrQixDQUFDLENBQUM7d0RBRWpDLElBQUksR0FBRyxNQUFNLENBQUMsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLFVBQVUsR0FBRyxjQUFjLENBQUMsZUFBZSxDQUFDLEdBQUcsQ0FBQyxDQUFDO3dEQUNqRixRQUFNLE1BQU0sQ0FBQyxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsV0FBVyxHQUFHLGNBQWMsQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsQ0FBQzt3REFFdEYsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxFQUFFLEVBQUUsT0FBTyxFQUFFLFdBQVMsY0FBYyxDQUFDLGVBQWUsZ0JBQVcsY0FBYyxDQUFDLGdCQUFnQixjQUFTLElBQUksYUFBUSxLQUFLLENBQUMsQ0FBQztxREFDMUo7eURBQ0k7d0RBQ0QsT0FBTyxDQUFDLEtBQUssQ0FBQyx5Q0FBeUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxhQUFhLEdBQUcsQ0FBQyxDQUFDLEdBQUcsYUFBYSxDQUFDLENBQUM7d0RBRXZHLEtBQUssQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO3FEQUNuQztvREFFRCxNQUFNO2dEQUNWO29EQUNJLE1BQU0sSUFBSSxLQUFLLENBQUMsa0ZBQWtGLEdBQUcsT0FBTyxZQUFZLEdBQUcsR0FBRyxDQUFDLENBQUM7NkNBQ3ZJO3lDQUNKOzZDQUNJOzRDQUNELE1BQU0sSUFBSSxLQUFLLENBQUMsa0ZBQWtGLEdBQUcsT0FBTyxZQUFZLEdBQUcsR0FBRyxDQUFDLENBQUM7eUNBQ25JO3dDQUVELElBQUksR0FBRyxJQUFJLENBQUM7d0NBRVoseUJBQU07O3dDQUdGLFlBQWtCLE9BQUssMEJBQTBCLENBQUMsQ0FBQyxDQUFDLE9BQUssMEJBQTBCLFNBQU8sUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQywwQkFBMEIsQ0FBQzs2Q0FFaEosVUFBTyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLEdBQUcsQ0FBQyxDQUFDLEdBQUcsY0FBYyxDQUFDLHNCQUFzQixHQUFuRix3QkFBbUY7d0NBQ25GLE9BQU8sQ0FBQyxJQUFJLENBQUMsdUNBQXVDLEdBQUcsU0FBTyxHQUFHLElBQUksQ0FBQyxDQUFDO3dDQUV2RSxPQUFPLENBQUMsYUFBYSxFQUFFLENBQUM7d0NBRXhCLHFCQUFNLElBQUksT0FBTyxDQUNiLFVBQUMsT0FBTyxFQUFFLE1BQU07Z0RBQ1osTUFBTSxDQUFDLFVBQVUsQ0FDYixjQUFRLE9BQU8sRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUNwQixTQUFPLENBQ1Y7NENBQ0wsQ0FBQyxDQUFDOzt3Q0FOTixTQU1NLENBQUM7Ozt3Q0FHUCxPQUFPLENBQUMsS0FBSyxDQUFDLDJDQUEyQyxHQUFHLENBQUMsT0FBTyxDQUFDLGFBQWEsR0FBRyxDQUFDLENBQUMsR0FBRyxhQUFhLENBQUMsQ0FBQzt3Q0FFekcsT0FBSyxlQUFlLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxDQUFDO3dDQUUxQyxJQUFJLEdBQUcsSUFBSSxDQUFDO3dDQUVaLEtBQUssQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUM7OzRDQUc1Qix5QkFBTTs7Ozs7Ozs7NkJBaEtmLENBQUMsSUFBSTs7Ozs7Ozs7O0tBb0tmO0lBRU8sOENBQXFCLEdBQTdCLFVBQThCLE9BQWtDO1FBQzVELElBQUksT0FBTyxHQUE0QixTQUFTLENBQUM7UUFFakQsSUFBSSxJQUFJLENBQUMsdUJBQXVCLEVBQUU7WUFDOUIsT0FBTyxHQUFHLElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUM7U0FDekQ7UUFFRCxJQUFJLENBQUMsT0FBTyxFQUFFO1lBQ1YsT0FBTyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDeEMsT0FBTyxDQUFDLFNBQVMsR0FBRyxzQkFBc0IsQ0FBQztZQUUzQyxJQUFJLE9BQU8sR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzVDLE9BQU8sQ0FBQyxTQUFTLEdBQUcsYUFBYSxDQUFDO1lBQ2xDLE9BQU8sQ0FBQyxLQUFLLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQztZQUM3QixPQUFPLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7WUFFOUIsT0FBTyxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsQ0FBQztTQUNoQztRQUVELE9BQU8sT0FBTyxDQUFDO0lBQ25CLENBQUM7SUFrQkQsZ0NBQU8sR0FBUCxVQUFRLE9BQVk7UUFBcEIsaUJBb0VDO1FBbkVHLElBQUksT0FBTyxPQUFPLEtBQUssUUFBUSxFQUFFO1lBQzdCLElBQUksT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLLGNBQWMsRUFBRTtnQkFDcEMsSUFBSSxPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssU0FBUyxFQUFFO29CQUNoQyxJQUFJLENBQUMsU0FBUyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztvQkFDbEMsT0FBTyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7aUJBQzNCO2dCQUVELElBQUksQ0FBQyxZQUFZLEdBQUcsT0FBTyxDQUFDO2FBQy9CO2lCQUNJO2dCQUNELElBQUksQ0FBQyxTQUFTLEdBQUcsT0FBTyxDQUFDO2FBQzVCO1NBQ0o7UUFFRCxJQUFJLElBQUksQ0FBQyxZQUFZLEVBQUU7WUFDbkIsSUFBSTtnQkFDQSxJQUFJLElBQUksR0FBRyxJQUFJLGtCQUFrQixFQUFFLENBQUM7Z0JBRXBDLElBQUksb0JBQW9CLEdBQUcsSUFBSSxRQUFRLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztnQkFDL0Qsb0JBQW9CLENBQUMsa0JBQWtCLENBQUMsY0FBYyxDQUFDLGlCQUFpQixDQUFDLENBQUM7Z0JBQzFFLG9CQUFvQixDQUFDLGlCQUFpQixDQUFDLGNBQWMsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO2dCQUV4RSxJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUU7b0JBQ2hCLElBQUksaUJBQWlCLEdBQUcsSUFBSSxVQUFVLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztvQkFDM0QsaUJBQWlCLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUM7b0JBRXpDLElBQUksUUFBUSxHQUFHLElBQUksVUFBVSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDO29CQUN6RCxJQUFJLG1CQUFtQixHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUMsQ0FBQztvQkFFN0QsSUFBSSxDQUFDLEtBQUssQ0FBQyxtQkFBbUIsRUFBRSxvQkFBb0IsQ0FBQyxDQUFDO2lCQUN6RDtxQkFDSTtvQkFDRCxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsb0JBQW9CLENBQUMsQ0FBQztpQkFDdkQ7Z0JBRUQsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUU7b0JBQ2IsTUFBTSxJQUFJLEtBQUssQ0FBQyxzREFBc0QsQ0FBQztpQkFDMUU7Z0JBRUQsSUFBSSxZQUFZLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7Z0JBRTdGLElBQUksWUFBWSxFQUFFO29CQUNkLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO29CQUNsQixJQUFJLENBQUMsS0FBSyxDQUFDLGVBQWUsR0FBRyxVQUFDLE1BQXVCO3dCQUNqRCxLQUFJLENBQUMscUJBQXFCLENBQUMsTUFBTSxFQUFFLDJDQUF5QixDQUFDLGVBQWUsQ0FBQyxDQUFDO29CQUNsRixDQUFDO29CQUVELElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUM7b0JBRXBCLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxlQUFlLEVBQUU7d0JBQzVCLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO3dCQUU3QixJQUFJLElBQUksQ0FBQyxhQUFhLEVBQUU7NEJBQ3BCLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUM7eUJBQzVCO3dCQUVELElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLEVBQUU7NEJBQ3hCLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxNQUFNLEVBQUUsMkNBQXlCLENBQUMsV0FBVyxDQUFDLENBQUM7eUJBQ3BHO3FCQUNKO2lCQUNKO2FBQ0o7WUFDRCxPQUFPLEtBQUssRUFBRTtnQkFDVixvQkFBb0I7Z0JBQ3BCLE9BQU8sQ0FBQyxLQUFLLENBQUMsV0FBVyxHQUFHLEtBQUssQ0FBQyxDQUFDO2FBQ3RDO1NBQ0o7SUFDTCxDQUFDO0lBRUQsc0JBQUksZ0NBQUk7YUFBUjtZQUNJLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQztRQUN0QixDQUFDOzs7T0FBQTtJQXRhYyxnQ0FBaUIsR0FBRyxJQUFJLFFBQVEsQ0FBQyxrQkFBa0IsRUFBd0IsQ0FBQztJQUM1RSwrQkFBZ0IsR0FBRyxJQUFJLFFBQVEsQ0FBQyxrQkFBa0IsRUFBbUIsQ0FBQztJQUU5RSxxQ0FBc0IsR0FBVyxDQUFDLENBQUM7SUFDbkMseUNBQTBCLEdBQVcsSUFBSSxDQUFDLENBQUMsWUFBWTtJQUN2RCw4QkFBZSxHQUFXLEdBQUcsQ0FBQztJQUM5QiwrQkFBZ0IsR0FBVyxHQUFHLENBQUM7SUFpYTFDLHFCQUFDO0NBQUE7QUF4YVksd0NBQWM7QUEwYTNCLGNBQWMsQ0FBQyxVQUFVLEVBQUUsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDNWhCNUIsaUdBQW1EO0FBQ25ELGlHQUFzRjtBQUd0RjtJQUF3QyxzQ0FBYztJQUNsRCw0QkFBcUIsR0FBVztRQUFoQyxZQUNJLGlCQUFPLFNBQ1Y7UUFGb0IsU0FBRyxHQUFILEdBQUcsQ0FBUTs7SUFFaEMsQ0FBQztJQUVLLDZDQUFnQixHQUF0QixVQUF1QixPQUF3Qjs7Ozs7NEJBQzVCLHFCQUFNLEtBQUssQ0FDdEIsSUFBSSxDQUFDLEdBQUcsRUFDUjs0QkFDSSxNQUFNLEVBQUUsTUFBTTs0QkFDZCxPQUFPLEVBQUU7Z0NBQ0wsY0FBYyxFQUFFLGtCQUFrQjs2QkFDckM7NEJBQ0QsSUFBSSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQzt5QkFDekMsQ0FDSjs7d0JBVEcsUUFBUSxHQUFHLFNBU2Q7NkJBRUcsU0FBUSxDQUFDLE1BQU0sS0FBSyxHQUFHLEdBQXZCLHdCQUF1Qjs7NEJBRW5CLE9BQU8sRUFBRSxPQUFPOzRCQUNoQixNQUFNLEVBQUUsZ0NBQWMsQ0FBQyxPQUFPOzt3QkFDckIscUJBQU0sUUFBUSxDQUFDLElBQUksRUFBRTs0QkFIbEMsdUJBR0ksVUFBTyxHQUFFLFNBQXFCO2lDQUNoQzs0QkFHRixzQkFBTzs0QkFDSCxPQUFPLEVBQUUsT0FBTzs0QkFDaEIsTUFBTSxFQUFFLGdDQUFjLENBQUMsT0FBTzs0QkFDOUIsT0FBTyxFQUFFLFFBQVEsQ0FBQyxVQUFVO3lCQUMvQjs7OztLQWlEUjtJQUNMLHlCQUFDO0FBQUQsQ0FBQyxDQS9FdUMsZ0NBQWMsR0ErRXJEO0FBL0VZLGdEQUFrQjs7Ozs7Ozs7Ozs7Ozs7O0FDeUIvQixJQUFZLHlCQUdYO0FBSEQsV0FBWSx5QkFBeUI7SUFDakMsdUZBQVc7SUFDWCwrRkFBZTtBQUNuQixDQUFDLEVBSFcseUJBQXlCLEdBQXpCLGlDQUF5QixLQUF6QixpQ0FBeUIsUUFHcEM7QUFRRCxJQUFZLGNBR1g7QUFIRCxXQUFZLGNBQWM7SUFDdEIseURBQU87SUFDUCx5REFBTztBQUNYLENBQUMsRUFIVyxjQUFjLEdBQWQsc0JBQWMsS0FBZCxzQkFBYyxRQUd6QiIsImZpbGUiOiJhYWYuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkge1xuXHRpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpXG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XG5cdGVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKVxuXHRcdGRlZmluZShbXSwgZmFjdG9yeSk7XG5cdGVsc2UgaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKVxuXHRcdGV4cG9ydHNbXCJBQUZSdW50aW1lXCJdID0gZmFjdG9yeSgpO1xuXHRlbHNlXG5cdFx0cm9vdFtcIkFBRlJ1bnRpbWVcIl0gPSBmYWN0b3J5KCk7XG59KSh3aW5kb3csIGZ1bmN0aW9uKCkge1xucmV0dXJuICIsIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSBcIi4vc3JjL2FhZi50c1wiKTtcbiIsIlwidXNlIHN0cmljdFwiO1xyXG5mdW5jdGlvbiBfX2V4cG9ydChtKSB7XHJcbiAgICBmb3IgKHZhciBwIGluIG0pIGlmICghZXhwb3J0cy5oYXNPd25Qcm9wZXJ0eShwKSkgZXhwb3J0c1twXSA9IG1bcF07XHJcbn1cclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG4vLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG5fX2V4cG9ydChyZXF1aXJlKFwiLi9zZXJpYWxpemF0aW9uXCIpKTtcclxuX19leHBvcnQocmVxdWlyZShcIi4vcmVnaXN0cnlcIikpO1xyXG5fX2V4cG9ydChyZXF1aXJlKFwiLi9jYXJkLW9iamVjdFwiKSk7XHJcbl9fZXhwb3J0KHJlcXVpcmUoXCIuL2NhcmQtZWxlbWVudHNcIikpO1xyXG5fX2V4cG9ydChyZXF1aXJlKFwiLi9lbnVtc1wiKSk7XHJcbl9fZXhwb3J0KHJlcXVpcmUoXCIuL2hvc3QtY29uZmlnXCIpKTtcclxuX19leHBvcnQocmVxdWlyZShcIi4vc2hhcmVkXCIpKTtcclxuX19leHBvcnQocmVxdWlyZShcIi4vdXRpbHNcIikpO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hZGFwdGl2ZWNhcmRzLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xyXG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XHJcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxyXG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xyXG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xyXG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XHJcbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xyXG4gICAgfTtcclxufSkoKTtcclxudmFyIF9fZGVjb3JhdGUgPSAodGhpcyAmJiB0aGlzLl9fZGVjb3JhdGUpIHx8IGZ1bmN0aW9uIChkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xyXG4gICAgdmFyIGMgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYyA8IDMgPyB0YXJnZXQgOiBkZXNjID09PSBudWxsID8gZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpIDogZGVzYywgZDtcclxuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5kZWNvcmF0ZSA9PT0gXCJmdW5jdGlvblwiKSByID0gUmVmbGVjdC5kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYyk7XHJcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xyXG4gICAgcmV0dXJuIGMgPiAzICYmIHIgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCByKSwgcjtcclxufTtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG4vLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG52YXIgRW51bXMgPSByZXF1aXJlKFwiLi9lbnVtc1wiKTtcclxudmFyIHNoYXJlZF8xID0gcmVxdWlyZShcIi4vc2hhcmVkXCIpO1xyXG52YXIgVXRpbHMgPSByZXF1aXJlKFwiLi91dGlsc1wiKTtcclxudmFyIGhvc3RfY29uZmlnXzEgPSByZXF1aXJlKFwiLi9ob3N0LWNvbmZpZ1wiKTtcclxudmFyIFRleHRGb3JtYXR0ZXJzID0gcmVxdWlyZShcIi4vdGV4dC1mb3JtYXR0ZXJzXCIpO1xyXG52YXIgY2FyZF9vYmplY3RfMSA9IHJlcXVpcmUoXCIuL2NhcmQtb2JqZWN0XCIpO1xyXG52YXIgc2VyaWFsaXphdGlvbl8xID0gcmVxdWlyZShcIi4vc2VyaWFsaXphdGlvblwiKTtcclxudmFyIHJlZ2lzdHJ5XzEgPSByZXF1aXJlKFwiLi9yZWdpc3RyeVwiKTtcclxudmFyIENhcmRFbGVtZW50ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKENhcmRFbGVtZW50LCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gQ2FyZEVsZW1lbnQoKSB7XHJcbiAgICAgICAgLy8jcmVnaW9uIFNjaGVtYVxyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLl90cnVuY2F0ZWREdWVUb092ZXJmbG93ID0gZmFsc2U7XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENhcmRFbGVtZW50LnByb3RvdHlwZSwgXCJsYW5nXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIGxhbmcgPSB0aGlzLmdldFZhbHVlKENhcmRFbGVtZW50LmxhbmdQcm9wZXJ0eSk7XHJcbiAgICAgICAgICAgIGlmIChsYW5nKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbGFuZztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnBhcmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcmVudC5sYW5nO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICAgICAgdGhpcy5zZXRWYWx1ZShDYXJkRWxlbWVudC5sYW5nUHJvcGVydHksIHZhbHVlKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDYXJkRWxlbWVudC5wcm90b3R5cGUsIFwiaXNWaXNpYmxlXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VmFsdWUoQ2FyZEVsZW1lbnQuaXNWaXNpYmxlUHJvcGVydHkpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICAgICAgLy8gSWYgdGhlIGVsZW1lbnQgaXMgZ29pbmcgdG8gYmUgaGlkZGVuLCByZXNldCBhbnkgY2hhbmdlcyB0aGF0IHdlcmUgZHVlXHJcbiAgICAgICAgICAgIC8vIHRvIG92ZXJmbG93IHRydW5jYXRpb24gKHRoaXMgZW5zdXJlcyB0aGF0IGlmIHRoZSBlbGVtZW50IGlzIGxhdGVyXHJcbiAgICAgICAgICAgIC8vIHVuLWhpZGRlbiBpdCBoYXMgdGhlIHJpZ2h0IGNvbnRlbnQpXHJcbiAgICAgICAgICAgIGlmIChzaGFyZWRfMS5HbG9iYWxTZXR0aW5ncy51c2VBZHZhbmNlZENhcmRCb3R0b21UcnVuY2F0aW9uICYmICF2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy51bmRvT3ZlcmZsb3dUcnVuY2F0aW9uKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMuaXNWaXNpYmxlICE9PSB2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRWYWx1ZShDYXJkRWxlbWVudC5pc1Zpc2libGVQcm9wZXJ0eSwgdmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVSZW5kZXJlZEVsZW1lbnRWaXNpYmlsaXR5KCk7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcmVuZGVyZWRFbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmFpc2VFbGVtZW50VmlzaWJpbGl0eUNoYW5nZWRFdmVudCh0aGlzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgQ2FyZEVsZW1lbnQucHJvdG90eXBlLmludGVybmFsUmVuZGVyU2VwYXJhdG9yID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciByZW5kZXJlZFNlcGFyYXRvciA9IFV0aWxzLnJlbmRlclNlcGFyYXRpb24odGhpcy5ob3N0Q29uZmlnLCB7XHJcbiAgICAgICAgICAgIHNwYWNpbmc6IHRoaXMuaG9zdENvbmZpZy5nZXRFZmZlY3RpdmVTcGFjaW5nKHRoaXMuc3BhY2luZyksXHJcbiAgICAgICAgICAgIGxpbmVUaGlja25lc3M6IHRoaXMuc2VwYXJhdG9yID8gdGhpcy5ob3N0Q29uZmlnLnNlcGFyYXRvci5saW5lVGhpY2tuZXNzIDogdW5kZWZpbmVkLFxyXG4gICAgICAgICAgICBsaW5lQ29sb3I6IHRoaXMuc2VwYXJhdG9yID8gdGhpcy5ob3N0Q29uZmlnLnNlcGFyYXRvci5saW5lQ29sb3IgOiB1bmRlZmluZWRcclxuICAgICAgICB9LCB0aGlzLnNlcGFyYXRvck9yaWVudGF0aW9uKTtcclxuICAgICAgICBpZiAoc2hhcmVkXzEuR2xvYmFsU2V0dGluZ3MuYWx3YXlzQmxlZWRTZXBhcmF0b3JzICYmIHJlbmRlcmVkU2VwYXJhdG9yICYmIHRoaXMuc2VwYXJhdG9yT3JpZW50YXRpb24gPT0gRW51bXMuT3JpZW50YXRpb24uSG9yaXpvbnRhbCkge1xyXG4gICAgICAgICAgICAvLyBBZGp1c3Qgc2VwYXJhdG9yJ3MgbWFyZ2lucyBpZiB0aGUgb3B0aW9uIHRvIGFsd2F5cyBibGVlZCBzZXBhcmF0b3JzIGlzIHR1cm5lZCBvblxyXG4gICAgICAgICAgICB2YXIgcGFyZW50Q29udGFpbmVyID0gdGhpcy5nZXRQYXJlbnRDb250YWluZXIoKTtcclxuICAgICAgICAgICAgaWYgKHBhcmVudENvbnRhaW5lciAmJiBwYXJlbnRDb250YWluZXIuZ2V0RWZmZWN0aXZlUGFkZGluZygpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcGFyZW50UGh5c2ljYWxQYWRkaW5nID0gdGhpcy5ob3N0Q29uZmlnLnBhZGRpbmdEZWZpbml0aW9uVG9TcGFjaW5nRGVmaW5pdGlvbihwYXJlbnRDb250YWluZXIuZ2V0RWZmZWN0aXZlUGFkZGluZygpKTtcclxuICAgICAgICAgICAgICAgIHJlbmRlcmVkU2VwYXJhdG9yLnN0eWxlLm1hcmdpbkxlZnQgPSBcIi1cIiArIHBhcmVudFBoeXNpY2FsUGFkZGluZy5sZWZ0ICsgXCJweFwiO1xyXG4gICAgICAgICAgICAgICAgcmVuZGVyZWRTZXBhcmF0b3Iuc3R5bGUubWFyZ2luUmlnaHQgPSBcIi1cIiArIHBhcmVudFBoeXNpY2FsUGFkZGluZy5yaWdodCArIFwicHhcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVuZGVyZWRTZXBhcmF0b3I7XHJcbiAgICB9O1xyXG4gICAgQ2FyZEVsZW1lbnQucHJvdG90eXBlLnVwZGF0ZVJlbmRlcmVkRWxlbWVudFZpc2liaWxpdHkgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2RlZmF1bHRSZW5kZXJlZEVsZW1lbnREaXNwbGF5TW9kZSkge1xyXG4gICAgICAgICAgICB2YXIgZGlzcGxheU1vZGUgPSB0aGlzLmlzRGVzaWduTW9kZSgpIHx8IHRoaXMuaXNWaXNpYmxlID8gdGhpcy5fZGVmYXVsdFJlbmRlcmVkRWxlbWVudERpc3BsYXlNb2RlIDogXCJub25lXCI7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9yZW5kZXJlZEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3JlbmRlcmVkRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gZGlzcGxheU1vZGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMuX3NlcGFyYXRvckVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnBhcmVudCAmJiB0aGlzLnBhcmVudC5pc0ZpcnN0RWxlbWVudCh0aGlzKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3NlcGFyYXRvckVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2VwYXJhdG9yRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gZGlzcGxheU1vZGU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgQ2FyZEVsZW1lbnQucHJvdG90eXBlLmhpZGVFbGVtZW50RHVlVG9PdmVyZmxvdyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAodGhpcy5fcmVuZGVyZWRFbGVtZW50ICYmIHRoaXMuaXNWaXNpYmxlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3JlbmRlcmVkRWxlbWVudC5zdHlsZS52aXNpYmlsaXR5ID0gXCJoaWRkZW5cIjtcclxuICAgICAgICAgICAgdGhpcy5pc1Zpc2libGUgPSBmYWxzZTtcclxuICAgICAgICAgICAgcmFpc2VFbGVtZW50VmlzaWJpbGl0eUNoYW5nZWRFdmVudCh0aGlzLCBmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIENhcmRFbGVtZW50LnByb3RvdHlwZS5zaG93RWxlbWVudEhpZGRlbkR1ZVRvT3ZlcmZsb3cgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX3JlbmRlcmVkRWxlbWVudCAmJiAhdGhpcy5pc1Zpc2libGUpIHtcclxuICAgICAgICAgICAgdGhpcy5fcmVuZGVyZWRFbGVtZW50LnN0eWxlLnJlbW92ZVByb3BlcnR5KFwidmlzaWJpbGl0eVwiKTtcclxuICAgICAgICAgICAgdGhpcy5pc1Zpc2libGUgPSB0cnVlO1xyXG4gICAgICAgICAgICByYWlzZUVsZW1lbnRWaXNpYmlsaXR5Q2hhbmdlZEV2ZW50KHRoaXMsIGZhbHNlKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgLy8gTWFya2VkIHByaXZhdGUgdG8gZW11bGF0ZSBpbnRlcm5hbCBhY2Nlc3NcclxuICAgIENhcmRFbGVtZW50LnByb3RvdHlwZS5oYW5kbGVPdmVyZmxvdyA9IGZ1bmN0aW9uIChtYXhIZWlnaHQpIHtcclxuICAgICAgICBpZiAodGhpcy5pc1Zpc2libGUgfHwgdGhpcy5pc0hpZGRlbkR1ZVRvT3ZlcmZsb3coKSkge1xyXG4gICAgICAgICAgICB2YXIgaGFuZGxlZCA9IHRoaXMudHJ1bmNhdGVPdmVyZmxvdyhtYXhIZWlnaHQpO1xyXG4gICAgICAgICAgICAvLyBFdmVuIGlmIHdlIHdlcmUgdW5hYmxlIHRvIHRydW5jYXRlIHRoZSBlbGVtZW50IHRvIGZpdCB0aGlzIHRpbWUsXHJcbiAgICAgICAgICAgIC8vIGl0IHN0aWxsIGNvdWxkIGhhdmUgYmVlbiBwcmV2aW91c2x5IHRydW5jYXRlZFxyXG4gICAgICAgICAgICB0aGlzLl90cnVuY2F0ZWREdWVUb092ZXJmbG93ID0gaGFuZGxlZCB8fCB0aGlzLl90cnVuY2F0ZWREdWVUb092ZXJmbG93O1xyXG4gICAgICAgICAgICBpZiAoIWhhbmRsZWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaGlkZUVsZW1lbnREdWVUb092ZXJmbG93KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoaGFuZGxlZCAmJiAhdGhpcy5pc1Zpc2libGUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2hvd0VsZW1lbnRIaWRkZW5EdWVUb092ZXJmbG93KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgLy8gTWFya2VkIHByaXZhdGUgdG8gZW11bGF0ZSBpbnRlcm5hbCBhY2Nlc3NcclxuICAgIENhcmRFbGVtZW50LnByb3RvdHlwZS5yZXNldE92ZXJmbG93ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBzaXplQ2hhbmdlZCA9IGZhbHNlO1xyXG4gICAgICAgIGlmICh0aGlzLl90cnVuY2F0ZWREdWVUb092ZXJmbG93KSB7XHJcbiAgICAgICAgICAgIHRoaXMudW5kb092ZXJmbG93VHJ1bmNhdGlvbigpO1xyXG4gICAgICAgICAgICB0aGlzLl90cnVuY2F0ZWREdWVUb092ZXJmbG93ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHNpemVDaGFuZ2VkID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuaXNIaWRkZW5EdWVUb092ZXJmbG93KCkpIHtcclxuICAgICAgICAgICAgdGhpcy5zaG93RWxlbWVudEhpZGRlbkR1ZVRvT3ZlcmZsb3coKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHNpemVDaGFuZ2VkO1xyXG4gICAgfTtcclxuICAgIENhcmRFbGVtZW50LnByb3RvdHlwZS5jcmVhdGVQbGFjZWhvbGRlckVsZW1lbnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHN0eWxlRGVmaW5pdGlvbiA9IHRoaXMuZ2V0RWZmZWN0aXZlU3R5bGVEZWZpbml0aW9uKCk7XHJcbiAgICAgICAgdmFyIGZvcmVncm91bmRDc3NDb2xvciA9IFV0aWxzLnN0cmluZ1RvQ3NzQ29sb3Ioc3R5bGVEZWZpbml0aW9uLmZvcmVncm91bmRDb2xvcnMuZGVmYXVsdC5zdWJ0bGUpO1xyXG4gICAgICAgIHZhciBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICBlbGVtZW50LnN0eWxlLmJvcmRlciA9IFwiMXB4IGRhc2hlZCBcIiArIGZvcmVncm91bmRDc3NDb2xvcjtcclxuICAgICAgICBlbGVtZW50LnN0eWxlLnBhZGRpbmcgPSBcIjRweFwiO1xyXG4gICAgICAgIGVsZW1lbnQuc3R5bGUubWluSGVpZ2h0ID0gXCIzMnB4XCI7XHJcbiAgICAgICAgZWxlbWVudC5zdHlsZS5mb250U2l6ZSA9IFwiMTBweFwiO1xyXG4gICAgICAgIGVsZW1lbnQuc3R5bGUuY29sb3IgPSBmb3JlZ3JvdW5kQ3NzQ29sb3I7XHJcbiAgICAgICAgZWxlbWVudC5pbm5lclRleHQgPSBcIkVtcHR5IFwiICsgdGhpcy5nZXRKc29uVHlwZU5hbWUoKTtcclxuICAgICAgICByZXR1cm4gZWxlbWVudDtcclxuICAgIH07XHJcbiAgICBDYXJkRWxlbWVudC5wcm90b3R5cGUuYWRqdXN0UmVuZGVyZWRFbGVtZW50U2l6ZSA9IGZ1bmN0aW9uIChyZW5kZXJlZEVsZW1lbnQpIHtcclxuICAgICAgICBpZiAodGhpcy5oZWlnaHQgPT09IFwiYXV0b1wiKSB7XHJcbiAgICAgICAgICAgIHJlbmRlcmVkRWxlbWVudC5zdHlsZS5mbGV4ID0gXCIwIDAgYXV0b1wiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmVuZGVyZWRFbGVtZW50LnN0eWxlLmZsZXggPSBcIjEgMSBhdXRvXCI7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIENhcmRFbGVtZW50LnByb3RvdHlwZS5pc0Rpc3BsYXllZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fcmVuZGVyZWRFbGVtZW50ICE9PSB1bmRlZmluZWQgJiYgdGhpcy5pc1Zpc2libGUgJiYgdGhpcy5fcmVuZGVyZWRFbGVtZW50Lm9mZnNldEhlaWdodCA+IDA7XHJcbiAgICB9O1xyXG4gICAgQ2FyZEVsZW1lbnQucHJvdG90eXBlLm92ZXJyaWRlSW50ZXJuYWxSZW5kZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW50ZXJuYWxSZW5kZXIoKTtcclxuICAgIH07XHJcbiAgICBDYXJkRWxlbWVudC5wcm90b3R5cGUuYXBwbHlQYWRkaW5nID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLnNlcGFyYXRvckVsZW1lbnQpIHtcclxuICAgICAgICAgICAgaWYgKHNoYXJlZF8xLkdsb2JhbFNldHRpbmdzLmFsd2F5c0JsZWVkU2VwYXJhdG9ycyAmJiB0aGlzLnNlcGFyYXRvck9yaWVudGF0aW9uID09IEVudW1zLk9yaWVudGF0aW9uLkhvcml6b250YWwgJiYgIXRoaXMuaXNCbGVlZGluZygpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcGFkZGluZyA9IG5ldyBzaGFyZWRfMS5QYWRkaW5nRGVmaW5pdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5nZXRJbW1lZGlhdGVTdXJyb3VuZGluZ1BhZGRpbmcocGFkZGluZyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgcGh5c2ljYWxQYWRkaW5nID0gdGhpcy5ob3N0Q29uZmlnLnBhZGRpbmdEZWZpbml0aW9uVG9TcGFjaW5nRGVmaW5pdGlvbihwYWRkaW5nKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VwYXJhdG9yRWxlbWVudC5zdHlsZS5tYXJnaW5MZWZ0ID0gXCItXCIgKyBwaHlzaWNhbFBhZGRpbmcubGVmdCArIFwicHhcIjtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VwYXJhdG9yRWxlbWVudC5zdHlsZS5tYXJnaW5SaWdodCA9IFwiLVwiICsgcGh5c2ljYWxQYWRkaW5nLnJpZ2h0ICsgXCJweFwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXBhcmF0b3JFbGVtZW50LnN0eWxlLm1hcmdpblJpZ2h0ID0gXCIwXCI7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlcGFyYXRvckVsZW1lbnQuc3R5bGUubWFyZ2luTGVmdCA9IFwiMFwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIC8qXHJcbiAgICAgKiBDYWxsZWQgd2hlbiB0aGlzIGVsZW1lbnQgb3ZlcmZsb3dzIHRoZSBib3R0b20gb2YgdGhlIGNhcmQuXHJcbiAgICAgKiBtYXhIZWlnaHQgd2lsbCBiZSB0aGUgYW1vdW50IG9mIHNwYWNlIHN0aWxsIGF2YWlsYWJsZSBvbiB0aGUgY2FyZCAoMCBpZlxyXG4gICAgICogdGhlIGVsZW1lbnQgaXMgZnVsbHkgb2ZmIHRoZSBjYXJkKS5cclxuICAgICAqL1xyXG4gICAgQ2FyZEVsZW1lbnQucHJvdG90eXBlLnRydW5jYXRlT3ZlcmZsb3cgPSBmdW5jdGlvbiAobWF4SGVpZ2h0KSB7XHJcbiAgICAgICAgLy8gQ2hpbGQgaW1wbGVtZW50YXRpb25zIHNob3VsZCByZXR1cm4gdHJ1ZSBpZiB0aGUgZWxlbWVudCBoYW5kbGVkXHJcbiAgICAgICAgLy8gdGhlIHRydW5jYXRpb24gcmVxdWVzdCBzdWNoIHRoYXQgaXRzIGNvbnRlbnQgZml0cyB3aXRoaW4gbWF4SGVpZ2h0LFxyXG4gICAgICAgIC8vIGZhbHNlIGlmIHRoZSBlbGVtZW50IHNob3VsZCBmYWxsIGJhY2sgdG8gYmVpbmcgaGlkZGVuXHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfTtcclxuICAgIC8qXHJcbiAgICAgKiBUaGlzIHNob3VsZCByZXZlcnNlIGFueSBjaGFuZ2VzIHBlcmZvcm1lZCBpbiB0cnVuY2F0ZU92ZXJmbG93KCkuXHJcbiAgICAgKi9cclxuICAgIENhcmRFbGVtZW50LnByb3RvdHlwZS51bmRvT3ZlcmZsb3dUcnVuY2F0aW9uID0gZnVuY3Rpb24gKCkgeyB9O1xyXG4gICAgQ2FyZEVsZW1lbnQucHJvdG90eXBlLmdldERlZmF1bHRQYWRkaW5nID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgc2hhcmVkXzEuUGFkZGluZ0RlZmluaXRpb24oKTtcclxuICAgIH07XHJcbiAgICBDYXJkRWxlbWVudC5wcm90b3R5cGUuZ2V0SGFzQmFja2dyb3VuZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9O1xyXG4gICAgQ2FyZEVsZW1lbnQucHJvdG90eXBlLmdldFBhZGRpbmcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3BhZGRpbmc7XHJcbiAgICB9O1xyXG4gICAgQ2FyZEVsZW1lbnQucHJvdG90eXBlLnNldFBhZGRpbmcgPSBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICB0aGlzLl9wYWRkaW5nID0gdmFsdWU7XHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENhcmRFbGVtZW50LnByb3RvdHlwZSwgXCJ1c2VEZWZhdWx0U2l6aW5nXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ2FyZEVsZW1lbnQucHJvdG90eXBlLCBcImFsbG93Q3VzdG9tUGFkZGluZ1wiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENhcmRFbGVtZW50LnByb3RvdHlwZSwgXCJzZXBhcmF0b3JPcmllbnRhdGlvblwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBFbnVtcy5PcmllbnRhdGlvbi5Ib3Jpem9udGFsO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENhcmRFbGVtZW50LnByb3RvdHlwZSwgXCJkZWZhdWx0U3R5bGVcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gRW51bXMuQ29udGFpbmVyU3R5bGUuRGVmYXVsdDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIENhcmRFbGVtZW50LnByb3RvdHlwZS5wYXJzZSA9IGZ1bmN0aW9uIChzb3VyY2UsIGNvbnRleHQpIHtcclxuICAgICAgICBfc3VwZXIucHJvdG90eXBlLnBhcnNlLmNhbGwodGhpcywgc291cmNlLCBjb250ZXh0ID8gY29udGV4dCA6IG5ldyBTZXJpYWxpemF0aW9uQ29udGV4dCgpKTtcclxuICAgIH07XHJcbiAgICBDYXJkRWxlbWVudC5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gKGNvbnRleHQpIHtcclxuICAgICAgICByZXR1cm4gX3N1cGVyLnByb3RvdHlwZS50b0pTT04uY2FsbCh0aGlzLCBjb250ZXh0ID8gY29udGV4dCA6IG5ldyBTZXJpYWxpemF0aW9uQ29udGV4dCgpKTtcclxuICAgIH07XHJcbiAgICBDYXJkRWxlbWVudC5wcm90b3R5cGUuYXNTdHJpbmcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIFwiXCI7XHJcbiAgICB9O1xyXG4gICAgQ2FyZEVsZW1lbnQucHJvdG90eXBlLmlzQmxlZWRpbmcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfTtcclxuICAgIENhcmRFbGVtZW50LnByb3RvdHlwZS5nZXRFZmZlY3RpdmVTdHlsZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAodGhpcy5wYXJlbnQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50LmdldEVmZmVjdGl2ZVN0eWxlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLmRlZmF1bHRTdHlsZTtcclxuICAgIH07XHJcbiAgICBDYXJkRWxlbWVudC5wcm90b3R5cGUuZ2V0RWZmZWN0aXZlU3R5bGVEZWZpbml0aW9uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmhvc3RDb25maWcuY29udGFpbmVyU3R5bGVzLmdldFN0eWxlQnlOYW1lKHRoaXMuZ2V0RWZmZWN0aXZlU3R5bGUoKSk7XHJcbiAgICB9O1xyXG4gICAgQ2FyZEVsZW1lbnQucHJvdG90eXBlLmdldEZvcmJpZGRlbkFjdGlvblR5cGVzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBbXTtcclxuICAgIH07XHJcbiAgICBDYXJkRWxlbWVudC5wcm90b3R5cGUuZ2V0SW1tZWRpYXRlU3Vycm91bmRpbmdQYWRkaW5nID0gZnVuY3Rpb24gKHJlc3VsdCwgcHJvY2Vzc1RvcCwgcHJvY2Vzc1JpZ2h0LCBwcm9jZXNzQm90dG9tLCBwcm9jZXNzTGVmdCkge1xyXG4gICAgICAgIGlmIChwcm9jZXNzVG9wID09PSB2b2lkIDApIHsgcHJvY2Vzc1RvcCA9IHRydWU7IH1cclxuICAgICAgICBpZiAocHJvY2Vzc1JpZ2h0ID09PSB2b2lkIDApIHsgcHJvY2Vzc1JpZ2h0ID0gdHJ1ZTsgfVxyXG4gICAgICAgIGlmIChwcm9jZXNzQm90dG9tID09PSB2b2lkIDApIHsgcHJvY2Vzc0JvdHRvbSA9IHRydWU7IH1cclxuICAgICAgICBpZiAocHJvY2Vzc0xlZnQgPT09IHZvaWQgMCkgeyBwcm9jZXNzTGVmdCA9IHRydWU7IH1cclxuICAgICAgICBpZiAodGhpcy5wYXJlbnQpIHtcclxuICAgICAgICAgICAgdmFyIGRvUHJvY2Vzc1RvcCA9IHByb2Nlc3NUb3AgJiYgdGhpcy5wYXJlbnQuaXNUb3BFbGVtZW50KHRoaXMpO1xyXG4gICAgICAgICAgICB2YXIgZG9Qcm9jZXNzUmlnaHQgPSBwcm9jZXNzUmlnaHQgJiYgdGhpcy5wYXJlbnQuaXNSaWdodE1vc3RFbGVtZW50KHRoaXMpO1xyXG4gICAgICAgICAgICB2YXIgZG9Qcm9jZXNzQm90dG9tID0gcHJvY2Vzc0JvdHRvbSAmJiB0aGlzLnBhcmVudC5pc0JvdHRvbUVsZW1lbnQodGhpcyk7XHJcbiAgICAgICAgICAgIHZhciBkb1Byb2Nlc3NMZWZ0ID0gcHJvY2Vzc0xlZnQgJiYgdGhpcy5wYXJlbnQuaXNMZWZ0TW9zdEVsZW1lbnQodGhpcyk7XHJcbiAgICAgICAgICAgIHZhciBlZmZlY3RpdmVQYWRkaW5nID0gdGhpcy5wYXJlbnQuZ2V0RWZmZWN0aXZlUGFkZGluZygpO1xyXG4gICAgICAgICAgICBpZiAoZWZmZWN0aXZlUGFkZGluZykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGRvUHJvY2Vzc1RvcCAmJiBlZmZlY3RpdmVQYWRkaW5nLnRvcCAhPSBFbnVtcy5TcGFjaW5nLk5vbmUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQudG9wID0gZWZmZWN0aXZlUGFkZGluZy50b3A7XHJcbiAgICAgICAgICAgICAgICAgICAgZG9Qcm9jZXNzVG9wID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoZG9Qcm9jZXNzUmlnaHQgJiYgZWZmZWN0aXZlUGFkZGluZy5yaWdodCAhPSBFbnVtcy5TcGFjaW5nLk5vbmUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQucmlnaHQgPSBlZmZlY3RpdmVQYWRkaW5nLnJpZ2h0O1xyXG4gICAgICAgICAgICAgICAgICAgIGRvUHJvY2Vzc1JpZ2h0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoZG9Qcm9jZXNzQm90dG9tICYmIGVmZmVjdGl2ZVBhZGRpbmcuYm90dG9tICE9IEVudW1zLlNwYWNpbmcuTm9uZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5ib3R0b20gPSBlZmZlY3RpdmVQYWRkaW5nLmJvdHRvbTtcclxuICAgICAgICAgICAgICAgICAgICBkb1Byb2Nlc3NCb3R0b20gPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChkb1Byb2Nlc3NMZWZ0ICYmIGVmZmVjdGl2ZVBhZGRpbmcubGVmdCAhPSBFbnVtcy5TcGFjaW5nLk5vbmUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQubGVmdCA9IGVmZmVjdGl2ZVBhZGRpbmcubGVmdDtcclxuICAgICAgICAgICAgICAgICAgICBkb1Byb2Nlc3NMZWZ0ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGRvUHJvY2Vzc1RvcCB8fCBkb1Byb2Nlc3NSaWdodCB8fCBkb1Byb2Nlc3NCb3R0b20gfHwgZG9Qcm9jZXNzTGVmdCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wYXJlbnQuZ2V0SW1tZWRpYXRlU3Vycm91bmRpbmdQYWRkaW5nKHJlc3VsdCwgZG9Qcm9jZXNzVG9wLCBkb1Byb2Nlc3NSaWdodCwgZG9Qcm9jZXNzQm90dG9tLCBkb1Byb2Nlc3NMZWZ0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBDYXJkRWxlbWVudC5wcm90b3R5cGUuZ2V0QWN0aW9uQ291bnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIDA7XHJcbiAgICB9O1xyXG4gICAgQ2FyZEVsZW1lbnQucHJvdG90eXBlLmdldEFjdGlvbkF0ID0gZnVuY3Rpb24gKGluZGV4KSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW5kZXggb3V0IG9mIHJhbmdlLlwiKTtcclxuICAgIH07XHJcbiAgICBDYXJkRWxlbWVudC5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLnBhcmVudCAmJiB0aGlzLnBhcmVudCBpbnN0YW5jZW9mIENhcmRFbGVtZW50Q29udGFpbmVyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcmVudC5yZW1vdmVJdGVtKHRoaXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9O1xyXG4gICAgQ2FyZEVsZW1lbnQucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLl9yZW5kZXJlZEVsZW1lbnQgPSB0aGlzLm92ZXJyaWRlSW50ZXJuYWxSZW5kZXIoKTtcclxuICAgICAgICB0aGlzLl9zZXBhcmF0b3JFbGVtZW50ID0gdGhpcy5pbnRlcm5hbFJlbmRlclNlcGFyYXRvcigpO1xyXG4gICAgICAgIGlmICh0aGlzLl9yZW5kZXJlZEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuY3VzdG9tQ3NzU2VsZWN0b3IpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3JlbmRlcmVkRWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuY3VzdG9tQ3NzU2VsZWN0b3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuX3JlbmRlcmVkRWxlbWVudC5zdHlsZS5ib3hTaXppbmcgPSBcImJvcmRlci1ib3hcIjtcclxuICAgICAgICAgICAgdGhpcy5fZGVmYXVsdFJlbmRlcmVkRWxlbWVudERpc3BsYXlNb2RlID0gdGhpcy5fcmVuZGVyZWRFbGVtZW50LnN0eWxlLmRpc3BsYXkgPyB0aGlzLl9yZW5kZXJlZEVsZW1lbnQuc3R5bGUuZGlzcGxheSA6IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgdGhpcy5hZGp1c3RSZW5kZXJlZEVsZW1lbnRTaXplKHRoaXMuX3JlbmRlcmVkRWxlbWVudCk7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlTGF5b3V0KGZhbHNlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAodGhpcy5pc0Rlc2lnbk1vZGUoKSkge1xyXG4gICAgICAgICAgICB0aGlzLl9yZW5kZXJlZEVsZW1lbnQgPSB0aGlzLmNyZWF0ZVBsYWNlaG9sZGVyRWxlbWVudCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5fcmVuZGVyZWRFbGVtZW50O1xyXG4gICAgfTtcclxuICAgIENhcmRFbGVtZW50LnByb3RvdHlwZS51cGRhdGVMYXlvdXQgPSBmdW5jdGlvbiAocHJvY2Vzc0NoaWxkcmVuKSB7XHJcbiAgICAgICAgaWYgKHByb2Nlc3NDaGlsZHJlbiA9PT0gdm9pZCAwKSB7IHByb2Nlc3NDaGlsZHJlbiA9IHRydWU7IH1cclxuICAgICAgICB0aGlzLnVwZGF0ZVJlbmRlcmVkRWxlbWVudFZpc2liaWxpdHkoKTtcclxuICAgICAgICB0aGlzLmFwcGx5UGFkZGluZygpO1xyXG4gICAgfTtcclxuICAgIENhcmRFbGVtZW50LnByb3RvdHlwZS5pbmRleE9mID0gZnVuY3Rpb24gKGNhcmRFbGVtZW50KSB7XHJcbiAgICAgICAgcmV0dXJuIC0xO1xyXG4gICAgfTtcclxuICAgIENhcmRFbGVtZW50LnByb3RvdHlwZS5pc0Rlc2lnbk1vZGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHJvb3RFbGVtZW50ID0gdGhpcy5nZXRSb290RWxlbWVudCgpO1xyXG4gICAgICAgIHJldHVybiByb290RWxlbWVudCBpbnN0YW5jZW9mIEFkYXB0aXZlQ2FyZCAmJiByb290RWxlbWVudC5kZXNpZ25Nb2RlO1xyXG4gICAgfTtcclxuICAgIENhcmRFbGVtZW50LnByb3RvdHlwZS5pc0ZpcnN0RWxlbWVudCA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9O1xyXG4gICAgQ2FyZEVsZW1lbnQucHJvdG90eXBlLmlzTGFzdEVsZW1lbnQgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfTtcclxuICAgIENhcmRFbGVtZW50LnByb3RvdHlwZS5pc0F0VGhlVmVyeUxlZnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50ID8gdGhpcy5wYXJlbnQuaXNMZWZ0TW9zdEVsZW1lbnQodGhpcykgJiYgdGhpcy5wYXJlbnQuaXNBdFRoZVZlcnlMZWZ0KCkgOiB0cnVlO1xyXG4gICAgfTtcclxuICAgIENhcmRFbGVtZW50LnByb3RvdHlwZS5pc0F0VGhlVmVyeVJpZ2h0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnBhcmVudCA/IHRoaXMucGFyZW50LmlzUmlnaHRNb3N0RWxlbWVudCh0aGlzKSAmJiB0aGlzLnBhcmVudC5pc0F0VGhlVmVyeVJpZ2h0KCkgOiB0cnVlO1xyXG4gICAgfTtcclxuICAgIENhcmRFbGVtZW50LnByb3RvdHlwZS5pc0F0VGhlVmVyeVRvcCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5wYXJlbnQgPyB0aGlzLnBhcmVudC5pc0ZpcnN0RWxlbWVudCh0aGlzKSAmJiB0aGlzLnBhcmVudC5pc0F0VGhlVmVyeVRvcCgpIDogdHJ1ZTtcclxuICAgIH07XHJcbiAgICBDYXJkRWxlbWVudC5wcm90b3R5cGUuaXNBdFRoZVZlcnlCb3R0b20gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50ID8gdGhpcy5wYXJlbnQuaXNMYXN0RWxlbWVudCh0aGlzKSAmJiB0aGlzLnBhcmVudC5pc0F0VGhlVmVyeUJvdHRvbSgpIDogdHJ1ZTtcclxuICAgIH07XHJcbiAgICBDYXJkRWxlbWVudC5wcm90b3R5cGUuaXNCbGVlZGluZ0F0VG9wID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH07XHJcbiAgICBDYXJkRWxlbWVudC5wcm90b3R5cGUuaXNCbGVlZGluZ0F0Qm90dG9tID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH07XHJcbiAgICBDYXJkRWxlbWVudC5wcm90b3R5cGUuaXNMZWZ0TW9zdEVsZW1lbnQgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfTtcclxuICAgIENhcmRFbGVtZW50LnByb3RvdHlwZS5pc1JpZ2h0TW9zdEVsZW1lbnQgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfTtcclxuICAgIENhcmRFbGVtZW50LnByb3RvdHlwZS5pc1RvcEVsZW1lbnQgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmlzRmlyc3RFbGVtZW50KGVsZW1lbnQpO1xyXG4gICAgfTtcclxuICAgIENhcmRFbGVtZW50LnByb3RvdHlwZS5pc0JvdHRvbUVsZW1lbnQgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmlzTGFzdEVsZW1lbnQoZWxlbWVudCk7XHJcbiAgICB9O1xyXG4gICAgQ2FyZEVsZW1lbnQucHJvdG90eXBlLmlzSGlkZGVuRHVlVG9PdmVyZmxvdyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fcmVuZGVyZWRFbGVtZW50ICE9PSB1bmRlZmluZWQgJiYgdGhpcy5fcmVuZGVyZWRFbGVtZW50LnN0eWxlLnZpc2liaWxpdHkgPT0gJ2hpZGRlbic7XHJcbiAgICB9O1xyXG4gICAgQ2FyZEVsZW1lbnQucHJvdG90eXBlLmdldFJvb3RFbGVtZW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldFJvb3RPYmplY3QoKTtcclxuICAgIH07XHJcbiAgICBDYXJkRWxlbWVudC5wcm90b3R5cGUuZ2V0UGFyZW50Q29udGFpbmVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBjdXJyZW50RWxlbWVudCA9IHRoaXMucGFyZW50O1xyXG4gICAgICAgIHdoaWxlIChjdXJyZW50RWxlbWVudCkge1xyXG4gICAgICAgICAgICBpZiAoY3VycmVudEVsZW1lbnQgaW5zdGFuY2VvZiBDb250YWluZXIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjdXJyZW50RWxlbWVudDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjdXJyZW50RWxlbWVudCA9IGN1cnJlbnRFbGVtZW50LnBhcmVudDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgIH07XHJcbiAgICBDYXJkRWxlbWVudC5wcm90b3R5cGUuZ2V0QWxsSW5wdXRzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBbXTtcclxuICAgIH07XHJcbiAgICBDYXJkRWxlbWVudC5wcm90b3R5cGUuZ2V0UmVzb3VyY2VJbmZvcm1hdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gW107XHJcbiAgICB9O1xyXG4gICAgQ2FyZEVsZW1lbnQucHJvdG90eXBlLmdldEVsZW1lbnRCeUlkID0gZnVuY3Rpb24gKGlkKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaWQgPT09IGlkID8gdGhpcyA6IHVuZGVmaW5lZDtcclxuICAgIH07XHJcbiAgICBDYXJkRWxlbWVudC5wcm90b3R5cGUuZ2V0QWN0aW9uQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xyXG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICB9O1xyXG4gICAgQ2FyZEVsZW1lbnQucHJvdG90eXBlLmdldEVmZmVjdGl2ZVBhZGRpbmcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHBhZGRpbmcgPSB0aGlzLmdldFBhZGRpbmcoKTtcclxuICAgICAgICByZXR1cm4gKHBhZGRpbmcgJiYgdGhpcy5hbGxvd0N1c3RvbVBhZGRpbmcpID8gcGFkZGluZyA6IHRoaXMuZ2V0RGVmYXVsdFBhZGRpbmcoKTtcclxuICAgIH07XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ2FyZEVsZW1lbnQucHJvdG90eXBlLCBcImhvc3RDb25maWdcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5faG9zdENvbmZpZykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2hvc3RDb25maWc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5wYXJlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJlbnQuaG9zdENvbmZpZztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBob3N0X2NvbmZpZ18xLmRlZmF1bHRIb3N0Q29uZmlnO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgICAgICB0aGlzLl9ob3N0Q29uZmlnID0gdmFsdWU7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ2FyZEVsZW1lbnQucHJvdG90eXBlLCBcImluZGV4XCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMucGFyZW50KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJlbnQuaW5kZXhPZih0aGlzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ2FyZEVsZW1lbnQucHJvdG90eXBlLCBcImlzSW50ZXJhY3RpdmVcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ2FyZEVsZW1lbnQucHJvdG90eXBlLCBcImlzU3RhbmRhbG9uZVwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENhcmRFbGVtZW50LnByb3RvdHlwZSwgXCJpc0lubGluZVwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDYXJkRWxlbWVudC5wcm90b3R5cGUsIFwiaGFzVmlzaWJsZVNlcGFyYXRvclwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnBhcmVudCAmJiB0aGlzLnNlcGFyYXRvckVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAhdGhpcy5wYXJlbnQuaXNGaXJzdEVsZW1lbnQodGhpcykgJiYgKHRoaXMuaXNWaXNpYmxlIHx8IHRoaXMuaXNEZXNpZ25Nb2RlKCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ2FyZEVsZW1lbnQucHJvdG90eXBlLCBcInNlcGFyYXRvckVsZW1lbnRcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fc2VwYXJhdG9yRWxlbWVudDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDYXJkRWxlbWVudC5wcm90b3R5cGUsIFwicGFyZW50XCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BhcmVudDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIENhcmRFbGVtZW50LmxhbmdQcm9wZXJ0eSA9IG5ldyBzZXJpYWxpemF0aW9uXzEuU3RyaW5nUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzEsIFwibGFuZ1wiLCB0cnVlLCAvXlthLXpdezIsM30kL2lnKTtcclxuICAgIENhcmRFbGVtZW50LmlzVmlzaWJsZVByb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5Cb29sUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzIsIFwiaXNWaXNpYmxlXCIsIHRydWUpO1xyXG4gICAgQ2FyZEVsZW1lbnQuc2VwYXJhdG9yUHJvcGVydHkgPSBuZXcgc2VyaWFsaXphdGlvbl8xLkJvb2xQcm9wZXJ0eShzZXJpYWxpemF0aW9uXzEuVmVyc2lvbnMudjFfMCwgXCJzZXBhcmF0b3JcIiwgZmFsc2UpO1xyXG4gICAgQ2FyZEVsZW1lbnQuaGVpZ2h0UHJvcGVydHkgPSBuZXcgc2VyaWFsaXphdGlvbl8xLlZhbHVlU2V0UHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzEsIFwiaGVpZ2h0XCIsIFtcclxuICAgICAgICB7IHZhbHVlOiBcImF1dG9cIiB9LFxyXG4gICAgICAgIHsgdmFsdWU6IFwic3RyZXRjaFwiIH1cclxuICAgIF0sIFwiYXV0b1wiKTtcclxuICAgIENhcmRFbGVtZW50Lmhvcml6b250YWxBbGlnbm1lbnRQcm9wZXJ0eSA9IG5ldyBzZXJpYWxpemF0aW9uXzEuRW51bVByb3BlcnR5KHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8wLCBcImhvcml6b250YWxBbGlnbm1lbnRcIiwgRW51bXMuSG9yaXpvbnRhbEFsaWdubWVudCwgRW51bXMuSG9yaXpvbnRhbEFsaWdubWVudC5MZWZ0KTtcclxuICAgIENhcmRFbGVtZW50LnNwYWNpbmdQcm9wZXJ0eSA9IG5ldyBzZXJpYWxpemF0aW9uXzEuRW51bVByb3BlcnR5KHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8wLCBcInNwYWNpbmdcIiwgRW51bXMuU3BhY2luZywgRW51bXMuU3BhY2luZy5EZWZhdWx0KTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHNlcmlhbGl6YXRpb25fMS5wcm9wZXJ0eShDYXJkRWxlbWVudC5ob3Jpem9udGFsQWxpZ25tZW50UHJvcGVydHkpXHJcbiAgICBdLCBDYXJkRWxlbWVudC5wcm90b3R5cGUsIFwiaG9yaXpvbnRhbEFsaWdubWVudFwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KENhcmRFbGVtZW50LnNwYWNpbmdQcm9wZXJ0eSlcclxuICAgIF0sIENhcmRFbGVtZW50LnByb3RvdHlwZSwgXCJzcGFjaW5nXCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBzZXJpYWxpemF0aW9uXzEucHJvcGVydHkoQ2FyZEVsZW1lbnQuc2VwYXJhdG9yUHJvcGVydHkpXHJcbiAgICBdLCBDYXJkRWxlbWVudC5wcm90b3R5cGUsIFwic2VwYXJhdG9yXCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBzZXJpYWxpemF0aW9uXzEucHJvcGVydHkoQ2FyZEVsZW1lbnQuaGVpZ2h0UHJvcGVydHkpXHJcbiAgICBdLCBDYXJkRWxlbWVudC5wcm90b3R5cGUsIFwiaGVpZ2h0XCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBzZXJpYWxpemF0aW9uXzEucHJvcGVydHkoQ2FyZEVsZW1lbnQubGFuZ1Byb3BlcnR5KVxyXG4gICAgXSwgQ2FyZEVsZW1lbnQucHJvdG90eXBlLCBcImxhbmdcIiwgbnVsbCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBzZXJpYWxpemF0aW9uXzEucHJvcGVydHkoQ2FyZEVsZW1lbnQuaXNWaXNpYmxlUHJvcGVydHkpXHJcbiAgICBdLCBDYXJkRWxlbWVudC5wcm90b3R5cGUsIFwiaXNWaXNpYmxlXCIsIG51bGwpO1xyXG4gICAgcmV0dXJuIENhcmRFbGVtZW50O1xyXG59KGNhcmRfb2JqZWN0XzEuQ2FyZE9iamVjdCkpO1xyXG5leHBvcnRzLkNhcmRFbGVtZW50ID0gQ2FyZEVsZW1lbnQ7XHJcbnZhciBBY3Rpb25Qcm9wZXJ0eSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhBY3Rpb25Qcm9wZXJ0eSwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIEFjdGlvblByb3BlcnR5KHRhcmdldFZlcnNpb24sIG5hbWUsIGZvcmJpZGRlbkFjdGlvblR5cGVzKSB7XHJcbiAgICAgICAgaWYgKGZvcmJpZGRlbkFjdGlvblR5cGVzID09PSB2b2lkIDApIHsgZm9yYmlkZGVuQWN0aW9uVHlwZXMgPSBbXTsgfVxyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHRhcmdldFZlcnNpb24sIG5hbWUsIHVuZGVmaW5lZCkgfHwgdGhpcztcclxuICAgICAgICBfdGhpcy50YXJnZXRWZXJzaW9uID0gdGFyZ2V0VmVyc2lvbjtcclxuICAgICAgICBfdGhpcy5uYW1lID0gbmFtZTtcclxuICAgICAgICBfdGhpcy5mb3JiaWRkZW5BY3Rpb25UeXBlcyA9IGZvcmJpZGRlbkFjdGlvblR5cGVzO1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIEFjdGlvblByb3BlcnR5LnByb3RvdHlwZS5wYXJzZSA9IGZ1bmN0aW9uIChzZW5kZXIsIHNvdXJjZSwgY29udGV4dCkge1xyXG4gICAgICAgIHZhciBwYXJlbnQgPSBzZW5kZXI7XHJcbiAgICAgICAgcmV0dXJuIGNvbnRleHQucGFyc2VBY3Rpb24ocGFyZW50LCBzb3VyY2VbdGhpcy5uYW1lXSwgdGhpcy5mb3JiaWRkZW5BY3Rpb25UeXBlcywgcGFyZW50LmlzRGVzaWduTW9kZSgpKTtcclxuICAgIH07XHJcbiAgICBBY3Rpb25Qcm9wZXJ0eS5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gKHNlbmRlciwgdGFyZ2V0LCB2YWx1ZSwgY29udGV4dCkge1xyXG4gICAgICAgIGNvbnRleHQuc2VyaWFsaXplVmFsdWUodGFyZ2V0LCB0aGlzLm5hbWUsIHZhbHVlID8gdmFsdWUudG9KU09OKGNvbnRleHQpIDogdW5kZWZpbmVkKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gQWN0aW9uUHJvcGVydHk7XHJcbn0oc2VyaWFsaXphdGlvbl8xLlByb3BlcnR5RGVmaW5pdGlvbikpO1xyXG5leHBvcnRzLkFjdGlvblByb3BlcnR5ID0gQWN0aW9uUHJvcGVydHk7XHJcbnZhciBCYXNlVGV4dEJsb2NrID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKEJhc2VUZXh0QmxvY2ssIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBCYXNlVGV4dEJsb2NrKCkge1xyXG4gICAgICAgIC8vI3JlZ2lvbiBTY2hlbWFcclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgICAgICBfdGhpcy5zaXplID0gRW51bXMuVGV4dFNpemUuRGVmYXVsdDtcclxuICAgICAgICBfdGhpcy53ZWlnaHQgPSBFbnVtcy5UZXh0V2VpZ2h0LkRlZmF1bHQ7XHJcbiAgICAgICAgX3RoaXMuY29sb3IgPSBFbnVtcy5UZXh0Q29sb3IuRGVmYXVsdDtcclxuICAgICAgICBfdGhpcy5pc1N1YnRsZSA9IGZhbHNlO1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIEJhc2VUZXh0QmxvY2sucHJvdG90eXBlLnBvcHVsYXRlU2NoZW1hID0gZnVuY3Rpb24gKHNjaGVtYSkge1xyXG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUucG9wdWxhdGVTY2hlbWEuY2FsbCh0aGlzLCBzY2hlbWEpO1xyXG4gICAgICAgIC8vIHNlbGVjdEFjdGlvbiBpcyBkZWNsYXJlZCBvbiBCYXNlVGV4dEJsb2NrIGJ1dCBpcyBvbmx5IGV4cG9zZWQgb24gVGV4dFJ1bixcclxuICAgICAgICAvLyBzbyB0aGUgcHJvcGVydHkgaXMgcmVtb3ZlZCBmcm9tIHRoZSBCYXNlVGV4dEJsb2NrIHNjaGVtYS5cclxuICAgICAgICBzY2hlbWEucmVtb3ZlKEJhc2VUZXh0QmxvY2suc2VsZWN0QWN0aW9uUHJvcGVydHkpO1xyXG4gICAgfTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShCYXNlVGV4dEJsb2NrLnByb3RvdHlwZSwgXCJ0ZXh0XCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VmFsdWUoQmFzZVRleHRCbG9jay50ZXh0UHJvcGVydHkpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICAgICAgdGhpcy5zZXRUZXh0KHZhbHVlKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIC8vI2VuZHJlZ2lvblxyXG4gICAgQmFzZVRleHRCbG9jay5wcm90b3R5cGUuZ2V0Rm9udFNpemUgPSBmdW5jdGlvbiAoZm9udFR5cGUpIHtcclxuICAgICAgICBzd2l0Y2ggKHRoaXMuc2l6ZSkge1xyXG4gICAgICAgICAgICBjYXNlIEVudW1zLlRleHRTaXplLlNtYWxsOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZvbnRUeXBlLmZvbnRTaXplcy5zbWFsbDtcclxuICAgICAgICAgICAgY2FzZSBFbnVtcy5UZXh0U2l6ZS5NZWRpdW06XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZm9udFR5cGUuZm9udFNpemVzLm1lZGl1bTtcclxuICAgICAgICAgICAgY2FzZSBFbnVtcy5UZXh0U2l6ZS5MYXJnZTpcclxuICAgICAgICAgICAgICAgIHJldHVybiBmb250VHlwZS5mb250U2l6ZXMubGFyZ2U7XHJcbiAgICAgICAgICAgIGNhc2UgRW51bXMuVGV4dFNpemUuRXh0cmFMYXJnZTpcclxuICAgICAgICAgICAgICAgIHJldHVybiBmb250VHlwZS5mb250U2l6ZXMuZXh0cmFMYXJnZTtcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHJldHVybiBmb250VHlwZS5mb250U2l6ZXMuZGVmYXVsdDtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgQmFzZVRleHRCbG9jay5wcm90b3R5cGUuZ2V0Q29sb3JEZWZpbml0aW9uID0gZnVuY3Rpb24gKGNvbG9yU2V0LCBjb2xvcikge1xyXG4gICAgICAgIHN3aXRjaCAoY29sb3IpIHtcclxuICAgICAgICAgICAgY2FzZSBFbnVtcy5UZXh0Q29sb3IuQWNjZW50OlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbG9yU2V0LmFjY2VudDtcclxuICAgICAgICAgICAgY2FzZSBFbnVtcy5UZXh0Q29sb3IuRGFyazpcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb2xvclNldC5kYXJrO1xyXG4gICAgICAgICAgICBjYXNlIEVudW1zLlRleHRDb2xvci5MaWdodDpcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb2xvclNldC5saWdodDtcclxuICAgICAgICAgICAgY2FzZSBFbnVtcy5UZXh0Q29sb3IuR29vZDpcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb2xvclNldC5nb29kO1xyXG4gICAgICAgICAgICBjYXNlIEVudW1zLlRleHRDb2xvci5XYXJuaW5nOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbG9yU2V0Lndhcm5pbmc7XHJcbiAgICAgICAgICAgIGNhc2UgRW51bXMuVGV4dENvbG9yLkF0dGVudGlvbjpcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb2xvclNldC5hdHRlbnRpb247XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29sb3JTZXQuZGVmYXVsdDtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgQmFzZVRleHRCbG9jay5wcm90b3R5cGUuc2V0VGV4dCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgIHRoaXMuc2V0VmFsdWUoQmFzZVRleHRCbG9jay50ZXh0UHJvcGVydHksIHZhbHVlKTtcclxuICAgIH07XHJcbiAgICBCYXNlVGV4dEJsb2NrLnByb3RvdHlwZS5hc1N0cmluZyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy50ZXh0O1xyXG4gICAgfTtcclxuICAgIEJhc2VUZXh0QmxvY2sucHJvdG90eXBlLmFwcGx5U3R5bGVzVG8gPSBmdW5jdGlvbiAodGFyZ2V0RWxlbWVudCkge1xyXG4gICAgICAgIHZhciBmb250VHlwZSA9IHRoaXMuaG9zdENvbmZpZy5nZXRGb250VHlwZURlZmluaXRpb24odGhpcy5mb250VHlwZSk7XHJcbiAgICAgICAgaWYgKGZvbnRUeXBlLmZvbnRGYW1pbHkpIHtcclxuICAgICAgICAgICAgdGFyZ2V0RWxlbWVudC5zdHlsZS5mb250RmFtaWx5ID0gZm9udFR5cGUuZm9udEZhbWlseTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGZvbnRTaXplO1xyXG4gICAgICAgIHN3aXRjaCAodGhpcy5zaXplKSB7XHJcbiAgICAgICAgICAgIGNhc2UgRW51bXMuVGV4dFNpemUuU21hbGw6XHJcbiAgICAgICAgICAgICAgICBmb250U2l6ZSA9IGZvbnRUeXBlLmZvbnRTaXplcy5zbWFsbDtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIEVudW1zLlRleHRTaXplLk1lZGl1bTpcclxuICAgICAgICAgICAgICAgIGZvbnRTaXplID0gZm9udFR5cGUuZm9udFNpemVzLm1lZGl1bTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIEVudW1zLlRleHRTaXplLkxhcmdlOlxyXG4gICAgICAgICAgICAgICAgZm9udFNpemUgPSBmb250VHlwZS5mb250U2l6ZXMubGFyZ2U7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBFbnVtcy5UZXh0U2l6ZS5FeHRyYUxhcmdlOlxyXG4gICAgICAgICAgICAgICAgZm9udFNpemUgPSBmb250VHlwZS5mb250U2l6ZXMuZXh0cmFMYXJnZTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgZm9udFNpemUgPSBmb250VHlwZS5mb250U2l6ZXMuZGVmYXVsdDtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0YXJnZXRFbGVtZW50LnN0eWxlLmZvbnRTaXplID0gZm9udFNpemUgKyBcInB4XCI7XHJcbiAgICAgICAgdmFyIGNvbG9yRGVmaW5pdGlvbiA9IHRoaXMuZ2V0Q29sb3JEZWZpbml0aW9uKHRoaXMuZ2V0RWZmZWN0aXZlU3R5bGVEZWZpbml0aW9uKCkuZm9yZWdyb3VuZENvbG9ycywgdGhpcy5lZmZlY3RpdmVDb2xvcik7XHJcbiAgICAgICAgdGFyZ2V0RWxlbWVudC5zdHlsZS5jb2xvciA9IFV0aWxzLnN0cmluZ1RvQ3NzQ29sb3IodGhpcy5pc1N1YnRsZSA/IGNvbG9yRGVmaW5pdGlvbi5zdWJ0bGUgOiBjb2xvckRlZmluaXRpb24uZGVmYXVsdCk7XHJcbiAgICAgICAgdmFyIGZvbnRXZWlnaHQ7XHJcbiAgICAgICAgc3dpdGNoICh0aGlzLndlaWdodCkge1xyXG4gICAgICAgICAgICBjYXNlIEVudW1zLlRleHRXZWlnaHQuTGlnaHRlcjpcclxuICAgICAgICAgICAgICAgIGZvbnRXZWlnaHQgPSBmb250VHlwZS5mb250V2VpZ2h0cy5saWdodGVyO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgRW51bXMuVGV4dFdlaWdodC5Cb2xkZXI6XHJcbiAgICAgICAgICAgICAgICBmb250V2VpZ2h0ID0gZm9udFR5cGUuZm9udFdlaWdodHMuYm9sZGVyO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICBmb250V2VpZ2h0ID0gZm9udFR5cGUuZm9udFdlaWdodHMuZGVmYXVsdDtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0YXJnZXRFbGVtZW50LnN0eWxlLmZvbnRXZWlnaHQgPSBmb250V2VpZ2h0LnRvU3RyaW5nKCk7XHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEJhc2VUZXh0QmxvY2sucHJvdG90eXBlLCBcImVmZmVjdGl2ZUNvbG9yXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29sb3IgPyB0aGlzLmNvbG9yIDogRW51bXMuVGV4dENvbG9yLkRlZmF1bHQ7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBCYXNlVGV4dEJsb2NrLnRleHRQcm9wZXJ0eSA9IG5ldyBzZXJpYWxpemF0aW9uXzEuU3RyaW5nUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzAsIFwidGV4dFwiLCB0cnVlKTtcclxuICAgIEJhc2VUZXh0QmxvY2suc2l6ZVByb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5FbnVtUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzAsIFwic2l6ZVwiLCBFbnVtcy5UZXh0U2l6ZSwgRW51bXMuVGV4dFNpemUuRGVmYXVsdCk7XHJcbiAgICBCYXNlVGV4dEJsb2NrLndlaWdodFByb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5FbnVtUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzAsIFwid2VpZ2h0XCIsIEVudW1zLlRleHRXZWlnaHQsIEVudW1zLlRleHRXZWlnaHQuRGVmYXVsdCk7XHJcbiAgICBCYXNlVGV4dEJsb2NrLmNvbG9yUHJvcGVydHkgPSBuZXcgc2VyaWFsaXphdGlvbl8xLkVudW1Qcm9wZXJ0eShzZXJpYWxpemF0aW9uXzEuVmVyc2lvbnMudjFfMCwgXCJjb2xvclwiLCBFbnVtcy5UZXh0Q29sb3IsIEVudW1zLlRleHRDb2xvci5EZWZhdWx0KTtcclxuICAgIEJhc2VUZXh0QmxvY2suaXNTdWJ0bGVQcm9wZXJ0eSA9IG5ldyBzZXJpYWxpemF0aW9uXzEuQm9vbFByb3BlcnR5KHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8wLCBcImlzU3VidGxlXCIsIGZhbHNlKTtcclxuICAgIEJhc2VUZXh0QmxvY2suZm9udFR5cGVQcm9wZXJ0eSA9IG5ldyBzZXJpYWxpemF0aW9uXzEuRW51bVByb3BlcnR5KHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8yLCBcImZvbnRUeXBlXCIsIEVudW1zLkZvbnRUeXBlKTtcclxuICAgIEJhc2VUZXh0QmxvY2suc2VsZWN0QWN0aW9uUHJvcGVydHkgPSBuZXcgQWN0aW9uUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzAsIFwic2VsZWN0QWN0aW9uXCIsIFtcIkFjdGlvbi5TaG93Q2FyZFwiXSk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBzZXJpYWxpemF0aW9uXzEucHJvcGVydHkoQmFzZVRleHRCbG9jay5zaXplUHJvcGVydHkpXHJcbiAgICBdLCBCYXNlVGV4dEJsb2NrLnByb3RvdHlwZSwgXCJzaXplXCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBzZXJpYWxpemF0aW9uXzEucHJvcGVydHkoQmFzZVRleHRCbG9jay53ZWlnaHRQcm9wZXJ0eSlcclxuICAgIF0sIEJhc2VUZXh0QmxvY2sucHJvdG90eXBlLCBcIndlaWdodFwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KEJhc2VUZXh0QmxvY2suY29sb3JQcm9wZXJ0eSlcclxuICAgIF0sIEJhc2VUZXh0QmxvY2sucHJvdG90eXBlLCBcImNvbG9yXCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBzZXJpYWxpemF0aW9uXzEucHJvcGVydHkoQmFzZVRleHRCbG9jay5mb250VHlwZVByb3BlcnR5KVxyXG4gICAgXSwgQmFzZVRleHRCbG9jay5wcm90b3R5cGUsIFwiZm9udFR5cGVcIiwgdm9pZCAwKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHNlcmlhbGl6YXRpb25fMS5wcm9wZXJ0eShCYXNlVGV4dEJsb2NrLmlzU3VidGxlUHJvcGVydHkpXHJcbiAgICBdLCBCYXNlVGV4dEJsb2NrLnByb3RvdHlwZSwgXCJpc1N1YnRsZVwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KEJhc2VUZXh0QmxvY2sudGV4dFByb3BlcnR5KVxyXG4gICAgXSwgQmFzZVRleHRCbG9jay5wcm90b3R5cGUsIFwidGV4dFwiLCBudWxsKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHNlcmlhbGl6YXRpb25fMS5wcm9wZXJ0eShCYXNlVGV4dEJsb2NrLnNlbGVjdEFjdGlvblByb3BlcnR5KVxyXG4gICAgXSwgQmFzZVRleHRCbG9jay5wcm90b3R5cGUsIFwic2VsZWN0QWN0aW9uXCIsIHZvaWQgMCk7XHJcbiAgICByZXR1cm4gQmFzZVRleHRCbG9jaztcclxufShDYXJkRWxlbWVudCkpO1xyXG5leHBvcnRzLkJhc2VUZXh0QmxvY2sgPSBCYXNlVGV4dEJsb2NrO1xyXG52YXIgVGV4dEJsb2NrID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKFRleHRCbG9jaywgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIFRleHRCbG9jaygpIHtcclxuICAgICAgICAvLyNyZWdpb24gU2NoZW1hXHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMud3JhcCA9IGZhbHNlO1xyXG4gICAgICAgIF90aGlzLl90cmVhdEFzUGxhaW5UZXh0ID0gdHJ1ZTtcclxuICAgICAgICBfdGhpcy51c2VNYXJrZG93biA9IHRydWU7XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgVGV4dEJsb2NrLnByb3RvdHlwZS5yZXN0b3JlT3JpZ2luYWxDb250ZW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLnJlbmRlcmVkRWxlbWVudCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm1heExpbmVzICYmIHRoaXMubWF4TGluZXMgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcmVkRWxlbWVudC5zdHlsZS5tYXhIZWlnaHQgPSB0aGlzLl9jb21wdXRlZExpbmVIZWlnaHQgKiB0aGlzLm1heExpbmVzICsgXCJweFwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZWRFbGVtZW50LmlubmVySFRNTCA9IHRoaXMuX29yaWdpbmFsSW5uZXJIdG1sO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBUZXh0QmxvY2sucHJvdG90eXBlLnRydW5jYXRlSWZTdXBwb3J0ZWQgPSBmdW5jdGlvbiAobWF4SGVpZ2h0KSB7XHJcbiAgICAgICAgaWYgKHRoaXMucmVuZGVyZWRFbGVtZW50ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgLy8gRm9yIG5vdywgb25seSB0cnVuY2F0ZSBUZXh0QmxvY2tzIHRoYXQgY29udGFpbiBqdXN0IGEgc2luZ2xlXHJcbiAgICAgICAgICAgIC8vIHBhcmFncmFwaCAtLSBzaW5jZSB0aGUgbWF4TGluZXMgY2FsY3VsYXRpb24gZG9lc24ndCB0YWtlIGludG9cclxuICAgICAgICAgICAgLy8gYWNjb3VudCBNYXJrZG93biBsaXN0c1xyXG4gICAgICAgICAgICB2YXIgY2hpbGRyZW4gPSB0aGlzLnJlbmRlcmVkRWxlbWVudC5jaGlsZHJlbjtcclxuICAgICAgICAgICAgdmFyIGlzVGV4dE9ubHkgPSAhY2hpbGRyZW4ubGVuZ3RoO1xyXG4gICAgICAgICAgICB2YXIgdHJ1bmNhdGlvblN1cHBvcnRlZCA9IGlzVGV4dE9ubHkgfHwgY2hpbGRyZW4ubGVuZ3RoID09IDEgJiYgY2hpbGRyZW5bMF0udGFnTmFtZS50b0xvd2VyQ2FzZSgpID09ICdwJztcclxuICAgICAgICAgICAgaWYgKHRydW5jYXRpb25TdXBwb3J0ZWQpIHtcclxuICAgICAgICAgICAgICAgIHZhciBlbGVtZW50ID0gaXNUZXh0T25seSA/IHRoaXMucmVuZGVyZWRFbGVtZW50IDogY2hpbGRyZW5bMF07XHJcbiAgICAgICAgICAgICAgICBVdGlscy50cnVuY2F0ZShlbGVtZW50LCBtYXhIZWlnaHQsIHRoaXMuX2NvbXB1dGVkTGluZUhlaWdodCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9O1xyXG4gICAgVGV4dEJsb2NrLnByb3RvdHlwZS5zZXRUZXh0ID0gZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5zZXRUZXh0LmNhbGwodGhpcywgdmFsdWUpO1xyXG4gICAgICAgIHRoaXMuX3Byb2Nlc3NlZFRleHQgPSB1bmRlZmluZWQ7XHJcbiAgICB9O1xyXG4gICAgVGV4dEJsb2NrLnByb3RvdHlwZS5nZXRSZW5kZXJlZERvbUVsZW1lbnRUeXBlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBcImRpdlwiO1xyXG4gICAgfTtcclxuICAgIFRleHRCbG9jay5wcm90b3R5cGUuaW50ZXJuYWxSZW5kZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB0aGlzLl9wcm9jZXNzZWRUZXh0ID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIGlmICh0aGlzLnRleHQpIHtcclxuICAgICAgICAgICAgdmFyIHByZVByb2Nlc3NlZFRleHQgPSB0aGlzLnByZVByb2Nlc3NQcm9wZXJ0eVZhbHVlKEJhc2VUZXh0QmxvY2sudGV4dFByb3BlcnR5KTtcclxuICAgICAgICAgICAgdmFyIGhvc3RDb25maWcgPSB0aGlzLmhvc3RDb25maWc7XHJcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0aGlzLmdldFJlbmRlcmVkRG9tRWxlbWVudFR5cGUoKSk7XHJcbiAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZChob3N0Q29uZmlnLm1ha2VDc3NDbGFzc05hbWUoXCJhYy10ZXh0QmxvY2tcIikpO1xyXG4gICAgICAgICAgICBlbGVtZW50LnN0eWxlLm92ZXJmbG93ID0gXCJoaWRkZW5cIjtcclxuICAgICAgICAgICAgdGhpcy5hcHBseVN0eWxlc1RvKGVsZW1lbnQpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5zZWxlY3RBY3Rpb24pIHtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQub25jbGljayA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGUuY2FuY2VsQnViYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMuc2VsZWN0QWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnNlbGVjdEFjdGlvbi5leGVjdXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIGlmIChob3N0Q29uZmlnLnN1cHBvcnRzSW50ZXJhY3Rpdml0eSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQudGFiSW5kZXggPSAwO1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKFwicm9sZVwiLCBcImJ1dHRvblwiKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5zZWxlY3RBY3Rpb24udGl0bGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIHRoaXMuc2VsZWN0QWN0aW9uLnRpdGxlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKGhvc3RDb25maWcubWFrZUNzc0NsYXNzTmFtZShcImFjLXNlbGVjdGFibGVcIikpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5fcHJvY2Vzc2VkVGV4dCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fdHJlYXRBc1BsYWluVGV4dCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB2YXIgZm9ybWF0dGVkVGV4dCA9IFRleHRGb3JtYXR0ZXJzLmZvcm1hdFRleHQodGhpcy5sYW5nLCBwcmVQcm9jZXNzZWRUZXh0KTtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnVzZU1hcmtkb3duICYmIGZvcm1hdHRlZFRleHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoc2hhcmVkXzEuR2xvYmFsU2V0dGluZ3MuYWxsb3dNYXJrRm9yVGV4dEhpZ2hsaWdodGluZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXR0ZWRUZXh0ID0gZm9ybWF0dGVkVGV4dC5yZXBsYWNlKC88bWFyaz4vZywgXCI9PT1cIikucmVwbGFjZSgvPFxcL21hcms+L2csIFwiLz09XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB2YXIgbWFya2Rvd25Qcm9jZXNzaW5nUmVzdWx0ID0gQWRhcHRpdmVDYXJkLmFwcGx5TWFya2Rvd24oZm9ybWF0dGVkVGV4dCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1hcmtkb3duUHJvY2Vzc2luZ1Jlc3VsdC5kaWRQcm9jZXNzICYmIG1hcmtkb3duUHJvY2Vzc2luZ1Jlc3VsdC5vdXRwdXRIdG1sKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3Byb2Nlc3NlZFRleHQgPSBtYXJrZG93blByb2Nlc3NpbmdSZXN1bHQub3V0cHV0SHRtbDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fdHJlYXRBc1BsYWluVGV4dCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBPbmx5IHByb2Nlc3MgPG1hcms+IHRhZyBpZiBtYXJrZG93biBwcm9jZXNzaW5nIHdhcyBhcHBsaWVkIGJlY2F1c2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gbWFya2Rvd24gcHJvY2Vzc2luZyBpcyBhbHNvIHJlc3BvbnNpYmxlIGZvciBzYW5pdGl6aW5nIHRoZSBpbnB1dCBzdHJpbmdcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNoYXJlZF8xLkdsb2JhbFNldHRpbmdzLmFsbG93TWFya0ZvclRleHRIaWdobGlnaHRpbmcgJiYgdGhpcy5fcHJvY2Vzc2VkVGV4dCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1hcmtTdHlsZSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZWZmZWN0aXZlU3R5bGUgPSB0aGlzLmdldEVmZmVjdGl2ZVN0eWxlRGVmaW5pdGlvbigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVmZmVjdGl2ZVN0eWxlLmhpZ2hsaWdodEJhY2tncm91bmRDb2xvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcmtTdHlsZSArPSBcImJhY2tncm91bmQtY29sb3I6IFwiICsgZWZmZWN0aXZlU3R5bGUuaGlnaGxpZ2h0QmFja2dyb3VuZENvbG9yICsgXCI7XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZWZmZWN0aXZlU3R5bGUuaGlnaGxpZ2h0Rm9yZWdyb3VuZENvbG9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFya1N0eWxlICs9IFwiY29sb3I6IFwiICsgZWZmZWN0aXZlU3R5bGUuaGlnaGxpZ2h0Rm9yZWdyb3VuZENvbG9yICsgXCI7XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobWFya1N0eWxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFya1N0eWxlID0gJ3N0eWxlPVwiJyArIG1hcmtTdHlsZSArICdcIic7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9wcm9jZXNzZWRUZXh0ID0gdGhpcy5fcHJvY2Vzc2VkVGV4dC5yZXBsYWNlKC89PT0vZywgXCI8bWFyayBcIiArIG1hcmtTdHlsZSArIFwiPlwiKS5yZXBsYWNlKC9cXC89PS9nLCBcIjwvbWFyaz5cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3Byb2Nlc3NlZFRleHQgPSBmb3JtYXR0ZWRUZXh0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl90cmVhdEFzUGxhaW5UZXh0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9wcm9jZXNzZWRUZXh0ID0gZm9ybWF0dGVkVGV4dDtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl90cmVhdEFzUGxhaW5UZXh0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIXRoaXMuX3Byb2Nlc3NlZFRleHQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3Byb2Nlc3NlZFRleHQgPSBcIlwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLl90cmVhdEFzUGxhaW5UZXh0KSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LmlubmVyVGV4dCA9IHRoaXMuX3Byb2Nlc3NlZFRleHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LmlubmVySFRNTCA9IHRoaXMuX3Byb2Nlc3NlZFRleHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGVsZW1lbnQuZmlyc3RFbGVtZW50Q2hpbGQgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGZpcnN0RWxlbWVudENoaWxkID0gZWxlbWVudC5maXJzdEVsZW1lbnRDaGlsZDtcclxuICAgICAgICAgICAgICAgIGZpcnN0RWxlbWVudENoaWxkLnN0eWxlLm1hcmdpblRvcCA9IFwiMHB4XCI7XHJcbiAgICAgICAgICAgICAgICBmaXJzdEVsZW1lbnRDaGlsZC5zdHlsZS53aWR0aCA9IFwiMTAwJVwiO1xyXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLndyYXApIHtcclxuICAgICAgICAgICAgICAgICAgICBmaXJzdEVsZW1lbnRDaGlsZC5zdHlsZS5vdmVyZmxvdyA9IFwiaGlkZGVuXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgZmlyc3RFbGVtZW50Q2hpbGQuc3R5bGUudGV4dE92ZXJmbG93ID0gXCJlbGxpcHNpc1wiO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChlbGVtZW50Lmxhc3RFbGVtZW50Q2hpbGQgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5sYXN0RWxlbWVudENoaWxkLnN0eWxlLm1hcmdpbkJvdHRvbSA9IFwiMHB4XCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIGFuY2hvcnMgPSBlbGVtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiYVwiKTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhbmNob3JzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgYW5jaG9yID0gYW5jaG9yc1tpXTtcclxuICAgICAgICAgICAgICAgIGFuY2hvci5jbGFzc0xpc3QuYWRkKGhvc3RDb25maWcubWFrZUNzc0NsYXNzTmFtZShcImFjLWFuY2hvclwiKSk7XHJcbiAgICAgICAgICAgICAgICBhbmNob3IudGFyZ2V0ID0gXCJfYmxhbmtcIjtcclxuICAgICAgICAgICAgICAgIGFuY2hvci5vbmNsaWNrID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmFpc2VBbmNob3JDbGlja2VkRXZlbnQoX3RoaXMsIGUudGFyZ2V0KSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGUuY2FuY2VsQnViYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLndyYXApIHtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUud29yZFdyYXAgPSBcImJyZWFrLXdvcmRcIjtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLm1heExpbmVzICYmIHRoaXMubWF4TGluZXMgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5tYXhIZWlnaHQgPSAodGhpcy5fY29tcHV0ZWRMaW5lSGVpZ2h0ICogdGhpcy5tYXhMaW5lcykgKyBcInB4XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5vdmVyZmxvdyA9IFwiaGlkZGVuXCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LnN0eWxlLndoaXRlU3BhY2UgPSBcIm5vd3JhcFwiO1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5zdHlsZS50ZXh0T3ZlcmZsb3cgPSBcImVsbGlwc2lzXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHNoYXJlZF8xLkdsb2JhbFNldHRpbmdzLnVzZUFkdmFuY2VkVGV4dEJsb2NrVHJ1bmNhdGlvbiB8fCBzaGFyZWRfMS5HbG9iYWxTZXR0aW5ncy51c2VBZHZhbmNlZENhcmRCb3R0b21UcnVuY2F0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9vcmlnaW5hbElubmVySHRtbCA9IGVsZW1lbnQuaW5uZXJIVE1MO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50O1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgVGV4dEJsb2NrLnByb3RvdHlwZS50cnVuY2F0ZU92ZXJmbG93ID0gZnVuY3Rpb24gKG1heEhlaWdodCkge1xyXG4gICAgICAgIGlmIChtYXhIZWlnaHQgPj0gdGhpcy5fY29tcHV0ZWRMaW5lSGVpZ2h0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnRydW5jYXRlSWZTdXBwb3J0ZWQobWF4SGVpZ2h0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfTtcclxuICAgIFRleHRCbG9jay5wcm90b3R5cGUudW5kb092ZXJmbG93VHJ1bmNhdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLnJlc3RvcmVPcmlnaW5hbENvbnRlbnQoKTtcclxuICAgICAgICBpZiAoc2hhcmVkXzEuR2xvYmFsU2V0dGluZ3MudXNlQWR2YW5jZWRUZXh0QmxvY2tUcnVuY2F0aW9uICYmIHRoaXMubWF4TGluZXMpIHtcclxuICAgICAgICAgICAgdmFyIG1heEhlaWdodCA9IHRoaXMuX2NvbXB1dGVkTGluZUhlaWdodCAqIHRoaXMubWF4TGluZXM7XHJcbiAgICAgICAgICAgIHRoaXMudHJ1bmNhdGVJZlN1cHBvcnRlZChtYXhIZWlnaHQpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBUZXh0QmxvY2sucHJvdG90eXBlLmFwcGx5U3R5bGVzVG8gPSBmdW5jdGlvbiAodGFyZ2V0RWxlbWVudCkge1xyXG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUuYXBwbHlTdHlsZXNUby5jYWxsKHRoaXMsIHRhcmdldEVsZW1lbnQpO1xyXG4gICAgICAgIHZhciBwYXJlbnRDb250YWluZXIgPSB0aGlzLmdldFBhcmVudENvbnRhaW5lcigpO1xyXG4gICAgICAgIHZhciBpc1J0bCA9IHBhcmVudENvbnRhaW5lciA/IHBhcmVudENvbnRhaW5lci5pc1J0bCgpIDogZmFsc2U7XHJcbiAgICAgICAgc3dpdGNoICh0aGlzLmhvcml6b250YWxBbGlnbm1lbnQpIHtcclxuICAgICAgICAgICAgY2FzZSBFbnVtcy5Ib3Jpem9udGFsQWxpZ25tZW50LkNlbnRlcjpcclxuICAgICAgICAgICAgICAgIHRhcmdldEVsZW1lbnQuc3R5bGUudGV4dEFsaWduID0gXCJjZW50ZXJcIjtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIEVudW1zLkhvcml6b250YWxBbGlnbm1lbnQuUmlnaHQ6XHJcbiAgICAgICAgICAgICAgICB0YXJnZXRFbGVtZW50LnN0eWxlLnRleHRBbGlnbiA9IGlzUnRsID8gXCJsZWZ0XCIgOiBcInJpZ2h0XCI7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHRhcmdldEVsZW1lbnQuc3R5bGUudGV4dEFsaWduID0gaXNSdGwgPyBcInJpZ2h0XCIgOiBcImxlZnRcIjtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgbGluZUhlaWdodHMgPSB0aGlzLmhvc3RDb25maWcubGluZUhlaWdodHM7XHJcbiAgICAgICAgaWYgKGxpbmVIZWlnaHRzKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAodGhpcy5zaXplKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIEVudW1zLlRleHRTaXplLlNtYWxsOlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2NvbXB1dGVkTGluZUhlaWdodCA9IGxpbmVIZWlnaHRzLnNtYWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBFbnVtcy5UZXh0U2l6ZS5NZWRpdW06XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY29tcHV0ZWRMaW5lSGVpZ2h0ID0gbGluZUhlaWdodHMubWVkaXVtO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBFbnVtcy5UZXh0U2l6ZS5MYXJnZTpcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jb21wdXRlZExpbmVIZWlnaHQgPSBsaW5lSGVpZ2h0cy5sYXJnZTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgRW51bXMuVGV4dFNpemUuRXh0cmFMYXJnZTpcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jb21wdXRlZExpbmVIZWlnaHQgPSBsaW5lSGVpZ2h0cy5leHRyYUxhcmdlO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jb21wdXRlZExpbmVIZWlnaHQgPSBsaW5lSGVpZ2h0cy5kZWZhdWx0O1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAvLyBMb29rcyBsaWtlIDEuMzMgaXMgdGhlIG1hZ2ljIG51bWJlciB0byBjb21wdXRlIGxpbmUtaGVpZ2h0XHJcbiAgICAgICAgICAgIC8vIGZyb20gZm9udCBzaXplLlxyXG4gICAgICAgICAgICB0aGlzLl9jb21wdXRlZExpbmVIZWlnaHQgPSB0aGlzLmdldEZvbnRTaXplKHRoaXMuaG9zdENvbmZpZy5nZXRGb250VHlwZURlZmluaXRpb24odGhpcy5mb250VHlwZSkpICogMS4zMztcclxuICAgICAgICB9XHJcbiAgICAgICAgdGFyZ2V0RWxlbWVudC5zdHlsZS5saW5lSGVpZ2h0ID0gdGhpcy5fY29tcHV0ZWRMaW5lSGVpZ2h0ICsgXCJweFwiO1xyXG4gICAgfTtcclxuICAgIFRleHRCbG9jay5wcm90b3R5cGUuZ2V0SnNvblR5cGVOYW1lID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBcIlRleHRCbG9ja1wiO1xyXG4gICAgfTtcclxuICAgIFRleHRCbG9jay5wcm90b3R5cGUudXBkYXRlTGF5b3V0ID0gZnVuY3Rpb24gKHByb2Nlc3NDaGlsZHJlbikge1xyXG4gICAgICAgIGlmIChwcm9jZXNzQ2hpbGRyZW4gPT09IHZvaWQgMCkgeyBwcm9jZXNzQ2hpbGRyZW4gPSBmYWxzZTsgfVxyXG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUudXBkYXRlTGF5b3V0LmNhbGwodGhpcywgcHJvY2Vzc0NoaWxkcmVuKTtcclxuICAgICAgICBpZiAoc2hhcmVkXzEuR2xvYmFsU2V0dGluZ3MudXNlQWR2YW5jZWRUZXh0QmxvY2tUcnVuY2F0aW9uICYmIHRoaXMubWF4TGluZXMgJiYgdGhpcy5pc0Rpc3BsYXllZCgpKSB7XHJcbiAgICAgICAgICAgIC8vIFJlc2V0IHRoZSBlbGVtZW50J3MgaW5uZXJIVE1MIGluIGNhc2UgdGhlIGF2YWlsYWJsZSByb29tIGZvclxyXG4gICAgICAgICAgICAvLyBjb250ZW50IGhhcyBpbmNyZWFzZWRcclxuICAgICAgICAgICAgdGhpcy5yZXN0b3JlT3JpZ2luYWxDb250ZW50KCk7XHJcbiAgICAgICAgICAgIHRoaXMudHJ1bmNhdGVJZlN1cHBvcnRlZCh0aGlzLl9jb21wdXRlZExpbmVIZWlnaHQgKiB0aGlzLm1heExpbmVzKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgVGV4dEJsb2NrLndyYXBQcm9wZXJ0eSA9IG5ldyBzZXJpYWxpemF0aW9uXzEuQm9vbFByb3BlcnR5KHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8wLCBcIndyYXBcIiwgZmFsc2UpO1xyXG4gICAgVGV4dEJsb2NrLm1heExpbmVzUHJvcGVydHkgPSBuZXcgc2VyaWFsaXphdGlvbl8xLk51bVByb3BlcnR5KHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8wLCBcIm1heExpbmVzXCIpO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KFRleHRCbG9jay53cmFwUHJvcGVydHkpXHJcbiAgICBdLCBUZXh0QmxvY2sucHJvdG90eXBlLCBcIndyYXBcIiwgdm9pZCAwKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHNlcmlhbGl6YXRpb25fMS5wcm9wZXJ0eShUZXh0QmxvY2subWF4TGluZXNQcm9wZXJ0eSlcclxuICAgIF0sIFRleHRCbG9jay5wcm90b3R5cGUsIFwibWF4TGluZXNcIiwgdm9pZCAwKTtcclxuICAgIHJldHVybiBUZXh0QmxvY2s7XHJcbn0oQmFzZVRleHRCbG9jaykpO1xyXG5leHBvcnRzLlRleHRCbG9jayA9IFRleHRCbG9jaztcclxudmFyIExhYmVsID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKExhYmVsLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gTGFiZWwoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgTGFiZWwucHJvdG90eXBlLmdldFJlbmRlcmVkRG9tRWxlbWVudFR5cGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIFwibGFiZWxcIjtcclxuICAgIH07XHJcbiAgICBMYWJlbC5wcm90b3R5cGUuaW50ZXJuYWxSZW5kZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHJlbmRlcmVkRWxlbWVudCA9IF9zdXBlci5wcm90b3R5cGUuaW50ZXJuYWxSZW5kZXIuY2FsbCh0aGlzKTtcclxuICAgICAgICBpZiAocmVuZGVyZWRFbGVtZW50ICYmIHRoaXMuZm9yRWxlbWVudElkKSB7XHJcbiAgICAgICAgICAgIHJlbmRlcmVkRWxlbWVudC5odG1sRm9yID0gdGhpcy5mb3JFbGVtZW50SWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZW5kZXJlZEVsZW1lbnQ7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIExhYmVsO1xyXG59KFRleHRCbG9jaykpO1xyXG52YXIgVGV4dFJ1biA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhUZXh0UnVuLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gVGV4dFJ1bigpIHtcclxuICAgICAgICAvLyNyZWdpb24gU2NoZW1hXHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMuaXRhbGljID0gZmFsc2U7XHJcbiAgICAgICAgX3RoaXMuc3RyaWtldGhyb3VnaCA9IGZhbHNlO1xyXG4gICAgICAgIF90aGlzLmhpZ2hsaWdodCA9IGZhbHNlO1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIFRleHRSdW4ucHJvdG90eXBlLnBvcHVsYXRlU2NoZW1hID0gZnVuY3Rpb24gKHNjaGVtYSkge1xyXG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUucG9wdWxhdGVTY2hlbWEuY2FsbCh0aGlzLCBzY2hlbWEpO1xyXG4gICAgICAgIHNjaGVtYS5hZGQoQmFzZVRleHRCbG9jay5zZWxlY3RBY3Rpb25Qcm9wZXJ0eSk7XHJcbiAgICB9O1xyXG4gICAgLy8jZW5kcmVnaW9uXHJcbiAgICBUZXh0UnVuLnByb3RvdHlwZS5pbnRlcm5hbFJlbmRlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIGlmICh0aGlzLnRleHQpIHtcclxuICAgICAgICAgICAgdmFyIHByZVByb2Nlc3NlZFRleHQgPSB0aGlzLnByZVByb2Nlc3NQcm9wZXJ0eVZhbHVlKEJhc2VUZXh0QmxvY2sudGV4dFByb3BlcnR5KTtcclxuICAgICAgICAgICAgdmFyIGhvc3RDb25maWcgPSB0aGlzLmhvc3RDb25maWc7XHJcbiAgICAgICAgICAgIHZhciBmb3JtYXR0ZWRUZXh0ID0gVGV4dEZvcm1hdHRlcnMuZm9ybWF0VGV4dCh0aGlzLmxhbmcsIHByZVByb2Nlc3NlZFRleHQpO1xyXG4gICAgICAgICAgICBpZiAoIWZvcm1hdHRlZFRleHQpIHtcclxuICAgICAgICAgICAgICAgIGZvcm1hdHRlZFRleHQgPSBcIlwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XHJcbiAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LmFkZChob3N0Q29uZmlnLm1ha2VDc3NDbGFzc05hbWUoXCJhYy10ZXh0UnVuXCIpKTtcclxuICAgICAgICAgICAgdGhpcy5hcHBseVN0eWxlc1RvKGVsZW1lbnQpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5zZWxlY3RBY3Rpb24gJiYgaG9zdENvbmZpZy5zdXBwb3J0c0ludGVyYWN0aXZpdHkpIHtcclxuICAgICAgICAgICAgICAgIHZhciBhbmNob3IgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKTtcclxuICAgICAgICAgICAgICAgIGFuY2hvci5jbGFzc0xpc3QuYWRkKGhvc3RDb25maWcubWFrZUNzc0NsYXNzTmFtZShcImFjLWFuY2hvclwiKSk7XHJcbiAgICAgICAgICAgICAgICB2YXIgaHJlZiA9IHRoaXMuc2VsZWN0QWN0aW9uLmdldEhyZWYoKTtcclxuICAgICAgICAgICAgICAgIGFuY2hvci5ocmVmID0gaHJlZiA/IGhyZWYgOiBcIlwiO1xyXG4gICAgICAgICAgICAgICAgYW5jaG9yLnRhcmdldCA9IFwiX2JsYW5rXCI7XHJcbiAgICAgICAgICAgICAgICBhbmNob3Iub25jbGljayA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGUuY2FuY2VsQnViYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMuc2VsZWN0QWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnNlbGVjdEFjdGlvbi5leGVjdXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIGFuY2hvci5pbm5lclRleHQgPSBmb3JtYXR0ZWRUZXh0O1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5hcHBlbmRDaGlsZChhbmNob3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5pbm5lclRleHQgPSBmb3JtYXR0ZWRUZXh0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50O1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgVGV4dFJ1bi5wcm90b3R5cGUuYXBwbHlTdHlsZXNUbyA9IGZ1bmN0aW9uICh0YXJnZXRFbGVtZW50KSB7XHJcbiAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5hcHBseVN0eWxlc1RvLmNhbGwodGhpcywgdGFyZ2V0RWxlbWVudCk7XHJcbiAgICAgICAgaWYgKHRoaXMuaXRhbGljKSB7XHJcbiAgICAgICAgICAgIHRhcmdldEVsZW1lbnQuc3R5bGUuZm9udFN0eWxlID0gXCJpdGFsaWNcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuc3RyaWtldGhyb3VnaCkge1xyXG4gICAgICAgICAgICB0YXJnZXRFbGVtZW50LnN0eWxlLnRleHREZWNvcmF0aW9uID0gXCJsaW5lLXRocm91Z2hcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuaGlnaGxpZ2h0KSB7XHJcbiAgICAgICAgICAgIHZhciBjb2xvckRlZmluaXRpb24gPSB0aGlzLmdldENvbG9yRGVmaW5pdGlvbih0aGlzLmdldEVmZmVjdGl2ZVN0eWxlRGVmaW5pdGlvbigpLmZvcmVncm91bmRDb2xvcnMsIHRoaXMuZWZmZWN0aXZlQ29sb3IpO1xyXG4gICAgICAgICAgICB0YXJnZXRFbGVtZW50LnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFV0aWxzLnN0cmluZ1RvQ3NzQ29sb3IodGhpcy5pc1N1YnRsZSA/IGNvbG9yRGVmaW5pdGlvbi5oaWdobGlnaHRDb2xvcnMuc3VidGxlIDogY29sb3JEZWZpbml0aW9uLmhpZ2hsaWdodENvbG9ycy5kZWZhdWx0KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgVGV4dFJ1bi5wcm90b3R5cGUuZ2V0SnNvblR5cGVOYW1lID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBcIlRleHRSdW5cIjtcclxuICAgIH07XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoVGV4dFJ1bi5wcm90b3R5cGUsIFwiaXNTdGFuZGFsb25lXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFRleHRSdW4ucHJvdG90eXBlLCBcImlzSW5saW5lXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBUZXh0UnVuLml0YWxpY1Byb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5Cb29sUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzIsIFwiaXRhbGljXCIsIGZhbHNlKTtcclxuICAgIFRleHRSdW4uc3RyaWtldGhyb3VnaFByb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5Cb29sUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzIsIFwic3RyaWtldGhyb3VnaFwiLCBmYWxzZSk7XHJcbiAgICBUZXh0UnVuLmhpZ2hsaWdodFByb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5Cb29sUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzIsIFwiaGlnaGxpZ2h0XCIsIGZhbHNlKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHNlcmlhbGl6YXRpb25fMS5wcm9wZXJ0eShUZXh0UnVuLml0YWxpY1Byb3BlcnR5KVxyXG4gICAgXSwgVGV4dFJ1bi5wcm90b3R5cGUsIFwiaXRhbGljXCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBzZXJpYWxpemF0aW9uXzEucHJvcGVydHkoVGV4dFJ1bi5zdHJpa2V0aHJvdWdoUHJvcGVydHkpXHJcbiAgICBdLCBUZXh0UnVuLnByb3RvdHlwZSwgXCJzdHJpa2V0aHJvdWdoXCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBzZXJpYWxpemF0aW9uXzEucHJvcGVydHkoVGV4dFJ1bi5oaWdobGlnaHRQcm9wZXJ0eSlcclxuICAgIF0sIFRleHRSdW4ucHJvdG90eXBlLCBcImhpZ2hsaWdodFwiLCB2b2lkIDApO1xyXG4gICAgcmV0dXJuIFRleHRSdW47XHJcbn0oQmFzZVRleHRCbG9jaykpO1xyXG5leHBvcnRzLlRleHRSdW4gPSBUZXh0UnVuO1xyXG52YXIgUmljaFRleHRCbG9jayA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhSaWNoVGV4dEJsb2NrLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gUmljaFRleHRCbG9jaygpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgICAgICBfdGhpcy5faW5saW5lcyA9IFtdO1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIFJpY2hUZXh0QmxvY2sucHJvdG90eXBlLmludGVybmFsQWRkSW5saW5lID0gZnVuY3Rpb24gKGlubGluZSwgZm9yY2VBZGQpIHtcclxuICAgICAgICBpZiAoZm9yY2VBZGQgPT09IHZvaWQgMCkgeyBmb3JjZUFkZCA9IGZhbHNlOyB9XHJcbiAgICAgICAgaWYgKCFpbmxpbmUuaXNJbmxpbmUpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUmljaFRleHRCbG9jay5hZGRJbmxpbmU6IHRoZSBzcGVjaWZpZWQgY2FyZCBlbGVtZW50IGNhbm5vdCBiZSB1c2VkIGFzIGEgUmljaFRleHRCbG9jayBpbmxpbmUuXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgZG9BZGQgPSBpbmxpbmUucGFyZW50ID09PSB1bmRlZmluZWQgfHwgZm9yY2VBZGQ7XHJcbiAgICAgICAgaWYgKCFkb0FkZCAmJiBpbmxpbmUucGFyZW50ICE9IHRoaXMpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUmljaFRleHRCbG9jay5hZGRJbmxpbmU6IHRoZSBzcGVjaWZpZWQgaW5saW5lIGFscmVhZHkgYmVsb25ncyB0byBhbm90aGVyIFJpY2hUZXh0QmxvY2suXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgaW5saW5lLnNldFBhcmVudCh0aGlzKTtcclxuICAgICAgICAgICAgdGhpcy5faW5saW5lcy5wdXNoKGlubGluZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFJpY2hUZXh0QmxvY2sucHJvdG90eXBlLmludGVybmFsUGFyc2UgPSBmdW5jdGlvbiAoc291cmNlLCBjb250ZXh0KSB7XHJcbiAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5pbnRlcm5hbFBhcnNlLmNhbGwodGhpcywgc291cmNlLCBjb250ZXh0KTtcclxuICAgICAgICB0aGlzLl9pbmxpbmVzID0gW107XHJcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoc291cmNlW1wiaW5saW5lc1wiXSkpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHNvdXJjZVtcImlubGluZXNcIl07IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIganNvbklubGluZSA9IF9hW19pXTtcclxuICAgICAgICAgICAgICAgIHZhciBpbmxpbmUgPSB2b2lkIDA7XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGpzb25JbmxpbmUgPT09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdGV4dFJ1biA9IG5ldyBUZXh0UnVuKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dFJ1bi50ZXh0ID0ganNvbklubGluZTtcclxuICAgICAgICAgICAgICAgICAgICBpbmxpbmUgPSB0ZXh0UnVuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gTm8gZmFsbGJhY2sgZm9yIGlubGluZXMgaW4gMS4yXHJcbiAgICAgICAgICAgICAgICAgICAgaW5saW5lID0gY29udGV4dC5wYXJzZUVsZW1lbnQodGhpcywganNvbklubGluZSwgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGlubGluZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW50ZXJuYWxBZGRJbmxpbmUoaW5saW5lLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBSaWNoVGV4dEJsb2NrLnByb3RvdHlwZS5pbnRlcm5hbFRvSlNPTiA9IGZ1bmN0aW9uICh0YXJnZXQsIGNvbnRleHQpIHtcclxuICAgICAgICBfc3VwZXIucHJvdG90eXBlLmludGVybmFsVG9KU09OLmNhbGwodGhpcywgdGFyZ2V0LCBjb250ZXh0KTtcclxuICAgICAgICBpZiAodGhpcy5faW5saW5lcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIHZhciBqc29uSW5saW5lcyA9IFtdO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gdGhpcy5faW5saW5lczsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBpbmxpbmUgPSBfYVtfaV07XHJcbiAgICAgICAgICAgICAgICBqc29uSW5saW5lcy5wdXNoKGlubGluZS50b0pTT04oY29udGV4dCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnRleHQuc2VyaWFsaXplVmFsdWUodGFyZ2V0LCBcImlubGluZXNcIiwganNvbklubGluZXMpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBSaWNoVGV4dEJsb2NrLnByb3RvdHlwZS5pbnRlcm5hbFJlbmRlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAodGhpcy5faW5saW5lcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIHZhciBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgICAgZWxlbWVudC5jbGFzc05hbWUgPSB0aGlzLmhvc3RDb25maWcubWFrZUNzc0NsYXNzTmFtZShcImFjLXJpY2hUZXh0QmxvY2tcIik7XHJcbiAgICAgICAgICAgIHZhciBwYXJlbnRDb250YWluZXIgPSB0aGlzLmdldFBhcmVudENvbnRhaW5lcigpO1xyXG4gICAgICAgICAgICB2YXIgaXNSdGwgPSBwYXJlbnRDb250YWluZXIgPyBwYXJlbnRDb250YWluZXIuaXNSdGwoKSA6IGZhbHNlO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHRoaXMuaG9yaXpvbnRhbEFsaWdubWVudCkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSBFbnVtcy5Ib3Jpem9udGFsQWxpZ25tZW50LkNlbnRlcjpcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnN0eWxlLnRleHRBbGlnbiA9IFwiY2VudGVyXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIEVudW1zLkhvcml6b250YWxBbGlnbm1lbnQuUmlnaHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5zdHlsZS50ZXh0QWxpZ24gPSBpc1J0bCA/IFwibGVmdFwiIDogXCJyaWdodFwiO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnN0eWxlLnRleHRBbGlnbiA9IGlzUnRsID8gXCJyaWdodFwiIDogXCJsZWZ0XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHJlbmRlcmVkSW5saW5lcyA9IDA7XHJcbiAgICAgICAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSB0aGlzLl9pbmxpbmVzOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGlubGluZSA9IF9hW19pXTtcclxuICAgICAgICAgICAgICAgIHZhciByZW5kZXJlZElubGluZSA9IGlubGluZS5yZW5kZXIoKTtcclxuICAgICAgICAgICAgICAgIGlmIChyZW5kZXJlZElubGluZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYXBwZW5kQ2hpbGQocmVuZGVyZWRJbmxpbmUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlbmRlcmVkSW5saW5lcysrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChyZW5kZXJlZElubGluZXMgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgfTtcclxuICAgIFJpY2hUZXh0QmxvY2sucHJvdG90eXBlLmFzU3RyaW5nID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciByZXN1bHQgPSBcIlwiO1xyXG4gICAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSB0aGlzLl9pbmxpbmVzOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgICAgICB2YXIgaW5saW5lID0gX2FbX2ldO1xyXG4gICAgICAgICAgICByZXN1bHQgKz0gaW5saW5lLmFzU3RyaW5nKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9O1xyXG4gICAgUmljaFRleHRCbG9jay5wcm90b3R5cGUuZ2V0SnNvblR5cGVOYW1lID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBcIlJpY2hUZXh0QmxvY2tcIjtcclxuICAgIH07XHJcbiAgICBSaWNoVGV4dEJsb2NrLnByb3RvdHlwZS5nZXRJbmxpbmVDb3VudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5faW5saW5lcy5sZW5ndGg7XHJcbiAgICB9O1xyXG4gICAgUmljaFRleHRCbG9jay5wcm90b3R5cGUuZ2V0SW5saW5lQXQgPSBmdW5jdGlvbiAoaW5kZXgpIHtcclxuICAgICAgICBpZiAoaW5kZXggPj0gMCAmJiBpbmRleCA8IHRoaXMuX2lubGluZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pbmxpbmVzW2luZGV4XTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlJpY2hUZXh0QmxvY2suZ2V0SW5saW5lQXQ6IEluZGV4IG91dCBvZiByYW5nZSAoXCIgKyBpbmRleCArIFwiKVwiKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgUmljaFRleHRCbG9jay5wcm90b3R5cGUuYWRkSW5saW5lID0gZnVuY3Rpb24gKGlubGluZSkge1xyXG4gICAgICAgIHRoaXMuaW50ZXJuYWxBZGRJbmxpbmUoaW5saW5lKTtcclxuICAgIH07XHJcbiAgICBSaWNoVGV4dEJsb2NrLnByb3RvdHlwZS5yZW1vdmVJbmxpbmUgPSBmdW5jdGlvbiAoaW5saW5lKSB7XHJcbiAgICAgICAgdmFyIGluZGV4ID0gdGhpcy5faW5saW5lcy5pbmRleE9mKGlubGluZSk7XHJcbiAgICAgICAgaWYgKGluZGV4ID49IDApIHtcclxuICAgICAgICAgICAgdGhpcy5faW5saW5lc1tpbmRleF0uc2V0UGFyZW50KHVuZGVmaW5lZCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2lubGluZXMuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gUmljaFRleHRCbG9jaztcclxufShDYXJkRWxlbWVudCkpO1xyXG5leHBvcnRzLlJpY2hUZXh0QmxvY2sgPSBSaWNoVGV4dEJsb2NrO1xyXG52YXIgRmFjdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhGYWN0LCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gRmFjdChuYW1lLCB2YWx1ZSkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMubmFtZSA9IG5hbWU7XHJcbiAgICAgICAgX3RoaXMudmFsdWUgPSB2YWx1ZTtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICAvLyNlbmRyZWdpb25cclxuICAgIEZhY3QucHJvdG90eXBlLmdldFNjaGVtYUtleSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gXCJGYWN0XCI7XHJcbiAgICB9O1xyXG4gICAgLy8jcmVnaW9uIFNjaGVtYVxyXG4gICAgRmFjdC50aXRsZVByb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5TdHJpbmdQcm9wZXJ0eShzZXJpYWxpemF0aW9uXzEuVmVyc2lvbnMudjFfMCwgXCJ0aXRsZVwiKTtcclxuICAgIEZhY3QudmFsdWVQcm9wZXJ0eSA9IG5ldyBzZXJpYWxpemF0aW9uXzEuU3RyaW5nUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzAsIFwidmFsdWVcIik7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBzZXJpYWxpemF0aW9uXzEucHJvcGVydHkoRmFjdC50aXRsZVByb3BlcnR5KVxyXG4gICAgXSwgRmFjdC5wcm90b3R5cGUsIFwibmFtZVwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KEZhY3QudmFsdWVQcm9wZXJ0eSlcclxuICAgIF0sIEZhY3QucHJvdG90eXBlLCBcInZhbHVlXCIsIHZvaWQgMCk7XHJcbiAgICByZXR1cm4gRmFjdDtcclxufShzZXJpYWxpemF0aW9uXzEuU2VyaWFsaXphYmxlT2JqZWN0KSk7XHJcbmV4cG9ydHMuRmFjdCA9IEZhY3Q7XHJcbnZhciBGYWN0U2V0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKEZhY3RTZXQsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBGYWN0U2V0KCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgIH1cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShGYWN0U2V0LnByb3RvdHlwZSwgXCJ1c2VEZWZhdWx0U2l6aW5nXCIsIHtcclxuICAgICAgICAvLyNlbmRyZWdpb25cclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgRmFjdFNldC5wcm90b3R5cGUuaW50ZXJuYWxSZW5kZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGVsZW1lbnQgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgdmFyIGhvc3RDb25maWcgPSB0aGlzLmhvc3RDb25maWc7XHJcbiAgICAgICAgaWYgKHRoaXMuZmFjdHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRhYmxlXCIpO1xyXG4gICAgICAgICAgICBlbGVtZW50LnN0eWxlLmJvcmRlcldpZHRoID0gXCIwcHhcIjtcclxuICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5ib3JkZXJTcGFjaW5nID0gXCIwcHhcIjtcclxuICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5ib3JkZXJTdHlsZSA9IFwibm9uZVwiO1xyXG4gICAgICAgICAgICBlbGVtZW50LnN0eWxlLmJvcmRlckNvbGxhcHNlID0gXCJjb2xsYXBzZVwiO1xyXG4gICAgICAgICAgICBlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XHJcbiAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUub3ZlcmZsb3cgPSBcImhpZGRlblwiO1xyXG4gICAgICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoaG9zdENvbmZpZy5tYWtlQ3NzQ2xhc3NOYW1lKFwiYWMtZmFjdHNldFwiKSk7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5mYWN0cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHRyRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0clwiKTtcclxuICAgICAgICAgICAgICAgIGlmIChpID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRyRWxlbWVudC5zdHlsZS5tYXJnaW5Ub3AgPSBob3N0Q29uZmlnLmZhY3RTZXQuc3BhY2luZyArIFwicHhcIjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vIFRpdGxlIGNvbHVtblxyXG4gICAgICAgICAgICAgICAgdmFyIHRkRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJ0ZFwiKTtcclxuICAgICAgICAgICAgICAgIHRkRWxlbWVudC5zdHlsZS5wYWRkaW5nID0gXCIwXCI7XHJcbiAgICAgICAgICAgICAgICB0ZEVsZW1lbnQuY2xhc3NMaXN0LmFkZChob3N0Q29uZmlnLm1ha2VDc3NDbGFzc05hbWUoXCJhYy1mYWN0LXRpdGxlXCIpKTtcclxuICAgICAgICAgICAgICAgIGlmIChob3N0Q29uZmlnLmZhY3RTZXQudGl0bGUubWF4V2lkdGgpIHtcclxuICAgICAgICAgICAgICAgICAgICB0ZEVsZW1lbnQuc3R5bGUubWF4V2lkdGggPSBob3N0Q29uZmlnLmZhY3RTZXQudGl0bGUubWF4V2lkdGggKyBcInB4XCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0ZEVsZW1lbnQuc3R5bGUudmVydGljYWxBbGlnbiA9IFwidG9wXCI7XHJcbiAgICAgICAgICAgICAgICB2YXIgdGV4dEJsb2NrID0gbmV3IFRleHRCbG9jaygpO1xyXG4gICAgICAgICAgICAgICAgdGV4dEJsb2NrLnNldFBhcmVudCh0aGlzKTtcclxuICAgICAgICAgICAgICAgIHRleHRCbG9jay50ZXh0ID0gKCF0aGlzLmZhY3RzW2ldLm5hbWUgJiYgdGhpcy5pc0Rlc2lnbk1vZGUoKSkgPyBcIlRpdGxlXCIgOiB0aGlzLmZhY3RzW2ldLm5hbWU7XHJcbiAgICAgICAgICAgICAgICB0ZXh0QmxvY2suc2l6ZSA9IGhvc3RDb25maWcuZmFjdFNldC50aXRsZS5zaXplO1xyXG4gICAgICAgICAgICAgICAgdGV4dEJsb2NrLmNvbG9yID0gaG9zdENvbmZpZy5mYWN0U2V0LnRpdGxlLmNvbG9yO1xyXG4gICAgICAgICAgICAgICAgdGV4dEJsb2NrLmlzU3VidGxlID0gaG9zdENvbmZpZy5mYWN0U2V0LnRpdGxlLmlzU3VidGxlO1xyXG4gICAgICAgICAgICAgICAgdGV4dEJsb2NrLndlaWdodCA9IGhvc3RDb25maWcuZmFjdFNldC50aXRsZS53ZWlnaHQ7XHJcbiAgICAgICAgICAgICAgICB0ZXh0QmxvY2sud3JhcCA9IGhvc3RDb25maWcuZmFjdFNldC50aXRsZS53cmFwO1xyXG4gICAgICAgICAgICAgICAgdGV4dEJsb2NrLnNwYWNpbmcgPSBFbnVtcy5TcGFjaW5nLk5vbmU7XHJcbiAgICAgICAgICAgICAgICBVdGlscy5hcHBlbmRDaGlsZCh0ZEVsZW1lbnQsIHRleHRCbG9jay5yZW5kZXIoKSk7XHJcbiAgICAgICAgICAgICAgICBVdGlscy5hcHBlbmRDaGlsZCh0ckVsZW1lbnQsIHRkRWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICAvLyBTcGFjZXIgY29sdW1uXHJcbiAgICAgICAgICAgICAgICB0ZEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGRcIik7XHJcbiAgICAgICAgICAgICAgICB0ZEVsZW1lbnQuc3R5bGUud2lkdGggPSBcIjEwcHhcIjtcclxuICAgICAgICAgICAgICAgIFV0aWxzLmFwcGVuZENoaWxkKHRyRWxlbWVudCwgdGRFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgIC8vIFZhbHVlIGNvbHVtblxyXG4gICAgICAgICAgICAgICAgdGRFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInRkXCIpO1xyXG4gICAgICAgICAgICAgICAgdGRFbGVtZW50LnN0eWxlLnBhZGRpbmcgPSBcIjBcIjtcclxuICAgICAgICAgICAgICAgIHRkRWxlbWVudC5zdHlsZS52ZXJ0aWNhbEFsaWduID0gXCJ0b3BcIjtcclxuICAgICAgICAgICAgICAgIHRkRWxlbWVudC5jbGFzc0xpc3QuYWRkKGhvc3RDb25maWcubWFrZUNzc0NsYXNzTmFtZShcImFjLWZhY3QtdmFsdWVcIikpO1xyXG4gICAgICAgICAgICAgICAgdGV4dEJsb2NrID0gbmV3IFRleHRCbG9jaygpO1xyXG4gICAgICAgICAgICAgICAgdGV4dEJsb2NrLnNldFBhcmVudCh0aGlzKTtcclxuICAgICAgICAgICAgICAgIHRleHRCbG9jay50ZXh0ID0gdGhpcy5mYWN0c1tpXS52YWx1ZTtcclxuICAgICAgICAgICAgICAgIHRleHRCbG9jay5zaXplID0gaG9zdENvbmZpZy5mYWN0U2V0LnZhbHVlLnNpemU7XHJcbiAgICAgICAgICAgICAgICB0ZXh0QmxvY2suY29sb3IgPSBob3N0Q29uZmlnLmZhY3RTZXQudmFsdWUuY29sb3I7XHJcbiAgICAgICAgICAgICAgICB0ZXh0QmxvY2suaXNTdWJ0bGUgPSBob3N0Q29uZmlnLmZhY3RTZXQudmFsdWUuaXNTdWJ0bGU7XHJcbiAgICAgICAgICAgICAgICB0ZXh0QmxvY2sud2VpZ2h0ID0gaG9zdENvbmZpZy5mYWN0U2V0LnZhbHVlLndlaWdodDtcclxuICAgICAgICAgICAgICAgIHRleHRCbG9jay53cmFwID0gaG9zdENvbmZpZy5mYWN0U2V0LnZhbHVlLndyYXA7XHJcbiAgICAgICAgICAgICAgICB0ZXh0QmxvY2suc3BhY2luZyA9IEVudW1zLlNwYWNpbmcuTm9uZTtcclxuICAgICAgICAgICAgICAgIFV0aWxzLmFwcGVuZENoaWxkKHRkRWxlbWVudCwgdGV4dEJsb2NrLnJlbmRlcigpKTtcclxuICAgICAgICAgICAgICAgIFV0aWxzLmFwcGVuZENoaWxkKHRyRWxlbWVudCwgdGRFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgIFV0aWxzLmFwcGVuZENoaWxkKGVsZW1lbnQsIHRyRWxlbWVudCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XHJcbiAgICB9O1xyXG4gICAgRmFjdFNldC5wcm90b3R5cGUuZ2V0SnNvblR5cGVOYW1lID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBcIkZhY3RTZXRcIjtcclxuICAgIH07XHJcbiAgICAvLyNyZWdpb24gU2NoZW1hXHJcbiAgICBGYWN0U2V0LmZhY3RzUHJvcGVydHkgPSBuZXcgc2VyaWFsaXphdGlvbl8xLlNlcmlhbGl6YWJsZU9iamVjdENvbGxlY3Rpb25Qcm9wZXJ0eShzZXJpYWxpemF0aW9uXzEuVmVyc2lvbnMudjFfMCwgXCJmYWN0c1wiLCBGYWN0KTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHNlcmlhbGl6YXRpb25fMS5wcm9wZXJ0eShGYWN0U2V0LmZhY3RzUHJvcGVydHkpXHJcbiAgICBdLCBGYWN0U2V0LnByb3RvdHlwZSwgXCJmYWN0c1wiLCB2b2lkIDApO1xyXG4gICAgcmV0dXJuIEZhY3RTZXQ7XHJcbn0oQ2FyZEVsZW1lbnQpKTtcclxuZXhwb3J0cy5GYWN0U2V0ID0gRmFjdFNldDtcclxudmFyIEltYWdlRGltZW5zaW9uUHJvcGVydHkgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoSW1hZ2VEaW1lbnNpb25Qcm9wZXJ0eSwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIEltYWdlRGltZW5zaW9uUHJvcGVydHkodGFyZ2V0VmVyc2lvbiwgbmFtZSwgaW50ZXJuYWxOYW1lKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgdGFyZ2V0VmVyc2lvbiwgbmFtZSkgfHwgdGhpcztcclxuICAgICAgICBfdGhpcy50YXJnZXRWZXJzaW9uID0gdGFyZ2V0VmVyc2lvbjtcclxuICAgICAgICBfdGhpcy5uYW1lID0gbmFtZTtcclxuICAgICAgICBfdGhpcy5pbnRlcm5hbE5hbWUgPSBpbnRlcm5hbE5hbWU7XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgSW1hZ2VEaW1lbnNpb25Qcm9wZXJ0eS5wcm90b3R5cGUuZ2V0SW50ZXJuYWxOYW1lID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmludGVybmFsTmFtZTtcclxuICAgIH07XHJcbiAgICBJbWFnZURpbWVuc2lvblByb3BlcnR5LnByb3RvdHlwZS5wYXJzZSA9IGZ1bmN0aW9uIChzZW5kZXIsIHNvdXJjZSwgY29udGV4dCkge1xyXG4gICAgICAgIHZhciByZXN1bHQgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgdmFyIHNvdXJjZVZhbHVlID0gc291cmNlW3RoaXMubmFtZV07XHJcbiAgICAgICAgaWYgKHNvdXJjZVZhbHVlID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGVmYXVsdFZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgaXNWYWxpZCA9IGZhbHNlO1xyXG4gICAgICAgIGlmICh0eXBlb2Ygc291cmNlVmFsdWUgPT09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIHZhciBzaXplID0gc2hhcmVkXzEuU2l6ZUFuZFVuaXQucGFyc2Uoc291cmNlVmFsdWUsIHRydWUpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNpemUudW5pdCA9PSBFbnVtcy5TaXplVW5pdC5QaXhlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHNpemUucGh5c2ljYWxTaXplO1xyXG4gICAgICAgICAgICAgICAgICAgIGlzVmFsaWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhdGNoIChfYSkge1xyXG4gICAgICAgICAgICAgICAgLy8gRG8gbm90aGluZy4gQSBwYXJzZSBlcnJvciBpcyBlbWl0dGVkIGJlbG93XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCFpc1ZhbGlkKSB7XHJcbiAgICAgICAgICAgIGNvbnRleHQubG9nUGFyc2VFdmVudCg2IC8qIEludmFsaWRQcm9wZXJ0eVZhbHVlICovLCBcIkludmFsaWQgXCIgKyB0aGlzLm5hbWUgKyBcIiB2YWx1ZTogXCIgKyBzb3VyY2VWYWx1ZSwgc2VuZGVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH07XHJcbiAgICBJbWFnZURpbWVuc2lvblByb3BlcnR5LnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiAoc2VuZGVyLCB0YXJnZXQsIHZhbHVlLCBjb250ZXh0KSB7XHJcbiAgICAgICAgY29udGV4dC5zZXJpYWxpemVWYWx1ZSh0YXJnZXQsIHRoaXMubmFtZSwgdHlwZW9mIHZhbHVlID09PSBcIm51bWJlclwiICYmICFpc05hTih2YWx1ZSkgPyB2YWx1ZSArIFwicHhcIiA6IHVuZGVmaW5lZCk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIEltYWdlRGltZW5zaW9uUHJvcGVydHk7XHJcbn0oc2VyaWFsaXphdGlvbl8xLlByb3BlcnR5RGVmaW5pdGlvbikpO1xyXG52YXIgSW1hZ2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoSW1hZ2UsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBJbWFnZSgpIHtcclxuICAgICAgICAvLyNyZWdpb24gU2NoZW1hXHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMuc2l6ZSA9IEVudW1zLlNpemUuQXV0bztcclxuICAgICAgICBfdGhpcy5zdHlsZSA9IEVudW1zLkltYWdlU3R5bGUuRGVmYXVsdDtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICBJbWFnZS5wcm90b3R5cGUucG9wdWxhdGVTY2hlbWEgPSBmdW5jdGlvbiAoc2NoZW1hKSB7XHJcbiAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5wb3B1bGF0ZVNjaGVtYS5jYWxsKHRoaXMsIHNjaGVtYSk7XHJcbiAgICAgICAgc2NoZW1hLnJlbW92ZShDYXJkRWxlbWVudC5oZWlnaHRQcm9wZXJ0eSk7XHJcbiAgICB9O1xyXG4gICAgLy8jZW5kcmVnaW9uXHJcbiAgICBJbWFnZS5wcm90b3R5cGUuYXBwbHlTaXplID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcclxuICAgICAgICBpZiAodGhpcy5waXhlbFdpZHRoIHx8IHRoaXMucGl4ZWxIZWlnaHQpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMucGl4ZWxXaWR0aCkge1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5zdHlsZS53aWR0aCA9IHRoaXMucGl4ZWxXaWR0aCArIFwicHhcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5waXhlbEhlaWdodCkge1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5oZWlnaHQgPSB0aGlzLnBpeGVsSGVpZ2h0ICsgXCJweFwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHRoaXMuc2l6ZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSBFbnVtcy5TaXplLlN0cmV0Y2g6XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5zdHlsZS53aWR0aCA9IFwiMTAwJVwiO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBFbnVtcy5TaXplLkF1dG86XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5tYXhXaWR0aCA9IFwiMTAwJVwiO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBFbnVtcy5TaXplLlNtYWxsOlxyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUud2lkdGggPSB0aGlzLmhvc3RDb25maWcuaW1hZ2VTaXplcy5zbWFsbCArIFwicHhcIjtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgRW51bXMuU2l6ZS5MYXJnZTpcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnN0eWxlLndpZHRoID0gdGhpcy5ob3N0Q29uZmlnLmltYWdlU2l6ZXMubGFyZ2UgKyBcInB4XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIEVudW1zLlNpemUuTWVkaXVtOlxyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUud2lkdGggPSB0aGlzLmhvc3RDb25maWcuaW1hZ2VTaXplcy5tZWRpdW0gKyBcInB4XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEltYWdlLnByb3RvdHlwZSwgXCJ1c2VEZWZhdWx0U2l6aW5nXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgSW1hZ2UucHJvdG90eXBlLmludGVybmFsUmVuZGVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdmFyIGVsZW1lbnQgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgaWYgKHRoaXMudXJsKSB7XHJcbiAgICAgICAgICAgIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICBlbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcclxuICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5hbGlnbkl0ZW1zID0gXCJmbGV4LXN0YXJ0XCI7XHJcbiAgICAgICAgICAgIGVsZW1lbnQub25rZXlwcmVzcyA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMuc2VsZWN0QWN0aW9uICYmIChlLmtleUNvZGUgPT0gMTMgfHwgZS5rZXlDb2RlID09IDMyKSkgeyAvLyBlbnRlciBvciBzcGFjZSBwcmVzc2VkXHJcbiAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGUuY2FuY2VsQnViYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZWxlY3RBY3Rpb24uZXhlY3V0ZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBlbGVtZW50Lm9uY2xpY2sgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKF90aGlzLnNlbGVjdEFjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICBlLmNhbmNlbEJ1YmJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2VsZWN0QWN0aW9uLmV4ZWN1dGUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgc3dpdGNoICh0aGlzLmhvcml6b250YWxBbGlnbm1lbnQpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgRW51bXMuSG9yaXpvbnRhbEFsaWdubWVudC5DZW50ZXI6XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5qdXN0aWZ5Q29udGVudCA9IFwiY2VudGVyXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIEVudW1zLkhvcml6b250YWxBbGlnbm1lbnQuUmlnaHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5qdXN0aWZ5Q29udGVudCA9IFwiZmxleC1lbmRcIjtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5qdXN0aWZ5Q29udGVudCA9IFwiZmxleC1zdGFydFwiO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIENhY2hlIGhvc3RDb25maWcgdG8gYXZvaWQgd2Fsa2luZyB0aGUgcGFyZW50IGhpZXJhcmNoeSBtdWx0aXBsZSB0aW1lc1xyXG4gICAgICAgICAgICB2YXIgaG9zdENvbmZpZyA9IHRoaXMuaG9zdENvbmZpZztcclxuICAgICAgICAgICAgdmFyIGltYWdlRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbWdcIik7XHJcbiAgICAgICAgICAgIGltYWdlRWxlbWVudC5vbmxvYWQgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgcmFpc2VJbWFnZUxvYWRlZEV2ZW50KF90aGlzKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgaW1hZ2VFbGVtZW50Lm9uZXJyb3IgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKF90aGlzLnJlbmRlcmVkRWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjYXJkID0gX3RoaXMuZ2V0Um9vdEVsZW1lbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5yZW5kZXJlZEVsZW1lbnQuaW5uZXJIVE1MID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2FyZCAmJiBjYXJkLmRlc2lnbk1vZGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yRWxlbWVudC5zdHlsZS5hbGlnbkl0ZW1zID0gXCJjZW50ZXJcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JFbGVtZW50LnN0eWxlLmp1c3RpZnlDb250ZW50ID0gXCJjZW50ZXJcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JFbGVtZW50LnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFwiI0VFRUVFRVwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvckVsZW1lbnQuc3R5bGUuY29sb3IgPSBcImJsYWNrXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yRWxlbWVudC5pbm5lclRleHQgPSBcIjotKFwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvckVsZW1lbnQuc3R5bGUucGFkZGluZyA9IFwiMTBweFwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5hcHBseVNpemUoZXJyb3JFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMucmVuZGVyZWRFbGVtZW50LmFwcGVuZENoaWxkKGVycm9yRWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmFpc2VJbWFnZUxvYWRlZEV2ZW50KF90aGlzKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgaW1hZ2VFbGVtZW50LnN0eWxlLm1heEhlaWdodCA9IFwiMTAwJVwiO1xyXG4gICAgICAgICAgICBpbWFnZUVsZW1lbnQuc3R5bGUubWluV2lkdGggPSBcIjBcIjtcclxuICAgICAgICAgICAgaW1hZ2VFbGVtZW50LmNsYXNzTGlzdC5hZGQoaG9zdENvbmZpZy5tYWtlQ3NzQ2xhc3NOYW1lKFwiYWMtaW1hZ2VcIikpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5zZWxlY3RBY3Rpb24gIT09IHVuZGVmaW5lZCAmJiBob3N0Q29uZmlnLnN1cHBvcnRzSW50ZXJhY3Rpdml0eSkge1xyXG4gICAgICAgICAgICAgICAgaW1hZ2VFbGVtZW50LnRhYkluZGV4ID0gMDtcclxuICAgICAgICAgICAgICAgIGltYWdlRWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsIFwiYnV0dG9uXCIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0QWN0aW9uLnRpdGxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW1hZ2VFbGVtZW50LnNldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxcIiwgdGhpcy5zZWxlY3RBY3Rpb24udGl0bGUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaW1hZ2VFbGVtZW50LmNsYXNzTGlzdC5hZGQoaG9zdENvbmZpZy5tYWtlQ3NzQ2xhc3NOYW1lKFwiYWMtc2VsZWN0YWJsZVwiKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5hcHBseVNpemUoaW1hZ2VFbGVtZW50KTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuc3R5bGUgPT09IEVudW1zLkltYWdlU3R5bGUuUGVyc29uKSB7XHJcbiAgICAgICAgICAgICAgICBpbWFnZUVsZW1lbnQuc3R5bGUuYm9yZGVyUmFkaXVzID0gXCI1MCVcIjtcclxuICAgICAgICAgICAgICAgIGltYWdlRWxlbWVudC5zdHlsZS5iYWNrZ3JvdW5kUG9zaXRpb24gPSBcIjUwJSA1MCVcIjtcclxuICAgICAgICAgICAgICAgIGltYWdlRWxlbWVudC5zdHlsZS5iYWNrZ3JvdW5kUmVwZWF0ID0gXCJuby1yZXBlYXRcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpbWFnZUVsZW1lbnQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gVXRpbHMuc3RyaW5nVG9Dc3NDb2xvcih0aGlzLmJhY2tncm91bmRDb2xvcik7XHJcbiAgICAgICAgICAgIGltYWdlRWxlbWVudC5zcmMgPSB0aGlzLnByZVByb2Nlc3NQcm9wZXJ0eVZhbHVlKEltYWdlLnVybFByb3BlcnR5KTtcclxuICAgICAgICAgICAgaW1hZ2VFbGVtZW50LmFsdCA9IHRoaXMucHJlUHJvY2Vzc1Byb3BlcnR5VmFsdWUoSW1hZ2UuYWx0VGV4dFByb3BlcnR5KTtcclxuICAgICAgICAgICAgZWxlbWVudC5hcHBlbmRDaGlsZChpbWFnZUVsZW1lbnQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZWxlbWVudDtcclxuICAgIH07XHJcbiAgICBJbWFnZS5wcm90b3R5cGUuZ2V0SnNvblR5cGVOYW1lID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBcIkltYWdlXCI7XHJcbiAgICB9O1xyXG4gICAgSW1hZ2UucHJvdG90eXBlLmdldEFjdGlvbkJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcclxuICAgICAgICB2YXIgcmVzdWx0ID0gX3N1cGVyLnByb3RvdHlwZS5nZXRBY3Rpb25CeUlkLmNhbGwodGhpcywgaWQpO1xyXG4gICAgICAgIGlmICghcmVzdWx0ICYmIHRoaXMuc2VsZWN0QWN0aW9uKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMuc2VsZWN0QWN0aW9uLmdldEFjdGlvbkJ5SWQoaWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuICAgIEltYWdlLnByb3RvdHlwZS5nZXRSZXNvdXJjZUluZm9ybWF0aW9uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnVybCA/IFt7IHVybDogdGhpcy51cmwsIG1pbWVUeXBlOiBcImltYWdlXCIgfV0gOiBbXTtcclxuICAgIH07XHJcbiAgICBJbWFnZS51cmxQcm9wZXJ0eSA9IG5ldyBzZXJpYWxpemF0aW9uXzEuU3RyaW5nUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzAsIFwidXJsXCIpO1xyXG4gICAgSW1hZ2UuYWx0VGV4dFByb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5TdHJpbmdQcm9wZXJ0eShzZXJpYWxpemF0aW9uXzEuVmVyc2lvbnMudjFfMCwgXCJhbHRUZXh0XCIpO1xyXG4gICAgSW1hZ2UuYmFja2dyb3VuZENvbG9yUHJvcGVydHkgPSBuZXcgc2VyaWFsaXphdGlvbl8xLlN0cmluZ1Byb3BlcnR5KHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8xLCBcImJhY2tncm91bmRDb2xvclwiKTtcclxuICAgIEltYWdlLnN0eWxlUHJvcGVydHkgPSBuZXcgc2VyaWFsaXphdGlvbl8xLkVudW1Qcm9wZXJ0eShzZXJpYWxpemF0aW9uXzEuVmVyc2lvbnMudjFfMCwgXCJzdHlsZVwiLCBFbnVtcy5JbWFnZVN0eWxlLCBFbnVtcy5JbWFnZVN0eWxlLkRlZmF1bHQpO1xyXG4gICAgSW1hZ2Uuc2l6ZVByb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5FbnVtUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzAsIFwic2l6ZVwiLCBFbnVtcy5TaXplLCBFbnVtcy5TaXplLkF1dG8pO1xyXG4gICAgSW1hZ2UucGl4ZWxXaWR0aFByb3BlcnR5ID0gbmV3IEltYWdlRGltZW5zaW9uUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzEsIFwid2lkdGhcIiwgXCJwaXhlbFdpZHRoXCIpO1xyXG4gICAgSW1hZ2UucGl4ZWxIZWlnaHRQcm9wZXJ0eSA9IG5ldyBJbWFnZURpbWVuc2lvblByb3BlcnR5KHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8xLCBcImhlaWdodFwiLCBcInBpeGVsSGVpZ2h0XCIpO1xyXG4gICAgSW1hZ2Uuc2VsZWN0QWN0aW9uUHJvcGVydHkgPSBuZXcgQWN0aW9uUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzAsIFwic2VsZWN0QWN0aW9uXCIsIFtcIkFjdGlvbi5TaG93Q2FyZFwiXSk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBzZXJpYWxpemF0aW9uXzEucHJvcGVydHkoSW1hZ2UudXJsUHJvcGVydHkpXHJcbiAgICBdLCBJbWFnZS5wcm90b3R5cGUsIFwidXJsXCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBzZXJpYWxpemF0aW9uXzEucHJvcGVydHkoSW1hZ2UuYWx0VGV4dFByb3BlcnR5KVxyXG4gICAgXSwgSW1hZ2UucHJvdG90eXBlLCBcImFsdFRleHRcIiwgdm9pZCAwKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHNlcmlhbGl6YXRpb25fMS5wcm9wZXJ0eShJbWFnZS5iYWNrZ3JvdW5kQ29sb3JQcm9wZXJ0eSlcclxuICAgIF0sIEltYWdlLnByb3RvdHlwZSwgXCJiYWNrZ3JvdW5kQ29sb3JcIiwgdm9pZCAwKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHNlcmlhbGl6YXRpb25fMS5wcm9wZXJ0eShJbWFnZS5zaXplUHJvcGVydHkpXHJcbiAgICBdLCBJbWFnZS5wcm90b3R5cGUsIFwic2l6ZVwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KEltYWdlLnN0eWxlUHJvcGVydHkpXHJcbiAgICBdLCBJbWFnZS5wcm90b3R5cGUsIFwic3R5bGVcIiwgdm9pZCAwKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHNlcmlhbGl6YXRpb25fMS5wcm9wZXJ0eShJbWFnZS5waXhlbFdpZHRoUHJvcGVydHkpXHJcbiAgICBdLCBJbWFnZS5wcm90b3R5cGUsIFwicGl4ZWxXaWR0aFwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KEltYWdlLnBpeGVsSGVpZ2h0UHJvcGVydHkpXHJcbiAgICBdLCBJbWFnZS5wcm90b3R5cGUsIFwicGl4ZWxIZWlnaHRcIiwgdm9pZCAwKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHNlcmlhbGl6YXRpb25fMS5wcm9wZXJ0eShJbWFnZS5zZWxlY3RBY3Rpb25Qcm9wZXJ0eSlcclxuICAgIF0sIEltYWdlLnByb3RvdHlwZSwgXCJzZWxlY3RBY3Rpb25cIiwgdm9pZCAwKTtcclxuICAgIHJldHVybiBJbWFnZTtcclxufShDYXJkRWxlbWVudCkpO1xyXG5leHBvcnRzLkltYWdlID0gSW1hZ2U7XHJcbnZhciBDYXJkRWxlbWVudENvbnRhaW5lciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhDYXJkRWxlbWVudENvbnRhaW5lciwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIENhcmRFbGVtZW50Q29udGFpbmVyKCkge1xyXG4gICAgICAgIC8vI3JlZ2lvbiBTY2hlbWFcclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgICAgICBfdGhpcy5hbGxvd1ZlcnRpY2FsT3ZlcmZsb3cgPSBmYWxzZTtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICBDYXJkRWxlbWVudENvbnRhaW5lci5wcm90b3R5cGUucG9wdWxhdGVTY2hlbWEgPSBmdW5jdGlvbiAoc2NoZW1hKSB7XHJcbiAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5wb3B1bGF0ZVNjaGVtYS5jYWxsKHRoaXMsIHNjaGVtYSk7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzU2VsZWN0YWJsZSkge1xyXG4gICAgICAgICAgICBzY2hlbWEucmVtb3ZlKENhcmRFbGVtZW50Q29udGFpbmVyLnNlbGVjdEFjdGlvblByb3BlcnR5KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgLy8jZW5kcmVnaW9uXHJcbiAgICBDYXJkRWxlbWVudENvbnRhaW5lci5wcm90b3R5cGUuaXNFbGVtZW50QWxsb3dlZCA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaG9zdENvbmZpZy5zdXBwb3J0c0ludGVyYWN0aXZpdHkgfHwgIWVsZW1lbnQuaXNJbnRlcmFjdGl2ZTtcclxuICAgIH07XHJcbiAgICBDYXJkRWxlbWVudENvbnRhaW5lci5wcm90b3R5cGUuYXBwbHlQYWRkaW5nID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUuYXBwbHlQYWRkaW5nLmNhbGwodGhpcyk7XHJcbiAgICAgICAgaWYgKCF0aGlzLnJlbmRlcmVkRWxlbWVudCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBwaHlzaWNhbFBhZGRpbmcgPSBuZXcgc2hhcmVkXzEuU3BhY2luZ0RlZmluaXRpb24oKTtcclxuICAgICAgICBpZiAodGhpcy5nZXRFZmZlY3RpdmVQYWRkaW5nKCkpIHtcclxuICAgICAgICAgICAgcGh5c2ljYWxQYWRkaW5nID0gdGhpcy5ob3N0Q29uZmlnLnBhZGRpbmdEZWZpbml0aW9uVG9TcGFjaW5nRGVmaW5pdGlvbih0aGlzLmdldEVmZmVjdGl2ZVBhZGRpbmcoKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucmVuZGVyZWRFbGVtZW50LnN0eWxlLnBhZGRpbmdUb3AgPSBwaHlzaWNhbFBhZGRpbmcudG9wICsgXCJweFwiO1xyXG4gICAgICAgIHRoaXMucmVuZGVyZWRFbGVtZW50LnN0eWxlLnBhZGRpbmdSaWdodCA9IHBoeXNpY2FsUGFkZGluZy5yaWdodCArIFwicHhcIjtcclxuICAgICAgICB0aGlzLnJlbmRlcmVkRWxlbWVudC5zdHlsZS5wYWRkaW5nQm90dG9tID0gcGh5c2ljYWxQYWRkaW5nLmJvdHRvbSArIFwicHhcIjtcclxuICAgICAgICB0aGlzLnJlbmRlcmVkRWxlbWVudC5zdHlsZS5wYWRkaW5nTGVmdCA9IHBoeXNpY2FsUGFkZGluZy5sZWZ0ICsgXCJweFwiO1xyXG4gICAgICAgIHRoaXMucmVuZGVyZWRFbGVtZW50LnN0eWxlLm1hcmdpblJpZ2h0ID0gXCIwXCI7XHJcbiAgICAgICAgdGhpcy5yZW5kZXJlZEVsZW1lbnQuc3R5bGUubWFyZ2luTGVmdCA9IFwiMFwiO1xyXG4gICAgfTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDYXJkRWxlbWVudENvbnRhaW5lci5wcm90b3R5cGUsIFwiaXNTZWxlY3RhYmxlXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgQ2FyZEVsZW1lbnRDb250YWluZXIucHJvdG90eXBlLmludGVybmFsVmFsaWRhdGVQcm9wZXJ0aWVzID0gZnVuY3Rpb24gKGNvbnRleHQpIHtcclxuICAgICAgICBfc3VwZXIucHJvdG90eXBlLmludGVybmFsVmFsaWRhdGVQcm9wZXJ0aWVzLmNhbGwodGhpcywgY29udGV4dCk7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmdldEl0ZW1Db3VudCgpOyBpKyspIHtcclxuICAgICAgICAgICAgdmFyIGl0ZW0gPSB0aGlzLmdldEl0ZW1BdChpKTtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmhvc3RDb25maWcuc3VwcG9ydHNJbnRlcmFjdGl2aXR5ICYmIGl0ZW0uaXNJbnRlcmFjdGl2ZSkge1xyXG4gICAgICAgICAgICAgICAgY29udGV4dC5hZGRGYWlsdXJlKHRoaXMsIDUgLyogSW50ZXJhY3Rpdml0eU5vdEFsbG93ZWQgKi8sIFwiSW50ZXJhY3Rpdml0eSBpcyBub3QgYWxsb3dlZC5cIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCF0aGlzLmlzRWxlbWVudEFsbG93ZWQoaXRlbSkpIHtcclxuICAgICAgICAgICAgICAgIGNvbnRleHQuYWRkRmFpbHVyZSh0aGlzLCA1IC8qIEludGVyYWN0aXZpdHlOb3RBbGxvd2VkICovLCBcIkVsZW1lbnRzIG9mIHR5cGUgXCIgKyBpdGVtLmdldEpzb25UeXBlTmFtZSgpICsgXCIgYXJlIG5vdCBhbGxvd2VkIGluIHRoaXMgY29udGFpbmVyLlwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpdGVtLmludGVybmFsVmFsaWRhdGVQcm9wZXJ0aWVzKGNvbnRleHQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5fc2VsZWN0QWN0aW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3NlbGVjdEFjdGlvbi5pbnRlcm5hbFZhbGlkYXRlUHJvcGVydGllcyhjb250ZXh0KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgQ2FyZEVsZW1lbnRDb250YWluZXIucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHZhciBlbGVtZW50ID0gX3N1cGVyLnByb3RvdHlwZS5yZW5kZXIuY2FsbCh0aGlzKTtcclxuICAgICAgICBpZiAoZWxlbWVudCkge1xyXG4gICAgICAgICAgICB2YXIgaG9zdENvbmZpZyA9IHRoaXMuaG9zdENvbmZpZztcclxuICAgICAgICAgICAgaWYgKHRoaXMuYWxsb3dWZXJ0aWNhbE92ZXJmbG93KSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LnN0eWxlLm92ZXJmbG93WCA9IFwiaGlkZGVuXCI7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LnN0eWxlLm92ZXJmbG93WSA9IFwiYXV0b1wiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChlbGVtZW50ICYmIHRoaXMuaXNTZWxlY3RhYmxlICYmIHRoaXMuX3NlbGVjdEFjdGlvbiAmJiBob3N0Q29uZmlnLnN1cHBvcnRzSW50ZXJhY3Rpdml0eSkge1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKGhvc3RDb25maWcubWFrZUNzc0NsYXNzTmFtZShcImFjLXNlbGVjdGFibGVcIikpO1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC50YWJJbmRleCA9IDA7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZShcInJvbGVcIiwgXCJidXR0b25cIik7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fc2VsZWN0QWN0aW9uLnRpdGxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIHRoaXMuX3NlbGVjdEFjdGlvbi50aXRsZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50Lm9uY2xpY2sgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5fc2VsZWN0QWN0aW9uICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlLmNhbmNlbEJ1YmJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLl9zZWxlY3RBY3Rpb24uZXhlY3V0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50Lm9ua2V5cHJlc3MgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5fc2VsZWN0QWN0aW9uICE9PSB1bmRlZmluZWQgJiYgKGUua2V5Q29kZSA9PSAxMyB8fCBlLmtleUNvZGUgPT0gMzIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEVudGVyIG9yIHNwYWNlIHByZXNzZWRcclxuICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlLmNhbmNlbEJ1YmJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLl9zZWxlY3RBY3Rpb24uZXhlY3V0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XHJcbiAgICB9O1xyXG4gICAgQ2FyZEVsZW1lbnRDb250YWluZXIucHJvdG90eXBlLnVwZGF0ZUxheW91dCA9IGZ1bmN0aW9uIChwcm9jZXNzQ2hpbGRyZW4pIHtcclxuICAgICAgICBpZiAocHJvY2Vzc0NoaWxkcmVuID09PSB2b2lkIDApIHsgcHJvY2Vzc0NoaWxkcmVuID0gdHJ1ZTsgfVxyXG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUudXBkYXRlTGF5b3V0LmNhbGwodGhpcywgcHJvY2Vzc0NoaWxkcmVuKTtcclxuICAgICAgICBpZiAocHJvY2Vzc0NoaWxkcmVuKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5nZXRJdGVtQ291bnQoKTsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmdldEl0ZW1BdChpKS51cGRhdGVMYXlvdXQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBDYXJkRWxlbWVudENvbnRhaW5lci5wcm90b3R5cGUuZ2V0QWxsSW5wdXRzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciByZXN1bHQgPSBbXTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuZ2V0SXRlbUNvdW50KCk7IGkrKykge1xyXG4gICAgICAgICAgICByZXN1bHQgPSByZXN1bHQuY29uY2F0KHRoaXMuZ2V0SXRlbUF0KGkpLmdldEFsbElucHV0cygpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH07XHJcbiAgICBDYXJkRWxlbWVudENvbnRhaW5lci5wcm90b3R5cGUuZ2V0UmVzb3VyY2VJbmZvcm1hdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgcmVzdWx0ID0gW107XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmdldEl0ZW1Db3VudCgpOyBpKyspIHtcclxuICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmNvbmNhdCh0aGlzLmdldEl0ZW1BdChpKS5nZXRSZXNvdXJjZUluZm9ybWF0aW9uKCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuICAgIENhcmRFbGVtZW50Q29udGFpbmVyLnByb3RvdHlwZS5nZXRFbGVtZW50QnlJZCA9IGZ1bmN0aW9uIChpZCkge1xyXG4gICAgICAgIHZhciByZXN1bHQgPSBfc3VwZXIucHJvdG90eXBlLmdldEVsZW1lbnRCeUlkLmNhbGwodGhpcywgaWQpO1xyXG4gICAgICAgIGlmICghcmVzdWx0KSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5nZXRJdGVtQ291bnQoKTsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgPSB0aGlzLmdldEl0ZW1BdChpKS5nZXRFbGVtZW50QnlJZChpZCk7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH07XHJcbiAgICBDYXJkRWxlbWVudENvbnRhaW5lci5zZWxlY3RBY3Rpb25Qcm9wZXJ0eSA9IG5ldyBBY3Rpb25Qcm9wZXJ0eShzZXJpYWxpemF0aW9uXzEuVmVyc2lvbnMudjFfMCwgXCJzZWxlY3RBY3Rpb25cIiwgW1wiQWN0aW9uLlNob3dDYXJkXCJdKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHNlcmlhbGl6YXRpb25fMS5wcm9wZXJ0eShDYXJkRWxlbWVudENvbnRhaW5lci5zZWxlY3RBY3Rpb25Qcm9wZXJ0eSlcclxuICAgIF0sIENhcmRFbGVtZW50Q29udGFpbmVyLnByb3RvdHlwZSwgXCJfc2VsZWN0QWN0aW9uXCIsIHZvaWQgMCk7XHJcbiAgICByZXR1cm4gQ2FyZEVsZW1lbnRDb250YWluZXI7XHJcbn0oQ2FyZEVsZW1lbnQpKTtcclxuZXhwb3J0cy5DYXJkRWxlbWVudENvbnRhaW5lciA9IENhcmRFbGVtZW50Q29udGFpbmVyO1xyXG52YXIgSW1hZ2VTZXQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoSW1hZ2VTZXQsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBJbWFnZVNldCgpIHtcclxuICAgICAgICAvLyNyZWdpb24gU2NoZW1hXHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMuX2ltYWdlcyA9IFtdO1xyXG4gICAgICAgIF90aGlzLmltYWdlU2l6ZSA9IEVudW1zLlNpemUuTWVkaXVtO1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIC8vI2VuZHJlZ2lvblxyXG4gICAgSW1hZ2VTZXQucHJvdG90eXBlLmludGVybmFsUmVuZGVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBlbGVtZW50ID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIGlmICh0aGlzLl9pbWFnZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XHJcbiAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUuZmxleFdyYXAgPSBcIndyYXBcIjtcclxuICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHRoaXMuX2ltYWdlczsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBpbWFnZSA9IF9hW19pXTtcclxuICAgICAgICAgICAgICAgIGltYWdlLnNpemUgPSB0aGlzLmltYWdlU2l6ZTtcclxuICAgICAgICAgICAgICAgIHZhciByZW5kZXJlZEltYWdlID0gaW1hZ2UucmVuZGVyKCk7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVuZGVyZWRJbWFnZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlbmRlcmVkSW1hZ2Uuc3R5bGUuZGlzcGxheSA9IFwiaW5saW5lLWZsZXhcIjtcclxuICAgICAgICAgICAgICAgICAgICByZW5kZXJlZEltYWdlLnN0eWxlLm1hcmdpbiA9IFwiMHB4XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyZWRJbWFnZS5zdHlsZS5tYXJnaW5SaWdodCA9IFwiMTBweFwiO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlbmRlcmVkSW1hZ2Uuc3R5bGUubWF4SGVpZ2h0ID0gdGhpcy5ob3N0Q29uZmlnLmltYWdlU2V0Lm1heEltYWdlSGVpZ2h0ICsgXCJweFwiO1xyXG4gICAgICAgICAgICAgICAgICAgIFV0aWxzLmFwcGVuZENoaWxkKGVsZW1lbnQsIHJlbmRlcmVkSW1hZ2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBlbGVtZW50O1xyXG4gICAgfTtcclxuICAgIEltYWdlU2V0LnByb3RvdHlwZS5nZXRJdGVtQ291bnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2ltYWdlcy5sZW5ndGg7XHJcbiAgICB9O1xyXG4gICAgSW1hZ2VTZXQucHJvdG90eXBlLmdldEl0ZW1BdCA9IGZ1bmN0aW9uIChpbmRleCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9pbWFnZXNbaW5kZXhdO1xyXG4gICAgfTtcclxuICAgIEltYWdlU2V0LnByb3RvdHlwZS5nZXRGaXJzdFZpc2libGVSZW5kZXJlZEl0ZW0gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2ltYWdlcyAmJiB0aGlzLl9pbWFnZXMubGVuZ3RoID4gMCA/IHRoaXMuX2ltYWdlc1swXSA6IHVuZGVmaW5lZDtcclxuICAgIH07XHJcbiAgICBJbWFnZVNldC5wcm90b3R5cGUuZ2V0TGFzdFZpc2libGVSZW5kZXJlZEl0ZW0gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2ltYWdlcyAmJiB0aGlzLl9pbWFnZXMubGVuZ3RoID4gMCA/IHRoaXMuX2ltYWdlc1t0aGlzLl9pbWFnZXMubGVuZ3RoIC0gMV0gOiB1bmRlZmluZWQ7XHJcbiAgICB9O1xyXG4gICAgSW1hZ2VTZXQucHJvdG90eXBlLnJlbW92ZUl0ZW0gPSBmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgIGlmIChpdGVtIGluc3RhbmNlb2YgSW1hZ2UpIHtcclxuICAgICAgICAgICAgdmFyIGl0ZW1JbmRleCA9IHRoaXMuX2ltYWdlcy5pbmRleE9mKGl0ZW0pO1xyXG4gICAgICAgICAgICBpZiAoaXRlbUluZGV4ID49IDApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2ltYWdlcy5zcGxpY2UoaXRlbUluZGV4LCAxKTtcclxuICAgICAgICAgICAgICAgIGl0ZW0uc2V0UGFyZW50KHVuZGVmaW5lZCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZUxheW91dCgpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfTtcclxuICAgIEltYWdlU2V0LnByb3RvdHlwZS5nZXRKc29uVHlwZU5hbWUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIFwiSW1hZ2VTZXRcIjtcclxuICAgIH07XHJcbiAgICBJbWFnZVNldC5wcm90b3R5cGUuYWRkSW1hZ2UgPSBmdW5jdGlvbiAoaW1hZ2UpIHtcclxuICAgICAgICBpZiAoIWltYWdlLnBhcmVudCkge1xyXG4gICAgICAgICAgICB0aGlzLl9pbWFnZXMucHVzaChpbWFnZSk7XHJcbiAgICAgICAgICAgIGltYWdlLnNldFBhcmVudCh0aGlzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlRoaXMgaW1hZ2UgYWxyZWFkeSBiZWxvbmdzIHRvIGFub3RoZXIgSW1hZ2VTZXRcIik7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEltYWdlU2V0LnByb3RvdHlwZS5pbmRleE9mID0gZnVuY3Rpb24gKGNhcmRFbGVtZW50KSB7XHJcbiAgICAgICAgcmV0dXJuIGNhcmRFbGVtZW50IGluc3RhbmNlb2YgSW1hZ2UgPyB0aGlzLl9pbWFnZXMuaW5kZXhPZihjYXJkRWxlbWVudCkgOiAtMTtcclxuICAgIH07XHJcbiAgICBJbWFnZVNldC5pbWFnZXNQcm9wZXJ0eSA9IG5ldyBzZXJpYWxpemF0aW9uXzEuU2VyaWFsaXphYmxlT2JqZWN0Q29sbGVjdGlvblByb3BlcnR5KHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8wLCBcImltYWdlc1wiLCBJbWFnZSwgZnVuY3Rpb24gKHNlbmRlciwgaXRlbSkgeyBpdGVtLnNldFBhcmVudChzZW5kZXIpOyB9KTtcclxuICAgIEltYWdlU2V0LmltYWdlU2l6ZVByb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5FbnVtUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzAsIFwiaW1hZ2VTaXplXCIsIEVudW1zLlNpemUsIEVudW1zLlNpemUuTWVkaXVtKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHNlcmlhbGl6YXRpb25fMS5wcm9wZXJ0eShJbWFnZVNldC5pbWFnZXNQcm9wZXJ0eSlcclxuICAgIF0sIEltYWdlU2V0LnByb3RvdHlwZSwgXCJfaW1hZ2VzXCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBzZXJpYWxpemF0aW9uXzEucHJvcGVydHkoSW1hZ2VTZXQuaW1hZ2VTaXplUHJvcGVydHkpXHJcbiAgICBdLCBJbWFnZVNldC5wcm90b3R5cGUsIFwiaW1hZ2VTaXplXCIsIHZvaWQgMCk7XHJcbiAgICByZXR1cm4gSW1hZ2VTZXQ7XHJcbn0oQ2FyZEVsZW1lbnRDb250YWluZXIpKTtcclxuZXhwb3J0cy5JbWFnZVNldCA9IEltYWdlU2V0O1xyXG52YXIgTWVkaWFTb3VyY2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoTWVkaWFTb3VyY2UsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBNZWRpYVNvdXJjZSh1cmwsIG1pbWVUeXBlKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpcztcclxuICAgICAgICBfdGhpcy51cmwgPSB1cmw7XHJcbiAgICAgICAgX3RoaXMubWltZVR5cGUgPSBtaW1lVHlwZTtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICAvLyNlbmRyZWdpb25cclxuICAgIE1lZGlhU291cmNlLnByb3RvdHlwZS5nZXRTY2hlbWFLZXkgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIFwiTWVkaWFTb3VyY2VcIjtcclxuICAgIH07XHJcbiAgICBNZWRpYVNvdXJjZS5wcm90b3R5cGUuaXNWYWxpZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5taW1lVHlwZSAmJiB0aGlzLnVybCA/IHRydWUgOiBmYWxzZTtcclxuICAgIH07XHJcbiAgICBNZWRpYVNvdXJjZS5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciByZXN1bHQgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNWYWxpZCgpKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzb3VyY2VcIik7XHJcbiAgICAgICAgICAgIHJlc3VsdC5zcmMgPSB0aGlzLnVybDtcclxuICAgICAgICAgICAgcmVzdWx0LnR5cGUgPSB0aGlzLm1pbWVUeXBlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuICAgIC8vI3JlZ2lvbiBTY2hlbWFcclxuICAgIE1lZGlhU291cmNlLm1pbWVUeXBlUHJvcGVydHkgPSBuZXcgc2VyaWFsaXphdGlvbl8xLlN0cmluZ1Byb3BlcnR5KHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8xLCBcIm1pbWVUeXBlXCIpO1xyXG4gICAgTWVkaWFTb3VyY2UudXJsUHJvcGVydHkgPSBuZXcgc2VyaWFsaXphdGlvbl8xLlN0cmluZ1Byb3BlcnR5KHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8xLCBcInVybFwiKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHNlcmlhbGl6YXRpb25fMS5wcm9wZXJ0eShNZWRpYVNvdXJjZS5taW1lVHlwZVByb3BlcnR5KVxyXG4gICAgXSwgTWVkaWFTb3VyY2UucHJvdG90eXBlLCBcIm1pbWVUeXBlXCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBzZXJpYWxpemF0aW9uXzEucHJvcGVydHkoTWVkaWFTb3VyY2UudXJsUHJvcGVydHkpXHJcbiAgICBdLCBNZWRpYVNvdXJjZS5wcm90b3R5cGUsIFwidXJsXCIsIHZvaWQgMCk7XHJcbiAgICByZXR1cm4gTWVkaWFTb3VyY2U7XHJcbn0oc2VyaWFsaXphdGlvbl8xLlNlcmlhbGl6YWJsZU9iamVjdCkpO1xyXG5leHBvcnRzLk1lZGlhU291cmNlID0gTWVkaWFTb3VyY2U7XHJcbnZhciBNZWRpYSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhNZWRpYSwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIE1lZGlhKCkge1xyXG4gICAgICAgIC8vI3JlZ2lvbiBTY2hlbWFcclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgICAgICBfdGhpcy5zb3VyY2VzID0gW107XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgTWVkaWEucHJvdG90eXBlLmdldFBvc3RlclVybCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5wb3N0ZXIgPyB0aGlzLnBvc3RlciA6IHRoaXMuaG9zdENvbmZpZy5tZWRpYS5kZWZhdWx0UG9zdGVyO1xyXG4gICAgfTtcclxuICAgIE1lZGlhLnByb3RvdHlwZS5wcm9jZXNzU291cmNlcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLl9zZWxlY3RlZFNvdXJjZXMgPSBbXTtcclxuICAgICAgICB0aGlzLl9zZWxlY3RlZE1lZGlhVHlwZSA9IHVuZGVmaW5lZDtcclxuICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gdGhpcy5zb3VyY2VzOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgICAgICB2YXIgc291cmNlID0gX2FbX2ldO1xyXG4gICAgICAgICAgICB2YXIgbWltZUNvbXBvbmVudHMgPSBzb3VyY2UubWltZVR5cGUgPyBzb3VyY2UubWltZVR5cGUuc3BsaXQoJy8nKSA6IFtdO1xyXG4gICAgICAgICAgICBpZiAobWltZUNvbXBvbmVudHMubGVuZ3RoID09IDIpIHtcclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5fc2VsZWN0ZWRNZWRpYVR5cGUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBNZWRpYS5zdXBwb3J0ZWRNZWRpYVR5cGVzLmluZGV4T2YobWltZUNvbXBvbmVudHNbMF0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3NlbGVjdGVkTWVkaWFUeXBlID0gTWVkaWEuc3VwcG9ydGVkTWVkaWFUeXBlc1tpbmRleF07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKG1pbWVDb21wb25lbnRzWzBdID09IHRoaXMuX3NlbGVjdGVkTWVkaWFUeXBlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2VsZWN0ZWRTb3VyY2VzLnB1c2goc291cmNlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBNZWRpYS5wcm90b3R5cGUucmVuZGVyUG9zdGVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdmFyIHBsYXlCdXR0b25BcnJvd1dpZHRoID0gMTI7XHJcbiAgICAgICAgdmFyIHBsYXlCdXR0b25BcnJvd0hlaWdodCA9IDE1O1xyXG4gICAgICAgIHZhciBwb3N0ZXJSb290RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgcG9zdGVyUm9vdEVsZW1lbnQuY2xhc3NOYW1lID0gdGhpcy5ob3N0Q29uZmlnLm1ha2VDc3NDbGFzc05hbWUoXCJhYy1tZWRpYS1wb3N0ZXJcIik7XHJcbiAgICAgICAgcG9zdGVyUm9vdEVsZW1lbnQuc2V0QXR0cmlidXRlKFwicm9sZVwiLCBcImNvbnRlbnRpbmZvXCIpO1xyXG4gICAgICAgIHBvc3RlclJvb3RFbGVtZW50LnNldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxcIiwgdGhpcy5hbHRUZXh0ID8gdGhpcy5hbHRUZXh0IDogXCJNZWRpYSBjb250ZW50XCIpO1xyXG4gICAgICAgIHBvc3RlclJvb3RFbGVtZW50LnN0eWxlLnBvc2l0aW9uID0gXCJyZWxhdGl2ZVwiO1xyXG4gICAgICAgIHBvc3RlclJvb3RFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcclxuICAgICAgICB2YXIgcG9zdGVyVXJsID0gdGhpcy5nZXRQb3N0ZXJVcmwoKTtcclxuICAgICAgICBpZiAocG9zdGVyVXJsKSB7XHJcbiAgICAgICAgICAgIHZhciBwb3N0ZXJJbWFnZUVsZW1lbnRfMSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbWdcIik7XHJcbiAgICAgICAgICAgIHBvc3RlckltYWdlRWxlbWVudF8xLnN0eWxlLndpZHRoID0gXCIxMDAlXCI7XHJcbiAgICAgICAgICAgIHBvc3RlckltYWdlRWxlbWVudF8xLnN0eWxlLmhlaWdodCA9IFwiMTAwJVwiO1xyXG4gICAgICAgICAgICBwb3N0ZXJJbWFnZUVsZW1lbnRfMS5vbmVycm9yID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgICAgIGlmIChwb3N0ZXJJbWFnZUVsZW1lbnRfMS5wYXJlbnROb2RlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcG9zdGVySW1hZ2VFbGVtZW50XzEucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChwb3N0ZXJJbWFnZUVsZW1lbnRfMSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBwb3N0ZXJSb290RWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiZW1wdHlcIik7XHJcbiAgICAgICAgICAgICAgICBwb3N0ZXJSb290RWxlbWVudC5zdHlsZS5taW5IZWlnaHQgPSBcIjE1MHB4XCI7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHBvc3RlckltYWdlRWxlbWVudF8xLnNyYyA9IHBvc3RlclVybDtcclxuICAgICAgICAgICAgcG9zdGVyUm9vdEVsZW1lbnQuYXBwZW5kQ2hpbGQocG9zdGVySW1hZ2VFbGVtZW50XzEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcG9zdGVyUm9vdEVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImVtcHR5XCIpO1xyXG4gICAgICAgICAgICBwb3N0ZXJSb290RWxlbWVudC5zdHlsZS5taW5IZWlnaHQgPSBcIjE1MHB4XCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmhvc3RDb25maWcuc3VwcG9ydHNJbnRlcmFjdGl2aXR5ICYmIHRoaXMuX3NlbGVjdGVkU291cmNlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIHZhciBwbGF5QnV0dG9uT3V0ZXJFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgICAgcGxheUJ1dHRvbk91dGVyRWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsIFwiYnV0dG9uXCIpO1xyXG4gICAgICAgICAgICBwbGF5QnV0dG9uT3V0ZXJFbGVtZW50LnNldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxcIiwgXCJQbGF5IG1lZGlhXCIpO1xyXG4gICAgICAgICAgICBwbGF5QnV0dG9uT3V0ZXJFbGVtZW50LmNsYXNzTmFtZSA9IHRoaXMuaG9zdENvbmZpZy5tYWtlQ3NzQ2xhc3NOYW1lKFwiYWMtbWVkaWEtcGxheUJ1dHRvblwiKTtcclxuICAgICAgICAgICAgcGxheUJ1dHRvbk91dGVyRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XHJcbiAgICAgICAgICAgIHBsYXlCdXR0b25PdXRlckVsZW1lbnQuc3R5bGUuYWxpZ25JdGVtcyA9IFwiY2VudGVyXCI7XHJcbiAgICAgICAgICAgIHBsYXlCdXR0b25PdXRlckVsZW1lbnQuc3R5bGUuanVzdGlmeUNvbnRlbnQgPSBcImNlbnRlclwiO1xyXG4gICAgICAgICAgICBwbGF5QnV0dG9uT3V0ZXJFbGVtZW50Lm9uY2xpY2sgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKF90aGlzLmhvc3RDb25maWcubWVkaWEuYWxsb3dJbmxpbmVQbGF5YmFjaykge1xyXG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgICAgICAgICBlLmNhbmNlbEJ1YmJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKF90aGlzLnJlbmRlcmVkRWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWVkaWFQbGF5ZXJFbGVtZW50ID0gX3RoaXMucmVuZGVyTWVkaWFQbGF5ZXIoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMucmVuZGVyZWRFbGVtZW50LmlubmVySFRNTCA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnJlbmRlcmVkRWxlbWVudC5hcHBlbmRDaGlsZChtZWRpYVBsYXllckVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZWRpYVBsYXllckVsZW1lbnQucGxheSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChNZWRpYS5vblBsYXkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBlLmNhbmNlbEJ1YmJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIE1lZGlhLm9uUGxheShfdGhpcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB2YXIgcGxheUJ1dHRvbklubmVyRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICAgIHBsYXlCdXR0b25Jbm5lckVsZW1lbnQuY2xhc3NOYW1lID0gdGhpcy5ob3N0Q29uZmlnLm1ha2VDc3NDbGFzc05hbWUoXCJhYy1tZWRpYS1wbGF5QnV0dG9uLWFycm93XCIpO1xyXG4gICAgICAgICAgICBwbGF5QnV0dG9uSW5uZXJFbGVtZW50LnN0eWxlLndpZHRoID0gcGxheUJ1dHRvbkFycm93V2lkdGggKyBcInB4XCI7XHJcbiAgICAgICAgICAgIHBsYXlCdXR0b25Jbm5lckVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gcGxheUJ1dHRvbkFycm93SGVpZ2h0ICsgXCJweFwiO1xyXG4gICAgICAgICAgICBwbGF5QnV0dG9uSW5uZXJFbGVtZW50LnN0eWxlLmJvcmRlclRvcFdpZHRoID0gKHBsYXlCdXR0b25BcnJvd0hlaWdodCAvIDIpICsgXCJweFwiO1xyXG4gICAgICAgICAgICBwbGF5QnV0dG9uSW5uZXJFbGVtZW50LnN0eWxlLmJvcmRlckJvdHRvbVdpZHRoID0gKHBsYXlCdXR0b25BcnJvd0hlaWdodCAvIDIpICsgXCJweFwiO1xyXG4gICAgICAgICAgICBwbGF5QnV0dG9uSW5uZXJFbGVtZW50LnN0eWxlLmJvcmRlckxlZnRXaWR0aCA9IHBsYXlCdXR0b25BcnJvd1dpZHRoICsgXCJweFwiO1xyXG4gICAgICAgICAgICBwbGF5QnV0dG9uSW5uZXJFbGVtZW50LnN0eWxlLmJvcmRlclJpZ2h0V2lkdGggPSBcIjBcIjtcclxuICAgICAgICAgICAgcGxheUJ1dHRvbklubmVyRWxlbWVudC5zdHlsZS5ib3JkZXJTdHlsZSA9IFwic29saWRcIjtcclxuICAgICAgICAgICAgcGxheUJ1dHRvbklubmVyRWxlbWVudC5zdHlsZS5ib3JkZXJUb3BDb2xvciA9IFwidHJhbnNwYXJlbnRcIjtcclxuICAgICAgICAgICAgcGxheUJ1dHRvbklubmVyRWxlbWVudC5zdHlsZS5ib3JkZXJSaWdodENvbG9yID0gXCJ0cmFuc3BhcmVudFwiO1xyXG4gICAgICAgICAgICBwbGF5QnV0dG9uSW5uZXJFbGVtZW50LnN0eWxlLmJvcmRlckJvdHRvbUNvbG9yID0gXCJ0cmFuc3BhcmVudFwiO1xyXG4gICAgICAgICAgICBwbGF5QnV0dG9uSW5uZXJFbGVtZW50LnN0eWxlLnRyYW5zZm9ybSA9IFwidHJhbnNsYXRlKFwiICsgKHBsYXlCdXR0b25BcnJvd1dpZHRoIC8gMTApICsgXCJweCwwcHgpXCI7XHJcbiAgICAgICAgICAgIHBsYXlCdXR0b25PdXRlckVsZW1lbnQuYXBwZW5kQ2hpbGQocGxheUJ1dHRvbklubmVyRWxlbWVudCk7XHJcbiAgICAgICAgICAgIHZhciBwbGF5QnV0dG9uQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICAgICAgcGxheUJ1dHRvbkNvbnRhaW5lci5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcclxuICAgICAgICAgICAgcGxheUJ1dHRvbkNvbnRhaW5lci5zdHlsZS5sZWZ0ID0gXCIwXCI7XHJcbiAgICAgICAgICAgIHBsYXlCdXR0b25Db250YWluZXIuc3R5bGUudG9wID0gXCIwXCI7XHJcbiAgICAgICAgICAgIHBsYXlCdXR0b25Db250YWluZXIuc3R5bGUud2lkdGggPSBcIjEwMCVcIjtcclxuICAgICAgICAgICAgcGxheUJ1dHRvbkNvbnRhaW5lci5zdHlsZS5oZWlnaHQgPSBcIjEwMCVcIjtcclxuICAgICAgICAgICAgcGxheUJ1dHRvbkNvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XHJcbiAgICAgICAgICAgIHBsYXlCdXR0b25Db250YWluZXIuc3R5bGUuanVzdGlmeUNvbnRlbnQgPSBcImNlbnRlclwiO1xyXG4gICAgICAgICAgICBwbGF5QnV0dG9uQ29udGFpbmVyLnN0eWxlLmFsaWduSXRlbXMgPSBcImNlbnRlclwiO1xyXG4gICAgICAgICAgICBwbGF5QnV0dG9uQ29udGFpbmVyLmFwcGVuZENoaWxkKHBsYXlCdXR0b25PdXRlckVsZW1lbnQpO1xyXG4gICAgICAgICAgICBwb3N0ZXJSb290RWxlbWVudC5hcHBlbmRDaGlsZChwbGF5QnV0dG9uQ29udGFpbmVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHBvc3RlclJvb3RFbGVtZW50O1xyXG4gICAgfTtcclxuICAgIE1lZGlhLnByb3RvdHlwZS5yZW5kZXJNZWRpYVBsYXllciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgbWVkaWFFbGVtZW50O1xyXG4gICAgICAgIGlmICh0aGlzLl9zZWxlY3RlZE1lZGlhVHlwZSA9PSBcInZpZGVvXCIpIHtcclxuICAgICAgICAgICAgdmFyIHZpZGVvUGxheWVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInZpZGVvXCIpO1xyXG4gICAgICAgICAgICB2YXIgcG9zdGVyVXJsID0gdGhpcy5nZXRQb3N0ZXJVcmwoKTtcclxuICAgICAgICAgICAgaWYgKHBvc3RlclVybCkge1xyXG4gICAgICAgICAgICAgICAgdmlkZW9QbGF5ZXIucG9zdGVyID0gcG9zdGVyVXJsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG1lZGlhRWxlbWVudCA9IHZpZGVvUGxheWVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgbWVkaWFFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImF1ZGlvXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBtZWRpYUVsZW1lbnQuY29udHJvbHMgPSB0cnVlO1xyXG4gICAgICAgIG1lZGlhRWxlbWVudC5wcmVsb2FkID0gXCJub25lXCI7XHJcbiAgICAgICAgbWVkaWFFbGVtZW50LnN0eWxlLndpZHRoID0gXCIxMDAlXCI7XHJcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHRoaXMuc291cmNlczsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgdmFyIHNvdXJjZSA9IF9hW19pXTtcclxuICAgICAgICAgICAgdmFyIHJlbmRlcmVkU291cmNlID0gc291cmNlLnJlbmRlcigpO1xyXG4gICAgICAgICAgICBVdGlscy5hcHBlbmRDaGlsZChtZWRpYUVsZW1lbnQsIHJlbmRlcmVkU291cmNlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG1lZGlhRWxlbWVudDtcclxuICAgIH07XHJcbiAgICBNZWRpYS5wcm90b3R5cGUuaW50ZXJuYWxSZW5kZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGVsZW1lbnQuY2xhc3NOYW1lID0gdGhpcy5ob3N0Q29uZmlnLm1ha2VDc3NDbGFzc05hbWUoXCJhYy1tZWRpYVwiKTtcclxuICAgICAgICB0aGlzLnByb2Nlc3NTb3VyY2VzKCk7XHJcbiAgICAgICAgZWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLnJlbmRlclBvc3RlcigpKTtcclxuICAgICAgICByZXR1cm4gZWxlbWVudDtcclxuICAgIH07XHJcbiAgICBNZWRpYS5wcm90b3R5cGUuZ2V0SnNvblR5cGVOYW1lID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBcIk1lZGlhXCI7XHJcbiAgICB9O1xyXG4gICAgTWVkaWEucHJvdG90eXBlLmdldFJlc291cmNlSW5mb3JtYXRpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IFtdO1xyXG4gICAgICAgIHZhciBwb3N0ZXJVcmwgPSB0aGlzLmdldFBvc3RlclVybCgpO1xyXG4gICAgICAgIGlmIChwb3N0ZXJVcmwpIHtcclxuICAgICAgICAgICAgcmVzdWx0LnB1c2goeyB1cmw6IHBvc3RlclVybCwgbWltZVR5cGU6IFwiaW1hZ2VcIiB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHRoaXMuc291cmNlczsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgdmFyIG1lZGlhU291cmNlID0gX2FbX2ldO1xyXG4gICAgICAgICAgICBpZiAobWVkaWFTb3VyY2UuaXNWYWxpZCgpKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBtZWRpYVNvdXJjZS51cmwsXHJcbiAgICAgICAgICAgICAgICAgICAgbWltZVR5cGU6IG1lZGlhU291cmNlLm1pbWVUeXBlXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShNZWRpYS5wcm90b3R5cGUsIFwic2VsZWN0ZWRNZWRpYVR5cGVcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fc2VsZWN0ZWRNZWRpYVR5cGU7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBNZWRpYS5zb3VyY2VzUHJvcGVydHkgPSBuZXcgc2VyaWFsaXphdGlvbl8xLlNlcmlhbGl6YWJsZU9iamVjdENvbGxlY3Rpb25Qcm9wZXJ0eShzZXJpYWxpemF0aW9uXzEuVmVyc2lvbnMudjFfMSwgXCJzb3VyY2VzXCIsIE1lZGlhU291cmNlKTtcclxuICAgIE1lZGlhLnBvc3RlclByb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5TdHJpbmdQcm9wZXJ0eShzZXJpYWxpemF0aW9uXzEuVmVyc2lvbnMudjFfMSwgXCJwb3N0ZXJcIik7XHJcbiAgICBNZWRpYS5hbHRUZXh0UHJvcGVydHkgPSBuZXcgc2VyaWFsaXphdGlvbl8xLlN0cmluZ1Byb3BlcnR5KHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8xLCBcImFsdFRleHRcIik7XHJcbiAgICAvLyNlbmRyZWdpb25cclxuICAgIE1lZGlhLnN1cHBvcnRlZE1lZGlhVHlwZXMgPSBbXCJhdWRpb1wiLCBcInZpZGVvXCJdO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KE1lZGlhLnNvdXJjZXNQcm9wZXJ0eSlcclxuICAgIF0sIE1lZGlhLnByb3RvdHlwZSwgXCJzb3VyY2VzXCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBzZXJpYWxpemF0aW9uXzEucHJvcGVydHkoTWVkaWEucG9zdGVyUHJvcGVydHkpXHJcbiAgICBdLCBNZWRpYS5wcm90b3R5cGUsIFwicG9zdGVyXCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBzZXJpYWxpemF0aW9uXzEucHJvcGVydHkoTWVkaWEuYWx0VGV4dFByb3BlcnR5KVxyXG4gICAgXSwgTWVkaWEucHJvdG90eXBlLCBcImFsdFRleHRcIiwgdm9pZCAwKTtcclxuICAgIHJldHVybiBNZWRpYTtcclxufShDYXJkRWxlbWVudCkpO1xyXG5leHBvcnRzLk1lZGlhID0gTWVkaWE7XHJcbnZhciBJbnB1dFZhbGlkYXRpb25PcHRpb25zID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKElucHV0VmFsaWRhdGlvbk9wdGlvbnMsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBJbnB1dFZhbGlkYXRpb25PcHRpb25zKCkge1xyXG4gICAgICAgIC8vI3JlZ2lvbiBTY2hlbWFcclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgICAgICBfdGhpcy5uZWNlc3NpdHkgPSBFbnVtcy5JbnB1dFZhbGlkYXRpb25OZWNlc3NpdHkuT3B0aW9uYWw7XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgSW5wdXRWYWxpZGF0aW9uT3B0aW9ucy5wcm90b3R5cGUuZ2V0U2NoZW1hS2V5ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBcIklucHV0VmFsaWRhdGlvbk9wdGlvbnNcIjtcclxuICAgIH07XHJcbiAgICAvLyNlbmRyZWdpb25cclxuICAgIElucHV0VmFsaWRhdGlvbk9wdGlvbnMucHJvdG90eXBlLmludGVybmFsVG9KU09OID0gZnVuY3Rpb24gKHRhcmdldCwgY29udGV4dCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmhhc0FsbERlZmF1bHRWYWx1ZXMoKSA/IHVuZGVmaW5lZCA6IF9zdXBlci5wcm90b3R5cGUuaW50ZXJuYWxUb0pTT04uY2FsbCh0aGlzLCB0YXJnZXQsIGNvbnRleHQpO1xyXG4gICAgfTtcclxuICAgIElucHV0VmFsaWRhdGlvbk9wdGlvbnMubmVjZXNzaXR5UHJvcGVydHkgPSBuZXcgc2VyaWFsaXphdGlvbl8xLkVudW1Qcm9wZXJ0eShzZXJpYWxpemF0aW9uXzEuVmVyc2lvbnMudk5leHQsIFwibmVjZXNzaXR5XCIsIEVudW1zLklucHV0VmFsaWRhdGlvbk5lY2Vzc2l0eSwgRW51bXMuSW5wdXRWYWxpZGF0aW9uTmVjZXNzaXR5Lk9wdGlvbmFsKTtcclxuICAgIElucHV0VmFsaWRhdGlvbk9wdGlvbnMuZXJyb3JNZXNzYWdlUHJvcGVydHkgPSBuZXcgc2VyaWFsaXphdGlvbl8xLlN0cmluZ1Byb3BlcnR5KHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52TmV4dCwgXCJlcnJvck1lc3NhZ3dlXCIpO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KElucHV0VmFsaWRhdGlvbk9wdGlvbnMubmVjZXNzaXR5UHJvcGVydHkpXHJcbiAgICBdLCBJbnB1dFZhbGlkYXRpb25PcHRpb25zLnByb3RvdHlwZSwgXCJuZWNlc3NpdHlcIiwgdm9pZCAwKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHNlcmlhbGl6YXRpb25fMS5wcm9wZXJ0eShJbnB1dFZhbGlkYXRpb25PcHRpb25zLmVycm9yTWVzc2FnZVByb3BlcnR5KVxyXG4gICAgXSwgSW5wdXRWYWxpZGF0aW9uT3B0aW9ucy5wcm90b3R5cGUsIFwiZXJyb3JNZXNzYWdlXCIsIHZvaWQgMCk7XHJcbiAgICByZXR1cm4gSW5wdXRWYWxpZGF0aW9uT3B0aW9ucztcclxufShzZXJpYWxpemF0aW9uXzEuU2VyaWFsaXphYmxlT2JqZWN0KSk7XHJcbmV4cG9ydHMuSW5wdXRWYWxpZGF0aW9uT3B0aW9ucyA9IElucHV0VmFsaWRhdGlvbk9wdGlvbnM7XHJcbnZhciBJbnB1dCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhJbnB1dCwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIElucHV0KCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgIH1cclxuICAgIElucHV0LnByb3RvdHlwZS5wb3B1bGF0ZVNjaGVtYSA9IGZ1bmN0aW9uIChzY2hlbWEpIHtcclxuICAgICAgICBfc3VwZXIucHJvdG90eXBlLnBvcHVsYXRlU2NoZW1hLmNhbGwodGhpcywgc2NoZW1hKTtcclxuICAgICAgICBpZiAoIXNoYXJlZF8xLkdsb2JhbFNldHRpbmdzLnVzZUJ1aWx0SW5JbnB1dFZhbGlkYXRpb24pIHtcclxuICAgICAgICAgICAgc2NoZW1hLnJlbW92ZShJbnB1dC52YWxpZGF0aW9uUHJvcGVydHkpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoSW5wdXQucHJvdG90eXBlLCBcInZhbGlkYXRpb25cIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRWYWx1ZShJbnB1dC52YWxpZGF0aW9uUHJvcGVydHkpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KElucHV0LnByb3RvdHlwZSwgXCJpc051bGxhYmxlXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoSW5wdXQucHJvdG90eXBlLCBcInJlbmRlcmVkSW5wdXRDb250cm9sRWxlbWVudFwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZW5kZXJlZElucHV0Q29udHJvbEVsZW1lbnQ7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoSW5wdXQucHJvdG90eXBlLCBcImlucHV0Q29udHJvbENvbnRhaW5lckVsZW1lbnRcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5faW5wdXRDb250cm9sQ29udGFpbmVyRWxlbWVudDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIElucHV0LnByb3RvdHlwZS5vdmVycmlkZUludGVybmFsUmVuZGVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBob3N0Q29uZmlnID0gdGhpcy5ob3N0Q29uZmlnO1xyXG4gICAgICAgIHRoaXMuX291dGVyQ29udGFpbmVyRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgdGhpcy5fb3V0ZXJDb250YWluZXJFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBcImZsZXhcIjtcclxuICAgICAgICB0aGlzLl9vdXRlckNvbnRhaW5lckVsZW1lbnQuc3R5bGUuZmxleERpcmVjdGlvbiA9IFwiY29sdW1uXCI7XHJcbiAgICAgICAgdGhpcy5faW5wdXRDb250cm9sQ29udGFpbmVyRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgdGhpcy5faW5wdXRDb250cm9sQ29udGFpbmVyRWxlbWVudC5jbGFzc05hbWUgPSBob3N0Q29uZmlnLm1ha2VDc3NDbGFzc05hbWUoXCJhYy1pbnB1dC1jb250YWluZXJcIik7XHJcbiAgICAgICAgdGhpcy5faW5wdXRDb250cm9sQ29udGFpbmVyRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XHJcbiAgICAgICAgdmFyIHJlbmRlcmVkSW5wdXRDb250cm9sRWxlbWVudCA9IHRoaXMuaW50ZXJuYWxSZW5kZXIoKTtcclxuICAgICAgICBpZiAocmVuZGVyZWRJbnB1dENvbnRyb2xFbGVtZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3JlbmRlcmVkSW5wdXRDb250cm9sRWxlbWVudCA9IHJlbmRlcmVkSW5wdXRDb250cm9sRWxlbWVudDtcclxuICAgICAgICAgICAgdGhpcy5fcmVuZGVyZWRJbnB1dENvbnRyb2xFbGVtZW50LnN0eWxlLm1pbldpZHRoID0gXCIwcHhcIjtcclxuICAgICAgICAgICAgaWYgKHNoYXJlZF8xLkdsb2JhbFNldHRpbmdzLnVzZUJ1aWx0SW5JbnB1dFZhbGlkYXRpb24gJiYgdGhpcy5pc051bGxhYmxlICYmIHRoaXMudmFsaWRhdGlvbi5uZWNlc3NpdHkgPT0gRW51bXMuSW5wdXRWYWxpZGF0aW9uTmVjZXNzaXR5LlJlcXVpcmVkV2l0aFZpc3VhbEN1ZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fcmVuZGVyZWRJbnB1dENvbnRyb2xFbGVtZW50LmNsYXNzTGlzdC5hZGQoaG9zdENvbmZpZy5tYWtlQ3NzQ2xhc3NOYW1lKFwiYWMtaW5wdXQtcmVxdWlyZWRcIikpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuX2lucHV0Q29udHJvbENvbnRhaW5lckVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5fcmVuZGVyZWRJbnB1dENvbnRyb2xFbGVtZW50KTtcclxuICAgICAgICAgICAgdGhpcy5fb3V0ZXJDb250YWluZXJFbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuX2lucHV0Q29udHJvbENvbnRhaW5lckVsZW1lbnQpO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fb3V0ZXJDb250YWluZXJFbGVtZW50O1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgfTtcclxuICAgIElucHV0LnByb3RvdHlwZS52YWx1ZUNoYW5nZWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5yZXNldFZhbGlkYXRpb25GYWlsdXJlQ3VlKCk7XHJcbiAgICAgICAgaWYgKHRoaXMub25WYWx1ZUNoYW5nZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5vblZhbHVlQ2hhbmdlZCh0aGlzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmFpc2VJbnB1dFZhbHVlQ2hhbmdlZEV2ZW50KHRoaXMpO1xyXG4gICAgfTtcclxuICAgIElucHV0LnByb3RvdHlwZS5yZXNldFZhbGlkYXRpb25GYWlsdXJlQ3VlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmIChzaGFyZWRfMS5HbG9iYWxTZXR0aW5ncy51c2VCdWlsdEluSW5wdXRWYWxpZGF0aW9uICYmIHRoaXMucmVuZGVyZWRFbGVtZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3JlbmRlcmVkSW5wdXRDb250cm9sRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuaG9zdENvbmZpZy5tYWtlQ3NzQ2xhc3NOYW1lKFwiYWMtaW5wdXQtdmFsaWRhdGlvbi1mYWlsZWRcIikpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5fZXJyb3JNZXNzYWdlRWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fb3V0ZXJDb250YWluZXJFbGVtZW50LnJlbW92ZUNoaWxkKHRoaXMuX2Vycm9yTWVzc2FnZUVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fZXJyb3JNZXNzYWdlRWxlbWVudCA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBJbnB1dC5wcm90b3R5cGUuc2hvd1ZhbGlkYXRpb25FcnJvck1lc3NhZ2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMucmVuZGVyZWRFbGVtZW50ICYmIHNoYXJlZF8xLkdsb2JhbFNldHRpbmdzLnVzZUJ1aWx0SW5JbnB1dFZhbGlkYXRpb24gJiYgc2hhcmVkXzEuR2xvYmFsU2V0dGluZ3MuZGlzcGxheUlucHV0VmFsaWRhdGlvbkVycm9ycyAmJiB0aGlzLnZhbGlkYXRpb24uZXJyb3JNZXNzYWdlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2Vycm9yTWVzc2FnZUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3BhblwiKTtcclxuICAgICAgICAgICAgdGhpcy5fZXJyb3JNZXNzYWdlRWxlbWVudC5jbGFzc05hbWUgPSB0aGlzLmhvc3RDb25maWcubWFrZUNzc0NsYXNzTmFtZShcImFjLWlucHV0LXZhbGlkYXRpb24tZXJyb3ItbWVzc2FnZVwiKTtcclxuICAgICAgICAgICAgdGhpcy5fZXJyb3JNZXNzYWdlRWxlbWVudC50ZXh0Q29udGVudCA9IHRoaXMudmFsaWRhdGlvbi5lcnJvck1lc3NhZ2U7XHJcbiAgICAgICAgICAgIHRoaXMuX291dGVyQ29udGFpbmVyRWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLl9lcnJvck1lc3NhZ2VFbGVtZW50KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgSW5wdXQucHJvdG90eXBlLmludGVybmFsVmFsaWRhdGVQcm9wZXJ0aWVzID0gZnVuY3Rpb24gKGNvbnRleHQpIHtcclxuICAgICAgICBfc3VwZXIucHJvdG90eXBlLmludGVybmFsVmFsaWRhdGVQcm9wZXJ0aWVzLmNhbGwodGhpcywgY29udGV4dCk7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlkKSB7XHJcbiAgICAgICAgICAgIGNvbnRleHQuYWRkRmFpbHVyZSh0aGlzLCA4IC8qIFByb3BlcnR5Q2FudEJlTnVsbCAqLywgXCJBbGwgaW5wdXRzIG11c3QgaGF2ZSBhIHVuaXF1ZSBJZFwiKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgSW5wdXQucHJvdG90eXBlLnZhbGlkYXRlVmFsdWUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHNoYXJlZF8xLkdsb2JhbFNldHRpbmdzLnVzZUJ1aWx0SW5JbnB1dFZhbGlkYXRpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5yZXNldFZhbGlkYXRpb25GYWlsdXJlQ3VlKCk7XHJcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSB0aGlzLnZhbGlkYXRpb24ubmVjZXNzaXR5ICE9IEVudW1zLklucHV0VmFsaWRhdGlvbk5lY2Vzc2l0eS5PcHRpb25hbCA/IHRoaXMuaXNTZXQoKSA6IHRydWU7XHJcbiAgICAgICAgICAgIGlmICghcmVzdWx0ICYmIHRoaXMucmVuZGVyZWRFbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9yZW5kZXJlZElucHV0Q29udHJvbEVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLmhvc3RDb25maWcubWFrZUNzc0NsYXNzTmFtZShcImFjLWlucHV0LXZhbGlkYXRpb24tZmFpbGVkXCIpKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2hvd1ZhbGlkYXRpb25FcnJvck1lc3NhZ2UoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIElucHV0LnByb3RvdHlwZS5nZXRBbGxJbnB1dHMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIFt0aGlzXTtcclxuICAgIH07XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoSW5wdXQucHJvdG90eXBlLCBcImlzSW50ZXJhY3RpdmVcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIC8vI3JlZ2lvbiBTY2hlbWFcclxuICAgIElucHV0LnZhbGlkYXRpb25Qcm9wZXJ0eSA9IG5ldyBzZXJpYWxpemF0aW9uXzEuU2VyaWFsaXphYmxlT2JqZWN0UHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnZOZXh0LCBcInZhbGlkYXRpb25cIiwgSW5wdXRWYWxpZGF0aW9uT3B0aW9ucyk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBzZXJpYWxpemF0aW9uXzEucHJvcGVydHkoSW5wdXQudmFsaWRhdGlvblByb3BlcnR5KVxyXG4gICAgXSwgSW5wdXQucHJvdG90eXBlLCBcInZhbGlkYXRpb25cIiwgbnVsbCk7XHJcbiAgICByZXR1cm4gSW5wdXQ7XHJcbn0oQ2FyZEVsZW1lbnQpKTtcclxuZXhwb3J0cy5JbnB1dCA9IElucHV0O1xyXG52YXIgVGV4dElucHV0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKFRleHRJbnB1dCwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIFRleHRJbnB1dCgpIHtcclxuICAgICAgICAvLyNyZWdpb24gU2NoZW1hXHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMuaXNNdWx0aWxpbmUgPSBmYWxzZTtcclxuICAgICAgICBfdGhpcy5zdHlsZSA9IEVudW1zLklucHV0VGV4dFN0eWxlLlRleHQ7XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgLy8jZW5kcmVnaW9uXHJcbiAgICBUZXh0SW5wdXQucHJvdG90eXBlLnNldHVwSW5wdXQgPSBmdW5jdGlvbiAoaW5wdXQpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIGlucHV0LnN0eWxlLmZsZXggPSBcIjEgMSBhdXRvXCI7XHJcbiAgICAgICAgaW5wdXQudGFiSW5kZXggPSAwO1xyXG4gICAgICAgIGlmICh0aGlzLnBsYWNlaG9sZGVyKSB7XHJcbiAgICAgICAgICAgIGlucHV0LnBsYWNlaG9sZGVyID0gdGhpcy5wbGFjZWhvbGRlcjtcclxuICAgICAgICAgICAgaW5wdXQuc2V0QXR0cmlidXRlKFwiYXJpYS1sYWJlbFwiLCB0aGlzLnBsYWNlaG9sZGVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuZGVmYXVsdFZhbHVlKSB7XHJcbiAgICAgICAgICAgIGlucHV0LnZhbHVlID0gdGhpcy5kZWZhdWx0VmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLm1heExlbmd0aCAmJiB0aGlzLm1heExlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgaW5wdXQubWF4TGVuZ3RoID0gdGhpcy5tYXhMZW5ndGg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlucHV0Lm9uaW5wdXQgPSBmdW5jdGlvbiAoKSB7IF90aGlzLnZhbHVlQ2hhbmdlZCgpOyB9O1xyXG4gICAgICAgIGlucHV0Lm9ua2V5cHJlc3MgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAvLyBDdHJsK0VudGVyIHByZXNzZWRcclxuICAgICAgICAgICAgaWYgKGUua2V5Q29kZSA9PSAxMCAmJiBfdGhpcy5pbmxpbmVBY3Rpb24pIHtcclxuICAgICAgICAgICAgICAgIF90aGlzLmlubGluZUFjdGlvbi5leGVjdXRlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfTtcclxuICAgIFRleHRJbnB1dC5wcm90b3R5cGUuaW50ZXJuYWxSZW5kZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHJlc3VsdDtcclxuICAgICAgICBpZiAodGhpcy5pc011bHRpbGluZSkge1xyXG4gICAgICAgICAgICByZXN1bHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwidGV4dGFyZWFcIik7XHJcbiAgICAgICAgICAgIHJlc3VsdC5jbGFzc05hbWUgPSB0aGlzLmhvc3RDb25maWcubWFrZUNzc0NsYXNzTmFtZShcImFjLWlucHV0XCIsIFwiYWMtdGV4dElucHV0XCIsIFwiYWMtbXVsdGlsaW5lXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmVzdWx0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xyXG4gICAgICAgICAgICByZXN1bHQuY2xhc3NOYW1lID0gdGhpcy5ob3N0Q29uZmlnLm1ha2VDc3NDbGFzc05hbWUoXCJhYy1pbnB1dFwiLCBcImFjLXRleHRJbnB1dFwiKTtcclxuICAgICAgICAgICAgcmVzdWx0LnR5cGUgPSBFbnVtcy5JbnB1dFRleHRTdHlsZVt0aGlzLnN0eWxlXS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnNldHVwSW5wdXQocmVzdWx0KTtcclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuICAgIFRleHRJbnB1dC5wcm90b3R5cGUub3ZlcnJpZGVJbnRlcm5hbFJlbmRlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHZhciByZW5kZXJlZElucHV0Q29udHJvbCA9IF9zdXBlci5wcm90b3R5cGUub3ZlcnJpZGVJbnRlcm5hbFJlbmRlci5jYWxsKHRoaXMpO1xyXG4gICAgICAgIGlmICh0aGlzLmlubGluZUFjdGlvbikge1xyXG4gICAgICAgICAgICB2YXIgYnV0dG9uXzEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xyXG4gICAgICAgICAgICBidXR0b25fMS5jbGFzc05hbWUgPSB0aGlzLmhvc3RDb25maWcubWFrZUNzc0NsYXNzTmFtZShcImFjLWlubGluZUFjdGlvbkJ1dHRvblwiKTtcclxuICAgICAgICAgICAgYnV0dG9uXzEub25jbGljayA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICBlLmNhbmNlbEJ1YmJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMuaW5saW5lQWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuaW5saW5lQWN0aW9uLmV4ZWN1dGUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuaW5saW5lQWN0aW9uLmljb25VcmwpIHtcclxuICAgICAgICAgICAgICAgIGJ1dHRvbl8xLmNsYXNzTGlzdC5hZGQoXCJpY29uT25seVwiKTtcclxuICAgICAgICAgICAgICAgIHZhciBpY29uXzEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW1nXCIpO1xyXG4gICAgICAgICAgICAgICAgaWNvbl8xLnN0eWxlLmhlaWdodCA9IFwiMTAwJVwiO1xyXG4gICAgICAgICAgICAgICAgLy8gVGhlIGJlbG93IHRyaWNrIGlzIG5lY2Vzc2FyeSBhcyBhIHdvcmthcm91bmQgaW4gQ2hyb21lIHdoZXJlIHRoZSBpY29uIGlzIGluaXRpYWxseSBkaXNwbGF5ZWRcclxuICAgICAgICAgICAgICAgIC8vIGF0IGl0cyBuYXRpdmUgc2l6ZSB0aGVuIHJlc2l6ZWQgdG8gMTAwJSBvZiB0aGUgYnV0dG9uJ3MgaGVpZ2h0LiBUaGlzIGNmcmVhdGVzIGFuIHVucGxlYXNhbnRcclxuICAgICAgICAgICAgICAgIC8vIGZsaWNrZXIuIE9uIHRvcCBvZiB0aGF0LCBDaHJvbWUncyBmbGV4IGltcGxlbWVudGF0aW9uIGZhaWxzIHRvIHBycGVybHkgcmUtbGF5b3V0IHRoZSBidXR0b25cclxuICAgICAgICAgICAgICAgIC8vIGFmdGVyIHRoZSBpbWFnZSBoYXMgbG9hZGVkIGFuZCBiZWVuIGdpY3ZlbiBpdHMgZmluYWwgc2l6ZS4gVGhlIGJlbG93IHRyaWNrIGFsc28gZml4ZXMgdGhhdC5cclxuICAgICAgICAgICAgICAgIGljb25fMS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbiAgICAgICAgICAgICAgICBpY29uXzEub25sb2FkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGljb25fMS5zdHlsZS5yZW1vdmVQcm9wZXJ0eShcImRpc3BsYXlcIik7XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgaWNvbl8xLm9uZXJyb3IgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uXzEucmVtb3ZlQ2hpbGQoaWNvbl8xKTtcclxuICAgICAgICAgICAgICAgICAgICBidXR0b25fMS5jbGFzc0xpc3QucmVtb3ZlKFwiaWNvbk9ubHlcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uXzEuY2xhc3NMaXN0LmFkZChcInRleHRPbmx5XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5pbmxpbmVBY3Rpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uXzEudGV4dENvbnRlbnQgPSBfdGhpcy5pbmxpbmVBY3Rpb24udGl0bGUgPyBfdGhpcy5pbmxpbmVBY3Rpb24udGl0bGUgOiBcIlRpdGxlXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBidXR0b25fMS50ZXh0Q29udGVudCA9IFwiVGl0bGVcIjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgaWNvbl8xLnNyYyA9IHRoaXMuaW5saW5lQWN0aW9uLmljb25Vcmw7XHJcbiAgICAgICAgICAgICAgICBidXR0b25fMS5hcHBlbmRDaGlsZChpY29uXzEpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaW5saW5lQWN0aW9uLnRpdGxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uXzEudGl0bGUgPSB0aGlzLmlubGluZUFjdGlvbi50aXRsZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGJ1dHRvbl8xLmNsYXNzTGlzdC5hZGQoXCJ0ZXh0T25seVwiKTtcclxuICAgICAgICAgICAgICAgIGJ1dHRvbl8xLnRleHRDb250ZW50ID0gdGhpcy5pbmxpbmVBY3Rpb24udGl0bGUgPyB0aGlzLmlubGluZUFjdGlvbi50aXRsZSA6IFwiVGl0bGVcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBidXR0b25fMS5zdHlsZS5tYXJnaW5MZWZ0ID0gXCI4cHhcIjtcclxuICAgICAgICAgICAgdGhpcy5pbnB1dENvbnRyb2xDb250YWluZXJFbGVtZW50LmFwcGVuZENoaWxkKGJ1dHRvbl8xKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlbmRlcmVkSW5wdXRDb250cm9sO1xyXG4gICAgfTtcclxuICAgIFRleHRJbnB1dC5wcm90b3R5cGUuZ2V0SnNvblR5cGVOYW1lID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBcIklucHV0LlRleHRcIjtcclxuICAgIH07XHJcbiAgICBUZXh0SW5wdXQucHJvdG90eXBlLmdldEFjdGlvbkJ5SWQgPSBmdW5jdGlvbiAoaWQpIHtcclxuICAgICAgICB2YXIgcmVzdWx0ID0gX3N1cGVyLnByb3RvdHlwZS5nZXRBY3Rpb25CeUlkLmNhbGwodGhpcywgaWQpO1xyXG4gICAgICAgIGlmICghcmVzdWx0ICYmIHRoaXMuaW5saW5lQWN0aW9uKSB7XHJcbiAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMuaW5saW5lQWN0aW9uLmdldEFjdGlvbkJ5SWQoaWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuICAgIFRleHRJbnB1dC5wcm90b3R5cGUuaXNTZXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudmFsdWUgPyB0cnVlIDogZmFsc2U7XHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFRleHRJbnB1dC5wcm90b3R5cGUsIFwidmFsdWVcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5yZW5kZXJlZElucHV0Q29udHJvbEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzTXVsdGlsaW5lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyZWRJbnB1dENvbnRyb2xFbGVtZW50LnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVuZGVyZWRJbnB1dENvbnRyb2xFbGVtZW50LnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgVGV4dElucHV0LnZhbHVlUHJvcGVydHkgPSBuZXcgc2VyaWFsaXphdGlvbl8xLlN0cmluZ1Byb3BlcnR5KHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8wLCBcInZhbHVlXCIpO1xyXG4gICAgVGV4dElucHV0Lm1heExlbmd0aFByb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5OdW1Qcm9wZXJ0eShzZXJpYWxpemF0aW9uXzEuVmVyc2lvbnMudjFfMCwgXCJtYXhMZW5ndGhcIik7XHJcbiAgICBUZXh0SW5wdXQuaXNNdWx0aWxpbmVQcm9wZXJ0eSA9IG5ldyBzZXJpYWxpemF0aW9uXzEuQm9vbFByb3BlcnR5KHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8wLCBcImlzTXVsdGlsaW5lXCIsIGZhbHNlKTtcclxuICAgIFRleHRJbnB1dC5wbGFjZWhvbGRlclByb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5TdHJpbmdQcm9wZXJ0eShzZXJpYWxpemF0aW9uXzEuVmVyc2lvbnMudjFfMCwgXCJwbGFjZWhvbGRlclwiKTtcclxuICAgIFRleHRJbnB1dC5zdHlsZVByb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5FbnVtUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzAsIFwic3R5bGVcIiwgRW51bXMuSW5wdXRUZXh0U3R5bGUsIEVudW1zLklucHV0VGV4dFN0eWxlLlRleHQpO1xyXG4gICAgVGV4dElucHV0LmlubGluZUFjdGlvblByb3BlcnR5ID0gbmV3IEFjdGlvblByb3BlcnR5KHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8wLCBcImlubGluZUFjdGlvblwiLCBbXCJBY3Rpb24uU2hvd0NhcmRcIl0pO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KFRleHRJbnB1dC52YWx1ZVByb3BlcnR5KVxyXG4gICAgXSwgVGV4dElucHV0LnByb3RvdHlwZSwgXCJkZWZhdWx0VmFsdWVcIiwgdm9pZCAwKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHNlcmlhbGl6YXRpb25fMS5wcm9wZXJ0eShUZXh0SW5wdXQubWF4TGVuZ3RoUHJvcGVydHkpXHJcbiAgICBdLCBUZXh0SW5wdXQucHJvdG90eXBlLCBcIm1heExlbmd0aFwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KFRleHRJbnB1dC5pc011bHRpbGluZVByb3BlcnR5KVxyXG4gICAgXSwgVGV4dElucHV0LnByb3RvdHlwZSwgXCJpc011bHRpbGluZVwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KFRleHRJbnB1dC5wbGFjZWhvbGRlclByb3BlcnR5KVxyXG4gICAgXSwgVGV4dElucHV0LnByb3RvdHlwZSwgXCJwbGFjZWhvbGRlclwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KFRleHRJbnB1dC5zdHlsZVByb3BlcnR5KVxyXG4gICAgXSwgVGV4dElucHV0LnByb3RvdHlwZSwgXCJzdHlsZVwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KFRleHRJbnB1dC5pbmxpbmVBY3Rpb25Qcm9wZXJ0eSlcclxuICAgIF0sIFRleHRJbnB1dC5wcm90b3R5cGUsIFwiaW5saW5lQWN0aW9uXCIsIHZvaWQgMCk7XHJcbiAgICByZXR1cm4gVGV4dElucHV0O1xyXG59KElucHV0KSk7XHJcbmV4cG9ydHMuVGV4dElucHV0ID0gVGV4dElucHV0O1xyXG52YXIgVG9nZ2xlSW5wdXQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoVG9nZ2xlSW5wdXQsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBUb2dnbGVJbnB1dCgpIHtcclxuICAgICAgICAvLyNyZWdpb24gU2NoZW1hXHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMudmFsdWVPbiA9IFwidHJ1ZVwiO1xyXG4gICAgICAgIF90aGlzLnZhbHVlT2ZmID0gXCJmYWxzZVwiO1xyXG4gICAgICAgIF90aGlzLndyYXAgPSBmYWxzZTtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICBUb2dnbGVJbnB1dC5wcm90b3R5cGUuaW50ZXJuYWxSZW5kZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB2YXIgZWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgZWxlbWVudC5jbGFzc05hbWUgPSB0aGlzLmhvc3RDb25maWcubWFrZUNzc0NsYXNzTmFtZShcImFjLWlucHV0XCIsIFwiYWMtdG9nZ2xlSW5wdXRcIik7XHJcbiAgICAgICAgZWxlbWVudC5zdHlsZS53aWR0aCA9IFwiMTAwJVwiO1xyXG4gICAgICAgIGVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IFwiZmxleFwiO1xyXG4gICAgICAgIGVsZW1lbnQuc3R5bGUuYWxpZ25JdGVtcyA9IFwiY2VudGVyXCI7XHJcbiAgICAgICAgdGhpcy5fY2hlY2tib3hJbnB1dEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XHJcbiAgICAgICAgdGhpcy5fY2hlY2tib3hJbnB1dEVsZW1lbnQuaWQgPSBVdGlscy5nZW5lcmF0ZVVuaXF1ZUlkKCk7XHJcbiAgICAgICAgdGhpcy5fY2hlY2tib3hJbnB1dEVsZW1lbnQudHlwZSA9IFwiY2hlY2tib3hcIjtcclxuICAgICAgICB0aGlzLl9jaGVja2JveElucHV0RWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gXCJpbmxpbmUtYmxvY2tcIjtcclxuICAgICAgICB0aGlzLl9jaGVja2JveElucHV0RWxlbWVudC5zdHlsZS52ZXJ0aWNhbEFsaWduID0gXCJtaWRkbGVcIjtcclxuICAgICAgICB0aGlzLl9jaGVja2JveElucHV0RWxlbWVudC5zdHlsZS5tYXJnaW4gPSBcIjBcIjtcclxuICAgICAgICB0aGlzLl9jaGVja2JveElucHV0RWxlbWVudC5zdHlsZS5mbGV4ID0gXCIwIDAgYXV0b1wiO1xyXG4gICAgICAgIGlmICh0aGlzLnRpdGxlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2NoZWNrYm94SW5wdXRFbGVtZW50LnNldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxcIiwgdGhpcy50aXRsZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX2NoZWNrYm94SW5wdXRFbGVtZW50LnRhYkluZGV4ID0gMDtcclxuICAgICAgICBpZiAodGhpcy5kZWZhdWx0VmFsdWUgPT0gdGhpcy52YWx1ZU9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2NoZWNrYm94SW5wdXRFbGVtZW50LmNoZWNrZWQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLl9jaGVja2JveElucHV0RWxlbWVudC5vbmNoYW5nZSA9IGZ1bmN0aW9uICgpIHsgX3RoaXMudmFsdWVDaGFuZ2VkKCk7IH07XHJcbiAgICAgICAgVXRpbHMuYXBwZW5kQ2hpbGQoZWxlbWVudCwgdGhpcy5fY2hlY2tib3hJbnB1dEVsZW1lbnQpO1xyXG4gICAgICAgIGlmICh0aGlzLnRpdGxlIHx8IHRoaXMuaXNEZXNpZ25Nb2RlKCkpIHtcclxuICAgICAgICAgICAgdmFyIGxhYmVsID0gbmV3IExhYmVsKCk7XHJcbiAgICAgICAgICAgIGxhYmVsLnNldFBhcmVudCh0aGlzKTtcclxuICAgICAgICAgICAgbGFiZWwuZm9yRWxlbWVudElkID0gdGhpcy5fY2hlY2tib3hJbnB1dEVsZW1lbnQuaWQ7XHJcbiAgICAgICAgICAgIGxhYmVsLmhvc3RDb25maWcgPSB0aGlzLmhvc3RDb25maWc7XHJcbiAgICAgICAgICAgIGxhYmVsLnRleHQgPSAhdGhpcy50aXRsZSA/IHRoaXMuZ2V0SnNvblR5cGVOYW1lKCkgOiB0aGlzLnRpdGxlO1xyXG4gICAgICAgICAgICBsYWJlbC51c2VNYXJrZG93biA9IHNoYXJlZF8xLkdsb2JhbFNldHRpbmdzLnVzZU1hcmtkb3duSW5SYWRpb0J1dHRvbkFuZENoZWNrYm94O1xyXG4gICAgICAgICAgICBsYWJlbC53cmFwID0gdGhpcy53cmFwO1xyXG4gICAgICAgICAgICB2YXIgbGFiZWxFbGVtZW50ID0gbGFiZWwucmVuZGVyKCk7XHJcbiAgICAgICAgICAgIGlmIChsYWJlbEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgIGxhYmVsRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gXCJpbmxpbmUtYmxvY2tcIjtcclxuICAgICAgICAgICAgICAgIGxhYmVsRWxlbWVudC5zdHlsZS5mbGV4ID0gXCIxIDEgYXV0b1wiO1xyXG4gICAgICAgICAgICAgICAgbGFiZWxFbGVtZW50LnN0eWxlLm1hcmdpbkxlZnQgPSBcIjZweFwiO1xyXG4gICAgICAgICAgICAgICAgbGFiZWxFbGVtZW50LnN0eWxlLnZlcnRpY2FsQWxpZ24gPSBcIm1pZGRsZVwiO1xyXG4gICAgICAgICAgICAgICAgdmFyIHNwYWNlckVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICAgICAgc3BhY2VyRWxlbWVudC5zdHlsZS53aWR0aCA9IFwiNnB4XCI7XHJcbiAgICAgICAgICAgICAgICBVdGlscy5hcHBlbmRDaGlsZChlbGVtZW50LCBzcGFjZXJFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgIFV0aWxzLmFwcGVuZENoaWxkKGVsZW1lbnQsIGxhYmVsRWxlbWVudCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFRvZ2dsZUlucHV0LnByb3RvdHlwZSwgXCJpc051bGxhYmxlXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgVG9nZ2xlSW5wdXQucHJvdG90eXBlLmdldEpzb25UeXBlTmFtZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gXCJJbnB1dC5Ub2dnbGVcIjtcclxuICAgIH07XHJcbiAgICBUb2dnbGVJbnB1dC5wcm90b3R5cGUuaXNTZXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudmFsdWUgPyB0cnVlIDogZmFsc2U7XHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFRvZ2dsZUlucHV0LnByb3RvdHlwZSwgXCJ2YWx1ZVwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9jaGVja2JveElucHV0RWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NoZWNrYm94SW5wdXRFbGVtZW50LmNoZWNrZWQgPyB0aGlzLnZhbHVlT24gOiB0aGlzLnZhbHVlT2ZmO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgVG9nZ2xlSW5wdXQudmFsdWVQcm9wZXJ0eSA9IG5ldyBzZXJpYWxpemF0aW9uXzEuU3RyaW5nUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzAsIFwidmFsdWVcIik7XHJcbiAgICBUb2dnbGVJbnB1dC50aXRsZVByb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5TdHJpbmdQcm9wZXJ0eShzZXJpYWxpemF0aW9uXzEuVmVyc2lvbnMudjFfMCwgXCJ0aXRsZVwiKTtcclxuICAgIFRvZ2dsZUlucHV0LnZhbHVlT25Qcm9wZXJ0eSA9IG5ldyBzZXJpYWxpemF0aW9uXzEuU3RyaW5nUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzAsIFwidmFsdWVPblwiLCB0cnVlLCB1bmRlZmluZWQsIFwidHJ1ZVwiLCBmdW5jdGlvbiAoc2VuZGVyKSB7IHJldHVybiBcInRydWVcIjsgfSk7XHJcbiAgICBUb2dnbGVJbnB1dC52YWx1ZU9mZlByb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5TdHJpbmdQcm9wZXJ0eShzZXJpYWxpemF0aW9uXzEuVmVyc2lvbnMudjFfMCwgXCJ2YWx1ZU9mZlwiLCB0cnVlLCB1bmRlZmluZWQsIFwiZmFsc2VcIiwgZnVuY3Rpb24gKHNlbmRlcikgeyByZXR1cm4gXCJmYWxzZVwiOyB9KTtcclxuICAgIFRvZ2dsZUlucHV0LndyYXBQcm9wZXJ0eSA9IG5ldyBzZXJpYWxpemF0aW9uXzEuQm9vbFByb3BlcnR5KHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8yLCBcIndyYXBcIiwgZmFsc2UpO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KFRvZ2dsZUlucHV0LnZhbHVlUHJvcGVydHkpXHJcbiAgICBdLCBUb2dnbGVJbnB1dC5wcm90b3R5cGUsIFwiZGVmYXVsdFZhbHVlXCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBzZXJpYWxpemF0aW9uXzEucHJvcGVydHkoVG9nZ2xlSW5wdXQudGl0bGVQcm9wZXJ0eSlcclxuICAgIF0sIFRvZ2dsZUlucHV0LnByb3RvdHlwZSwgXCJ0aXRsZVwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KFRvZ2dsZUlucHV0LnZhbHVlT25Qcm9wZXJ0eSlcclxuICAgIF0sIFRvZ2dsZUlucHV0LnByb3RvdHlwZSwgXCJ2YWx1ZU9uXCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBzZXJpYWxpemF0aW9uXzEucHJvcGVydHkoVG9nZ2xlSW5wdXQudmFsdWVPZmZQcm9wZXJ0eSlcclxuICAgIF0sIFRvZ2dsZUlucHV0LnByb3RvdHlwZSwgXCJ2YWx1ZU9mZlwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KFRvZ2dsZUlucHV0LndyYXBQcm9wZXJ0eSlcclxuICAgIF0sIFRvZ2dsZUlucHV0LnByb3RvdHlwZSwgXCJ3cmFwXCIsIHZvaWQgMCk7XHJcbiAgICByZXR1cm4gVG9nZ2xlSW5wdXQ7XHJcbn0oSW5wdXQpKTtcclxuZXhwb3J0cy5Ub2dnbGVJbnB1dCA9IFRvZ2dsZUlucHV0O1xyXG52YXIgQ2hvaWNlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKENob2ljZSwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIENob2ljZSh0aXRsZSwgdmFsdWUpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLnRpdGxlID0gdGl0bGU7XHJcbiAgICAgICAgX3RoaXMudmFsdWUgPSB2YWx1ZTtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICAvLyNlbmRyZWdpb25cclxuICAgIENob2ljZS5wcm90b3R5cGUuZ2V0U2NoZW1hS2V5ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBcIkNob2ljZVwiO1xyXG4gICAgfTtcclxuICAgIC8vI3JlZ2lvbiBTY2hlbWFcclxuICAgIENob2ljZS50aXRsZVByb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5TdHJpbmdQcm9wZXJ0eShzZXJpYWxpemF0aW9uXzEuVmVyc2lvbnMudjFfMCwgXCJ0aXRsZVwiKTtcclxuICAgIENob2ljZS52YWx1ZVByb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5TdHJpbmdQcm9wZXJ0eShzZXJpYWxpemF0aW9uXzEuVmVyc2lvbnMudjFfMCwgXCJ2YWx1ZVwiKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHNlcmlhbGl6YXRpb25fMS5wcm9wZXJ0eShDaG9pY2UudGl0bGVQcm9wZXJ0eSlcclxuICAgIF0sIENob2ljZS5wcm90b3R5cGUsIFwidGl0bGVcIiwgdm9pZCAwKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHNlcmlhbGl6YXRpb25fMS5wcm9wZXJ0eShDaG9pY2UudmFsdWVQcm9wZXJ0eSlcclxuICAgIF0sIENob2ljZS5wcm90b3R5cGUsIFwidmFsdWVcIiwgdm9pZCAwKTtcclxuICAgIHJldHVybiBDaG9pY2U7XHJcbn0oc2VyaWFsaXphdGlvbl8xLlNlcmlhbGl6YWJsZU9iamVjdCkpO1xyXG5leHBvcnRzLkNob2ljZSA9IENob2ljZTtcclxudmFyIENob2ljZVNldElucHV0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKENob2ljZVNldElucHV0LCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gQ2hvaWNlU2V0SW5wdXQoKSB7XHJcbiAgICAgICAgLy8jcmVnaW9uIFNjaGVtYVxyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLmlzTXVsdGlTZWxlY3QgPSBmYWxzZTtcclxuICAgICAgICBfdGhpcy53cmFwID0gZmFsc2U7XHJcbiAgICAgICAgX3RoaXMuY2hvaWNlcyA9IFtdO1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDaG9pY2VTZXRJbnB1dC5wcm90b3R5cGUsIFwiaXNDb21wYWN0XCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3R5bGUgIT09IFwiZXhwYW5kZWRcIjtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc3R5bGUgPSB2YWx1ZSA/IHVuZGVmaW5lZCA6IFwiZXhwYW5kZWRcIjtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIENob2ljZVNldElucHV0LmdldFVuaXF1ZUNhdGVnb3J5TmFtZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgdW5pcXVlQ3d0ZWdvcnlOYW1lID0gXCJfX2FjLWNhdGVnb3J5XCIgKyBDaG9pY2VTZXRJbnB1dC51bmlxdWVDYXRlZ29yeUNvdW50ZXI7XHJcbiAgICAgICAgQ2hvaWNlU2V0SW5wdXQudW5pcXVlQ2F0ZWdvcnlDb3VudGVyKys7XHJcbiAgICAgICAgcmV0dXJuIHVuaXF1ZUN3dGVnb3J5TmFtZTtcclxuICAgIH07XHJcbiAgICBDaG9pY2VTZXRJbnB1dC5wcm90b3R5cGUucmVuZGVyQ29tcHVuZElucHV0ID0gZnVuY3Rpb24gKGNzc0NsYXNzTmFtZSwgdHlwZSwgZGVmYXVsdFZhbHVlcykge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGVsZW1lbnQuY2xhc3NOYW1lID0gdGhpcy5ob3N0Q29uZmlnLm1ha2VDc3NDbGFzc05hbWUoXCJhYy1pbnB1dFwiLCBjc3NDbGFzc05hbWUpO1xyXG4gICAgICAgIGVsZW1lbnQuc3R5bGUud2lkdGggPSBcIjEwMCVcIjtcclxuICAgICAgICB0aGlzLl90b2dnbGVJbnB1dHMgPSBbXTtcclxuICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gdGhpcy5jaG9pY2VzOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgICAgICB2YXIgY2hvaWNlID0gX2FbX2ldO1xyXG4gICAgICAgICAgICB2YXIgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XHJcbiAgICAgICAgICAgIGlucHV0LmlkID0gVXRpbHMuZ2VuZXJhdGVVbmlxdWVJZCgpO1xyXG4gICAgICAgICAgICBpbnB1dC50eXBlID0gdHlwZTtcclxuICAgICAgICAgICAgaW5wdXQuc3R5bGUubWFyZ2luID0gXCIwXCI7XHJcbiAgICAgICAgICAgIGlucHV0LnN0eWxlLmRpc3BsYXkgPSBcImlubGluZS1ibG9ja1wiO1xyXG4gICAgICAgICAgICBpbnB1dC5zdHlsZS52ZXJ0aWNhbEFsaWduID0gXCJtaWRkbGVcIjtcclxuICAgICAgICAgICAgaW5wdXQuc3R5bGUuZmxleCA9IFwiMCAwIGF1dG9cIjtcclxuICAgICAgICAgICAgaW5wdXQubmFtZSA9IHRoaXMuaWQgPyB0aGlzLmlkIDogdGhpcy5fdW5pcXVlQ2F0ZWdvcnlOYW1lO1xyXG4gICAgICAgICAgICBpZiAoY2hvaWNlLnZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBpbnB1dC52YWx1ZSA9IGNob2ljZS52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoY2hvaWNlLnRpdGxlKSB7XHJcbiAgICAgICAgICAgICAgICBpbnB1dC5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIGNob2ljZS50aXRsZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGRlZmF1bHRWYWx1ZXMgJiYgY2hvaWNlLnZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZGVmYXVsdFZhbHVlcy5pbmRleE9mKGNob2ljZS52YWx1ZSkgPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlucHV0LmNoZWNrZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlucHV0Lm9uY2hhbmdlID0gZnVuY3Rpb24gKCkgeyBfdGhpcy52YWx1ZUNoYW5nZWQoKTsgfTtcclxuICAgICAgICAgICAgdGhpcy5fdG9nZ2xlSW5wdXRzLnB1c2goaW5wdXQpO1xyXG4gICAgICAgICAgICB2YXIgY29tcG91bmRJbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICAgIGNvbXBvdW5kSW5wdXQuc3R5bGUuZGlzcGxheSA9IFwiZmxleFwiO1xyXG4gICAgICAgICAgICBjb21wb3VuZElucHV0LnN0eWxlLmFsaWduSXRlbXMgPSBcImNlbnRlclwiO1xyXG4gICAgICAgICAgICBVdGlscy5hcHBlbmRDaGlsZChjb21wb3VuZElucHV0LCBpbnB1dCk7XHJcbiAgICAgICAgICAgIHZhciBsYWJlbCA9IG5ldyBMYWJlbCgpO1xyXG4gICAgICAgICAgICBsYWJlbC5zZXRQYXJlbnQodGhpcyk7XHJcbiAgICAgICAgICAgIGxhYmVsLmZvckVsZW1lbnRJZCA9IGlucHV0LmlkO1xyXG4gICAgICAgICAgICBsYWJlbC5ob3N0Q29uZmlnID0gdGhpcy5ob3N0Q29uZmlnO1xyXG4gICAgICAgICAgICBsYWJlbC50ZXh0ID0gY2hvaWNlLnRpdGxlID8gY2hvaWNlLnRpdGxlIDogXCJDaG9pY2UgXCIgKyB0aGlzLl90b2dnbGVJbnB1dHMubGVuZ3RoO1xyXG4gICAgICAgICAgICBsYWJlbC51c2VNYXJrZG93biA9IHNoYXJlZF8xLkdsb2JhbFNldHRpbmdzLnVzZU1hcmtkb3duSW5SYWRpb0J1dHRvbkFuZENoZWNrYm94O1xyXG4gICAgICAgICAgICBsYWJlbC53cmFwID0gdGhpcy53cmFwO1xyXG4gICAgICAgICAgICB2YXIgbGFiZWxFbGVtZW50ID0gbGFiZWwucmVuZGVyKCk7XHJcbiAgICAgICAgICAgIGlmIChsYWJlbEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgIGxhYmVsRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gXCJpbmxpbmUtYmxvY2tcIjtcclxuICAgICAgICAgICAgICAgIGxhYmVsRWxlbWVudC5zdHlsZS5mbGV4ID0gXCIxIDEgYXV0b1wiO1xyXG4gICAgICAgICAgICAgICAgbGFiZWxFbGVtZW50LnN0eWxlLm1hcmdpbkxlZnQgPSBcIjZweFwiO1xyXG4gICAgICAgICAgICAgICAgbGFiZWxFbGVtZW50LnN0eWxlLnZlcnRpY2FsQWxpZ24gPSBcIm1pZGRsZVwiO1xyXG4gICAgICAgICAgICAgICAgdmFyIHNwYWNlckVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICAgICAgc3BhY2VyRWxlbWVudC5zdHlsZS53aWR0aCA9IFwiNnB4XCI7XHJcbiAgICAgICAgICAgICAgICBVdGlscy5hcHBlbmRDaGlsZChjb21wb3VuZElucHV0LCBzcGFjZXJFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgIFV0aWxzLmFwcGVuZENoaWxkKGNvbXBvdW5kSW5wdXQsIGxhYmVsRWxlbWVudCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgVXRpbHMuYXBwZW5kQ2hpbGQoZWxlbWVudCwgY29tcG91bmRJbnB1dCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBlbGVtZW50O1xyXG4gICAgfTtcclxuICAgIENob2ljZVNldElucHV0LnByb3RvdHlwZS5pbnRlcm5hbFJlbmRlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMuX3VuaXF1ZUNhdGVnb3J5TmFtZSA9IENob2ljZVNldElucHV0LmdldFVuaXF1ZUNhdGVnb3J5TmFtZSgpO1xyXG4gICAgICAgIGlmICh0aGlzLmlzTXVsdGlTZWxlY3QpIHtcclxuICAgICAgICAgICAgLy8gUmVuZGVyIGFzIGEgbGlzdCBvZiB0b2dnbGUgaW5wdXRzXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnJlbmRlckNvbXB1bmRJbnB1dChcImFjLWNob2ljZVNldElucHV0LW11bHRpU2VsZWN0XCIsIFwiY2hlY2tib3hcIiwgdGhpcy5kZWZhdWx0VmFsdWUgPyB0aGlzLmRlZmF1bHRWYWx1ZS5zcGxpdCh0aGlzLmhvc3RDb25maWcuY2hvaWNlU2V0SW5wdXRWYWx1ZVNlcGFyYXRvcikgOiB1bmRlZmluZWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuc3R5bGUgPT09IFwiZXhwYW5kZWRcIikge1xyXG4gICAgICAgICAgICAgICAgLy8gUmVuZGVyIGFzIGEgc2VyaWVzIG9mIHJhZGlvIGJ1dHRvbnNcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJlbmRlckNvbXB1bmRJbnB1dChcImFjLWNob2ljZVNldElucHV0LWV4cGFuZGVkXCIsIFwicmFkaW9cIiwgdGhpcy5kZWZhdWx0VmFsdWUgPyBbdGhpcy5kZWZhdWx0VmFsdWVdIDogdW5kZWZpbmVkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIFJlbmRlciBhcyBhIGNvbWJvIGJveFxyXG4gICAgICAgICAgICAgICAgdGhpcy5fc2VsZWN0RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzZWxlY3RcIik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9zZWxlY3RFbGVtZW50LmNsYXNzTmFtZSA9IHRoaXMuaG9zdENvbmZpZy5tYWtlQ3NzQ2xhc3NOYW1lKFwiYWMtaW5wdXRcIiwgXCJhYy1tdWx0aWNob2ljZUlucHV0XCIsIFwiYWMtY2hvaWNlU2V0SW5wdXQtY29tcGFjdFwiKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3NlbGVjdEVsZW1lbnQuc3R5bGUud2lkdGggPSBcIjEwMCVcIjtcclxuICAgICAgICAgICAgICAgIHZhciBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwib3B0aW9uXCIpO1xyXG4gICAgICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIG9wdGlvbi5kaXNhYmxlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBvcHRpb24uaGlkZGVuID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIG9wdGlvbi52YWx1ZSA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5wbGFjZWhvbGRlcikge1xyXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbi50ZXh0ID0gdGhpcy5wbGFjZWhvbGRlcjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIFV0aWxzLmFwcGVuZENoaWxkKHRoaXMuX3NlbGVjdEVsZW1lbnQsIG9wdGlvbik7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gdGhpcy5jaG9pY2VzOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjaG9pY2UgPSBfYVtfaV07XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9wdGlvbl8xID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIm9wdGlvblwiKTtcclxuICAgICAgICAgICAgICAgICAgICBvcHRpb25fMS52YWx1ZSA9IGNob2ljZS52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICBvcHRpb25fMS50ZXh0ID0gY2hvaWNlLnRpdGxlO1xyXG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbl8xLnNldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxcIiwgY2hvaWNlLnRpdGxlKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2hvaWNlLnZhbHVlID09IHRoaXMuZGVmYXVsdFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbl8xLnNlbGVjdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgVXRpbHMuYXBwZW5kQ2hpbGQodGhpcy5fc2VsZWN0RWxlbWVudCwgb3B0aW9uXzEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5fc2VsZWN0RWxlbWVudC5vbmNoYW5nZSA9IGZ1bmN0aW9uICgpIHsgX3RoaXMudmFsdWVDaGFuZ2VkKCk7IH07XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc2VsZWN0RWxlbWVudDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBDaG9pY2VTZXRJbnB1dC5wcm90b3R5cGUuZ2V0SnNvblR5cGVOYW1lID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBcIklucHV0LkNob2ljZVNldFwiO1xyXG4gICAgfTtcclxuICAgIENob2ljZVNldElucHV0LnByb3RvdHlwZS5pbnRlcm5hbFZhbGlkYXRlUHJvcGVydGllcyA9IGZ1bmN0aW9uIChjb250ZXh0KSB7XHJcbiAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5pbnRlcm5hbFZhbGlkYXRlUHJvcGVydGllcy5jYWxsKHRoaXMsIGNvbnRleHQpO1xyXG4gICAgICAgIGlmICh0aGlzLmNob2ljZXMubGVuZ3RoID09IDApIHtcclxuICAgICAgICAgICAgY29udGV4dC5hZGRGYWlsdXJlKHRoaXMsIDIgLyogQ29sbGVjdGlvbkNhbnRCZUVtcHR5ICovLCBcIkFuIElucHV0LkNob2ljZVNldCBtdXN0IGhhdmUgYXQgbGVhc3Qgb25lIGNob2ljZSBkZWZpbmVkLlwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHRoaXMuY2hvaWNlczsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgdmFyIGNob2ljZSA9IF9hW19pXTtcclxuICAgICAgICAgICAgaWYgKCFjaG9pY2UudGl0bGUgfHwgIWNob2ljZS52YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgY29udGV4dC5hZGRGYWlsdXJlKHRoaXMsIDggLyogUHJvcGVydHlDYW50QmVOdWxsICovLCBcIkFsbCBjaG9pY2VzIGluIGFuIElucHV0LkNob2ljZVNldCBtdXN0IGhhdmUgdGhlaXIgdGl0bGUgYW5kIHZhbHVlIHByb3BlcnRpZXMgc2V0LlwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBDaG9pY2VTZXRJbnB1dC5wcm90b3R5cGUuaXNTZXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudmFsdWUgPyB0cnVlIDogZmFsc2U7XHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENob2ljZVNldElucHV0LnByb3RvdHlwZSwgXCJ2YWx1ZVwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5pc011bHRpU2VsZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0NvbXBhY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fc2VsZWN0RWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fc2VsZWN0RWxlbWVudC5zZWxlY3RlZEluZGV4ID4gMCA/IHRoaXMuX3NlbGVjdEVsZW1lbnQudmFsdWUgOiB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX3RvZ2dsZUlucHV0cyB8fCB0aGlzLl90b2dnbGVJbnB1dHMubGVuZ3RoID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHRoaXMuX3RvZ2dsZUlucHV0czsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRvZ2dsZUlucHV0ID0gX2FbX2ldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodG9nZ2xlSW5wdXQuY2hlY2tlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRvZ2dsZUlucHV0LnZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuX3RvZ2dsZUlucHV0cyB8fCB0aGlzLl90b2dnbGVJbnB1dHMubGVuZ3RoID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBfYiA9IDAsIF9jID0gdGhpcy5fdG9nZ2xlSW5wdXRzOyBfYiA8IF9jLmxlbmd0aDsgX2IrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0b2dnbGVJbnB1dCA9IF9jW19iXTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodG9nZ2xlSW5wdXQuY2hlY2tlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0ICE9IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSB0aGlzLmhvc3RDb25maWcuY2hvaWNlU2V0SW5wdXRWYWx1ZVNlcGFyYXRvcjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgKz0gdG9nZ2xlSW5wdXQudmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdCA/IHJlc3VsdCA6IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgQ2hvaWNlU2V0SW5wdXQudmFsdWVQcm9wZXJ0eSA9IG5ldyBzZXJpYWxpemF0aW9uXzEuU3RyaW5nUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzAsIFwidmFsdWVcIik7XHJcbiAgICBDaG9pY2VTZXRJbnB1dC5jaG9pY2VzUHJvcGVydHkgPSBuZXcgc2VyaWFsaXphdGlvbl8xLlNlcmlhbGl6YWJsZU9iamVjdENvbGxlY3Rpb25Qcm9wZXJ0eShzZXJpYWxpemF0aW9uXzEuVmVyc2lvbnMudjFfMCwgXCJjaG9pY2VzXCIsIENob2ljZSk7XHJcbiAgICBDaG9pY2VTZXRJbnB1dC5zdHlsZVByb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5WYWx1ZVNldFByb3BlcnR5KHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8wLCBcInN0eWxlXCIsIFtcclxuICAgICAgICB7IHZhbHVlOiBcImNvbXBhY3RcIiB9LFxyXG4gICAgICAgIHsgdmFsdWU6IFwiZXhwYW5kZWRcIiB9XHJcbiAgICBdLCBcImNvbXBhY3RcIik7XHJcbiAgICBDaG9pY2VTZXRJbnB1dC5pc011bHRpU2VsZWN0UHJvcGVydHkgPSBuZXcgc2VyaWFsaXphdGlvbl8xLkJvb2xQcm9wZXJ0eShzZXJpYWxpemF0aW9uXzEuVmVyc2lvbnMudjFfMCwgXCJpc011bHRpU2VsZWN0XCIsIGZhbHNlKTtcclxuICAgIENob2ljZVNldElucHV0LnBsYWNlaG9sZGVyUHJvcGVydHkgPSBuZXcgc2VyaWFsaXphdGlvbl8xLlN0cmluZ1Byb3BlcnR5KHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8wLCBcInBsYWNlaG9sZGVyXCIpO1xyXG4gICAgQ2hvaWNlU2V0SW5wdXQud3JhcFByb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5Cb29sUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzIsIFwid3JhcFwiLCBmYWxzZSk7XHJcbiAgICAvLyNlbmRyZWdpb25cclxuICAgIENob2ljZVNldElucHV0LnVuaXF1ZUNhdGVnb3J5Q291bnRlciA9IDA7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBzZXJpYWxpemF0aW9uXzEucHJvcGVydHkoQ2hvaWNlU2V0SW5wdXQudmFsdWVQcm9wZXJ0eSlcclxuICAgIF0sIENob2ljZVNldElucHV0LnByb3RvdHlwZSwgXCJkZWZhdWx0VmFsdWVcIiwgdm9pZCAwKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHNlcmlhbGl6YXRpb25fMS5wcm9wZXJ0eShDaG9pY2VTZXRJbnB1dC5zdHlsZVByb3BlcnR5KVxyXG4gICAgXSwgQ2hvaWNlU2V0SW5wdXQucHJvdG90eXBlLCBcInN0eWxlXCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBzZXJpYWxpemF0aW9uXzEucHJvcGVydHkoQ2hvaWNlU2V0SW5wdXQuaXNNdWx0aVNlbGVjdFByb3BlcnR5KVxyXG4gICAgXSwgQ2hvaWNlU2V0SW5wdXQucHJvdG90eXBlLCBcImlzTXVsdGlTZWxlY3RcIiwgdm9pZCAwKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHNlcmlhbGl6YXRpb25fMS5wcm9wZXJ0eShDaG9pY2VTZXRJbnB1dC5wbGFjZWhvbGRlclByb3BlcnR5KVxyXG4gICAgXSwgQ2hvaWNlU2V0SW5wdXQucHJvdG90eXBlLCBcInBsYWNlaG9sZGVyXCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBzZXJpYWxpemF0aW9uXzEucHJvcGVydHkoQ2hvaWNlU2V0SW5wdXQud3JhcFByb3BlcnR5KVxyXG4gICAgXSwgQ2hvaWNlU2V0SW5wdXQucHJvdG90eXBlLCBcIndyYXBcIiwgdm9pZCAwKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHNlcmlhbGl6YXRpb25fMS5wcm9wZXJ0eShDaG9pY2VTZXRJbnB1dC5jaG9pY2VzUHJvcGVydHkpXHJcbiAgICBdLCBDaG9pY2VTZXRJbnB1dC5wcm90b3R5cGUsIFwiY2hvaWNlc1wiLCB2b2lkIDApO1xyXG4gICAgcmV0dXJuIENob2ljZVNldElucHV0O1xyXG59KElucHV0KSk7XHJcbmV4cG9ydHMuQ2hvaWNlU2V0SW5wdXQgPSBDaG9pY2VTZXRJbnB1dDtcclxudmFyIE51bWJlcklucHV0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKE51bWJlcklucHV0LCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gTnVtYmVySW5wdXQoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgTnVtYmVySW5wdXQucHJvdG90eXBlLmludGVybmFsUmVuZGVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5fbnVtYmVySW5wdXRFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xyXG4gICAgICAgIHRoaXMuX251bWJlcklucHV0RWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsIFwibnVtYmVyXCIpO1xyXG4gICAgICAgIGlmICh0aGlzLm1pbikge1xyXG4gICAgICAgICAgICB0aGlzLl9udW1iZXJJbnB1dEVsZW1lbnQuc2V0QXR0cmlidXRlKFwibWluXCIsIHRoaXMubWluLnRvU3RyaW5nKCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5tYXgpIHtcclxuICAgICAgICAgICAgdGhpcy5fbnVtYmVySW5wdXRFbGVtZW50LnNldEF0dHJpYnV0ZShcIm1heFwiLCB0aGlzLm1heC50b1N0cmluZygpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fbnVtYmVySW5wdXRFbGVtZW50LmNsYXNzTmFtZSA9IHRoaXMuaG9zdENvbmZpZy5tYWtlQ3NzQ2xhc3NOYW1lKFwiYWMtaW5wdXRcIiwgXCJhYy1udW1iZXJJbnB1dFwiKTtcclxuICAgICAgICB0aGlzLl9udW1iZXJJbnB1dEVsZW1lbnQuc3R5bGUud2lkdGggPSBcIjEwMCVcIjtcclxuICAgICAgICB0aGlzLl9udW1iZXJJbnB1dEVsZW1lbnQudGFiSW5kZXggPSAwO1xyXG4gICAgICAgIGlmICh0aGlzLmRlZmF1bHRWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX251bWJlcklucHV0RWxlbWVudC52YWx1ZUFzTnVtYmVyID0gdGhpcy5kZWZhdWx0VmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLnBsYWNlaG9sZGVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX251bWJlcklucHV0RWxlbWVudC5wbGFjZWhvbGRlciA9IHRoaXMucGxhY2Vob2xkZXI7XHJcbiAgICAgICAgICAgIHRoaXMuX251bWJlcklucHV0RWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIHRoaXMucGxhY2Vob2xkZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLl9udW1iZXJJbnB1dEVsZW1lbnQub25pbnB1dCA9IGZ1bmN0aW9uICgpIHsgX3RoaXMudmFsdWVDaGFuZ2VkKCk7IH07XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX251bWJlcklucHV0RWxlbWVudDtcclxuICAgIH07XHJcbiAgICBOdW1iZXJJbnB1dC5wcm90b3R5cGUuZ2V0SnNvblR5cGVOYW1lID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBcIklucHV0Lk51bWJlclwiO1xyXG4gICAgfTtcclxuICAgIE51bWJlcklucHV0LnByb3RvdHlwZS5pc1NldCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy52YWx1ZSAhPT0gdW5kZWZpbmVkICYmICFpc05hTih0aGlzLnZhbHVlKTtcclxuICAgIH07XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTnVtYmVySW5wdXQucHJvdG90eXBlLCBcInZhbHVlXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX251bWJlcklucHV0RWxlbWVudCA/IHRoaXMuX251bWJlcklucHV0RWxlbWVudC52YWx1ZUFzTnVtYmVyIDogdW5kZWZpbmVkO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgLy8jcmVnaW9uIFNjaGVtYVxyXG4gICAgTnVtYmVySW5wdXQudmFsdWVQcm9wZXJ0eSA9IG5ldyBzZXJpYWxpemF0aW9uXzEuTnVtUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzAsIFwidmFsdWVcIik7XHJcbiAgICBOdW1iZXJJbnB1dC5wbGFjZWhvbGRlclByb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5TdHJpbmdQcm9wZXJ0eShzZXJpYWxpemF0aW9uXzEuVmVyc2lvbnMudjFfMCwgXCJwbGFjZWhvbGRlclwiKTtcclxuICAgIE51bWJlcklucHV0Lm1pblByb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5OdW1Qcm9wZXJ0eShzZXJpYWxpemF0aW9uXzEuVmVyc2lvbnMudjFfMCwgXCJtaW5cIik7XHJcbiAgICBOdW1iZXJJbnB1dC5tYXhQcm9wZXJ0eSA9IG5ldyBzZXJpYWxpemF0aW9uXzEuTnVtUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzAsIFwibWF4XCIpO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KE51bWJlcklucHV0LnZhbHVlUHJvcGVydHkpXHJcbiAgICBdLCBOdW1iZXJJbnB1dC5wcm90b3R5cGUsIFwiZGVmYXVsdFZhbHVlXCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBzZXJpYWxpemF0aW9uXzEucHJvcGVydHkoTnVtYmVySW5wdXQubWluUHJvcGVydHkpXHJcbiAgICBdLCBOdW1iZXJJbnB1dC5wcm90b3R5cGUsIFwibWluXCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBzZXJpYWxpemF0aW9uXzEucHJvcGVydHkoTnVtYmVySW5wdXQubWF4UHJvcGVydHkpXHJcbiAgICBdLCBOdW1iZXJJbnB1dC5wcm90b3R5cGUsIFwibWF4XCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBzZXJpYWxpemF0aW9uXzEucHJvcGVydHkoTnVtYmVySW5wdXQucGxhY2Vob2xkZXJQcm9wZXJ0eSlcclxuICAgIF0sIE51bWJlcklucHV0LnByb3RvdHlwZSwgXCJwbGFjZWhvbGRlclwiLCB2b2lkIDApO1xyXG4gICAgcmV0dXJuIE51bWJlcklucHV0O1xyXG59KElucHV0KSk7XHJcbmV4cG9ydHMuTnVtYmVySW5wdXQgPSBOdW1iZXJJbnB1dDtcclxudmFyIERhdGVJbnB1dCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhEYXRlSW5wdXQsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBEYXRlSW5wdXQoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgRGF0ZUlucHV0LnByb3RvdHlwZS5pbnRlcm5hbFJlbmRlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMuX2RhdGVJbnB1dEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XHJcbiAgICAgICAgdGhpcy5fZGF0ZUlucHV0RWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsIFwiZGF0ZVwiKTtcclxuICAgICAgICBpZiAodGhpcy5taW4pIHtcclxuICAgICAgICAgICAgdGhpcy5fZGF0ZUlucHV0RWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJtaW5cIiwgdGhpcy5taW4pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5tYXgpIHtcclxuICAgICAgICAgICAgdGhpcy5fZGF0ZUlucHV0RWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJtYXhcIiwgdGhpcy5tYXgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5wbGFjZWhvbGRlcikge1xyXG4gICAgICAgICAgICB0aGlzLl9kYXRlSW5wdXRFbGVtZW50LnBsYWNlaG9sZGVyID0gdGhpcy5wbGFjZWhvbGRlcjtcclxuICAgICAgICAgICAgdGhpcy5fZGF0ZUlucHV0RWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIHRoaXMucGxhY2Vob2xkZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLl9kYXRlSW5wdXRFbGVtZW50LmNsYXNzTmFtZSA9IHRoaXMuaG9zdENvbmZpZy5tYWtlQ3NzQ2xhc3NOYW1lKFwiYWMtaW5wdXRcIiwgXCJhYy1kYXRlSW5wdXRcIik7XHJcbiAgICAgICAgdGhpcy5fZGF0ZUlucHV0RWxlbWVudC5zdHlsZS53aWR0aCA9IFwiMTAwJVwiO1xyXG4gICAgICAgIHRoaXMuX2RhdGVJbnB1dEVsZW1lbnQub25pbnB1dCA9IGZ1bmN0aW9uICgpIHsgX3RoaXMudmFsdWVDaGFuZ2VkKCk7IH07XHJcbiAgICAgICAgaWYgKHRoaXMuZGVmYXVsdFZhbHVlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2RhdGVJbnB1dEVsZW1lbnQudmFsdWUgPSB0aGlzLmRlZmF1bHRWYWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGVJbnB1dEVsZW1lbnQ7XHJcbiAgICB9O1xyXG4gICAgRGF0ZUlucHV0LnByb3RvdHlwZS5nZXRKc29uVHlwZU5hbWUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIFwiSW5wdXQuRGF0ZVwiO1xyXG4gICAgfTtcclxuICAgIERhdGVJbnB1dC5wcm90b3R5cGUuaXNTZXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudmFsdWUgPyB0cnVlIDogZmFsc2U7XHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KERhdGVJbnB1dC5wcm90b3R5cGUsIFwidmFsdWVcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fZGF0ZUlucHV0RWxlbWVudCA/IHRoaXMuX2RhdGVJbnB1dEVsZW1lbnQudmFsdWUgOiB1bmRlZmluZWQ7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICAvLyNyZWdpb24gU2NoZW1hXHJcbiAgICBEYXRlSW5wdXQudmFsdWVQcm9wZXJ0eSA9IG5ldyBzZXJpYWxpemF0aW9uXzEuU3RyaW5nUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzAsIFwidmFsdWVcIik7XHJcbiAgICBEYXRlSW5wdXQucGxhY2Vob2xkZXJQcm9wZXJ0eSA9IG5ldyBzZXJpYWxpemF0aW9uXzEuU3RyaW5nUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzAsIFwicGxhY2Vob2xkZXJcIik7XHJcbiAgICBEYXRlSW5wdXQubWluUHJvcGVydHkgPSBuZXcgc2VyaWFsaXphdGlvbl8xLlN0cmluZ1Byb3BlcnR5KHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8wLCBcIm1pblwiKTtcclxuICAgIERhdGVJbnB1dC5tYXhQcm9wZXJ0eSA9IG5ldyBzZXJpYWxpemF0aW9uXzEuU3RyaW5nUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzAsIFwibWF4XCIpO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KERhdGVJbnB1dC52YWx1ZVByb3BlcnR5KVxyXG4gICAgXSwgRGF0ZUlucHV0LnByb3RvdHlwZSwgXCJkZWZhdWx0VmFsdWVcIiwgdm9pZCAwKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHNlcmlhbGl6YXRpb25fMS5wcm9wZXJ0eShEYXRlSW5wdXQubWluUHJvcGVydHkpXHJcbiAgICBdLCBEYXRlSW5wdXQucHJvdG90eXBlLCBcIm1pblwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KERhdGVJbnB1dC5tYXhQcm9wZXJ0eSlcclxuICAgIF0sIERhdGVJbnB1dC5wcm90b3R5cGUsIFwibWF4XCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBzZXJpYWxpemF0aW9uXzEucHJvcGVydHkoRGF0ZUlucHV0LnBsYWNlaG9sZGVyUHJvcGVydHkpXHJcbiAgICBdLCBEYXRlSW5wdXQucHJvdG90eXBlLCBcInBsYWNlaG9sZGVyXCIsIHZvaWQgMCk7XHJcbiAgICByZXR1cm4gRGF0ZUlucHV0O1xyXG59KElucHV0KSk7XHJcbmV4cG9ydHMuRGF0ZUlucHV0ID0gRGF0ZUlucHV0O1xyXG52YXIgVGltZVByb3BlcnR5ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKFRpbWVQcm9wZXJ0eSwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIFRpbWVQcm9wZXJ0eSh0YXJnZXRWZXJzaW9uLCBuYW1lKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgdGFyZ2V0VmVyc2lvbiwgbmFtZSwgZnVuY3Rpb24gKHNlbmRlciwgcHJvcGVydHksIHNvdXJjZSwgY29udGV4dCkge1xyXG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBzb3VyY2VbcHJvcGVydHkubmFtZV07XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUgJiYgL15bMC05XXsyfTpbMC05XXsyfSQvLnRlc3QodmFsdWUpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgICB9LCBmdW5jdGlvbiAoc2VuZGVyLCBwcm9wZXJ0eSwgdGFyZ2V0LCB2YWx1ZSwgY29udGV4dCkge1xyXG4gICAgICAgICAgICBjb250ZXh0LnNlcmlhbGl6ZVZhbHVlKHRhcmdldCwgcHJvcGVydHkubmFtZSwgdmFsdWUpO1xyXG4gICAgICAgIH0pIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMudGFyZ2V0VmVyc2lvbiA9IHRhcmdldFZlcnNpb247XHJcbiAgICAgICAgX3RoaXMubmFtZSA9IG5hbWU7XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIFRpbWVQcm9wZXJ0eTtcclxufShzZXJpYWxpemF0aW9uXzEuQ3VzdG9tUHJvcGVydHkpKTtcclxuZXhwb3J0cy5UaW1lUHJvcGVydHkgPSBUaW1lUHJvcGVydHk7XHJcbnZhciBUaW1lSW5wdXQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoVGltZUlucHV0LCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gVGltZUlucHV0KCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgIH1cclxuICAgIFRpbWVJbnB1dC5wcm90b3R5cGUuaW50ZXJuYWxSZW5kZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB0aGlzLl90aW1lSW5wdXRFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xyXG4gICAgICAgIHRoaXMuX3RpbWVJbnB1dEVsZW1lbnQuc2V0QXR0cmlidXRlKFwidHlwZVwiLCBcInRpbWVcIik7XHJcbiAgICAgICAgdGhpcy5fdGltZUlucHV0RWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJtaW5cIiwgdGhpcy5taW4pO1xyXG4gICAgICAgIHRoaXMuX3RpbWVJbnB1dEVsZW1lbnQuc2V0QXR0cmlidXRlKFwibWF4XCIsIHRoaXMubWF4KTtcclxuICAgICAgICB0aGlzLl90aW1lSW5wdXRFbGVtZW50LmNsYXNzTmFtZSA9IHRoaXMuaG9zdENvbmZpZy5tYWtlQ3NzQ2xhc3NOYW1lKFwiYWMtaW5wdXRcIiwgXCJhYy10aW1lSW5wdXRcIik7XHJcbiAgICAgICAgdGhpcy5fdGltZUlucHV0RWxlbWVudC5zdHlsZS53aWR0aCA9IFwiMTAwJVwiO1xyXG4gICAgICAgIHRoaXMuX3RpbWVJbnB1dEVsZW1lbnQub25pbnB1dCA9IGZ1bmN0aW9uICgpIHsgX3RoaXMudmFsdWVDaGFuZ2VkKCk7IH07XHJcbiAgICAgICAgaWYgKHRoaXMucGxhY2Vob2xkZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5fdGltZUlucHV0RWxlbWVudC5wbGFjZWhvbGRlciA9IHRoaXMucGxhY2Vob2xkZXI7XHJcbiAgICAgICAgICAgIHRoaXMuX3RpbWVJbnB1dEVsZW1lbnQuc2V0QXR0cmlidXRlKFwiYXJpYS1sYWJlbFwiLCB0aGlzLnBsYWNlaG9sZGVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuZGVmYXVsdFZhbHVlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3RpbWVJbnB1dEVsZW1lbnQudmFsdWUgPSB0aGlzLmRlZmF1bHRWYWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RpbWVJbnB1dEVsZW1lbnQ7XHJcbiAgICB9O1xyXG4gICAgVGltZUlucHV0LnByb3RvdHlwZS5nZXRKc29uVHlwZU5hbWUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIFwiSW5wdXQuVGltZVwiO1xyXG4gICAgfTtcclxuICAgIFRpbWVJbnB1dC5wcm90b3R5cGUuaXNTZXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudmFsdWUgPyB0cnVlIDogZmFsc2U7XHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFRpbWVJbnB1dC5wcm90b3R5cGUsIFwidmFsdWVcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fdGltZUlucHV0RWxlbWVudCA/IHRoaXMuX3RpbWVJbnB1dEVsZW1lbnQudmFsdWUgOiB1bmRlZmluZWQ7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICAvLyNyZWdpb24gU2NoZW1hXHJcbiAgICBUaW1lSW5wdXQudmFsdWVQcm9wZXJ0eSA9IG5ldyBUaW1lUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzAsIFwidmFsdWVcIik7XHJcbiAgICBUaW1lSW5wdXQucGxhY2Vob2xkZXJQcm9wZXJ0eSA9IG5ldyBzZXJpYWxpemF0aW9uXzEuU3RyaW5nUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzAsIFwicGxhY2Vob2xkZXJcIik7XHJcbiAgICBUaW1lSW5wdXQubWluUHJvcGVydHkgPSBuZXcgVGltZVByb3BlcnR5KHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8wLCBcIm1pblwiKTtcclxuICAgIFRpbWVJbnB1dC5tYXhQcm9wZXJ0eSA9IG5ldyBUaW1lUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzAsIFwibWF4XCIpO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KFRpbWVJbnB1dC52YWx1ZVByb3BlcnR5KVxyXG4gICAgXSwgVGltZUlucHV0LnByb3RvdHlwZSwgXCJkZWZhdWx0VmFsdWVcIiwgdm9pZCAwKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHNlcmlhbGl6YXRpb25fMS5wcm9wZXJ0eShUaW1lSW5wdXQubWluUHJvcGVydHkpXHJcbiAgICBdLCBUaW1lSW5wdXQucHJvdG90eXBlLCBcIm1pblwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KFRpbWVJbnB1dC5tYXhQcm9wZXJ0eSlcclxuICAgIF0sIFRpbWVJbnB1dC5wcm90b3R5cGUsIFwibWF4XCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBzZXJpYWxpemF0aW9uXzEucHJvcGVydHkoVGltZUlucHV0LnBsYWNlaG9sZGVyUHJvcGVydHkpXHJcbiAgICBdLCBUaW1lSW5wdXQucHJvdG90eXBlLCBcInBsYWNlaG9sZGVyXCIsIHZvaWQgMCk7XHJcbiAgICByZXR1cm4gVGltZUlucHV0O1xyXG59KElucHV0KSk7XHJcbmV4cG9ydHMuVGltZUlucHV0ID0gVGltZUlucHV0O1xyXG52YXIgQWN0aW9uQnV0dG9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQWN0aW9uQnV0dG9uKGFjdGlvbiwgcGFyZW50Q29udGFpbmVyU3R5bGUpIHtcclxuICAgICAgICB0aGlzLl9zdGF0ZSA9IDAgLyogTm9ybWFsICovO1xyXG4gICAgICAgIHRoaXMuYWN0aW9uID0gYWN0aW9uO1xyXG4gICAgICAgIHRoaXMuX3BhcmVudENvbnRhaW5lclN0eWxlID0gcGFyZW50Q29udGFpbmVyU3R5bGU7XHJcbiAgICB9XHJcbiAgICBBY3Rpb25CdXR0b24ucHJvdG90eXBlLnVwZGF0ZUNzc1N0eWxlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBfYSwgX2I7XHJcbiAgICAgICAgaWYgKHRoaXMuYWN0aW9uLnBhcmVudCAmJiB0aGlzLmFjdGlvbi5yZW5kZXJlZEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgdmFyIGhvc3RDb25maWcgPSB0aGlzLmFjdGlvbi5wYXJlbnQuaG9zdENvbmZpZztcclxuICAgICAgICAgICAgdGhpcy5hY3Rpb24ucmVuZGVyZWRFbGVtZW50LmNsYXNzTmFtZSA9IGhvc3RDb25maWcubWFrZUNzc0NsYXNzTmFtZShcImFjLXB1c2hCdXR0b25cIik7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9wYXJlbnRDb250YWluZXJTdHlsZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hY3Rpb24ucmVuZGVyZWRFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJzdHlsZS1cIiArIHRoaXMuX3BhcmVudENvbnRhaW5lclN0eWxlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmFjdGlvbi51cGRhdGVBY3Rpb25CdXR0b25Dc3NTdHlsZSh0aGlzLmFjdGlvbi5yZW5kZXJlZEVsZW1lbnQpO1xyXG4gICAgICAgICAgICB0aGlzLmFjdGlvbi5yZW5kZXJlZEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShob3N0Q29uZmlnLm1ha2VDc3NDbGFzc05hbWUoXCJleHBhbmRlZFwiKSk7XHJcbiAgICAgICAgICAgIHRoaXMuYWN0aW9uLnJlbmRlcmVkRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGhvc3RDb25maWcubWFrZUNzc0NsYXNzTmFtZShcInN1YmR1ZWRcIikpO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHRoaXMuX3N0YXRlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDEgLyogRXhwYW5kZWQgKi86XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3Rpb24ucmVuZGVyZWRFbGVtZW50LmNsYXNzTGlzdC5hZGQoaG9zdENvbmZpZy5tYWtlQ3NzQ2xhc3NOYW1lKFwiZXhwYW5kZWRcIikpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAyIC8qIFN1YmR1ZWQgKi86XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3Rpb24ucmVuZGVyZWRFbGVtZW50LmNsYXNzTGlzdC5hZGQoaG9zdENvbmZpZy5tYWtlQ3NzQ2xhc3NOYW1lKFwic3ViZHVlZFwiKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMuYWN0aW9uLnN0eWxlKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5hY3Rpb24uc3R5bGUgPT09IEVudW1zLkFjdGlvblN0eWxlLlBvc2l0aXZlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgKF9hID0gdGhpcy5hY3Rpb24ucmVuZGVyZWRFbGVtZW50LmNsYXNzTGlzdCkuYWRkLmFwcGx5KF9hLCBob3N0Q29uZmlnLm1ha2VDc3NDbGFzc05hbWVzKFwicHJpbWFyeVwiLCBcInN0eWxlLXBvc2l0aXZlXCIpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIChfYiA9IHRoaXMuYWN0aW9uLnJlbmRlcmVkRWxlbWVudC5jbGFzc0xpc3QpLmFkZC5hcHBseShfYiwgaG9zdENvbmZpZy5tYWtlQ3NzQ2xhc3NOYW1lcyhcInN0eWxlLVwiICsgdGhpcy5hY3Rpb24uc3R5bGUudG9Mb3dlckNhc2UoKSkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEFjdGlvbkJ1dHRvbi5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5hY3Rpb24ucmVuZGVyKCk7XHJcbiAgICAgICAgaWYgKHRoaXMuYWN0aW9uLnJlbmRlcmVkRWxlbWVudCkge1xyXG4gICAgICAgICAgICB0aGlzLmFjdGlvbi5yZW5kZXJlZEVsZW1lbnQub25jbGljayA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgICAgICBlLmNhbmNlbEJ1YmJsZSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5jbGljaygpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUNzc1N0eWxlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEFjdGlvbkJ1dHRvbi5wcm90b3R5cGUuY2xpY2sgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMub25DbGljayAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMub25DbGljayh0aGlzKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEFjdGlvbkJ1dHRvbi5wcm90b3R5cGUsIFwic3RhdGVcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fc3RhdGU7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgICAgICB0aGlzLl9zdGF0ZSA9IHZhbHVlO1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUNzc1N0eWxlKCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gQWN0aW9uQnV0dG9uO1xyXG59KCkpO1xyXG52YXIgQWN0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKEFjdGlvbiwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIEFjdGlvbigpIHtcclxuICAgICAgICAvLyNyZWdpb24gU2NoZW1hXHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMuc3R5bGUgPSBFbnVtcy5BY3Rpb25TdHlsZS5EZWZhdWx0O1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIEFjdGlvbi5wcm90b3R5cGUuYWRkQ3NzQ2xhc3NlcyA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XHJcbiAgICAgICAgLy8gRG8gbm90aGluZyBpbiBiYXNlIGltcGxlbWVudGF0aW9uXHJcbiAgICB9O1xyXG4gICAgQWN0aW9uLnByb3RvdHlwZS5pbnRlcm5hbEdldFJlZmVyZW5jZWRJbnB1dHMgPSBmdW5jdGlvbiAoYWxsSW5wdXRzKSB7XHJcbiAgICAgICAgcmV0dXJuIHt9O1xyXG4gICAgfTtcclxuICAgIEFjdGlvbi5wcm90b3R5cGUuaW50ZXJuYWxQcmVwYXJlRm9yRXhlY3V0aW9uID0gZnVuY3Rpb24gKGlucHV0cykge1xyXG4gICAgICAgIC8vIERvIG5vdGhpbmcgaW4gYmFzZSBpbXBsZW1lbnRhdGlvblxyXG4gICAgfTtcclxuICAgIEFjdGlvbi5wcm90b3R5cGUuaW50ZXJuYWxWYWxpZGF0ZUlucHV0cyA9IGZ1bmN0aW9uIChyZWZlcmVuY2VkSW5wdXRzKSB7XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IFtdO1xyXG4gICAgICAgIGlmIChzaGFyZWRfMS5HbG9iYWxTZXR0aW5ncy51c2VCdWlsdEluSW5wdXRWYWxpZGF0aW9uICYmICF0aGlzLmlnbm9yZUlucHV0VmFsaWRhdGlvbiAmJiByZWZlcmVuY2VkSW5wdXRzKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSBPYmplY3Qua2V5cyhyZWZlcmVuY2VkSW5wdXRzKTsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBrZXkgPSBfYVtfaV07XHJcbiAgICAgICAgICAgICAgICB2YXIgaW5wdXQgPSByZWZlcmVuY2VkSW5wdXRzW2tleV07XHJcbiAgICAgICAgICAgICAgICBpZiAoIWlucHV0LnZhbGlkYXRlVmFsdWUoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGlucHV0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuICAgIEFjdGlvbi5wcm90b3R5cGUuZ2V0SHJlZiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gXCJcIjtcclxuICAgIH07XHJcbiAgICBBY3Rpb24ucHJvdG90eXBlLnVwZGF0ZUFjdGlvbkJ1dHRvbkNzc1N0eWxlID0gZnVuY3Rpb24gKGFjdGlvbkJ1dHRvbkVsZW1lbnQpIHtcclxuICAgICAgICAvLyBEbyBub3RoaW5nIGluIGJhc2UgaW1wbGVtZW50YXRpb25cclxuICAgIH07XHJcbiAgICBBY3Rpb24ucHJvdG90eXBlLnBhcnNlID0gZnVuY3Rpb24gKHNvdXJjZSwgY29udGV4dCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIucHJvdG90eXBlLnBhcnNlLmNhbGwodGhpcywgc291cmNlLCBjb250ZXh0ID8gY29udGV4dCA6IG5ldyBTZXJpYWxpemF0aW9uQ29udGV4dCgpKTtcclxuICAgIH07XHJcbiAgICBBY3Rpb24ucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uIChjb250ZXh0KSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlci5wcm90b3R5cGUudG9KU09OLmNhbGwodGhpcywgY29udGV4dCA/IGNvbnRleHQgOiBuZXcgU2VyaWFsaXphdGlvbkNvbnRleHQoKSk7XHJcbiAgICB9O1xyXG4gICAgQWN0aW9uLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoYmFzZUNzc0NsYXNzKSB7XHJcbiAgICAgICAgaWYgKGJhc2VDc3NDbGFzcyA9PT0gdm9pZCAwKSB7IGJhc2VDc3NDbGFzcyA9IFwiYWMtcHVzaEJ1dHRvblwiOyB9XHJcbiAgICAgICAgLy8gQ2FjaGUgaG9zdENvbmZpZyBmb3IgcGVyZlxyXG4gICAgICAgIHZhciBob3N0Q29uZmlnID0gdGhpcy5ob3N0Q29uZmlnO1xyXG4gICAgICAgIHZhciBidXR0b25FbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImJ1dHRvblwiKTtcclxuICAgICAgICB0aGlzLmFkZENzc0NsYXNzZXMoYnV0dG9uRWxlbWVudCk7XHJcbiAgICAgICAgaWYgKHRoaXMudGl0bGUpIHtcclxuICAgICAgICAgICAgYnV0dG9uRWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIHRoaXMudGl0bGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBidXR0b25FbGVtZW50LnR5cGUgPSBcImJ1dHRvblwiO1xyXG4gICAgICAgIGJ1dHRvbkVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IFwiZmxleFwiO1xyXG4gICAgICAgIGJ1dHRvbkVsZW1lbnQuc3R5bGUuYWxpZ25JdGVtcyA9IFwiY2VudGVyXCI7XHJcbiAgICAgICAgYnV0dG9uRWxlbWVudC5zdHlsZS5qdXN0aWZ5Q29udGVudCA9IFwiY2VudGVyXCI7XHJcbiAgICAgICAgdmFyIHRpdGxlRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgdGl0bGVFbGVtZW50LnN0eWxlLm92ZXJmbG93ID0gXCJoaWRkZW5cIjtcclxuICAgICAgICB0aXRsZUVsZW1lbnQuc3R5bGUudGV4dE92ZXJmbG93ID0gXCJlbGxpcHNpc1wiO1xyXG4gICAgICAgIGlmICghKGhvc3RDb25maWcuYWN0aW9ucy5pY29uUGxhY2VtZW50ID09IEVudW1zLkFjdGlvbkljb25QbGFjZW1lbnQuQWJvdmVUaXRsZSB8fCBob3N0Q29uZmlnLmFjdGlvbnMuYWxsb3dUaXRsZVRvV3JhcCkpIHtcclxuICAgICAgICAgICAgdGl0bGVFbGVtZW50LnN0eWxlLndoaXRlU3BhY2UgPSBcIm5vd3JhcFwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy50aXRsZSkge1xyXG4gICAgICAgICAgICB0aXRsZUVsZW1lbnQuaW5uZXJUZXh0ID0gdGhpcy50aXRsZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCF0aGlzLmljb25VcmwpIHtcclxuICAgICAgICAgICAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwibm9JY29uXCIpO1xyXG4gICAgICAgICAgICBidXR0b25FbGVtZW50LmFwcGVuZENoaWxkKHRpdGxlRWxlbWVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB2YXIgaWNvbkVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW1nXCIpO1xyXG4gICAgICAgICAgICBpY29uRWxlbWVudC5zcmMgPSB0aGlzLmljb25Vcmw7XHJcbiAgICAgICAgICAgIGljb25FbGVtZW50LnN0eWxlLndpZHRoID0gaG9zdENvbmZpZy5hY3Rpb25zLmljb25TaXplICsgXCJweFwiO1xyXG4gICAgICAgICAgICBpY29uRWxlbWVudC5zdHlsZS5oZWlnaHQgPSBob3N0Q29uZmlnLmFjdGlvbnMuaWNvblNpemUgKyBcInB4XCI7XHJcbiAgICAgICAgICAgIGljb25FbGVtZW50LnN0eWxlLmZsZXggPSBcIjAgMCBhdXRvXCI7XHJcbiAgICAgICAgICAgIGlmIChob3N0Q29uZmlnLmFjdGlvbnMuaWNvblBsYWNlbWVudCA9PSBFbnVtcy5BY3Rpb25JY29uUGxhY2VtZW50LkFib3ZlVGl0bGUpIHtcclxuICAgICAgICAgICAgICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImljb25BYm92ZVwiKTtcclxuICAgICAgICAgICAgICAgIGJ1dHRvbkVsZW1lbnQuc3R5bGUuZmxleERpcmVjdGlvbiA9IFwiY29sdW1uXCI7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy50aXRsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGljb25FbGVtZW50LnN0eWxlLm1hcmdpbkJvdHRvbSA9IFwiNnB4XCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJpY29uTGVmdFwiKTtcclxuICAgICAgICAgICAgICAgIGljb25FbGVtZW50LnN0eWxlLm1heEhlaWdodCA9IFwiMTAwJVwiO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMudGl0bGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpY29uRWxlbWVudC5zdHlsZS5tYXJnaW5SaWdodCA9IFwiNnB4XCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYnV0dG9uRWxlbWVudC5hcHBlbmRDaGlsZChpY29uRWxlbWVudCk7XHJcbiAgICAgICAgICAgIGJ1dHRvbkVsZW1lbnQuYXBwZW5kQ2hpbGQodGl0bGVFbGVtZW50KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fcmVuZGVyZWRFbGVtZW50ID0gYnV0dG9uRWxlbWVudDtcclxuICAgIH07XHJcbiAgICBBY3Rpb24ucHJvdG90eXBlLmV4ZWN1dGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMub25FeGVjdXRlKSB7XHJcbiAgICAgICAgICAgIHRoaXMub25FeGVjdXRlKHRoaXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByYWlzZUV4ZWN1dGVBY3Rpb25FdmVudCh0aGlzKTtcclxuICAgIH07XHJcbiAgICBBY3Rpb24ucHJvdG90eXBlLnByZXBhcmVGb3JFeGVjdXRpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHJlZmVyZW5jZWRJbnB1dHMgPSB0aGlzLmdldFJlZmVyZW5jZWRJbnB1dHMoKTtcclxuICAgICAgICBpZiAodGhpcy5pbnRlcm5hbFZhbGlkYXRlSW5wdXRzKHJlZmVyZW5jZWRJbnB1dHMpLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmludGVybmFsUHJlcGFyZUZvckV4ZWN1dGlvbihyZWZlcmVuY2VkSW5wdXRzKTtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH07XHJcbiAgICA7XHJcbiAgICBBY3Rpb24ucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAodGhpcy5fYWN0aW9uQ29sbGVjdGlvbikge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fYWN0aW9uQ29sbGVjdGlvbi5yZW1vdmVBY3Rpb24odGhpcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH07XHJcbiAgICBBY3Rpb24ucHJvdG90eXBlLmdldEFsbElucHV0cyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gW107XHJcbiAgICB9O1xyXG4gICAgQWN0aW9uLnByb3RvdHlwZS5nZXRSZXNvdXJjZUluZm9ybWF0aW9uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmljb25VcmwgPyBbeyB1cmw6IHRoaXMuaWNvblVybCwgbWltZVR5cGU6IFwiaW1hZ2VcIiB9XSA6IFtdO1xyXG4gICAgfTtcclxuICAgIEFjdGlvbi5wcm90b3R5cGUuZ2V0QWN0aW9uQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmlkID09PSBpZCA/IHRoaXMgOiB1bmRlZmluZWQ7XHJcbiAgICB9O1xyXG4gICAgQWN0aW9uLnByb3RvdHlwZS5nZXRSZWZlcmVuY2VkSW5wdXRzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnBhcmVudCA/IHRoaXMuaW50ZXJuYWxHZXRSZWZlcmVuY2VkSW5wdXRzKHRoaXMucGFyZW50LmdldFJvb3RFbGVtZW50KCkuZ2V0QWxsSW5wdXRzKCkpIDogdW5kZWZpbmVkO1xyXG4gICAgfTtcclxuICAgIEFjdGlvbi5wcm90b3R5cGUudmFsaWRhdGVJbnB1dHMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW50ZXJuYWxWYWxpZGF0ZUlucHV0cyh0aGlzLmdldFJlZmVyZW5jZWRJbnB1dHMoKSk7XHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEFjdGlvbi5wcm90b3R5cGUsIFwiaXNQcmltYXJ5XCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3R5bGUgPT0gRW51bXMuQWN0aW9uU3R5bGUuUG9zaXRpdmU7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgICAgICBpZiAodmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc3R5bGUgPSBFbnVtcy5BY3Rpb25TdHlsZS5Qb3NpdGl2ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0eWxlID09IEVudW1zLkFjdGlvblN0eWxlLlBvc2l0aXZlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zdHlsZSA9IEVudW1zLkFjdGlvblN0eWxlLkRlZmF1bHQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShBY3Rpb24ucHJvdG90eXBlLCBcImlnbm9yZUlucHV0VmFsaWRhdGlvblwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEFjdGlvbi5wcm90b3R5cGUsIFwiaG9zdENvbmZpZ1wiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnBhcmVudCA/IHRoaXMucGFyZW50Lmhvc3RDb25maWcgOiBob3N0X2NvbmZpZ18xLmRlZmF1bHRIb3N0Q29uZmlnO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEFjdGlvbi5wcm90b3R5cGUsIFwicGFyZW50XCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BhcmVudDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIEFjdGlvbi50aXRsZVByb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5TdHJpbmdQcm9wZXJ0eShzZXJpYWxpemF0aW9uXzEuVmVyc2lvbnMudjFfMCwgXCJ0aXRsZVwiKTtcclxuICAgIEFjdGlvbi5pY29uVXJsUHJvcGVydHkgPSBuZXcgc2VyaWFsaXphdGlvbl8xLlN0cmluZ1Byb3BlcnR5KHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8xLCBcImljb25VcmxcIik7XHJcbiAgICBBY3Rpb24uc3R5bGVQcm9wZXJ0eSA9IG5ldyBzZXJpYWxpemF0aW9uXzEuVmFsdWVTZXRQcm9wZXJ0eShzZXJpYWxpemF0aW9uXzEuVmVyc2lvbnMudjFfMiwgXCJzdHlsZVwiLCBbXHJcbiAgICAgICAgeyB2YWx1ZTogRW51bXMuQWN0aW9uU3R5bGUuRGVmYXVsdCB9LFxyXG4gICAgICAgIHsgdmFsdWU6IEVudW1zLkFjdGlvblN0eWxlLlBvc2l0aXZlIH0sXHJcbiAgICAgICAgeyB2YWx1ZTogRW51bXMuQWN0aW9uU3R5bGUuRGVzdHJ1Y3RpdmUgfVxyXG4gICAgXSwgRW51bXMuQWN0aW9uU3R5bGUuRGVmYXVsdCk7XHJcbiAgICAvLyBUT0RPOiBSZXZpc2UgdGhpcyB3aGVuIGZpbmFsaXppbmcgaW5wdXQgdmFsaWRhdGlvblxyXG4gICAgQWN0aW9uLmlnbm9yZUlucHV0VmFsaWRhdGlvblByb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5Cb29sUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnZOZXh0LCBcImlnbm9yZUlucHV0VmFsaWRhdGlvblwiLCBmYWxzZSk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBzZXJpYWxpemF0aW9uXzEucHJvcGVydHkoQWN0aW9uLnRpdGxlUHJvcGVydHkpXHJcbiAgICBdLCBBY3Rpb24ucHJvdG90eXBlLCBcInRpdGxlXCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBzZXJpYWxpemF0aW9uXzEucHJvcGVydHkoQWN0aW9uLmljb25VcmxQcm9wZXJ0eSlcclxuICAgIF0sIEFjdGlvbi5wcm90b3R5cGUsIFwiaWNvblVybFwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KEFjdGlvbi5zdHlsZVByb3BlcnR5KVxyXG4gICAgXSwgQWN0aW9uLnByb3RvdHlwZSwgXCJzdHlsZVwiLCB2b2lkIDApO1xyXG4gICAgcmV0dXJuIEFjdGlvbjtcclxufShjYXJkX29iamVjdF8xLkNhcmRPYmplY3QpKTtcclxuZXhwb3J0cy5BY3Rpb24gPSBBY3Rpb247XHJcbnZhciBTdWJtaXRBY3Rpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoU3VibWl0QWN0aW9uLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gU3VibWl0QWN0aW9uKCkge1xyXG4gICAgICAgIC8vI3JlZ2lvbiBTY2hlbWFcclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgICAgICBfdGhpcy5faWdub3JlSW5wdXRWYWxpZGF0aW9uID0gZmFsc2U7XHJcbiAgICAgICAgX3RoaXMuX2lzUHJlcGFyZWQgPSBmYWxzZTtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICBTdWJtaXRBY3Rpb24ucHJvdG90eXBlLmludGVybmFsR2V0UmVmZXJlbmNlZElucHV0cyA9IGZ1bmN0aW9uIChhbGxJbnB1dHMpIHtcclxuICAgICAgICB2YXIgcmVzdWx0ID0ge307XHJcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBhbGxJbnB1dHNfMSA9IGFsbElucHV0czsgX2kgPCBhbGxJbnB1dHNfMS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgdmFyIGlucHV0ID0gYWxsSW5wdXRzXzFbX2ldO1xyXG4gICAgICAgICAgICBpZiAoaW5wdXQuaWQpIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdFtpbnB1dC5pZF0gPSBpbnB1dDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuICAgIFN1Ym1pdEFjdGlvbi5wcm90b3R5cGUuaW50ZXJuYWxQcmVwYXJlRm9yRXhlY3V0aW9uID0gZnVuY3Rpb24gKGlucHV0cykge1xyXG4gICAgICAgIGlmICh0aGlzLl9vcmlnaW5hbERhdGEpIHtcclxuICAgICAgICAgICAgdGhpcy5fcHJvY2Vzc2VkRGF0YSA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkodGhpcy5fb3JpZ2luYWxEYXRhKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9wcm9jZXNzZWREYXRhID0ge307XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLl9wcm9jZXNzZWREYXRhICYmIGlucHV0cykge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gT2JqZWN0LmtleXMoaW5wdXRzKTsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBrZXkgPSBfYVtfaV07XHJcbiAgICAgICAgICAgICAgICB2YXIgaW5wdXQgPSBpbnB1dHNba2V5XTtcclxuICAgICAgICAgICAgICAgIGlmIChpbnB1dC5pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Byb2Nlc3NlZERhdGFbaW5wdXQuaWRdID0gaW5wdXQudmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5faXNQcmVwYXJlZCA9IHRydWU7XHJcbiAgICB9O1xyXG4gICAgU3VibWl0QWN0aW9uLnByb3RvdHlwZS5nZXRKc29uVHlwZU5hbWUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIFN1Ym1pdEFjdGlvbi5Kc29uVHlwZU5hbWU7XHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFN1Ym1pdEFjdGlvbi5wcm90b3R5cGUsIFwiaWdub3JlSW5wdXRWYWxpZGF0aW9uXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lnbm9yZUlucHV0VmFsaWRhdGlvbjtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2lnbm9yZUlucHV0VmFsaWRhdGlvbiA9IHZhbHVlO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFN1Ym1pdEFjdGlvbi5wcm90b3R5cGUsIFwiZGF0YVwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9pc1ByZXBhcmVkID8gdGhpcy5fcHJvY2Vzc2VkRGF0YSA6IHRoaXMuX29yaWdpbmFsRGF0YTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX29yaWdpbmFsRGF0YSA9IHZhbHVlO1xyXG4gICAgICAgICAgICB0aGlzLl9pc1ByZXBhcmVkID0gZmFsc2U7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBTdWJtaXRBY3Rpb24uZGF0YVByb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5Qcm9wZXJ0eURlZmluaXRpb24oc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzAsIFwiZGF0YVwiKTtcclxuICAgIC8vI2VuZHJlZ2lvblxyXG4gICAgLy8gTm90ZSB0aGUgXCJ3ZWlyZFwiIHdheSB0aGlzIGZpZWxkIGlzIGRlY2xhcmVkIGlzIHRvIHdvcmsgYXJvdW5kIGEgYnJlYWtpbmdcclxuICAgIC8vIGNoYW5nZSBpbnRyb2R1Y2VkIGluIFRTIDMuMSB3cnQgZC50cyBnZW5lcmF0aW9uLiBETyBOT1QgQ0hBTkdFXHJcbiAgICBTdWJtaXRBY3Rpb24uSnNvblR5cGVOYW1lID0gXCJBY3Rpb24uU3VibWl0XCI7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBzZXJpYWxpemF0aW9uXzEucHJvcGVydHkoU3VibWl0QWN0aW9uLmRhdGFQcm9wZXJ0eSlcclxuICAgIF0sIFN1Ym1pdEFjdGlvbi5wcm90b3R5cGUsIFwiX29yaWdpbmFsRGF0YVwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KEFjdGlvbi5pZ25vcmVJbnB1dFZhbGlkYXRpb25Qcm9wZXJ0eSlcclxuICAgIF0sIFN1Ym1pdEFjdGlvbi5wcm90b3R5cGUsIFwiX2lnbm9yZUlucHV0VmFsaWRhdGlvblwiLCB2b2lkIDApO1xyXG4gICAgcmV0dXJuIFN1Ym1pdEFjdGlvbjtcclxufShBY3Rpb24pKTtcclxuZXhwb3J0cy5TdWJtaXRBY3Rpb24gPSBTdWJtaXRBY3Rpb247XHJcbnZhciBPcGVuVXJsQWN0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKE9wZW5VcmxBY3Rpb24sIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBPcGVuVXJsQWN0aW9uKCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgIH1cclxuICAgIE9wZW5VcmxBY3Rpb24ucHJvdG90eXBlLmdldEpzb25UeXBlTmFtZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gT3BlblVybEFjdGlvbi5Kc29uVHlwZU5hbWU7XHJcbiAgICB9O1xyXG4gICAgT3BlblVybEFjdGlvbi5wcm90b3R5cGUuaW50ZXJuYWxWYWxpZGF0ZVByb3BlcnRpZXMgPSBmdW5jdGlvbiAoY29udGV4dCkge1xyXG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUuaW50ZXJuYWxWYWxpZGF0ZVByb3BlcnRpZXMuY2FsbCh0aGlzLCBjb250ZXh0KTtcclxuICAgICAgICBpZiAoIXRoaXMudXJsKSB7XHJcbiAgICAgICAgICAgIGNvbnRleHQuYWRkRmFpbHVyZSh0aGlzLCA4IC8qIFByb3BlcnR5Q2FudEJlTnVsbCAqLywgXCJBbiBBY3Rpb24uT3BlblVybCBtdXN0IGhhdmUgaXRzIHVybCBwcm9wZXJ0eSBzZXQuXCIpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBPcGVuVXJsQWN0aW9uLnByb3RvdHlwZS5nZXRIcmVmID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnVybDtcclxuICAgIH07XHJcbiAgICAvLyNyZWdpb24gU2NoZW1hXHJcbiAgICBPcGVuVXJsQWN0aW9uLnVybFByb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5TdHJpbmdQcm9wZXJ0eShzZXJpYWxpemF0aW9uXzEuVmVyc2lvbnMudjFfMCwgXCJ1cmxcIik7XHJcbiAgICAvLyNlbmRyZWdpb25cclxuICAgIC8vIE5vdGUgdGhlIFwid2VpcmRcIiB3YXkgdGhpcyBmaWVsZCBpcyBkZWNsYXJlZCBpcyB0byB3b3JrIGFyb3VuZCBhIGJyZWFraW5nXHJcbiAgICAvLyBjaGFuZ2UgaW50cm9kdWNlZCBpbiBUUyAzLjEgd3J0IGQudHMgZ2VuZXJhdGlvbi4gRE8gTk9UIENIQU5HRVxyXG4gICAgT3BlblVybEFjdGlvbi5Kc29uVHlwZU5hbWUgPSBcIkFjdGlvbi5PcGVuVXJsXCI7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBzZXJpYWxpemF0aW9uXzEucHJvcGVydHkoT3BlblVybEFjdGlvbi51cmxQcm9wZXJ0eSlcclxuICAgIF0sIE9wZW5VcmxBY3Rpb24ucHJvdG90eXBlLCBcInVybFwiLCB2b2lkIDApO1xyXG4gICAgcmV0dXJuIE9wZW5VcmxBY3Rpb247XHJcbn0oQWN0aW9uKSk7XHJcbmV4cG9ydHMuT3BlblVybEFjdGlvbiA9IE9wZW5VcmxBY3Rpb247XHJcbnZhciBUb2dnbGVWaXNpYmlsaXR5QWN0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKFRvZ2dsZVZpc2liaWxpdHlBY3Rpb24sIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBUb2dnbGVWaXNpYmlsaXR5QWN0aW9uKCkge1xyXG4gICAgICAgIC8vI3JlZ2lvbiBTY2hlbWFcclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgICAgICBfdGhpcy50YXJnZXRFbGVtZW50cyA9IHt9O1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIFRvZ2dsZVZpc2liaWxpdHlBY3Rpb24ucHJvdG90eXBlLmdldEpzb25UeXBlTmFtZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gVG9nZ2xlVmlzaWJpbGl0eUFjdGlvbi5Kc29uVHlwZU5hbWU7XHJcbiAgICB9O1xyXG4gICAgVG9nZ2xlVmlzaWJpbGl0eUFjdGlvbi5wcm90b3R5cGUuZXhlY3V0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAodGhpcy5wYXJlbnQpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IE9iamVjdC5rZXlzKHRoaXMudGFyZ2V0RWxlbWVudHMpOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnRJZCA9IF9hW19pXTtcclxuICAgICAgICAgICAgICAgIHZhciB0YXJnZXRFbGVtZW50ID0gdGhpcy5wYXJlbnQuZ2V0Um9vdEVsZW1lbnQoKS5nZXRFbGVtZW50QnlJZChlbGVtZW50SWQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRhcmdldEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHRoaXMudGFyZ2V0RWxlbWVudHNbZWxlbWVudElkXSA9PT0gXCJib29sZWFuXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0RWxlbWVudC5pc1Zpc2libGUgPSB0aGlzLnRhcmdldEVsZW1lbnRzW2VsZW1lbnRJZF07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRFbGVtZW50LmlzVmlzaWJsZSA9ICF0YXJnZXRFbGVtZW50LmlzVmlzaWJsZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgVG9nZ2xlVmlzaWJpbGl0eUFjdGlvbi5wcm90b3R5cGUuYWRkVGFyZ2V0RWxlbWVudCA9IGZ1bmN0aW9uIChlbGVtZW50SWQsIGlzVmlzaWJsZSkge1xyXG4gICAgICAgIGlmIChpc1Zpc2libGUgPT09IHZvaWQgMCkgeyBpc1Zpc2libGUgPSB1bmRlZmluZWQ7IH1cclxuICAgICAgICB0aGlzLnRhcmdldEVsZW1lbnRzW2VsZW1lbnRJZF0gPSBpc1Zpc2libGU7XHJcbiAgICB9O1xyXG4gICAgVG9nZ2xlVmlzaWJpbGl0eUFjdGlvbi5wcm90b3R5cGUucmVtb3ZlVGFyZ2V0RWxlbWVudCA9IGZ1bmN0aW9uIChlbGVtZW50SWQpIHtcclxuICAgICAgICBkZWxldGUgdGhpcy50YXJnZXRFbGVtZW50c1tlbGVtZW50SWRdO1xyXG4gICAgfTtcclxuICAgIFRvZ2dsZVZpc2liaWxpdHlBY3Rpb24udGFyZ2V0RWxlbWVudHNQcm9wZXJ0eSA9IG5ldyBzZXJpYWxpemF0aW9uXzEuQ3VzdG9tUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzIsIFwidGFyZ2V0RWxlbWVudHNcIiwgZnVuY3Rpb24gKHNlbmRlciwgcHJvcGVydHksIHNvdXJjZSwgY29udGV4dCkge1xyXG4gICAgICAgIHZhciByZXN1bHQgPSB7fTtcclxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShzb3VyY2VbcHJvcGVydHkubmFtZV0pKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSBzb3VyY2VbcHJvcGVydHkubmFtZV07IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IF9hW19pXTtcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgaXRlbSA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdFtpdGVtXSA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBpdGVtID09PSBcIm9iamVjdFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVsZW1lbnRJZCA9IGl0ZW1bXCJlbGVtZW50SWRcIl07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBlbGVtZW50SWQgPT09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0W2VsZW1lbnRJZF0gPSBVdGlscy5wYXJzZUJvb2woaXRlbVtcImlzVmlzaWJsZVwiXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9LCBmdW5jdGlvbiAoc2VuZGVyLCBwcm9wZXJ0eSwgdGFyZ2V0LCB2YWx1ZSwgY29udGV4dCkge1xyXG4gICAgICAgIHZhciB0YXJnZXRFbGVtZW50cyA9IFtdO1xyXG4gICAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSBPYmplY3Qua2V5cyh2YWx1ZSk7IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciBpZCA9IF9hW19pXTtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZVtpZF0gPT09IFwiYm9vbGVhblwiKSB7XHJcbiAgICAgICAgICAgICAgICB0YXJnZXRFbGVtZW50cy5wdXNoKHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50SWQ6IGlkLFxyXG4gICAgICAgICAgICAgICAgICAgIGlzVmlzaWJsZTogdmFsdWVbaWRdXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRhcmdldEVsZW1lbnRzLnB1c2goaWQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnRleHQuc2VyaWFsaXplQXJyYXkodGFyZ2V0LCBwcm9wZXJ0eS5uYW1lLCB0YXJnZXRFbGVtZW50cyk7XHJcbiAgICB9LCB7fSwgZnVuY3Rpb24gKHNlbmRlcikgeyByZXR1cm4ge307IH0pO1xyXG4gICAgLy8jZW5kcmVnaW9uXHJcbiAgICAvLyBOb3RlIHRoZSBcIndlaXJkXCIgd2F5IHRoaXMgZmllbGQgaXMgZGVjbGFyZWQgaXMgdG8gd29yayBhcm91bmQgYSBicmVha2luZ1xyXG4gICAgLy8gY2hhbmdlIGludHJvZHVjZWQgaW4gVFMgMy4xIHdydCBkLnRzIGdlbmVyYXRpb24uIERPIE5PVCBDSEFOR0VcclxuICAgIFRvZ2dsZVZpc2liaWxpdHlBY3Rpb24uSnNvblR5cGVOYW1lID0gXCJBY3Rpb24uVG9nZ2xlVmlzaWJpbGl0eVwiO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KFRvZ2dsZVZpc2liaWxpdHlBY3Rpb24udGFyZ2V0RWxlbWVudHNQcm9wZXJ0eSlcclxuICAgIF0sIFRvZ2dsZVZpc2liaWxpdHlBY3Rpb24ucHJvdG90eXBlLCBcInRhcmdldEVsZW1lbnRzXCIsIHZvaWQgMCk7XHJcbiAgICByZXR1cm4gVG9nZ2xlVmlzaWJpbGl0eUFjdGlvbjtcclxufShBY3Rpb24pKTtcclxuZXhwb3J0cy5Ub2dnbGVWaXNpYmlsaXR5QWN0aW9uID0gVG9nZ2xlVmlzaWJpbGl0eUFjdGlvbjtcclxudmFyIFN0cmluZ1dpdGhTdWJzdGl0dXRpb25Qcm9wZXJ0eSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhTdHJpbmdXaXRoU3Vic3RpdHV0aW9uUHJvcGVydHksIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBTdHJpbmdXaXRoU3Vic3RpdHV0aW9uUHJvcGVydHkodGFyZ2V0VmVyc2lvbiwgbmFtZSkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHRhcmdldFZlcnNpb24sIG5hbWUsIHVuZGVmaW5lZCwgZnVuY3Rpb24gKCkgeyByZXR1cm4gbmV3IHNoYXJlZF8xLlN0cmluZ1dpdGhTdWJzdGl0dXRpb25zKCk7IH0pIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMudGFyZ2V0VmVyc2lvbiA9IHRhcmdldFZlcnNpb247XHJcbiAgICAgICAgX3RoaXMubmFtZSA9IG5hbWU7XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgU3RyaW5nV2l0aFN1YnN0aXR1dGlvblByb3BlcnR5LnByb3RvdHlwZS5wYXJzZSA9IGZ1bmN0aW9uIChzZW5kZXIsIHNvdXJjZSwgY29udGV4dCkge1xyXG4gICAgICAgIHZhciByZXN1bHQgPSBuZXcgc2hhcmVkXzEuU3RyaW5nV2l0aFN1YnN0aXR1dGlvbnMoKTtcclxuICAgICAgICByZXN1bHQuc2V0KFV0aWxzLnBhcnNlU3RyaW5nKHNvdXJjZVt0aGlzLm5hbWVdKSk7XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH07XHJcbiAgICBTdHJpbmdXaXRoU3Vic3RpdHV0aW9uUHJvcGVydHkucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uIChzZW5kZXIsIHRhcmdldCwgdmFsdWUsIGNvbnRleHQpIHtcclxuICAgICAgICBjb250ZXh0LnNlcmlhbGl6ZVZhbHVlKHRhcmdldCwgdGhpcy5uYW1lLCB2YWx1ZS5nZXRPcmlnaW5hbCgpKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gU3RyaW5nV2l0aFN1YnN0aXR1dGlvblByb3BlcnR5O1xyXG59KHNlcmlhbGl6YXRpb25fMS5Qcm9wZXJ0eURlZmluaXRpb24pKTtcclxudmFyIEh0dHBIZWFkZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoSHR0cEhlYWRlciwgX3N1cGVyKTtcclxuICAgIC8vI2VuZHJlZ2lvblxyXG4gICAgZnVuY3Rpb24gSHR0cEhlYWRlcihuYW1lLCB2YWx1ZSkge1xyXG4gICAgICAgIGlmIChuYW1lID09PSB2b2lkIDApIHsgbmFtZSA9IFwiXCI7IH1cclxuICAgICAgICBpZiAodmFsdWUgPT09IHZvaWQgMCkgeyB2YWx1ZSA9IFwiXCI7IH1cclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLm5hbWUgPSBuYW1lO1xyXG4gICAgICAgIF90aGlzLnZhbHVlID0gdmFsdWU7XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgSHR0cEhlYWRlci5wcm90b3R5cGUuZ2V0U2NoZW1hS2V5ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBcIkh0dHBIZWFkZXJcIjtcclxuICAgIH07XHJcbiAgICBIdHRwSGVhZGVyLnByb3RvdHlwZS5nZXRSZWZlcmVuY2VkSW5wdXRzID0gZnVuY3Rpb24gKGlucHV0cywgcmVmZXJlbmNlZElucHV0cykge1xyXG4gICAgICAgIHRoaXMuX3ZhbHVlLmdldFJlZmVyZW5jZWRJbnB1dHMoaW5wdXRzLCByZWZlcmVuY2VkSW5wdXRzKTtcclxuICAgIH07XHJcbiAgICBIdHRwSGVhZGVyLnByb3RvdHlwZS5wcmVwYXJlRm9yRXhlY3V0aW9uID0gZnVuY3Rpb24gKGlucHV0cykge1xyXG4gICAgICAgIHRoaXMuX3ZhbHVlLnN1YnN0aXR1dGVJbnB1dFZhbHVlcyhpbnB1dHMsIHNoYXJlZF8xLkNvbnRlbnRUeXBlcy5hcHBsaWNhdGlvblhXd3dGb3JtVXJsZW5jb2RlZCk7XHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEh0dHBIZWFkZXIucHJvdG90eXBlLCBcInZhbHVlXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlLmdldCgpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc2V0OiBmdW5jdGlvbiAobmV3VmFsdWUpIHtcclxuICAgICAgICAgICAgdGhpcy5fdmFsdWUuc2V0KG5ld1ZhbHVlKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIC8vI3JlZ2lvbiBTY2hlbWFcclxuICAgIEh0dHBIZWFkZXIubmFtZVByb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5TdHJpbmdQcm9wZXJ0eShzZXJpYWxpemF0aW9uXzEuVmVyc2lvbnMudjFfMCwgXCJuYW1lXCIpO1xyXG4gICAgSHR0cEhlYWRlci52YWx1ZVByb3BlcnR5ID0gbmV3IFN0cmluZ1dpdGhTdWJzdGl0dXRpb25Qcm9wZXJ0eShzZXJpYWxpemF0aW9uXzEuVmVyc2lvbnMudjFfMCwgXCJ2YWx1ZVwiKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHNlcmlhbGl6YXRpb25fMS5wcm9wZXJ0eShIdHRwSGVhZGVyLm5hbWVQcm9wZXJ0eSlcclxuICAgIF0sIEh0dHBIZWFkZXIucHJvdG90eXBlLCBcIm5hbWVcIiwgdm9pZCAwKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHNlcmlhbGl6YXRpb25fMS5wcm9wZXJ0eShIdHRwSGVhZGVyLnZhbHVlUHJvcGVydHkpXHJcbiAgICBdLCBIdHRwSGVhZGVyLnByb3RvdHlwZSwgXCJfdmFsdWVcIiwgdm9pZCAwKTtcclxuICAgIHJldHVybiBIdHRwSGVhZGVyO1xyXG59KHNlcmlhbGl6YXRpb25fMS5TZXJpYWxpemFibGVPYmplY3QpKTtcclxuZXhwb3J0cy5IdHRwSGVhZGVyID0gSHR0cEhlYWRlcjtcclxudmFyIEh0dHBBY3Rpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoSHR0cEFjdGlvbiwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIEh0dHBBY3Rpb24oKSB7XHJcbiAgICAgICAgLy8jcmVnaW9uIFNjaGVtYVxyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLl9pZ25vcmVJbnB1dFZhbGlkYXRpb24gPSBmYWxzZTtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICBIdHRwQWN0aW9uLnByb3RvdHlwZS5wb3B1bGF0ZVNjaGVtYSA9IGZ1bmN0aW9uIChzY2hlbWEpIHtcclxuICAgICAgICBfc3VwZXIucHJvdG90eXBlLnBvcHVsYXRlU2NoZW1hLmNhbGwodGhpcywgc2NoZW1hKTtcclxuICAgICAgICBzY2hlbWEuYWRkKEFjdGlvbi5pZ25vcmVJbnB1dFZhbGlkYXRpb25Qcm9wZXJ0eSk7XHJcbiAgICB9O1xyXG4gICAgSHR0cEFjdGlvbi5wcm90b3R5cGUuaW50ZXJuYWxHZXRSZWZlcmVuY2VkSW5wdXRzID0gZnVuY3Rpb24gKGFsbElucHV0cykge1xyXG4gICAgICAgIHZhciByZXN1bHQgPSB7fTtcclxuICAgICAgICB0aGlzLl91cmwuZ2V0UmVmZXJlbmNlZElucHV0cyhhbGxJbnB1dHMsIHJlc3VsdCk7XHJcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHRoaXMuaGVhZGVyczsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgdmFyIGhlYWRlciA9IF9hW19pXTtcclxuICAgICAgICAgICAgaGVhZGVyLmdldFJlZmVyZW5jZWRJbnB1dHMoYWxsSW5wdXRzLCByZXN1bHQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLl9ib2R5LmdldFJlZmVyZW5jZWRJbnB1dHMoYWxsSW5wdXRzLCByZXN1bHQpO1xyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9O1xyXG4gICAgSHR0cEFjdGlvbi5wcm90b3R5cGUuaW50ZXJuYWxQcmVwYXJlRm9yRXhlY3V0aW9uID0gZnVuY3Rpb24gKGlucHV0cykge1xyXG4gICAgICAgIGlmIChpbnB1dHMpIHtcclxuICAgICAgICAgICAgdGhpcy5fdXJsLnN1YnN0aXR1dGVJbnB1dFZhbHVlcyhpbnB1dHMsIHNoYXJlZF8xLkNvbnRlbnRUeXBlcy5hcHBsaWNhdGlvblhXd3dGb3JtVXJsZW5jb2RlZCk7XHJcbiAgICAgICAgICAgIHZhciBjb250ZW50VHlwZSA9IHNoYXJlZF8xLkNvbnRlbnRUeXBlcy5hcHBsaWNhdGlvbkpzb247XHJcbiAgICAgICAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSB0aGlzLmhlYWRlcnM7IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaGVhZGVyID0gX2FbX2ldO1xyXG4gICAgICAgICAgICAgICAgaGVhZGVyLnByZXBhcmVGb3JFeGVjdXRpb24oaW5wdXRzKTtcclxuICAgICAgICAgICAgICAgIGlmIChoZWFkZXIubmFtZSAmJiBoZWFkZXIubmFtZS50b0xvd2VyQ2FzZSgpID09IFwiY29udGVudC10eXBlXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb250ZW50VHlwZSA9IGhlYWRlci52YWx1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLl9ib2R5LnN1YnN0aXR1dGVJbnB1dFZhbHVlcyhpbnB1dHMsIGNvbnRlbnRUeXBlKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgO1xyXG4gICAgSHR0cEFjdGlvbi5wcm90b3R5cGUuZ2V0SnNvblR5cGVOYW1lID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBIdHRwQWN0aW9uLkpzb25UeXBlTmFtZTtcclxuICAgIH07XHJcbiAgICBIdHRwQWN0aW9uLnByb3RvdHlwZS5pbnRlcm5hbFZhbGlkYXRlUHJvcGVydGllcyA9IGZ1bmN0aW9uIChjb250ZXh0KSB7XHJcbiAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5pbnRlcm5hbFZhbGlkYXRlUHJvcGVydGllcy5jYWxsKHRoaXMsIGNvbnRleHQpO1xyXG4gICAgICAgIGlmICghdGhpcy51cmwpIHtcclxuICAgICAgICAgICAgY29udGV4dC5hZGRGYWlsdXJlKHRoaXMsIDggLyogUHJvcGVydHlDYW50QmVOdWxsICovLCBcIkFuIEFjdGlvbi5IdHRwIG11c3QgaGF2ZSBpdHMgdXJsIHByb3BlcnR5IHNldC5cIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmhlYWRlcnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gdGhpcy5oZWFkZXJzOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGhlYWRlciA9IF9hW19pXTtcclxuICAgICAgICAgICAgICAgIGlmICghaGVhZGVyLm5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmFkZEZhaWx1cmUodGhpcywgOCAvKiBQcm9wZXJ0eUNhbnRCZU51bGwgKi8sIFwiQWxsIGhlYWRlcnMgb2YgYW4gQWN0aW9uLkh0dHAgbXVzdCBoYXZlIHRoZWlyIG5hbWUgYW5kIHZhbHVlIHByb3BlcnRpZXMgc2V0LlwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoSHR0cEFjdGlvbi5wcm90b3R5cGUsIFwiaWdub3JlSW5wdXRWYWxpZGF0aW9uXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2lnbm9yZUlucHV0VmFsaWRhdGlvbjtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2lnbm9yZUlucHV0VmFsaWRhdGlvbiA9IHZhbHVlO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEh0dHBBY3Rpb24ucHJvdG90eXBlLCBcInVybFwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl91cmwuZ2V0KCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgICAgICB0aGlzLl91cmwuc2V0KHZhbHVlKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShIdHRwQWN0aW9uLnByb3RvdHlwZSwgXCJib2R5XCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2JvZHkuZ2V0KCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgICAgICB0aGlzLl9ib2R5LnNldCh2YWx1ZSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBIdHRwQWN0aW9uLnVybFByb3BlcnR5ID0gbmV3IFN0cmluZ1dpdGhTdWJzdGl0dXRpb25Qcm9wZXJ0eShzZXJpYWxpemF0aW9uXzEuVmVyc2lvbnMudjFfMCwgXCJ1cmxcIik7XHJcbiAgICBIdHRwQWN0aW9uLmJvZHlQcm9wZXJ0eSA9IG5ldyBTdHJpbmdXaXRoU3Vic3RpdHV0aW9uUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzAsIFwiYm9keVwiKTtcclxuICAgIEh0dHBBY3Rpb24ubWV0aG9kUHJvcGVydHkgPSBuZXcgc2VyaWFsaXphdGlvbl8xLlN0cmluZ1Byb3BlcnR5KHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8wLCBcIm1ldGhvZFwiKTtcclxuICAgIEh0dHBBY3Rpb24uaGVhZGVyc1Byb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5TZXJpYWxpemFibGVPYmplY3RDb2xsZWN0aW9uUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzAsIFwiaGVhZGVyc1wiLCBIdHRwSGVhZGVyKTtcclxuICAgIC8vI2VuZHJlZ2lvblxyXG4gICAgLy8gTm90ZSB0aGUgXCJ3ZWlyZFwiIHdheSB0aGlzIGZpZWxkIGlzIGRlY2xhcmVkIGlzIHRvIHdvcmsgYXJvdW5kIGEgYnJlYWtpbmdcclxuICAgIC8vIGNoYW5nZSBpbnRyb2R1Y2VkIGluIFRTIDMuMSB3cnQgZC50cyBnZW5lcmF0aW9uLiBETyBOT1QgQ0hBTkdFXHJcbiAgICBIdHRwQWN0aW9uLkpzb25UeXBlTmFtZSA9IFwiQWN0aW9uLkh0dHBcIjtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHNlcmlhbGl6YXRpb25fMS5wcm9wZXJ0eShIdHRwQWN0aW9uLnVybFByb3BlcnR5KVxyXG4gICAgXSwgSHR0cEFjdGlvbi5wcm90b3R5cGUsIFwiX3VybFwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KEh0dHBBY3Rpb24uYm9keVByb3BlcnR5KVxyXG4gICAgXSwgSHR0cEFjdGlvbi5wcm90b3R5cGUsIFwiX2JvZHlcIiwgdm9pZCAwKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHNlcmlhbGl6YXRpb25fMS5wcm9wZXJ0eShIdHRwQWN0aW9uLmJvZHlQcm9wZXJ0eSlcclxuICAgIF0sIEh0dHBBY3Rpb24ucHJvdG90eXBlLCBcIm1ldGhvZFwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KEh0dHBBY3Rpb24uaGVhZGVyc1Byb3BlcnR5KVxyXG4gICAgXSwgSHR0cEFjdGlvbi5wcm90b3R5cGUsIFwiaGVhZGVyc1wiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KEFjdGlvbi5pZ25vcmVJbnB1dFZhbGlkYXRpb25Qcm9wZXJ0eSlcclxuICAgIF0sIEh0dHBBY3Rpb24ucHJvdG90eXBlLCBcIl9pZ25vcmVJbnB1dFZhbGlkYXRpb25cIiwgdm9pZCAwKTtcclxuICAgIHJldHVybiBIdHRwQWN0aW9uO1xyXG59KEFjdGlvbikpO1xyXG5leHBvcnRzLkh0dHBBY3Rpb24gPSBIdHRwQWN0aW9uO1xyXG52YXIgU2hvd0NhcmRBY3Rpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoU2hvd0NhcmRBY3Rpb24sIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBTaG93Q2FyZEFjdGlvbigpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgICAgICBfdGhpcy5jYXJkID0gbmV3IElubGluZUFkYXB0aXZlQ2FyZCgpO1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIFNob3dDYXJkQWN0aW9uLnByb3RvdHlwZS5pbnRlcm5hbFBhcnNlID0gZnVuY3Rpb24gKHNvdXJjZSwgY29udGV4dCkge1xyXG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUuaW50ZXJuYWxQYXJzZS5jYWxsKHRoaXMsIHNvdXJjZSwgY29udGV4dCk7XHJcbiAgICAgICAgdmFyIGpzb25DYXJkID0gc291cmNlW1wiY2FyZFwiXTtcclxuICAgICAgICBpZiAoanNvbkNhcmQpIHtcclxuICAgICAgICAgICAgdGhpcy5jYXJkLnBhcnNlKGpzb25DYXJkLCBjb250ZXh0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnRleHQubG9nUGFyc2VFdmVudCg4IC8qIFByb3BlcnR5Q2FudEJlTnVsbCAqLywgXCJBbiBBY3Rpb24uU2hvd0NhcmQgbXVzdCBoYXZlIGl0cyBcXFwiY2FyZFxcXCIgcHJvcGVydHkgc2V0IHRvIGEgdmFsaWQgQWRhcHRpdmVDYXJkIG9iamVjdC5cIiwgdGhpcyk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFNob3dDYXJkQWN0aW9uLnByb3RvdHlwZS5pbnRlcm5hbFRvSlNPTiA9IGZ1bmN0aW9uICh0YXJnZXQsIGNvbnRleHQpIHtcclxuICAgICAgICBfc3VwZXIucHJvdG90eXBlLmludGVybmFsVG9KU09OLmNhbGwodGhpcywgdGFyZ2V0LCBjb250ZXh0KTtcclxuICAgICAgICBpZiAodGhpcy5jYXJkKSB7XHJcbiAgICAgICAgICAgIGNvbnRleHQuc2VyaWFsaXplVmFsdWUodGFyZ2V0LCBcImNhcmRcIiwgdGhpcy5jYXJkLnRvSlNPTihjb250ZXh0KSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFNob3dDYXJkQWN0aW9uLnByb3RvdHlwZS5hZGRDc3NDbGFzc2VzID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcclxuICAgICAgICBfc3VwZXIucHJvdG90eXBlLmFkZENzc0NsYXNzZXMuY2FsbCh0aGlzLCBlbGVtZW50KTtcclxuICAgICAgICBpZiAodGhpcy5wYXJlbnQpIHtcclxuICAgICAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMucGFyZW50Lmhvc3RDb25maWcubWFrZUNzc0NsYXNzTmFtZShcImV4cGFuZGFibGVcIikpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBTaG93Q2FyZEFjdGlvbi5wcm90b3R5cGUuZ2V0SnNvblR5cGVOYW1lID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBTaG93Q2FyZEFjdGlvbi5Kc29uVHlwZU5hbWU7XHJcbiAgICB9O1xyXG4gICAgU2hvd0NhcmRBY3Rpb24ucHJvdG90eXBlLmludGVybmFsVmFsaWRhdGVQcm9wZXJ0aWVzID0gZnVuY3Rpb24gKGNvbnRleHQpIHtcclxuICAgICAgICBfc3VwZXIucHJvdG90eXBlLmludGVybmFsVmFsaWRhdGVQcm9wZXJ0aWVzLmNhbGwodGhpcywgY29udGV4dCk7XHJcbiAgICAgICAgdGhpcy5jYXJkLmludGVybmFsVmFsaWRhdGVQcm9wZXJ0aWVzKGNvbnRleHQpO1xyXG4gICAgfTtcclxuICAgIFNob3dDYXJkQWN0aW9uLnByb3RvdHlwZS51cGRhdGVBY3Rpb25CdXR0b25Dc3NTdHlsZSA9IGZ1bmN0aW9uIChhY3Rpb25CdXR0b25FbGVtZW50KSB7XHJcbiAgICAgICAgX3N1cGVyLnByb3RvdHlwZS51cGRhdGVBY3Rpb25CdXR0b25Dc3NTdHlsZS5jYWxsKHRoaXMsIGFjdGlvbkJ1dHRvbkVsZW1lbnQpO1xyXG4gICAgICAgIGlmICh0aGlzLnBhcmVudCkge1xyXG4gICAgICAgICAgICBhY3Rpb25CdXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5wYXJlbnQuaG9zdENvbmZpZy5tYWtlQ3NzQ2xhc3NOYW1lKFwiZXhwYW5kYWJsZVwiKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFNob3dDYXJkQWN0aW9uLnByb3RvdHlwZS5zZXRQYXJlbnQgPSBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICBfc3VwZXIucHJvdG90eXBlLnNldFBhcmVudC5jYWxsKHRoaXMsIHZhbHVlKTtcclxuICAgICAgICB0aGlzLmNhcmQuc2V0UGFyZW50KHZhbHVlKTtcclxuICAgIH07XHJcbiAgICBTaG93Q2FyZEFjdGlvbi5wcm90b3R5cGUuZ2V0QWxsSW5wdXRzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNhcmQuZ2V0QWxsSW5wdXRzKCk7XHJcbiAgICB9O1xyXG4gICAgU2hvd0NhcmRBY3Rpb24ucHJvdG90eXBlLmdldFJlc291cmNlSW5mb3JtYXRpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlci5wcm90b3R5cGUuZ2V0UmVzb3VyY2VJbmZvcm1hdGlvbi5jYWxsKHRoaXMpLmNvbmNhdCh0aGlzLmNhcmQuZ2V0UmVzb3VyY2VJbmZvcm1hdGlvbigpKTtcclxuICAgIH07XHJcbiAgICBTaG93Q2FyZEFjdGlvbi5wcm90b3R5cGUuZ2V0QWN0aW9uQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xyXG4gICAgICAgIHZhciByZXN1bHQgPSBfc3VwZXIucHJvdG90eXBlLmdldEFjdGlvbkJ5SWQuY2FsbCh0aGlzLCBpZCk7XHJcbiAgICAgICAgaWYgKCFyZXN1bHQpIHtcclxuICAgICAgICAgICAgcmVzdWx0ID0gdGhpcy5jYXJkLmdldEFjdGlvbkJ5SWQoaWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuICAgIC8vIE5vdGUgdGhlIFwid2VpcmRcIiB3YXkgdGhpcyBmaWVsZCBpcyBkZWNsYXJlZCBpcyB0byB3b3JrIGFyb3VuZCBhIGJyZWFraW5nXHJcbiAgICAvLyBjaGFuZ2UgaW50cm9kdWNlZCBpbiBUUyAzLjEgd3J0IGQudHMgZ2VuZXJhdGlvbi4gRE8gTk9UIENIQU5HRVxyXG4gICAgU2hvd0NhcmRBY3Rpb24uSnNvblR5cGVOYW1lID0gXCJBY3Rpb24uU2hvd0NhcmRcIjtcclxuICAgIHJldHVybiBTaG93Q2FyZEFjdGlvbjtcclxufShBY3Rpb24pKTtcclxuZXhwb3J0cy5TaG93Q2FyZEFjdGlvbiA9IFNob3dDYXJkQWN0aW9uO1xyXG52YXIgQWN0aW9uQ29sbGVjdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEFjdGlvbkNvbGxlY3Rpb24ob3duZXIpIHtcclxuICAgICAgICB0aGlzLl9yZW5kZXJlZEFjdGlvbkNvdW50ID0gMDtcclxuICAgICAgICB0aGlzLml0ZW1zID0gW107XHJcbiAgICAgICAgdGhpcy5idXR0b25zID0gW107XHJcbiAgICAgICAgdGhpcy5fb3duZXIgPSBvd25lcjtcclxuICAgIH1cclxuICAgIEFjdGlvbkNvbGxlY3Rpb24ucHJvdG90eXBlLmlzQWN0aW9uQWxsb3dlZCA9IGZ1bmN0aW9uIChhY3Rpb24pIHtcclxuICAgICAgICB2YXIgZm9yYmlkZGVuVHlwZXMgPSB0aGlzLl9vd25lci5nZXRGb3JiaWRkZW5BY3Rpb25UeXBlcygpO1xyXG4gICAgICAgIGlmIChmb3JiaWRkZW5UeXBlcykge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIGZvcmJpZGRlblR5cGVzXzEgPSBmb3JiaWRkZW5UeXBlczsgX2kgPCBmb3JiaWRkZW5UeXBlc18xLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGZvcmJpZGRlblR5cGUgPSBmb3JiaWRkZW5UeXBlc18xW19pXTtcclxuICAgICAgICAgICAgICAgIGlmIChhY3Rpb24uY29uc3RydWN0b3IgPT09IGZvcmJpZGRlblR5cGUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9O1xyXG4gICAgQWN0aW9uQ29sbGVjdGlvbi5wcm90b3R5cGUucmVmcmVzaENvbnRhaW5lciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLl9hY3Rpb25DYXJkQ29udGFpbmVyLmlubmVySFRNTCA9IFwiXCI7XHJcbiAgICAgICAgaWYgKCF0aGlzLl9hY3Rpb25DYXJkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2FjdGlvbkNhcmRDb250YWluZXIuc3R5bGUubWFyZ2luVG9wID0gXCIwcHhcIjtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLl9hY3Rpb25DYXJkQ29udGFpbmVyLnN0eWxlLm1hcmdpblRvcCA9IHRoaXMuX3JlbmRlcmVkQWN0aW9uQ291bnQgPiAwID8gdGhpcy5fb3duZXIuaG9zdENvbmZpZy5hY3Rpb25zLnNob3dDYXJkLmlubGluZVRvcE1hcmdpbiArIFwicHhcIiA6IFwiMHB4XCI7XHJcbiAgICAgICAgdmFyIHBhZGRpbmcgPSB0aGlzLl9vd25lci5nZXRFZmZlY3RpdmVQYWRkaW5nKCk7XHJcbiAgICAgICAgdGhpcy5fb3duZXIuZ2V0SW1tZWRpYXRlU3Vycm91bmRpbmdQYWRkaW5nKHBhZGRpbmcpO1xyXG4gICAgICAgIHZhciBwaHlzaWNhbFBhZGRpbmcgPSB0aGlzLl9vd25lci5ob3N0Q29uZmlnLnBhZGRpbmdEZWZpbml0aW9uVG9TcGFjaW5nRGVmaW5pdGlvbihwYWRkaW5nKTtcclxuICAgICAgICBpZiAodGhpcy5fYWN0aW9uQ2FyZCkge1xyXG4gICAgICAgICAgICB0aGlzLl9hY3Rpb25DYXJkLnN0eWxlLnBhZGRpbmdMZWZ0ID0gcGh5c2ljYWxQYWRkaW5nLmxlZnQgKyBcInB4XCI7XHJcbiAgICAgICAgICAgIHRoaXMuX2FjdGlvbkNhcmQuc3R5bGUucGFkZGluZ1JpZ2h0ID0gcGh5c2ljYWxQYWRkaW5nLnJpZ2h0ICsgXCJweFwiO1xyXG4gICAgICAgICAgICB0aGlzLl9hY3Rpb25DYXJkLnN0eWxlLm1hcmdpbkxlZnQgPSBcIi1cIiArIHBoeXNpY2FsUGFkZGluZy5sZWZ0ICsgXCJweFwiO1xyXG4gICAgICAgICAgICB0aGlzLl9hY3Rpb25DYXJkLnN0eWxlLm1hcmdpblJpZ2h0ID0gXCItXCIgKyBwaHlzaWNhbFBhZGRpbmcucmlnaHQgKyBcInB4XCI7XHJcbiAgICAgICAgICAgIGlmIChwaHlzaWNhbFBhZGRpbmcuYm90dG9tICE9IDAgJiYgIXRoaXMuX293bmVyLmlzRGVzaWduTW9kZSgpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9hY3Rpb25DYXJkLnN0eWxlLnBhZGRpbmdCb3R0b20gPSBwaHlzaWNhbFBhZGRpbmcuYm90dG9tICsgXCJweFwiO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fYWN0aW9uQ2FyZC5zdHlsZS5tYXJnaW5Cb3R0b20gPSBcIi1cIiArIHBoeXNpY2FsUGFkZGluZy5ib3R0b20gKyBcInB4XCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgVXRpbHMuYXBwZW5kQ2hpbGQodGhpcy5fYWN0aW9uQ2FyZENvbnRhaW5lciwgdGhpcy5fYWN0aW9uQ2FyZCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEFjdGlvbkNvbGxlY3Rpb24ucHJvdG90eXBlLmxheW91dENoYW5nZWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5fb3duZXIuZ2V0Um9vdEVsZW1lbnQoKS51cGRhdGVMYXlvdXQoKTtcclxuICAgIH07XHJcbiAgICBBY3Rpb25Db2xsZWN0aW9uLnByb3RvdHlwZS5oaWRlQWN0aW9uQ2FyZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgcHJldmlvdXNseUV4cGFuZGVkQWN0aW9uID0gdGhpcy5fZXhwYW5kZWRBY3Rpb247XHJcbiAgICAgICAgdGhpcy5fZXhwYW5kZWRBY3Rpb24gPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgdGhpcy5fYWN0aW9uQ2FyZCA9IHVuZGVmaW5lZDtcclxuICAgICAgICB0aGlzLnJlZnJlc2hDb250YWluZXIoKTtcclxuICAgICAgICBpZiAocHJldmlvdXNseUV4cGFuZGVkQWN0aW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMubGF5b3V0Q2hhbmdlZCgpO1xyXG4gICAgICAgICAgICByYWlzZUlubGluZUNhcmRFeHBhbmRlZEV2ZW50KHByZXZpb3VzbHlFeHBhbmRlZEFjdGlvbiwgZmFsc2UpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBBY3Rpb25Db2xsZWN0aW9uLnByb3RvdHlwZS5zaG93QWN0aW9uQ2FyZCA9IGZ1bmN0aW9uIChhY3Rpb24sIHN1cHByZXNzU3R5bGUsIHJhaXNlRXZlbnQpIHtcclxuICAgICAgICBpZiAoc3VwcHJlc3NTdHlsZSA9PT0gdm9pZCAwKSB7IHN1cHByZXNzU3R5bGUgPSBmYWxzZTsgfVxyXG4gICAgICAgIGlmIChyYWlzZUV2ZW50ID09PSB2b2lkIDApIHsgcmFpc2VFdmVudCA9IHRydWU7IH1cclxuICAgICAgICBhY3Rpb24uY2FyZC5zdXBwcmVzc1N0eWxlID0gc3VwcHJlc3NTdHlsZTtcclxuICAgICAgICAvLyBBbHdheXMgcmUtcmVuZGVyIGEgU2hvd0NhcmQgYWN0aW9uIGluIGRlc2lnbiBtb2RlOyByZXVzZSBhbHJlYWR5IHJlbmRlcmVkIFNob3dDYXJkIChpZiBhdmFpbGFibGUpIG90aGVyd2lzZVxyXG4gICAgICAgIHZhciByZW5kZXJlZENhcmQgPSBhY3Rpb24uY2FyZC5yZW5kZXJlZEVsZW1lbnQgJiYgIXRoaXMuX293bmVyLmlzRGVzaWduTW9kZSgpID8gYWN0aW9uLmNhcmQucmVuZGVyZWRFbGVtZW50IDogYWN0aW9uLmNhcmQucmVuZGVyKCk7XHJcbiAgICAgICAgdGhpcy5fYWN0aW9uQ2FyZCA9IHJlbmRlcmVkQ2FyZDtcclxuICAgICAgICB0aGlzLl9leHBhbmRlZEFjdGlvbiA9IGFjdGlvbjtcclxuICAgICAgICB0aGlzLnJlZnJlc2hDb250YWluZXIoKTtcclxuICAgICAgICBpZiAocmFpc2VFdmVudCkge1xyXG4gICAgICAgICAgICB0aGlzLmxheW91dENoYW5nZWQoKTtcclxuICAgICAgICAgICAgcmFpc2VJbmxpbmVDYXJkRXhwYW5kZWRFdmVudChhY3Rpb24sIHRydWUpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBBY3Rpb25Db2xsZWN0aW9uLnByb3RvdHlwZS5jb2xsYXBzZUV4cGFuZGVkQWN0aW9uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSB0aGlzLmJ1dHRvbnM7IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciBidXR0b24gPSBfYVtfaV07XHJcbiAgICAgICAgICAgIGJ1dHRvbi5zdGF0ZSA9IDAgLyogTm9ybWFsICovO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmhpZGVBY3Rpb25DYXJkKCk7XHJcbiAgICB9O1xyXG4gICAgQWN0aW9uQ29sbGVjdGlvbi5wcm90b3R5cGUuZXhwYW5kU2hvd0NhcmRBY3Rpb24gPSBmdW5jdGlvbiAoYWN0aW9uLCByYWlzZUV2ZW50KSB7XHJcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHRoaXMuYnV0dG9uczsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgdmFyIGJ1dHRvbiA9IF9hW19pXTtcclxuICAgICAgICAgICAgaWYgKGJ1dHRvbi5hY3Rpb24gIT09IGFjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgYnV0dG9uLnN0YXRlID0gMiAvKiBTdWJkdWVkICovO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgYnV0dG9uLnN0YXRlID0gMSAvKiBFeHBhbmRlZCAqLztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnNob3dBY3Rpb25DYXJkKGFjdGlvbiwgISh0aGlzLl9vd25lci5pc0F0VGhlVmVyeUxlZnQoKSAmJiB0aGlzLl9vd25lci5pc0F0VGhlVmVyeVJpZ2h0KCkpLCByYWlzZUV2ZW50KTtcclxuICAgIH07XHJcbiAgICBBY3Rpb25Db2xsZWN0aW9uLnByb3RvdHlwZS5hY3Rpb25DbGlja2VkID0gZnVuY3Rpb24gKGFjdGlvbkJ1dHRvbikge1xyXG4gICAgICAgIGlmICghKGFjdGlvbkJ1dHRvbi5hY3Rpb24gaW5zdGFuY2VvZiBTaG93Q2FyZEFjdGlvbikpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHRoaXMuYnV0dG9uczsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBidXR0b24gPSBfYVtfaV07XHJcbiAgICAgICAgICAgICAgICBidXR0b24uc3RhdGUgPSAwIC8qIE5vcm1hbCAqLztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmhpZGVBY3Rpb25DYXJkKCk7XHJcbiAgICAgICAgICAgIGFjdGlvbkJ1dHRvbi5hY3Rpb24uZXhlY3V0ZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuX293bmVyLmhvc3RDb25maWcuYWN0aW9ucy5zaG93Q2FyZC5hY3Rpb25Nb2RlID09PSBFbnVtcy5TaG93Q2FyZEFjdGlvbk1vZGUuUG9wdXApIHtcclxuICAgICAgICAgICAgICAgIGFjdGlvbkJ1dHRvbi5hY3Rpb24uZXhlY3V0ZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKGFjdGlvbkJ1dHRvbi5hY3Rpb24gPT09IHRoaXMuX2V4cGFuZGVkQWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbGxhcHNlRXhwYW5kZWRBY3Rpb24oKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZXhwYW5kU2hvd0NhcmRBY3Rpb24oYWN0aW9uQnV0dG9uLmFjdGlvbiwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgQWN0aW9uQ29sbGVjdGlvbi5wcm90b3R5cGUuZ2V0UGFyZW50Q29udGFpbmVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9vd25lciBpbnN0YW5jZW9mIENvbnRhaW5lcikge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fb3duZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fb3duZXIuZ2V0UGFyZW50Q29udGFpbmVyKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEFjdGlvbkNvbGxlY3Rpb24ucHJvdG90eXBlLmZpbmRBY3Rpb25CdXR0b24gPSBmdW5jdGlvbiAoYWN0aW9uKSB7XHJcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHRoaXMuYnV0dG9uczsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgdmFyIGFjdGlvbkJ1dHRvbiA9IF9hW19pXTtcclxuICAgICAgICAgICAgaWYgKGFjdGlvbkJ1dHRvbi5hY3Rpb24gPT0gYWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYWN0aW9uQnV0dG9uO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICB9O1xyXG4gICAgQWN0aW9uQ29sbGVjdGlvbi5wcm90b3R5cGUucGFyc2UgPSBmdW5jdGlvbiAoc291cmNlLCBjb250ZXh0KSB7XHJcbiAgICAgICAgdGhpcy5jbGVhcigpO1xyXG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHNvdXJjZSkpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBzb3VyY2VfMSA9IHNvdXJjZTsgX2kgPCBzb3VyY2VfMS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBqc29uQWN0aW9uID0gc291cmNlXzFbX2ldO1xyXG4gICAgICAgICAgICAgICAgdmFyIGFjdGlvbiA9IGNvbnRleHQucGFyc2VBY3Rpb24odGhpcy5fb3duZXIsIGpzb25BY3Rpb24sIFtdLCAhdGhpcy5fb3duZXIuaXNEZXNpZ25Nb2RlKCkpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGFjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkQWN0aW9uKGFjdGlvbik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgQWN0aW9uQ29sbGVjdGlvbi5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gKHRhcmdldCwgcHJvcGVydHlOYW1lLCBjb250ZXh0KSB7XHJcbiAgICAgICAgY29udGV4dC5zZXJpYWxpemVBcnJheSh0YXJnZXQsIHByb3BlcnR5TmFtZSwgdGhpcy5pdGVtcyk7XHJcbiAgICB9O1xyXG4gICAgQWN0aW9uQ29sbGVjdGlvbi5wcm90b3R5cGUuZ2V0QWN0aW9uQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xyXG4gICAgICAgIHZhciByZXN1bHQgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHRoaXMuaXRlbXM7IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciBpdGVtID0gX2FbX2ldO1xyXG4gICAgICAgICAgICByZXN1bHQgPSBpdGVtLmdldEFjdGlvbkJ5SWQoaWQpO1xyXG4gICAgICAgICAgICBpZiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuICAgIEFjdGlvbkNvbGxlY3Rpb24ucHJvdG90eXBlLnZhbGlkYXRlUHJvcGVydGllcyA9IGZ1bmN0aW9uIChjb250ZXh0KSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX293bmVyLmhvc3RDb25maWcuYWN0aW9ucy5tYXhBY3Rpb25zICYmIHRoaXMuaXRlbXMubGVuZ3RoID4gdGhpcy5fb3duZXIuaG9zdENvbmZpZy5hY3Rpb25zLm1heEFjdGlvbnMpIHtcclxuICAgICAgICAgICAgY29udGV4dC5hZGRGYWlsdXJlKHRoaXMuX293bmVyLCA5IC8qIFRvb01hbnlBY3Rpb25zICovLCBcIkEgbWF4aW11bSBvZiBcIiArIHRoaXMuX293bmVyLmhvc3RDb25maWcuYWN0aW9ucy5tYXhBY3Rpb25zICsgXCIgYWN0aW9ucyBhcmUgYWxsb3dlZC5cIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLml0ZW1zLmxlbmd0aCA+IDAgJiYgIXRoaXMuX293bmVyLmhvc3RDb25maWcuc3VwcG9ydHNJbnRlcmFjdGl2aXR5KSB7XHJcbiAgICAgICAgICAgIGNvbnRleHQuYWRkRmFpbHVyZSh0aGlzLl9vd25lciwgNSAvKiBJbnRlcmFjdGl2aXR5Tm90QWxsb3dlZCAqLywgXCJJbnRlcmFjdGl2aXR5IGlzIG5vdCBhbGxvd2VkLlwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHRoaXMuaXRlbXM7IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciBpdGVtID0gX2FbX2ldO1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNBY3Rpb25BbGxvd2VkKGl0ZW0pKSB7XHJcbiAgICAgICAgICAgICAgICBjb250ZXh0LmFkZEZhaWx1cmUodGhpcy5fb3duZXIsIDEgLyogQWN0aW9uVHlwZU5vdEFsbG93ZWQgKi8sIFwiQWN0aW9ucyBvZiB0eXBlIFwiICsgaXRlbS5nZXRKc29uVHlwZU5hbWUoKSArIFwiIGFyZSBub3QgYWxsb3dlZCBpbiB0aGlzIGNvbnRleHQuXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGl0ZW0uaW50ZXJuYWxWYWxpZGF0ZVByb3BlcnRpZXMoY29udGV4dCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEFjdGlvbkNvbGxlY3Rpb24ucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uIChvcmllbnRhdGlvbiwgaXNEZXNpZ25Nb2RlKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICAvLyBDYWNoZSBob3N0Q29uZmlnIGZvciBiZXR0ZXIgcGVyZlxyXG4gICAgICAgIHZhciBob3N0Q29uZmlnID0gdGhpcy5fb3duZXIuaG9zdENvbmZpZztcclxuICAgICAgICBpZiAoIWhvc3RDb25maWcuc3VwcG9ydHNJbnRlcmFjdGl2aXR5KSB7XHJcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBlbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcclxuICAgICAgICB2YXIgbWF4QWN0aW9ucyA9IGhvc3RDb25maWcuYWN0aW9ucy5tYXhBY3Rpb25zID8gTWF0aC5taW4oaG9zdENvbmZpZy5hY3Rpb25zLm1heEFjdGlvbnMsIHRoaXMuaXRlbXMubGVuZ3RoKSA6IHRoaXMuaXRlbXMubGVuZ3RoO1xyXG4gICAgICAgIHRoaXMuX2FjdGlvbkNhcmRDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIHRoaXMuX3JlbmRlcmVkQWN0aW9uQ291bnQgPSAwO1xyXG4gICAgICAgIGlmIChob3N0Q29uZmlnLmFjdGlvbnMucHJlRXhwYW5kU2luZ2xlU2hvd0NhcmRBY3Rpb24gJiYgbWF4QWN0aW9ucyA9PSAxICYmIHRoaXMuaXRlbXNbMF0gaW5zdGFuY2VvZiBTaG93Q2FyZEFjdGlvbiAmJiB0aGlzLmlzQWN0aW9uQWxsb3dlZCh0aGlzLml0ZW1zWzBdKSkge1xyXG4gICAgICAgICAgICB0aGlzLnNob3dBY3Rpb25DYXJkKHRoaXMuaXRlbXNbMF0sIHRydWUpO1xyXG4gICAgICAgICAgICB0aGlzLl9yZW5kZXJlZEFjdGlvbkNvdW50ID0gMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHZhciBidXR0b25TdHJpcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICAgIGJ1dHRvblN0cmlwLmNsYXNzTmFtZSA9IGhvc3RDb25maWcubWFrZUNzc0NsYXNzTmFtZShcImFjLWFjdGlvblNldFwiKTtcclxuICAgICAgICAgICAgYnV0dG9uU3RyaXAuc3R5bGUuZGlzcGxheSA9IFwiZmxleFwiO1xyXG4gICAgICAgICAgICBpZiAob3JpZW50YXRpb24gPT0gRW51bXMuT3JpZW50YXRpb24uSG9yaXpvbnRhbCkge1xyXG4gICAgICAgICAgICAgICAgYnV0dG9uU3RyaXAuc3R5bGUuZmxleERpcmVjdGlvbiA9IFwicm93XCI7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fb3duZXIuaG9yaXpvbnRhbEFsaWdubWVudCAmJiBob3N0Q29uZmlnLmFjdGlvbnMuYWN0aW9uQWxpZ25tZW50ICE9IEVudW1zLkFjdGlvbkFsaWdubWVudC5TdHJldGNoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0aGlzLl9vd25lci5ob3Jpem9udGFsQWxpZ25tZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRW51bXMuSG9yaXpvbnRhbEFsaWdubWVudC5DZW50ZXI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBidXR0b25TdHJpcC5zdHlsZS5qdXN0aWZ5Q29udGVudCA9IFwiY2VudGVyXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFbnVtcy5Ib3Jpem9udGFsQWxpZ25tZW50LlJpZ2h0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uU3RyaXAuc3R5bGUuanVzdGlmeUNvbnRlbnQgPSBcImZsZXgtZW5kXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvblN0cmlwLnN0eWxlLmp1c3RpZnlDb250ZW50ID0gXCJmbGV4LXN0YXJ0XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKGhvc3RDb25maWcuYWN0aW9ucy5hY3Rpb25BbGlnbm1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFbnVtcy5BY3Rpb25BbGlnbm1lbnQuQ2VudGVyOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uU3RyaXAuc3R5bGUuanVzdGlmeUNvbnRlbnQgPSBcImNlbnRlclwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRW51bXMuQWN0aW9uQWxpZ25tZW50LlJpZ2h0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uU3RyaXAuc3R5bGUuanVzdGlmeUNvbnRlbnQgPSBcImZsZXgtZW5kXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvblN0cmlwLnN0eWxlLmp1c3RpZnlDb250ZW50ID0gXCJmbGV4LXN0YXJ0XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBidXR0b25TdHJpcC5zdHlsZS5mbGV4RGlyZWN0aW9uID0gXCJjb2x1bW5cIjtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9vd25lci5ob3Jpem9udGFsQWxpZ25tZW50ICYmIGhvc3RDb25maWcuYWN0aW9ucy5hY3Rpb25BbGlnbm1lbnQgIT0gRW51bXMuQWN0aW9uQWxpZ25tZW50LlN0cmV0Y2gpIHtcclxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHRoaXMuX293bmVyLmhvcml6b250YWxBbGlnbm1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFbnVtcy5Ib3Jpem9udGFsQWxpZ25tZW50LkNlbnRlcjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvblN0cmlwLnN0eWxlLmFsaWduSXRlbXMgPSBcImNlbnRlclwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgRW51bXMuSG9yaXpvbnRhbEFsaWdubWVudC5SaWdodDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvblN0cmlwLnN0eWxlLmFsaWduSXRlbXMgPSBcImZsZXgtZW5kXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvblN0cmlwLnN0eWxlLmFsaWduSXRlbXMgPSBcImZsZXgtc3RhcnRcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoaG9zdENvbmZpZy5hY3Rpb25zLmFjdGlvbkFsaWdubWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEVudW1zLkFjdGlvbkFsaWdubWVudC5DZW50ZXI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBidXR0b25TdHJpcC5zdHlsZS5hbGlnbkl0ZW1zID0gXCJjZW50ZXJcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIEVudW1zLkFjdGlvbkFsaWdubWVudC5SaWdodDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvblN0cmlwLnN0eWxlLmFsaWduSXRlbXMgPSBcImZsZXgtZW5kXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBFbnVtcy5BY3Rpb25BbGlnbm1lbnQuU3RyZXRjaDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1dHRvblN0cmlwLnN0eWxlLmFsaWduSXRlbXMgPSBcInN0cmV0Y2hcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uU3RyaXAuc3R5bGUuYWxpZ25JdGVtcyA9IFwiZmxleC1zdGFydFwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBwYXJlbnRDb250YWluZXIgPSB0aGlzLmdldFBhcmVudENvbnRhaW5lcigpO1xyXG4gICAgICAgICAgICBpZiAocGFyZW50Q29udGFpbmVyKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcGFyZW50Q29udGFpbmVyU3R5bGUgPSBwYXJlbnRDb250YWluZXIuZ2V0RWZmZWN0aXZlU3R5bGUoKTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5pdGVtcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzQWN0aW9uQWxsb3dlZCh0aGlzLml0ZW1zW2ldKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWN0aW9uQnV0dG9uID0gdGhpcy5maW5kQWN0aW9uQnV0dG9uKHRoaXMuaXRlbXNbaV0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWFjdGlvbkJ1dHRvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uQnV0dG9uID0gbmV3IEFjdGlvbkJ1dHRvbih0aGlzLml0ZW1zW2ldLCBwYXJlbnRDb250YWluZXJTdHlsZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25CdXR0b24ub25DbGljayA9IGZ1bmN0aW9uIChhYikgeyBfdGhpcy5hY3Rpb25DbGlja2VkKGFiKTsgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYnV0dG9ucy5wdXNoKGFjdGlvbkJ1dHRvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uQnV0dG9uLnJlbmRlcigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aW9uQnV0dG9uLmFjdGlvbi5yZW5kZXJlZEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChob3N0Q29uZmlnLmFjdGlvbnMuYWN0aW9uc09yaWVudGF0aW9uID09IEVudW1zLk9yaWVudGF0aW9uLkhvcml6b250YWwgJiYgaG9zdENvbmZpZy5hY3Rpb25zLmFjdGlvbkFsaWdubWVudCA9PSBFbnVtcy5BY3Rpb25BbGlnbm1lbnQuU3RyZXRjaCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkJ1dHRvbi5hY3Rpb24ucmVuZGVyZWRFbGVtZW50LnN0eWxlLmZsZXggPSBcIjAgMSAxMDAlXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25CdXR0b24uYWN0aW9uLnJlbmRlcmVkRWxlbWVudC5zdHlsZS5mbGV4ID0gXCIwIDEgYXV0b1wiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnV0dG9uU3RyaXAuYXBwZW5kQ2hpbGQoYWN0aW9uQnV0dG9uLmFjdGlvbi5yZW5kZXJlZEVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcmVuZGVyZWRBY3Rpb25Db3VudCsrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3JlbmRlcmVkQWN0aW9uQ291bnQgPj0gaG9zdENvbmZpZy5hY3Rpb25zLm1heEFjdGlvbnMgfHwgaSA9PSB0aGlzLml0ZW1zLmxlbmd0aCAtIDEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGhvc3RDb25maWcuYWN0aW9ucy5idXR0b25TcGFjaW5nID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzcGFjZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvcmllbnRhdGlvbiA9PT0gRW51bXMuT3JpZW50YXRpb24uSG9yaXpvbnRhbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGFjZXIuc3R5bGUuZmxleCA9IFwiMCAwIGF1dG9cIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BhY2VyLnN0eWxlLndpZHRoID0gaG9zdENvbmZpZy5hY3Rpb25zLmJ1dHRvblNwYWNpbmcgKyBcInB4XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGFjZXIuc3R5bGUuaGVpZ2h0ID0gaG9zdENvbmZpZy5hY3Rpb25zLmJ1dHRvblNwYWNpbmcgKyBcInB4XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLmFwcGVuZENoaWxkKGJ1dHRvblN0cmlwLCBzcGFjZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBidXR0b25TdHJpcENvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICAgIGJ1dHRvblN0cmlwQ29udGFpbmVyLnN0eWxlLm92ZXJmbG93ID0gXCJoaWRkZW5cIjtcclxuICAgICAgICAgICAgYnV0dG9uU3RyaXBDb250YWluZXIuYXBwZW5kQ2hpbGQoYnV0dG9uU3RyaXApO1xyXG4gICAgICAgICAgICBVdGlscy5hcHBlbmRDaGlsZChlbGVtZW50LCBidXR0b25TdHJpcENvbnRhaW5lcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFV0aWxzLmFwcGVuZENoaWxkKGVsZW1lbnQsIHRoaXMuX2FjdGlvbkNhcmRDb250YWluZXIpO1xyXG4gICAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSB0aGlzLmJ1dHRvbnM7IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciBidXR0b24gPSBfYVtfaV07XHJcbiAgICAgICAgICAgIGlmIChidXR0b24uc3RhdGUgPT0gMSAvKiBFeHBhbmRlZCAqLykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5leHBhbmRTaG93Q2FyZEFjdGlvbihidXR0b24uYWN0aW9uLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5fcmVuZGVyZWRBY3Rpb25Db3VudCA+IDAgPyBlbGVtZW50IDogdW5kZWZpbmVkO1xyXG4gICAgfTtcclxuICAgIEFjdGlvbkNvbGxlY3Rpb24ucHJvdG90eXBlLmFkZEFjdGlvbiA9IGZ1bmN0aW9uIChhY3Rpb24pIHtcclxuICAgICAgICBpZiAoIWFjdGlvbikge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGUgYWN0aW9uIHBhcmFtZXRlciBjYW5ub3QgYmUgbnVsbC5cIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICgoIWFjdGlvbi5wYXJlbnQgfHwgYWN0aW9uLnBhcmVudCA9PT0gdGhpcy5fb3duZXIpICYmIHRoaXMuaXRlbXMuaW5kZXhPZihhY3Rpb24pIDwgMCkge1xyXG4gICAgICAgICAgICB0aGlzLml0ZW1zLnB1c2goYWN0aW9uKTtcclxuICAgICAgICAgICAgaWYgKCFhY3Rpb24ucGFyZW50KSB7XHJcbiAgICAgICAgICAgICAgICBhY3Rpb24uc2V0UGFyZW50KHRoaXMuX293bmVyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBhY3Rpb25bXCJfYWN0aW9uQ29sbGVjdGlvblwiXSA9IHRoaXM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGUgYWN0aW9uIGFscmVhZHkgYmVsb25ncyB0byBhbm90aGVyIGVsZW1lbnQuXCIpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBBY3Rpb25Db2xsZWN0aW9uLnByb3RvdHlwZS5yZW1vdmVBY3Rpb24gPSBmdW5jdGlvbiAoYWN0aW9uKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZXhwYW5kZWRBY3Rpb24gJiYgdGhpcy5fZXhwYW5kZWRBY3Rpb24gPT0gYWN0aW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29sbGFwc2VFeHBhbmRlZEFjdGlvbigpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgYWN0aW9uSW5kZXggPSB0aGlzLml0ZW1zLmluZGV4T2YoYWN0aW9uKTtcclxuICAgICAgICBpZiAoYWN0aW9uSW5kZXggPj0gMCkge1xyXG4gICAgICAgICAgICB0aGlzLml0ZW1zLnNwbGljZShhY3Rpb25JbmRleCwgMSk7XHJcbiAgICAgICAgICAgIGFjdGlvbi5zZXRQYXJlbnQodW5kZWZpbmVkKTtcclxuICAgICAgICAgICAgYWN0aW9uW1wiX2FjdGlvbkNvbGxlY3Rpb25cIl0gPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5idXR0b25zLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5idXR0b25zW2ldLmFjdGlvbiA9PSBhY3Rpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmJ1dHRvbnMuc3BsaWNlKGksIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9O1xyXG4gICAgQWN0aW9uQ29sbGVjdGlvbi5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5pdGVtcyA9IFtdO1xyXG4gICAgICAgIHRoaXMuYnV0dG9ucyA9IFtdO1xyXG4gICAgICAgIHRoaXMuX2V4cGFuZGVkQWN0aW9uID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHRoaXMuX3JlbmRlcmVkQWN0aW9uQ291bnQgPSAwO1xyXG4gICAgfTtcclxuICAgIEFjdGlvbkNvbGxlY3Rpb24ucHJvdG90eXBlLmdldEFsbElucHV0cyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgcmVzdWx0ID0gW107XHJcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHRoaXMuaXRlbXM7IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciBhY3Rpb24gPSBfYVtfaV07XHJcbiAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdC5jb25jYXQoYWN0aW9uLmdldEFsbElucHV0cygpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH07XHJcbiAgICBBY3Rpb25Db2xsZWN0aW9uLnByb3RvdHlwZS5nZXRSZXNvdXJjZUluZm9ybWF0aW9uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciByZXN1bHQgPSBbXTtcclxuICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gdGhpcy5pdGVtczsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgdmFyIGFjdGlvbiA9IF9hW19pXTtcclxuICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0LmNvbmNhdChhY3Rpb24uZ2V0UmVzb3VyY2VJbmZvcm1hdGlvbigpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH07XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQWN0aW9uQ29sbGVjdGlvbi5wcm90b3R5cGUsIFwicmVuZGVyZWRBY3Rpb25Db3VudFwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZW5kZXJlZEFjdGlvbkNvdW50O1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEFjdGlvbkNvbGxlY3Rpb24ucHJvdG90eXBlLCBcImV4cGFuZGVkQWN0aW9uXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2V4cGFuZGVkQWN0aW9uO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIEFjdGlvbkNvbGxlY3Rpb247XHJcbn0oKSk7XHJcbnZhciBBY3Rpb25TZXQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoQWN0aW9uU2V0LCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gQWN0aW9uU2V0KCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMuX2FjdGlvbkNvbGxlY3Rpb24gPSBuZXcgQWN0aW9uQ29sbGVjdGlvbihfdGhpcyk7XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgQWN0aW9uU2V0LnByb3RvdHlwZS5pbnRlcm5hbFBhcnNlID0gZnVuY3Rpb24gKHNvdXJjZSwgY29udGV4dCkge1xyXG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUuaW50ZXJuYWxQYXJzZS5jYWxsKHRoaXMsIHNvdXJjZSwgY29udGV4dCk7XHJcbiAgICAgICAgdGhpcy5fYWN0aW9uQ29sbGVjdGlvbi5wYXJzZShzb3VyY2VbXCJhY3Rpb25zXCJdLCBjb250ZXh0KTtcclxuICAgIH07XHJcbiAgICBBY3Rpb25TZXQucHJvdG90eXBlLmludGVybmFsVG9KU09OID0gZnVuY3Rpb24gKHRhcmdldCwgY29udGV4dCkge1xyXG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUuaW50ZXJuYWxUb0pTT04uY2FsbCh0aGlzLCB0YXJnZXQsIGNvbnRleHQpO1xyXG4gICAgICAgIHRoaXMuX2FjdGlvbkNvbGxlY3Rpb24udG9KU09OKHRhcmdldCwgXCJhY3Rpb25zXCIsIGNvbnRleHQpO1xyXG4gICAgfTtcclxuICAgIEFjdGlvblNldC5wcm90b3R5cGUuaW50ZXJuYWxSZW5kZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2FjdGlvbkNvbGxlY3Rpb24ucmVuZGVyKHRoaXMub3JpZW50YXRpb24gIT09IHVuZGVmaW5lZCA/IHRoaXMub3JpZW50YXRpb24gOiB0aGlzLmhvc3RDb25maWcuYWN0aW9ucy5hY3Rpb25zT3JpZW50YXRpb24sIHRoaXMuaXNEZXNpZ25Nb2RlKCkpO1xyXG4gICAgfTtcclxuICAgIEFjdGlvblNldC5wcm90b3R5cGUuaXNCbGVlZGluZ0F0Qm90dG9tID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9hY3Rpb25Db2xsZWN0aW9uLnJlbmRlcmVkQWN0aW9uQ291bnQgPT0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gX3N1cGVyLnByb3RvdHlwZS5pc0JsZWVkaW5nQXRCb3R0b20uY2FsbCh0aGlzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9hY3Rpb25Db2xsZWN0aW9uLml0ZW1zLmxlbmd0aCA9PSAxKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYWN0aW9uQ29sbGVjdGlvbi5leHBhbmRlZEFjdGlvbiAhPT0gdW5kZWZpbmVkICYmICF0aGlzLmhvc3RDb25maWcuYWN0aW9ucy5wcmVFeHBhbmRTaW5nbGVTaG93Q2FyZEFjdGlvbjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9hY3Rpb25Db2xsZWN0aW9uLmV4cGFuZGVkQWN0aW9uICE9PSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgQWN0aW9uU2V0LnByb3RvdHlwZS5nZXRKc29uVHlwZU5hbWUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIFwiQWN0aW9uU2V0XCI7XHJcbiAgICB9O1xyXG4gICAgQWN0aW9uU2V0LnByb3RvdHlwZS5nZXRBY3Rpb25Db3VudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fYWN0aW9uQ29sbGVjdGlvbi5pdGVtcy5sZW5ndGg7XHJcbiAgICB9O1xyXG4gICAgQWN0aW9uU2V0LnByb3RvdHlwZS5nZXRBY3Rpb25BdCA9IGZ1bmN0aW9uIChpbmRleCkge1xyXG4gICAgICAgIGlmIChpbmRleCA+PSAwICYmIGluZGV4IDwgdGhpcy5nZXRBY3Rpb25Db3VudCgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hY3Rpb25Db2xsZWN0aW9uLml0ZW1zW2luZGV4XTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBfc3VwZXIucHJvdG90eXBlLmdldEFjdGlvbkF0LmNhbGwodGhpcywgaW5kZXgpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBBY3Rpb25TZXQucHJvdG90eXBlLmludGVybmFsVmFsaWRhdGVQcm9wZXJ0aWVzID0gZnVuY3Rpb24gKGNvbnRleHQpIHtcclxuICAgICAgICBfc3VwZXIucHJvdG90eXBlLmludGVybmFsVmFsaWRhdGVQcm9wZXJ0aWVzLmNhbGwodGhpcywgY29udGV4dCk7XHJcbiAgICAgICAgdGhpcy5fYWN0aW9uQ29sbGVjdGlvbi52YWxpZGF0ZVByb3BlcnRpZXMoY29udGV4dCk7XHJcbiAgICB9O1xyXG4gICAgQWN0aW9uU2V0LnByb3RvdHlwZS5hZGRBY3Rpb24gPSBmdW5jdGlvbiAoYWN0aW9uKSB7XHJcbiAgICAgICAgdGhpcy5fYWN0aW9uQ29sbGVjdGlvbi5hZGRBY3Rpb24oYWN0aW9uKTtcclxuICAgIH07XHJcbiAgICBBY3Rpb25TZXQucHJvdG90eXBlLmdldEFsbElucHV0cyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fYWN0aW9uQ29sbGVjdGlvbi5nZXRBbGxJbnB1dHMoKTtcclxuICAgIH07XHJcbiAgICBBY3Rpb25TZXQucHJvdG90eXBlLmdldFJlc291cmNlSW5mb3JtYXRpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2FjdGlvbkNvbGxlY3Rpb24uZ2V0UmVzb3VyY2VJbmZvcm1hdGlvbigpO1xyXG4gICAgfTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShBY3Rpb25TZXQucHJvdG90eXBlLCBcImlzSW50ZXJhY3RpdmVcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIC8vI3JlZ2lvbiBTY2hlbWFcclxuICAgIEFjdGlvblNldC5vcmllbnRhdGlvblByb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5FbnVtUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzEsIFwib3JpZW50YXRpb25cIiwgRW51bXMuT3JpZW50YXRpb24pO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KEFjdGlvblNldC5vcmllbnRhdGlvblByb3BlcnR5KVxyXG4gICAgXSwgQWN0aW9uU2V0LnByb3RvdHlwZSwgXCJvcmllbnRhdGlvblwiLCB2b2lkIDApO1xyXG4gICAgcmV0dXJuIEFjdGlvblNldDtcclxufShDYXJkRWxlbWVudCkpO1xyXG5leHBvcnRzLkFjdGlvblNldCA9IEFjdGlvblNldDtcclxudmFyIFN0eWxhYmxlQ2FyZEVsZW1lbnRDb250YWluZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoU3R5bGFibGVDYXJkRWxlbWVudENvbnRhaW5lciwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIFN0eWxhYmxlQ2FyZEVsZW1lbnRDb250YWluZXIoKSB7XHJcbiAgICAgICAgLy8jcmVnaW9uIFNjaGVtYVxyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLl9ibGVlZCA9IGZhbHNlO1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTdHlsYWJsZUNhcmRFbGVtZW50Q29udGFpbmVyLnByb3RvdHlwZSwgXCJzdHlsZVwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmFsbG93Q3VzdG9tU3R5bGUpIHtcclxuICAgICAgICAgICAgICAgIHZhciBzdHlsZSA9IHRoaXMuZ2V0VmFsdWUoU3R5bGFibGVDYXJkRWxlbWVudENvbnRhaW5lci5zdHlsZVByb3BlcnR5KTtcclxuICAgICAgICAgICAgICAgIGlmIChzdHlsZSAmJiB0aGlzLmhvc3RDb25maWcuY29udGFpbmVyU3R5bGVzLmdldFN0eWxlQnlOYW1lKHN0eWxlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzdHlsZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICAgICAgdGhpcy5zZXRWYWx1ZShTdHlsYWJsZUNhcmRFbGVtZW50Q29udGFpbmVyLnN0eWxlUHJvcGVydHksIHZhbHVlKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIC8vI2VuZHJlZ2lvblxyXG4gICAgU3R5bGFibGVDYXJkRWxlbWVudENvbnRhaW5lci5wcm90b3R5cGUuYWRqdXN0UmVuZGVyZWRFbGVtZW50U2l6ZSA9IGZ1bmN0aW9uIChyZW5kZXJlZEVsZW1lbnQpIHtcclxuICAgICAgICBfc3VwZXIucHJvdG90eXBlLmFkanVzdFJlbmRlcmVkRWxlbWVudFNpemUuY2FsbCh0aGlzLCByZW5kZXJlZEVsZW1lbnQpO1xyXG4gICAgICAgIGlmICh0aGlzLm1pblBpeGVsSGVpZ2h0KSB7XHJcbiAgICAgICAgICAgIHJlbmRlcmVkRWxlbWVudC5zdHlsZS5taW5IZWlnaHQgPSB0aGlzLm1pblBpeGVsSGVpZ2h0ICsgXCJweFwiO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBTdHlsYWJsZUNhcmRFbGVtZW50Q29udGFpbmVyLnByb3RvdHlwZS5hcHBseUJhY2tncm91bmQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMucmVuZGVyZWRFbGVtZW50KSB7XHJcbiAgICAgICAgICAgIHZhciBzdHlsZURlZmluaXRpb24gPSB0aGlzLmhvc3RDb25maWcuY29udGFpbmVyU3R5bGVzLmdldFN0eWxlQnlOYW1lKHRoaXMuc3R5bGUsIHRoaXMuaG9zdENvbmZpZy5jb250YWluZXJTdHlsZXMuZ2V0U3R5bGVCeU5hbWUodGhpcy5kZWZhdWx0U3R5bGUpKTtcclxuICAgICAgICAgICAgaWYgKHN0eWxlRGVmaW5pdGlvbi5iYWNrZ3JvdW5kQ29sb3IpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZWRFbGVtZW50LnN0eWxlLmJhY2tncm91bmRDb2xvciA9IFV0aWxzLnN0cmluZ1RvQ3NzQ29sb3Ioc3R5bGVEZWZpbml0aW9uLmJhY2tncm91bmRDb2xvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgU3R5bGFibGVDYXJkRWxlbWVudENvbnRhaW5lci5wcm90b3R5cGUuYXBwbHlQYWRkaW5nID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUuYXBwbHlQYWRkaW5nLmNhbGwodGhpcyk7XHJcbiAgICAgICAgaWYgKCF0aGlzLnJlbmRlcmVkRWxlbWVudCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBwaHlzaWNhbFBhZGRpbmcgPSBuZXcgc2hhcmVkXzEuU3BhY2luZ0RlZmluaXRpb24oKTtcclxuICAgICAgICBpZiAodGhpcy5nZXRFZmZlY3RpdmVQYWRkaW5nKCkpIHtcclxuICAgICAgICAgICAgcGh5c2ljYWxQYWRkaW5nID0gdGhpcy5ob3N0Q29uZmlnLnBhZGRpbmdEZWZpbml0aW9uVG9TcGFjaW5nRGVmaW5pdGlvbih0aGlzLmdldEVmZmVjdGl2ZVBhZGRpbmcoKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucmVuZGVyZWRFbGVtZW50LnN0eWxlLnBhZGRpbmdUb3AgPSBwaHlzaWNhbFBhZGRpbmcudG9wICsgXCJweFwiO1xyXG4gICAgICAgIHRoaXMucmVuZGVyZWRFbGVtZW50LnN0eWxlLnBhZGRpbmdSaWdodCA9IHBoeXNpY2FsUGFkZGluZy5yaWdodCArIFwicHhcIjtcclxuICAgICAgICB0aGlzLnJlbmRlcmVkRWxlbWVudC5zdHlsZS5wYWRkaW5nQm90dG9tID0gcGh5c2ljYWxQYWRkaW5nLmJvdHRvbSArIFwicHhcIjtcclxuICAgICAgICB0aGlzLnJlbmRlcmVkRWxlbWVudC5zdHlsZS5wYWRkaW5nTGVmdCA9IHBoeXNpY2FsUGFkZGluZy5sZWZ0ICsgXCJweFwiO1xyXG4gICAgICAgIGlmICh0aGlzLmlzQmxlZWRpbmcoKSkge1xyXG4gICAgICAgICAgICAvLyBCbGVlZCBpbnRvIHRoZSBmaXJzdCBwYXJlbnQgdGhhdCBkb2VzIGhhdmUgcGFkZGluZ1xyXG4gICAgICAgICAgICB2YXIgcGFkZGluZyA9IG5ldyBzaGFyZWRfMS5QYWRkaW5nRGVmaW5pdGlvbigpO1xyXG4gICAgICAgICAgICB0aGlzLmdldEltbWVkaWF0ZVN1cnJvdW5kaW5nUGFkZGluZyhwYWRkaW5nKTtcclxuICAgICAgICAgICAgdmFyIHN1cnJvdW5kaW5nUGFkZGluZyA9IHRoaXMuaG9zdENvbmZpZy5wYWRkaW5nRGVmaW5pdGlvblRvU3BhY2luZ0RlZmluaXRpb24ocGFkZGluZyk7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZWRFbGVtZW50LnN0eWxlLm1hcmdpblJpZ2h0ID0gXCItXCIgKyBzdXJyb3VuZGluZ1BhZGRpbmcucmlnaHQgKyBcInB4XCI7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZWRFbGVtZW50LnN0eWxlLm1hcmdpbkxlZnQgPSBcIi1cIiArIHN1cnJvdW5kaW5nUGFkZGluZy5sZWZ0ICsgXCJweFwiO1xyXG4gICAgICAgICAgICBpZiAoIXRoaXMuaXNEZXNpZ25Nb2RlKCkpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZWRFbGVtZW50LnN0eWxlLm1hcmdpblRvcCA9IFwiLVwiICsgc3Vycm91bmRpbmdQYWRkaW5nLnRvcCArIFwicHhcIjtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZWRFbGVtZW50LnN0eWxlLm1hcmdpbkJvdHRvbSA9IFwiLVwiICsgc3Vycm91bmRpbmdQYWRkaW5nLmJvdHRvbSArIFwicHhcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5zZXBhcmF0b3JFbGVtZW50ICYmIHRoaXMuc2VwYXJhdG9yT3JpZW50YXRpb24gPT0gRW51bXMuT3JpZW50YXRpb24uSG9yaXpvbnRhbCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXBhcmF0b3JFbGVtZW50LnN0eWxlLm1hcmdpbkxlZnQgPSBcIi1cIiArIHN1cnJvdW5kaW5nUGFkZGluZy5sZWZ0ICsgXCJweFwiO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXBhcmF0b3JFbGVtZW50LnN0eWxlLm1hcmdpblJpZ2h0ID0gXCItXCIgKyBzdXJyb3VuZGluZ1BhZGRpbmcucmlnaHQgKyBcInB4XCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZWRFbGVtZW50LnN0eWxlLm1hcmdpblJpZ2h0ID0gXCIwXCI7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZWRFbGVtZW50LnN0eWxlLm1hcmdpbkxlZnQgPSBcIjBcIjtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJlZEVsZW1lbnQuc3R5bGUubWFyZ2luVG9wID0gXCIwXCI7XHJcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZWRFbGVtZW50LnN0eWxlLm1hcmdpbkJvdHRvbSA9IFwiMFwiO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5zZXBhcmF0b3JFbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNlcGFyYXRvckVsZW1lbnQuc3R5bGUubWFyZ2luUmlnaHQgPSBcIjBcIjtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2VwYXJhdG9yRWxlbWVudC5zdHlsZS5tYXJnaW5MZWZ0ID0gXCIwXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgU3R5bGFibGVDYXJkRWxlbWVudENvbnRhaW5lci5wcm90b3R5cGUuZ2V0SGFzQmFja2dyb3VuZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgY3VycmVudEVsZW1lbnQgPSB0aGlzLnBhcmVudDtcclxuICAgICAgICB3aGlsZSAoY3VycmVudEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgdmFyIGN1cnJlbnRFbGVtZW50SGFzQmFja2dyb3VuZEltYWdlID0gY3VycmVudEVsZW1lbnQgaW5zdGFuY2VvZiBDb250YWluZXIgPyBjdXJyZW50RWxlbWVudC5iYWNrZ3JvdW5kSW1hZ2UuaXNWYWxpZCgpIDogZmFsc2U7XHJcbiAgICAgICAgICAgIGlmIChjdXJyZW50RWxlbWVudCBpbnN0YW5jZW9mIFN0eWxhYmxlQ2FyZEVsZW1lbnRDb250YWluZXIpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmhhc0V4cGxpY2l0U3R5bGUgJiYgKGN1cnJlbnRFbGVtZW50LmdldEVmZmVjdGl2ZVN0eWxlKCkgIT0gdGhpcy5nZXRFZmZlY3RpdmVTdHlsZSgpIHx8IGN1cnJlbnRFbGVtZW50SGFzQmFja2dyb3VuZEltYWdlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGN1cnJlbnRFbGVtZW50ID0gY3VycmVudEVsZW1lbnQucGFyZW50O1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9O1xyXG4gICAgU3R5bGFibGVDYXJkRWxlbWVudENvbnRhaW5lci5wcm90b3R5cGUuZ2V0RGVmYXVsdFBhZGRpbmcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0SGFzQmFja2dyb3VuZCgpID9cclxuICAgICAgICAgICAgbmV3IHNoYXJlZF8xLlBhZGRpbmdEZWZpbml0aW9uKEVudW1zLlNwYWNpbmcuUGFkZGluZywgRW51bXMuU3BhY2luZy5QYWRkaW5nLCBFbnVtcy5TcGFjaW5nLlBhZGRpbmcsIEVudW1zLlNwYWNpbmcuUGFkZGluZykgOiBfc3VwZXIucHJvdG90eXBlLmdldERlZmF1bHRQYWRkaW5nLmNhbGwodGhpcyk7XHJcbiAgICB9O1xyXG4gICAgU3R5bGFibGVDYXJkRWxlbWVudENvbnRhaW5lci5wcm90b3R5cGUuZ2V0SGFzRXhwYW5kZWRBY3Rpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfTtcclxuICAgIFN0eWxhYmxlQ2FyZEVsZW1lbnRDb250YWluZXIucHJvdG90eXBlLmdldEJsZWVkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9ibGVlZDtcclxuICAgIH07XHJcbiAgICBTdHlsYWJsZUNhcmRFbGVtZW50Q29udGFpbmVyLnByb3RvdHlwZS5zZXRCbGVlZCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgIHRoaXMuX2JsZWVkID0gdmFsdWU7XHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFN0eWxhYmxlQ2FyZEVsZW1lbnRDb250YWluZXIucHJvdG90eXBlLCBcInJlbmRlcmVkQWN0aW9uQ291bnRcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTdHlsYWJsZUNhcmRFbGVtZW50Q29udGFpbmVyLnByb3RvdHlwZSwgXCJoYXNFeHBsaWNpdFN0eWxlXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VmFsdWUoU3R5bGFibGVDYXJkRWxlbWVudENvbnRhaW5lci5zdHlsZVByb3BlcnR5KSAhPT0gdW5kZWZpbmVkO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFN0eWxhYmxlQ2FyZEVsZW1lbnRDb250YWluZXIucHJvdG90eXBlLCBcImFsbG93Q3VzdG9tU3R5bGVcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIFN0eWxhYmxlQ2FyZEVsZW1lbnRDb250YWluZXIucHJvdG90eXBlLmlzQmxlZWRpbmcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuICh0aGlzLmdldEhhc0JhY2tncm91bmQoKSB8fCB0aGlzLmhvc3RDb25maWcuYWx3YXlzQWxsb3dCbGVlZCkgJiYgdGhpcy5nZXRCbGVlZCgpO1xyXG4gICAgfTtcclxuICAgIFN0eWxhYmxlQ2FyZEVsZW1lbnRDb250YWluZXIucHJvdG90eXBlLmludGVybmFsVmFsaWRhdGVQcm9wZXJ0aWVzID0gZnVuY3Rpb24gKGNvbnRleHQpIHtcclxuICAgICAgICBfc3VwZXIucHJvdG90eXBlLmludGVybmFsVmFsaWRhdGVQcm9wZXJ0aWVzLmNhbGwodGhpcywgY29udGV4dCk7XHJcbiAgICAgICAgdmFyIGV4cGxpY2l0U3R5bGUgPSB0aGlzLmdldFZhbHVlKFN0eWxhYmxlQ2FyZEVsZW1lbnRDb250YWluZXIuc3R5bGVQcm9wZXJ0eSk7XHJcbiAgICAgICAgaWYgKGV4cGxpY2l0U3R5bGUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB2YXIgc3R5bGVEZWZpbml0aW9uID0gdGhpcy5ob3N0Q29uZmlnLmNvbnRhaW5lclN0eWxlcy5nZXRTdHlsZUJ5TmFtZShleHBsaWNpdFN0eWxlKTtcclxuICAgICAgICAgICAgaWYgKCFzdHlsZURlZmluaXRpb24pIHtcclxuICAgICAgICAgICAgICAgIGNvbnRleHQuYWRkRmFpbHVyZSh0aGlzLCA2IC8qIEludmFsaWRQcm9wZXJ0eVZhbHVlICovLCBcIlVua25vd24gY29udGFpbmVyIHN0eWxlOiBcIiArIGV4cGxpY2l0U3R5bGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFN0eWxhYmxlQ2FyZEVsZW1lbnRDb250YWluZXIucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgcmVuZGVyZWRFbGVtZW50ID0gX3N1cGVyLnByb3RvdHlwZS5yZW5kZXIuY2FsbCh0aGlzKTtcclxuICAgICAgICBpZiAocmVuZGVyZWRFbGVtZW50ICYmIHRoaXMuZ2V0SGFzQmFja2dyb3VuZCgpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYXBwbHlCYWNrZ3JvdW5kKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZW5kZXJlZEVsZW1lbnQ7XHJcbiAgICB9O1xyXG4gICAgU3R5bGFibGVDYXJkRWxlbWVudENvbnRhaW5lci5wcm90b3R5cGUuZ2V0RWZmZWN0aXZlU3R5bGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGVmZmVjdGl2ZVN0eWxlID0gdGhpcy5zdHlsZTtcclxuICAgICAgICByZXR1cm4gZWZmZWN0aXZlU3R5bGUgPyBlZmZlY3RpdmVTdHlsZSA6IF9zdXBlci5wcm90b3R5cGUuZ2V0RWZmZWN0aXZlU3R5bGUuY2FsbCh0aGlzKTtcclxuICAgIH07XHJcbiAgICBTdHlsYWJsZUNhcmRFbGVtZW50Q29udGFpbmVyLnN0eWxlUHJvcGVydHkgPSBuZXcgc2VyaWFsaXphdGlvbl8xLlZhbHVlU2V0UHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzAsIFwic3R5bGVcIiwgW1xyXG4gICAgICAgIHsgdmFsdWU6IEVudW1zLkNvbnRhaW5lclN0eWxlLkRlZmF1bHQgfSxcclxuICAgICAgICB7IHZhbHVlOiBFbnVtcy5Db250YWluZXJTdHlsZS5FbXBoYXNpcyB9LFxyXG4gICAgICAgIHsgdGFyZ2V0VmVyc2lvbjogc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzIsIHZhbHVlOiBFbnVtcy5Db250YWluZXJTdHlsZS5BY2NlbnQgfSxcclxuICAgICAgICB7IHRhcmdldFZlcnNpb246IHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8yLCB2YWx1ZTogRW51bXMuQ29udGFpbmVyU3R5bGUuR29vZCB9LFxyXG4gICAgICAgIHsgdGFyZ2V0VmVyc2lvbjogc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzIsIHZhbHVlOiBFbnVtcy5Db250YWluZXJTdHlsZS5BdHRlbnRpb24gfSxcclxuICAgICAgICB7IHRhcmdldFZlcnNpb246IHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8yLCB2YWx1ZTogRW51bXMuQ29udGFpbmVyU3R5bGUuV2FybmluZyB9XHJcbiAgICBdKTtcclxuICAgIFN0eWxhYmxlQ2FyZEVsZW1lbnRDb250YWluZXIuYmxlZWRQcm9wZXJ0eSA9IG5ldyBzZXJpYWxpemF0aW9uXzEuQm9vbFByb3BlcnR5KHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8yLCBcImJsZWVkXCIsIGZhbHNlKTtcclxuICAgIFN0eWxhYmxlQ2FyZEVsZW1lbnRDb250YWluZXIubWluSGVpZ2h0UHJvcGVydHkgPSBuZXcgc2VyaWFsaXphdGlvbl8xLlBpeGVsU2l6ZVByb3BlcnR5KHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8yLCBcIm1pbkhlaWdodFwiKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHNlcmlhbGl6YXRpb25fMS5wcm9wZXJ0eShTdHlsYWJsZUNhcmRFbGVtZW50Q29udGFpbmVyLnN0eWxlUHJvcGVydHkpXHJcbiAgICBdLCBTdHlsYWJsZUNhcmRFbGVtZW50Q29udGFpbmVyLnByb3RvdHlwZSwgXCJzdHlsZVwiLCBudWxsKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHNlcmlhbGl6YXRpb25fMS5wcm9wZXJ0eShTdHlsYWJsZUNhcmRFbGVtZW50Q29udGFpbmVyLmJsZWVkUHJvcGVydHkpXHJcbiAgICBdLCBTdHlsYWJsZUNhcmRFbGVtZW50Q29udGFpbmVyLnByb3RvdHlwZSwgXCJfYmxlZWRcIiwgdm9pZCAwKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHNlcmlhbGl6YXRpb25fMS5wcm9wZXJ0eShTdHlsYWJsZUNhcmRFbGVtZW50Q29udGFpbmVyLm1pbkhlaWdodFByb3BlcnR5KVxyXG4gICAgXSwgU3R5bGFibGVDYXJkRWxlbWVudENvbnRhaW5lci5wcm90b3R5cGUsIFwibWluUGl4ZWxIZWlnaHRcIiwgdm9pZCAwKTtcclxuICAgIHJldHVybiBTdHlsYWJsZUNhcmRFbGVtZW50Q29udGFpbmVyO1xyXG59KENhcmRFbGVtZW50Q29udGFpbmVyKSk7XHJcbmV4cG9ydHMuU3R5bGFibGVDYXJkRWxlbWVudENvbnRhaW5lciA9IFN0eWxhYmxlQ2FyZEVsZW1lbnRDb250YWluZXI7XHJcbnZhciBCYWNrZ3JvdW5kSW1hZ2UgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoQmFja2dyb3VuZEltYWdlLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gQmFja2dyb3VuZEltYWdlKCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgIH1cclxuICAgIC8vI2VuZHJlZ2lvblxyXG4gICAgQmFja2dyb3VuZEltYWdlLnByb3RvdHlwZS5nZXRTY2hlbWFLZXkgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIFwiQmFja2dyb3VuZEltYWdlXCI7XHJcbiAgICB9O1xyXG4gICAgQmFja2dyb3VuZEltYWdlLnByb3RvdHlwZS5pbnRlcm5hbFBhcnNlID0gZnVuY3Rpb24gKHNvdXJjZSwgY29udGV4dCkge1xyXG4gICAgICAgIGlmICh0eXBlb2Ygc291cmNlID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgIHRoaXMucmVzZXREZWZhdWx0VmFsdWVzKCk7XHJcbiAgICAgICAgICAgIHRoaXMudXJsID0gc291cmNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIF9zdXBlci5wcm90b3R5cGUuaW50ZXJuYWxQYXJzZS5jYWxsKHRoaXMsIHNvdXJjZSwgY29udGV4dCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEJhY2tncm91bmRJbWFnZS5wcm90b3R5cGUuYXBwbHkgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xyXG4gICAgICAgIGlmICh0aGlzLnVybCAmJiBlbGVtZW50LnJlbmRlcmVkRWxlbWVudCkge1xyXG4gICAgICAgICAgICBlbGVtZW50LnJlbmRlcmVkRWxlbWVudC5zdHlsZS5iYWNrZ3JvdW5kSW1hZ2UgPSBcInVybCgnXCIgKyBlbGVtZW50LnByZVByb2Nlc3NQcm9wZXJ0eVZhbHVlKEJhY2tncm91bmRJbWFnZS51cmxQcm9wZXJ0eSwgdGhpcy51cmwpICsgXCInKVwiO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHRoaXMuZmlsbE1vZGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgRW51bXMuRmlsbE1vZGUuUmVwZWF0OlxyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQucmVuZGVyZWRFbGVtZW50LnN0eWxlLmJhY2tncm91bmRSZXBlYXQgPSBcInJlcGVhdFwiO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBFbnVtcy5GaWxsTW9kZS5SZXBlYXRIb3Jpem9udGFsbHk6XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5yZW5kZXJlZEVsZW1lbnQuc3R5bGUuYmFja2dyb3VuZFJlcGVhdCA9IFwicmVwZWF0LXhcIjtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgRW51bXMuRmlsbE1vZGUuUmVwZWF0VmVydGljYWxseTpcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnJlbmRlcmVkRWxlbWVudC5zdHlsZS5iYWNrZ3JvdW5kUmVwZWF0ID0gXCJyZXBlYXQteVwiO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBFbnVtcy5GaWxsTW9kZS5Db3ZlcjpcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5yZW5kZXJlZEVsZW1lbnQuc3R5bGUuYmFja2dyb3VuZFJlcGVhdCA9IFwibm8tcmVwZWF0XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5yZW5kZXJlZEVsZW1lbnQuc3R5bGUuYmFja2dyb3VuZFNpemUgPSBcImNvdmVyXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc3dpdGNoICh0aGlzLmhvcml6b250YWxBbGlnbm1lbnQpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgRW51bXMuSG9yaXpvbnRhbEFsaWdubWVudC5DZW50ZXI6XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5yZW5kZXJlZEVsZW1lbnQuc3R5bGUuYmFja2dyb3VuZFBvc2l0aW9uWCA9IFwiY2VudGVyXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIEVudW1zLkhvcml6b250YWxBbGlnbm1lbnQuUmlnaHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5yZW5kZXJlZEVsZW1lbnQuc3R5bGUuYmFja2dyb3VuZFBvc2l0aW9uWCA9IFwicmlnaHRcIjtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzd2l0Y2ggKHRoaXMudmVydGljYWxBbGlnbm1lbnQpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgRW51bXMuVmVydGljYWxBbGlnbm1lbnQuQ2VudGVyOlxyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQucmVuZGVyZWRFbGVtZW50LnN0eWxlLmJhY2tncm91bmRQb3NpdGlvblkgPSBcImNlbnRlclwiO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBFbnVtcy5WZXJ0aWNhbEFsaWdubWVudC5Cb3R0b206XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5yZW5kZXJlZEVsZW1lbnQuc3R5bGUuYmFja2dyb3VuZFBvc2l0aW9uWSA9IFwiYm90dG9tXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgQmFja2dyb3VuZEltYWdlLnByb3RvdHlwZS5pc1ZhbGlkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnVybCA/IHRydWUgOiBmYWxzZTtcclxuICAgIH07XHJcbiAgICAvLyNyZWdpb24gU2NoZW1hXHJcbiAgICBCYWNrZ3JvdW5kSW1hZ2UudXJsUHJvcGVydHkgPSBuZXcgc2VyaWFsaXphdGlvbl8xLlN0cmluZ1Byb3BlcnR5KHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8wLCBcInVybFwiKTtcclxuICAgIEJhY2tncm91bmRJbWFnZS5maWxsTW9kZVByb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5FbnVtUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzIsIFwiZmlsbE1vZGVcIiwgRW51bXMuRmlsbE1vZGUsIEVudW1zLkZpbGxNb2RlLkNvdmVyKTtcclxuICAgIEJhY2tncm91bmRJbWFnZS5ob3Jpem9udGFsQWxpZ25tZW50UHJvcGVydHkgPSBuZXcgc2VyaWFsaXphdGlvbl8xLkVudW1Qcm9wZXJ0eShzZXJpYWxpemF0aW9uXzEuVmVyc2lvbnMudjFfMiwgXCJob3Jpem9udGFsQWxpZ25tZW50XCIsIEVudW1zLkhvcml6b250YWxBbGlnbm1lbnQsIEVudW1zLkhvcml6b250YWxBbGlnbm1lbnQuTGVmdCk7XHJcbiAgICBCYWNrZ3JvdW5kSW1hZ2UudmVydGljYWxBbGlnbm1lbnRQcm9wZXJ0eSA9IG5ldyBzZXJpYWxpemF0aW9uXzEuRW51bVByb3BlcnR5KHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8yLCBcInZlcnRpY2FsQWxpZ25tZW50XCIsIEVudW1zLlZlcnRpY2FsQWxpZ25tZW50LCBFbnVtcy5WZXJ0aWNhbEFsaWdubWVudC5Ub3ApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KEJhY2tncm91bmRJbWFnZS51cmxQcm9wZXJ0eSlcclxuICAgIF0sIEJhY2tncm91bmRJbWFnZS5wcm90b3R5cGUsIFwidXJsXCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBzZXJpYWxpemF0aW9uXzEucHJvcGVydHkoQmFja2dyb3VuZEltYWdlLmZpbGxNb2RlUHJvcGVydHkpXHJcbiAgICBdLCBCYWNrZ3JvdW5kSW1hZ2UucHJvdG90eXBlLCBcImZpbGxNb2RlXCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBzZXJpYWxpemF0aW9uXzEucHJvcGVydHkoQmFja2dyb3VuZEltYWdlLmhvcml6b250YWxBbGlnbm1lbnRQcm9wZXJ0eSlcclxuICAgIF0sIEJhY2tncm91bmRJbWFnZS5wcm90b3R5cGUsIFwiaG9yaXpvbnRhbEFsaWdubWVudFwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KEJhY2tncm91bmRJbWFnZS52ZXJ0aWNhbEFsaWdubWVudFByb3BlcnR5KVxyXG4gICAgXSwgQmFja2dyb3VuZEltYWdlLnByb3RvdHlwZSwgXCJ2ZXJ0aWNhbEFsaWdubWVudFwiLCB2b2lkIDApO1xyXG4gICAgcmV0dXJuIEJhY2tncm91bmRJbWFnZTtcclxufShzZXJpYWxpemF0aW9uXzEuU2VyaWFsaXphYmxlT2JqZWN0KSk7XHJcbmV4cG9ydHMuQmFja2dyb3VuZEltYWdlID0gQmFja2dyb3VuZEltYWdlO1xyXG52YXIgQ29udGFpbmVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKENvbnRhaW5lciwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIENvbnRhaW5lcigpIHtcclxuICAgICAgICAvLyNyZWdpb24gU2NoZW1hXHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMudmVydGljYWxDb250ZW50QWxpZ25tZW50ID0gRW51bXMuVmVydGljYWxBbGlnbm1lbnQuVG9wO1xyXG4gICAgICAgIC8vI2VuZHJlZ2lvblxyXG4gICAgICAgIF90aGlzLl9pdGVtcyA9IFtdO1xyXG4gICAgICAgIF90aGlzLl9yZW5kZXJlZEl0ZW1zID0gW107XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENvbnRhaW5lci5wcm90b3R5cGUsIFwiYmFja2dyb3VuZEltYWdlXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VmFsdWUoQ29udGFpbmVyLmJhY2tncm91bmRJbWFnZVByb3BlcnR5KTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIENvbnRhaW5lci5wcm90b3R5cGUuaW5zZXJ0SXRlbUF0ID0gZnVuY3Rpb24gKGl0ZW0sIGluZGV4LCBmb3JjZUluc2VydCkge1xyXG4gICAgICAgIGlmICghaXRlbS5wYXJlbnQgfHwgZm9yY2VJbnNlcnQpIHtcclxuICAgICAgICAgICAgaWYgKGl0ZW0uaXNTdGFuZGFsb25lKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPCAwIHx8IGluZGV4ID49IHRoaXMuX2l0ZW1zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2l0ZW1zLnB1c2goaXRlbSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9pdGVtcy5zcGxpY2UoaW5kZXgsIDAsIGl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaXRlbS5zZXRQYXJlbnQodGhpcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJFbGVtZW50cyBvZiB0eXBlIFwiICsgaXRlbS5nZXRKc29uVHlwZU5hbWUoKSArIFwiIGNhbm5vdCBiZSB1c2VkIGFzIHN0YW5kYWxvbmUgZWxlbWVudHMuXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGUgZWxlbWVudCBhbHJlYWR5IGJlbG9uZ3MgdG8gYW5vdGhlciBjb250YWluZXIuXCIpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBDb250YWluZXIucHJvdG90eXBlLnN1cHBvcnRzRXhjcGxpdGlIZWlnaHQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9O1xyXG4gICAgQ29udGFpbmVyLnByb3RvdHlwZS5nZXRJdGVtc0NvbGxlY3Rpb25Qcm9wZXJ0eU5hbWUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIFwiaXRlbXNcIjtcclxuICAgIH07XHJcbiAgICBDb250YWluZXIucHJvdG90eXBlLmFwcGx5QmFja2dyb3VuZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAodGhpcy5iYWNrZ3JvdW5kSW1hZ2UuaXNWYWxpZCgpICYmIHRoaXMucmVuZGVyZWRFbGVtZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMuYmFja2dyb3VuZEltYWdlLmFwcGx5KHRoaXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBfc3VwZXIucHJvdG90eXBlLmFwcGx5QmFja2dyb3VuZC5jYWxsKHRoaXMpO1xyXG4gICAgfTtcclxuICAgIENvbnRhaW5lci5wcm90b3R5cGUuaW50ZXJuYWxSZW5kZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5fcmVuZGVyZWRJdGVtcyA9IFtdO1xyXG4gICAgICAgIC8vIENhY2hlIGhvc3RDb25maWcgdG8gYXZvaWQgd2Fsa2luZyB0aGUgcGFyZW50IGhpZXJhcmNoeSBzZXZlcmFsIHRpbWVzXHJcbiAgICAgICAgdmFyIGhvc3RDb25maWcgPSB0aGlzLmhvc3RDb25maWc7XHJcbiAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIGlmICh0aGlzLnJ0bCAhPT0gdW5kZWZpbmVkICYmIHRoaXMucnRsKSB7XHJcbiAgICAgICAgICAgIGVsZW1lbnQuZGlyID0gXCJydGxcIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxlbWVudC5jbGFzc0xpc3QuYWRkKGhvc3RDb25maWcubWFrZUNzc0NsYXNzTmFtZShcImFjLWNvbnRhaW5lclwiKSk7XHJcbiAgICAgICAgZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XHJcbiAgICAgICAgZWxlbWVudC5zdHlsZS5mbGV4RGlyZWN0aW9uID0gXCJjb2x1bW5cIjtcclxuICAgICAgICBpZiAoc2hhcmVkXzEuR2xvYmFsU2V0dGluZ3MudXNlQWR2YW5jZWRDYXJkQm90dG9tVHJ1bmNhdGlvbikge1xyXG4gICAgICAgICAgICAvLyBGb3JjZXMgdGhlIGNvbnRhaW5lciB0byBiZSBhdCBsZWFzdCBhcyB0YWxsIGFzIGl0cyBjb250ZW50LlxyXG4gICAgICAgICAgICAvL1xyXG4gICAgICAgICAgICAvLyBGaXhlcyBhIHF1aXJrIGluIENocm9tZSB3aGVyZSwgZm9yIG5lc3RlZCBmbGV4IGVsZW1lbnRzLCB0aGVcclxuICAgICAgICAgICAgLy8gaW5uZXIgZWxlbWVudCdzIGhlaWdodCB3b3VsZCBuZXZlciBleGNlZWQgdGhlIG91dGVyIGVsZW1lbnQnc1xyXG4gICAgICAgICAgICAvLyBoZWlnaHQuIFRoaXMgY2F1c2VkIG92ZXJmbG93IHRydW5jYXRpb24gdG8gYnJlYWsgLS0gY29udGFpbmVyc1xyXG4gICAgICAgICAgICAvLyB3b3VsZCBhbHdheXMgYmUgbWVhc3VyZWQgYXMgbm90IG92ZXJmbG93aW5nLCBzaW5jZSB0aGVpciBoZWlnaHRzXHJcbiAgICAgICAgICAgIC8vIHdlcmUgY29uc3RyYWluZWQgYnkgdGhlaXIgcGFyZW50cyBhcyBvcHBvc2VkIHRvIHRydWx5IHJlZmxlY3RpbmdcclxuICAgICAgICAgICAgLy8gdGhlIGhlaWdodCBvZiB0aGVpciBjb250ZW50LlxyXG4gICAgICAgICAgICAvL1xyXG4gICAgICAgICAgICAvLyBTZWUgdGhlIFwiQnJvd3NlciBSZW5kZXJpbmcgTm90ZXNcIiBzZWN0aW9uIG9mIHRoaXMgYW5zd2VyOlxyXG4gICAgICAgICAgICAvLyBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8zNjI0NzE0MC93aHktZG9lc250LWZsZXgtaXRlbS1zaHJpbmstcGFzdC1jb250ZW50LXNpemVcclxuICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5taW5IZWlnaHQgPSAnLXdlYmtpdC1taW4tY29udGVudCc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN3aXRjaCAodGhpcy52ZXJ0aWNhbENvbnRlbnRBbGlnbm1lbnQpIHtcclxuICAgICAgICAgICAgY2FzZSBFbnVtcy5WZXJ0aWNhbEFsaWdubWVudC5DZW50ZXI6XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LnN0eWxlLmp1c3RpZnlDb250ZW50ID0gXCJjZW50ZXJcIjtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICBjYXNlIEVudW1zLlZlcnRpY2FsQWxpZ25tZW50LkJvdHRvbTpcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUuanVzdGlmeUNvbnRlbnQgPSBcImZsZXgtZW5kXCI7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUuanVzdGlmeUNvbnRlbnQgPSBcImZsZXgtc3RhcnRcIjtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5faXRlbXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gdGhpcy5faXRlbXM7IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IF9hW19pXTtcclxuICAgICAgICAgICAgICAgIHZhciByZW5kZXJlZEl0ZW0gPSB0aGlzLmlzRWxlbWVudEFsbG93ZWQoaXRlbSkgPyBpdGVtLnJlbmRlcigpIDogdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlbmRlcmVkSXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9yZW5kZXJlZEl0ZW1zLmxlbmd0aCA+IDAgJiYgaXRlbS5zZXBhcmF0b3JFbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uc2VwYXJhdG9yRWxlbWVudC5zdHlsZS5mbGV4ID0gXCIwIDAgYXV0b1wiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBVdGlscy5hcHBlbmRDaGlsZChlbGVtZW50LCBpdGVtLnNlcGFyYXRvckVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBVdGlscy5hcHBlbmRDaGlsZChlbGVtZW50LCByZW5kZXJlZEl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlbmRlcmVkSXRlbXMucHVzaChpdGVtKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuaXNEZXNpZ25Nb2RlKCkpIHtcclxuICAgICAgICAgICAgICAgIHZhciBwbGFjZWhvbGRlckVsZW1lbnQgPSB0aGlzLmNyZWF0ZVBsYWNlaG9sZGVyRWxlbWVudCgpO1xyXG4gICAgICAgICAgICAgICAgcGxhY2Vob2xkZXJFbGVtZW50LnN0eWxlLndpZHRoID0gXCIxMDAlXCI7XHJcbiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlckVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gXCIxMDAlXCI7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LmFwcGVuZENoaWxkKHBsYWNlaG9sZGVyRWxlbWVudCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XHJcbiAgICB9O1xyXG4gICAgQ29udGFpbmVyLnByb3RvdHlwZS50cnVuY2F0ZU92ZXJmbG93ID0gZnVuY3Rpb24gKG1heEhlaWdodCkge1xyXG4gICAgICAgIGlmICh0aGlzLnJlbmRlcmVkRWxlbWVudCkge1xyXG4gICAgICAgICAgICAvLyBBZGQgMSB0byBhY2NvdW50IGZvciByb3VuZGluZyBkaWZmZXJlbmNlcyBiZXR3ZWVuIGJyb3dzZXJzXHJcbiAgICAgICAgICAgIHZhciBib3VuZGFyeV8xID0gdGhpcy5yZW5kZXJlZEVsZW1lbnQub2Zmc2V0VG9wICsgbWF4SGVpZ2h0ICsgMTtcclxuICAgICAgICAgICAgdmFyIGhhbmRsZUVsZW1lbnRfMSA9IGZ1bmN0aW9uIChjYXJkRWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGVsdCA9IGNhcmRFbGVtZW50LnJlbmRlcmVkRWxlbWVudDtcclxuICAgICAgICAgICAgICAgIGlmIChlbHQpIHtcclxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKFV0aWxzLmdldEZpdFN0YXR1cyhlbHQsIGJvdW5kYXJ5XzEpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMCAvKiBGdWxseUluQ29udGFpbmVyICovOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNpemVDaGFuZ2VkID0gY2FyZEVsZW1lbnRbJ3Jlc2V0T3ZlcmZsb3cnXSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlIGVsZW1lbnQncyBzaXplIGNoYW5nZWQgYWZ0ZXIgcmVzZXR0aW5nIGNvbnRlbnQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB3ZSBoYXZlIHRvIGNoZWNrIGlmIGl0IHN0aWxsIGZpdHMgZnVsbHkgaW4gdGhlIGNhcmRcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzaXplQ2hhbmdlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZUVsZW1lbnRfMShjYXJkRWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxIC8qIE92ZXJmbG93aW5nICovOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1heEhlaWdodF8xID0gYm91bmRhcnlfMSAtIGVsdC5vZmZzZXRUb3A7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXJkRWxlbWVudFsnaGFuZGxlT3ZlcmZsb3cnXShtYXhIZWlnaHRfMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAyIC8qIEZ1bGx5T3V0T2ZDb250YWluZXIgKi86XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXJkRWxlbWVudFsnaGFuZGxlT3ZlcmZsb3cnXSgwKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHRoaXMuX2l0ZW1zOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBfYVtfaV07XHJcbiAgICAgICAgICAgICAgICBoYW5kbGVFbGVtZW50XzEoaXRlbSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH07XHJcbiAgICBDb250YWluZXIucHJvdG90eXBlLnVuZG9PdmVyZmxvd1RydW5jYXRpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHRoaXMuX2l0ZW1zOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgICAgICB2YXIgaXRlbSA9IF9hW19pXTtcclxuICAgICAgICAgICAgaXRlbVsncmVzZXRPdmVyZmxvdyddKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIENvbnRhaW5lci5wcm90b3R5cGUuZ2V0SGFzQmFja2dyb3VuZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5iYWNrZ3JvdW5kSW1hZ2UuaXNWYWxpZCgpIHx8IF9zdXBlci5wcm90b3R5cGUuZ2V0SGFzQmFja2dyb3VuZC5jYWxsKHRoaXMpO1xyXG4gICAgfTtcclxuICAgIENvbnRhaW5lci5wcm90b3R5cGUuaW50ZXJuYWxQYXJzZSA9IGZ1bmN0aW9uIChzb3VyY2UsIGNvbnRleHQpIHtcclxuICAgICAgICBfc3VwZXIucHJvdG90eXBlLmludGVybmFsUGFyc2UuY2FsbCh0aGlzLCBzb3VyY2UsIGNvbnRleHQpO1xyXG4gICAgICAgIHRoaXMuY2xlYXIoKTtcclxuICAgICAgICB0aGlzLnNldFNob3VsZEZhbGxiYWNrKGZhbHNlKTtcclxuICAgICAgICB2YXIganNvbkl0ZW1zID0gc291cmNlW3RoaXMuZ2V0SXRlbXNDb2xsZWN0aW9uUHJvcGVydHlOYW1lKCldO1xyXG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KGpzb25JdGVtcykpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBqc29uSXRlbXNfMSA9IGpzb25JdGVtczsgX2kgPCBqc29uSXRlbXNfMS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBpdGVtID0ganNvbkl0ZW1zXzFbX2ldO1xyXG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBjb250ZXh0LnBhcnNlRWxlbWVudCh0aGlzLCBpdGVtLCAhdGhpcy5pc0Rlc2lnbk1vZGUoKSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW5zZXJ0SXRlbUF0KGVsZW1lbnQsIC0xLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBDb250YWluZXIucHJvdG90eXBlLmludGVybmFsVG9KU09OID0gZnVuY3Rpb24gKHRhcmdldCwgY29udGV4dCkge1xyXG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUuaW50ZXJuYWxUb0pTT04uY2FsbCh0aGlzLCB0YXJnZXQsIGNvbnRleHQpO1xyXG4gICAgICAgIGNvbnRleHQuc2VyaWFsaXplQXJyYXkodGFyZ2V0LCB0aGlzLmdldEl0ZW1zQ29sbGVjdGlvblByb3BlcnR5TmFtZSgpLCB0aGlzLl9pdGVtcyk7XHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENvbnRhaW5lci5wcm90b3R5cGUsIFwiaXNTZWxlY3RhYmxlXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBDb250YWluZXIucHJvdG90eXBlLmdldEl0ZW1Db3VudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5faXRlbXMubGVuZ3RoO1xyXG4gICAgfTtcclxuICAgIENvbnRhaW5lci5wcm90b3R5cGUuZ2V0SXRlbUF0ID0gZnVuY3Rpb24gKGluZGV4KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2l0ZW1zW2luZGV4XTtcclxuICAgIH07XHJcbiAgICBDb250YWluZXIucHJvdG90eXBlLmdldEZpcnN0VmlzaWJsZVJlbmRlcmVkSXRlbSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAodGhpcy5yZW5kZXJlZEVsZW1lbnQgJiYgdGhpcy5fcmVuZGVyZWRJdGVtcyAmJiB0aGlzLl9yZW5kZXJlZEl0ZW1zLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHRoaXMuX3JlbmRlcmVkSXRlbXM7IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IF9hW19pXTtcclxuICAgICAgICAgICAgICAgIGlmIChpdGVtLmlzVmlzaWJsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpdGVtO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgIH07XHJcbiAgICBDb250YWluZXIucHJvdG90eXBlLmdldExhc3RWaXNpYmxlUmVuZGVyZWRJdGVtID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLnJlbmRlcmVkRWxlbWVudCAmJiB0aGlzLl9yZW5kZXJlZEl0ZW1zICYmIHRoaXMuX3JlbmRlcmVkSXRlbXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gdGhpcy5fcmVuZGVyZWRJdGVtcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX3JlbmRlcmVkSXRlbXNbaV0uaXNWaXNpYmxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlbmRlcmVkSXRlbXNbaV07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgIH07XHJcbiAgICBDb250YWluZXIucHJvdG90eXBlLmdldEpzb25UeXBlTmFtZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gXCJDb250YWluZXJcIjtcclxuICAgIH07XHJcbiAgICBDb250YWluZXIucHJvdG90eXBlLmlzRmlyc3RFbGVtZW50ID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcclxuICAgICAgICB2YXIgZGVzaWduTW9kZSA9IHRoaXMuaXNEZXNpZ25Nb2RlKCk7XHJcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHRoaXMuX2l0ZW1zOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgICAgICB2YXIgaXRlbSA9IF9hW19pXTtcclxuICAgICAgICAgICAgaWYgKGl0ZW0uaXNWaXNpYmxlIHx8IGRlc2lnbk1vZGUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtID09IGVsZW1lbnQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfTtcclxuICAgIENvbnRhaW5lci5wcm90b3R5cGUuaXNMYXN0RWxlbWVudCA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XHJcbiAgICAgICAgdmFyIGRlc2lnbk1vZGUgPSB0aGlzLmlzRGVzaWduTW9kZSgpO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSB0aGlzLl9pdGVtcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5faXRlbXNbaV0uaXNWaXNpYmxlIHx8IGRlc2lnbk1vZGUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9pdGVtc1tpXSA9PSBlbGVtZW50O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH07XHJcbiAgICBDb250YWluZXIucHJvdG90eXBlLmlzUnRsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLnJ0bCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnJ0bDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHZhciBwYXJlbnRDb250YWluZXIgPSB0aGlzLmdldFBhcmVudENvbnRhaW5lcigpO1xyXG4gICAgICAgICAgICByZXR1cm4gcGFyZW50Q29udGFpbmVyID8gcGFyZW50Q29udGFpbmVyLmlzUnRsKCkgOiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgQ29udGFpbmVyLnByb3RvdHlwZS5pc0JsZWVkaW5nQXRUb3AgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGZpcnN0UmVuZGVyZWRJdGVtID0gdGhpcy5nZXRGaXJzdFZpc2libGVSZW5kZXJlZEl0ZW0oKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5pc0JsZWVkaW5nKCkgfHwgKGZpcnN0UmVuZGVyZWRJdGVtID8gZmlyc3RSZW5kZXJlZEl0ZW0uaXNCbGVlZGluZ0F0VG9wKCkgOiBmYWxzZSk7XHJcbiAgICB9O1xyXG4gICAgQ29udGFpbmVyLnByb3RvdHlwZS5pc0JsZWVkaW5nQXRCb3R0b20gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGxhc3RSZW5kZXJlZEl0ZW0gPSB0aGlzLmdldExhc3RWaXNpYmxlUmVuZGVyZWRJdGVtKCk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNCbGVlZGluZygpIHx8IChsYXN0UmVuZGVyZWRJdGVtID8gbGFzdFJlbmRlcmVkSXRlbS5pc0JsZWVkaW5nQXRCb3R0b20oKSAmJiBsYXN0UmVuZGVyZWRJdGVtLmdldEVmZmVjdGl2ZVN0eWxlKCkgPT0gdGhpcy5nZXRFZmZlY3RpdmVTdHlsZSgpIDogZmFsc2UpO1xyXG4gICAgfTtcclxuICAgIENvbnRhaW5lci5wcm90b3R5cGUuaW5kZXhPZiA9IGZ1bmN0aW9uIChjYXJkRWxlbWVudCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9pdGVtcy5pbmRleE9mKGNhcmRFbGVtZW50KTtcclxuICAgIH07XHJcbiAgICBDb250YWluZXIucHJvdG90eXBlLmFkZEl0ZW0gPSBmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgIHRoaXMuaW5zZXJ0SXRlbUF0KGl0ZW0sIC0xLCBmYWxzZSk7XHJcbiAgICB9O1xyXG4gICAgQ29udGFpbmVyLnByb3RvdHlwZS5pbnNlcnRJdGVtQmVmb3JlID0gZnVuY3Rpb24gKGl0ZW0sIGluc2VydEJlZm9yZSkge1xyXG4gICAgICAgIHRoaXMuaW5zZXJ0SXRlbUF0KGl0ZW0sIHRoaXMuX2l0ZW1zLmluZGV4T2YoaW5zZXJ0QmVmb3JlKSwgZmFsc2UpO1xyXG4gICAgfTtcclxuICAgIENvbnRhaW5lci5wcm90b3R5cGUuaW5zZXJ0SXRlbUFmdGVyID0gZnVuY3Rpb24gKGl0ZW0sIGluc2VydEFmdGVyKSB7XHJcbiAgICAgICAgdGhpcy5pbnNlcnRJdGVtQXQoaXRlbSwgdGhpcy5faXRlbXMuaW5kZXhPZihpbnNlcnRBZnRlcikgKyAxLCBmYWxzZSk7XHJcbiAgICB9O1xyXG4gICAgQ29udGFpbmVyLnByb3RvdHlwZS5yZW1vdmVJdGVtID0gZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICB2YXIgaXRlbUluZGV4ID0gdGhpcy5faXRlbXMuaW5kZXhPZihpdGVtKTtcclxuICAgICAgICBpZiAoaXRlbUluZGV4ID49IDApIHtcclxuICAgICAgICAgICAgdGhpcy5faXRlbXMuc3BsaWNlKGl0ZW1JbmRleCwgMSk7XHJcbiAgICAgICAgICAgIGl0ZW0uc2V0UGFyZW50KHVuZGVmaW5lZCk7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlTGF5b3V0KCk7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9O1xyXG4gICAgQ29udGFpbmVyLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLl9pdGVtcyA9IFtdO1xyXG4gICAgICAgIHRoaXMuX3JlbmRlcmVkSXRlbXMgPSBbXTtcclxuICAgIH07XHJcbiAgICBDb250YWluZXIucHJvdG90eXBlLmdldFJlc291cmNlSW5mb3JtYXRpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IF9zdXBlci5wcm90b3R5cGUuZ2V0UmVzb3VyY2VJbmZvcm1hdGlvbi5jYWxsKHRoaXMpO1xyXG4gICAgICAgIGlmICh0aGlzLmJhY2tncm91bmRJbWFnZS5pc1ZhbGlkKCkpIHtcclxuICAgICAgICAgICAgcmVzdWx0LnB1c2goe1xyXG4gICAgICAgICAgICAgICAgdXJsOiB0aGlzLmJhY2tncm91bmRJbWFnZS51cmwsXHJcbiAgICAgICAgICAgICAgICBtaW1lVHlwZTogXCJpbWFnZVwiXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuICAgIENvbnRhaW5lci5wcm90b3R5cGUuZ2V0QWN0aW9uQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xyXG4gICAgICAgIHZhciByZXN1bHQgPSBfc3VwZXIucHJvdG90eXBlLmdldEFjdGlvbkJ5SWQuY2FsbCh0aGlzLCBpZCk7XHJcbiAgICAgICAgaWYgKCFyZXN1bHQpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0QWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgPSB0aGlzLnNlbGVjdEFjdGlvbi5nZXRBY3Rpb25CeUlkKGlkKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIXJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHRoaXMuX2l0ZW1zOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpdGVtID0gX2FbX2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGl0ZW0uZ2V0QWN0aW9uQnlJZChpZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH07XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ29udGFpbmVyLnByb3RvdHlwZSwgXCJwYWRkaW5nXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UGFkZGluZygpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICAgICAgdGhpcy5zZXRQYWRkaW5nKHZhbHVlKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb250YWluZXIucHJvdG90eXBlLCBcInNlbGVjdEFjdGlvblwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zZWxlY3RBY3Rpb247XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgICAgICB0aGlzLl9zZWxlY3RBY3Rpb24gPSB2YWx1ZTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb250YWluZXIucHJvdG90eXBlLCBcImJsZWVkXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QmxlZWQoKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0QmxlZWQodmFsdWUpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgQ29udGFpbmVyLmJhY2tncm91bmRJbWFnZVByb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5TZXJpYWxpemFibGVPYmplY3RQcm9wZXJ0eShzZXJpYWxpemF0aW9uXzEuVmVyc2lvbnMudjFfMCwgXCJiYWNrZ3JvdW5kSW1hZ2VcIiwgQmFja2dyb3VuZEltYWdlKTtcclxuICAgIENvbnRhaW5lci52ZXJ0aWNhbENvbnRlbnRBbGlnbm1lbnRQcm9wZXJ0eSA9IG5ldyBzZXJpYWxpemF0aW9uXzEuRW51bVByb3BlcnR5KHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8xLCBcInZlcnRpY2FsQ29udGVudEFsaWdubWVudFwiLCBFbnVtcy5WZXJ0aWNhbEFsaWdubWVudCwgRW51bXMuVmVydGljYWxBbGlnbm1lbnQuVG9wKTtcclxuICAgIENvbnRhaW5lci5ydGxQcm9wZXJ0eSA9IG5ldyBzZXJpYWxpemF0aW9uXzEuQm9vbFByb3BlcnR5KHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8wLCBcInJ0bFwiKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHNlcmlhbGl6YXRpb25fMS5wcm9wZXJ0eShDb250YWluZXIuYmFja2dyb3VuZEltYWdlUHJvcGVydHkpXHJcbiAgICBdLCBDb250YWluZXIucHJvdG90eXBlLCBcImJhY2tncm91bmRJbWFnZVwiLCBudWxsKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHNlcmlhbGl6YXRpb25fMS5wcm9wZXJ0eShDb250YWluZXIudmVydGljYWxDb250ZW50QWxpZ25tZW50UHJvcGVydHkpXHJcbiAgICBdLCBDb250YWluZXIucHJvdG90eXBlLCBcInZlcnRpY2FsQ29udGVudEFsaWdubWVudFwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KENvbnRhaW5lci5ydGxQcm9wZXJ0eSlcclxuICAgIF0sIENvbnRhaW5lci5wcm90b3R5cGUsIFwicnRsXCIsIHZvaWQgMCk7XHJcbiAgICByZXR1cm4gQ29udGFpbmVyO1xyXG59KFN0eWxhYmxlQ2FyZEVsZW1lbnRDb250YWluZXIpKTtcclxuZXhwb3J0cy5Db250YWluZXIgPSBDb250YWluZXI7XHJcbnZhciBDb2x1bW4gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoQ29sdW1uLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gQ29sdW1uKHdpZHRoKSB7XHJcbiAgICAgICAgaWYgKHdpZHRoID09PSB2b2lkIDApIHsgd2lkdGggPSBcInN0cmV0Y2hcIjsgfVxyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMud2lkdGggPSBcInN0cmV0Y2hcIjtcclxuICAgICAgICAvLyNlbmRyZWdpb25cclxuICAgICAgICBfdGhpcy5fY29tcHV0ZWRXZWlnaHQgPSAwO1xyXG4gICAgICAgIF90aGlzLndpZHRoID0gd2lkdGg7XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgQ29sdW1uLnByb3RvdHlwZS5hZGp1c3RSZW5kZXJlZEVsZW1lbnRTaXplID0gZnVuY3Rpb24gKHJlbmRlcmVkRWxlbWVudCkge1xyXG4gICAgICAgIHZhciBtaW5EZXNpZ25UaW1lQ29sdW1uSGVpZ2h0ID0gMjA7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNEZXNpZ25Nb2RlKCkpIHtcclxuICAgICAgICAgICAgcmVuZGVyZWRFbGVtZW50LnN0eWxlLm1pbldpZHRoID0gXCIyMHB4XCI7XHJcbiAgICAgICAgICAgIHJlbmRlcmVkRWxlbWVudC5zdHlsZS5taW5IZWlnaHQgPSAoIXRoaXMubWluUGl4ZWxIZWlnaHQgPyBtaW5EZXNpZ25UaW1lQ29sdW1uSGVpZ2h0IDogTWF0aC5tYXgodGhpcy5taW5QaXhlbEhlaWdodCwgbWluRGVzaWduVGltZUNvbHVtbkhlaWdodCkpICsgXCJweFwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmVuZGVyZWRFbGVtZW50LnN0eWxlLm1pbldpZHRoID0gXCIwXCI7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm1pblBpeGVsSGVpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICByZW5kZXJlZEVsZW1lbnQuc3R5bGUubWluSGVpZ2h0ID0gdGhpcy5taW5QaXhlbEhlaWdodCArIFwicHhcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy53aWR0aCA9PT0gXCJhdXRvXCIpIHtcclxuICAgICAgICAgICAgcmVuZGVyZWRFbGVtZW50LnN0eWxlLmZsZXggPSBcIjAgMSBhdXRvXCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHRoaXMud2lkdGggPT09IFwic3RyZXRjaFwiKSB7XHJcbiAgICAgICAgICAgIHJlbmRlcmVkRWxlbWVudC5zdHlsZS5mbGV4ID0gXCIxIDEgNTBweFwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICh0aGlzLndpZHRoIGluc3RhbmNlb2Ygc2hhcmVkXzEuU2l6ZUFuZFVuaXQpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMud2lkdGgudW5pdCA9PSBFbnVtcy5TaXplVW5pdC5QaXhlbCkge1xyXG4gICAgICAgICAgICAgICAgcmVuZGVyZWRFbGVtZW50LnN0eWxlLmZsZXggPSBcIjAgMCBhdXRvXCI7XHJcbiAgICAgICAgICAgICAgICByZW5kZXJlZEVsZW1lbnQuc3R5bGUud2lkdGggPSB0aGlzLndpZHRoLnBoeXNpY2FsU2l6ZSArIFwicHhcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJlbmRlcmVkRWxlbWVudC5zdHlsZS5mbGV4ID0gXCIxIDEgXCIgKyAodGhpcy5fY29tcHV0ZWRXZWlnaHQgPiAwID8gdGhpcy5fY29tcHV0ZWRXZWlnaHQgOiB0aGlzLndpZHRoLnBoeXNpY2FsU2l6ZSkgKyBcIiVcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ29sdW1uLnByb3RvdHlwZSwgXCJzZXBhcmF0b3JPcmllbnRhdGlvblwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBFbnVtcy5PcmllbnRhdGlvbi5WZXJ0aWNhbDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIENvbHVtbi5wcm90b3R5cGUuZ2V0SnNvblR5cGVOYW1lID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBcIkNvbHVtblwiO1xyXG4gICAgfTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb2x1bW4ucHJvdG90eXBlLCBcImhhc1Zpc2libGVTZXBhcmF0b3JcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5wYXJlbnQgJiYgdGhpcy5wYXJlbnQgaW5zdGFuY2VvZiBDb2x1bW5TZXQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNlcGFyYXRvckVsZW1lbnQgIT09IHVuZGVmaW5lZCAmJiAhdGhpcy5wYXJlbnQuaXNMZWZ0TW9zdEVsZW1lbnQodGhpcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb2x1bW4ucHJvdG90eXBlLCBcImlzU3RhbmRhbG9uZVwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIC8vI3JlZ2lvbiBTY2hlbWFcclxuICAgIENvbHVtbi53aWR0aFByb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5DdXN0b21Qcm9wZXJ0eShzZXJpYWxpemF0aW9uXzEuVmVyc2lvbnMudjFfMCwgXCJ3aWR0aFwiLCBmdW5jdGlvbiAoc2VuZGVyLCBwcm9wZXJ0eSwgc291cmNlLCBjb250ZXh0KSB7XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IHByb3BlcnR5LmRlZmF1bHRWYWx1ZTtcclxuICAgICAgICB2YXIgdmFsdWUgPSBzb3VyY2VbcHJvcGVydHkubmFtZV07XHJcbiAgICAgICAgdmFyIGludmFsaWRXaWR0aCA9IGZhbHNlO1xyXG4gICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09IFwibnVtYmVyXCIgJiYgIWlzTmFOKHZhbHVlKSkge1xyXG4gICAgICAgICAgICByZXN1bHQgPSBuZXcgc2hhcmVkXzEuU2l6ZUFuZFVuaXQodmFsdWUsIEVudW1zLlNpemVVbml0LldlaWdodCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHZhbHVlID09PSBcImF1dG9cIiB8fCB2YWx1ZSA9PT0gXCJzdHJldGNoXCIpIHtcclxuICAgICAgICAgICAgcmVzdWx0ID0gdmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0gc2hhcmVkXzEuU2l6ZUFuZFVuaXQucGFyc2UodmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC51bml0ID09PSBFbnVtcy5TaXplVW5pdC5QaXhlbCAmJiBwcm9wZXJ0eS50YXJnZXRWZXJzaW9uLmNvbXBhcmVUbyhjb250ZXh0LnRhcmdldFZlcnNpb24pID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGludmFsaWRXaWR0aCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgIGludmFsaWRXaWR0aCA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGludmFsaWRXaWR0aCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpbnZhbGlkV2lkdGgpIHtcclxuICAgICAgICAgICAgY29udGV4dC5sb2dQYXJzZUV2ZW50KDYgLyogSW52YWxpZFByb3BlcnR5VmFsdWUgKi8sIFwiSW52YWxpZCBjb2x1bW4gd2lkdGg6XCIgKyB2YWx1ZSArIFwiIC0gZGVmYXVsdGluZyB0byBcXFwiYXV0b1xcXCJcIiwgc2VuZGVyKTtcclxuICAgICAgICAgICAgcmVzdWx0ID0gXCJhdXRvXCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9LCBmdW5jdGlvbiAoc2VuZGVyLCBwcm9wZXJ0eSwgdGFyZ2V0LCB2YWx1ZSwgY29udGV4dCkge1xyXG4gICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIHNoYXJlZF8xLlNpemVBbmRVbml0KSB7XHJcbiAgICAgICAgICAgIGlmICh2YWx1ZS51bml0ID09PSBFbnVtcy5TaXplVW5pdC5QaXhlbCkge1xyXG4gICAgICAgICAgICAgICAgY29udGV4dC5zZXJpYWxpemVWYWx1ZSh0YXJnZXQsIFwid2lkdGhcIiwgdmFsdWUucGh5c2ljYWxTaXplICsgXCJweFwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnRleHQuc2VyaWFsaXplTnVtYmVyKHRhcmdldCwgXCJ3aWR0aFwiLCB2YWx1ZS5waHlzaWNhbFNpemUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb250ZXh0LnNlcmlhbGl6ZVZhbHVlKHRhcmdldCwgXCJ3aWR0aFwiLCB2YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSwgXCJzdHJldGNoXCIpO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KENvbHVtbi53aWR0aFByb3BlcnR5KVxyXG4gICAgXSwgQ29sdW1uLnByb3RvdHlwZSwgXCJ3aWR0aFwiLCB2b2lkIDApO1xyXG4gICAgcmV0dXJuIENvbHVtbjtcclxufShDb250YWluZXIpKTtcclxuZXhwb3J0cy5Db2x1bW4gPSBDb2x1bW47XHJcbnZhciBDb2x1bW5TZXQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoQ29sdW1uU2V0LCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gQ29sdW1uU2V0KCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLl9jb2x1bW5zID0gW107XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgQ29sdW1uU2V0LnByb3RvdHlwZS5jcmVhdGVDb2x1bW5JbnN0YW5jZSA9IGZ1bmN0aW9uIChzb3VyY2UsIGNvbnRleHQpIHtcclxuICAgICAgICByZXR1cm4gY29udGV4dC5wYXJzZUNhcmRPYmplY3QodGhpcywgc291cmNlLCBbXSwgLy8gRm9yYmlkZGVuIHR5cGVzIG5vdCBzdXBwb3J0ZWQgZm9yIGVsZW1lbnRzIGZvciBub3dcclxuICAgICAgICAhdGhpcy5pc0Rlc2lnbk1vZGUoKSwgZnVuY3Rpb24gKHR5cGVOYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAhdHlwZU5hbWUgfHwgdHlwZU5hbWUgPT09IFwiQ29sdW1uXCIgPyBuZXcgQ29sdW1uKCkgOiB1bmRlZmluZWQ7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKHR5cGVOYW1lLCBlcnJvclR5cGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIGVycm9yOiA0IC8qIEVsZW1lbnRUeXBlTm90QWxsb3dlZCAqLyxcclxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiSW52YWxpZCBlbGVtZW50IHR5cGUgXCIgKyB0eXBlTmFtZSArIFwiLiBPbmx5IENvbHVtbiBlbGVtZW50cyBhcmUgYWxsb3dlZCBpbiBhIENvbHVtblNldC5cIlxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIENvbHVtblNldC5wcm90b3R5cGUuaW50ZXJuYWxSZW5kZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5fcmVuZGVyZWRDb2x1bW5zID0gW107XHJcbiAgICAgICAgaWYgKHRoaXMuX2NvbHVtbnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAvLyBDYWNoZSBob3N0Q29uZmlnIHRvIGF2b2lkIHdhbGtpbmcgdGhlIHBhcmVudCBoaWVyYXJjaHkgc2V2ZXJhbCB0aW1lc1xyXG4gICAgICAgICAgICB2YXIgaG9zdENvbmZpZyA9IHRoaXMuaG9zdENvbmZpZztcclxuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICBlbGVtZW50LmNsYXNzTmFtZSA9IGhvc3RDb25maWcubWFrZUNzc0NsYXNzTmFtZShcImFjLWNvbHVtblNldFwiKTtcclxuICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XHJcbiAgICAgICAgICAgIGlmIChzaGFyZWRfMS5HbG9iYWxTZXR0aW5ncy51c2VBZHZhbmNlZENhcmRCb3R0b21UcnVuY2F0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBTZWUgY29tbWVudCBpbiBDb250YWluZXIuaW50ZXJuYWxSZW5kZXIoKVxyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5taW5IZWlnaHQgPSAnLXdlYmtpdC1taW4tY29udGVudCc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc3dpdGNoICh0aGlzLmhvcml6b250YWxBbGlnbm1lbnQpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgRW51bXMuSG9yaXpvbnRhbEFsaWdubWVudC5DZW50ZXI6XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5qdXN0aWZ5Q29udGVudCA9IFwiY2VudGVyXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIEVudW1zLkhvcml6b250YWxBbGlnbm1lbnQuUmlnaHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5qdXN0aWZ5Q29udGVudCA9IFwiZmxleC1lbmRcIjtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5qdXN0aWZ5Q29udGVudCA9IFwiZmxleC1zdGFydFwiO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciB0b3RhbFdlaWdodCA9IDA7XHJcbiAgICAgICAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSB0aGlzLl9jb2x1bW5zOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNvbHVtbiA9IF9hW19pXTtcclxuICAgICAgICAgICAgICAgIGlmIChjb2x1bW4ud2lkdGggaW5zdGFuY2VvZiBzaGFyZWRfMS5TaXplQW5kVW5pdCAmJiAoY29sdW1uLndpZHRoLnVuaXQgPT0gRW51bXMuU2l6ZVVuaXQuV2VpZ2h0KSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsV2VpZ2h0ICs9IGNvbHVtbi53aWR0aC5waHlzaWNhbFNpemU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZm9yICh2YXIgX2IgPSAwLCBfYyA9IHRoaXMuX2NvbHVtbnM7IF9iIDwgX2MubGVuZ3RoOyBfYisrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY29sdW1uID0gX2NbX2JdO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNvbHVtbi53aWR0aCBpbnN0YW5jZW9mIHNoYXJlZF8xLlNpemVBbmRVbml0ICYmIGNvbHVtbi53aWR0aC51bml0ID09IEVudW1zLlNpemVVbml0LldlaWdodCAmJiB0b3RhbFdlaWdodCA+IDApIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY29tcHV0ZWRXZWlnaHQgPSAxMDAgLyB0b3RhbFdlaWdodCAqIGNvbHVtbi53aWR0aC5waHlzaWNhbFNpemU7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gQmVzdCB3YXkgdG8gZW11bGF0ZSBcImludGVybmFsXCIgYWNjZXNzIEkga25vdyBvZlxyXG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbltcIl9jb21wdXRlZFdlaWdodFwiXSA9IGNvbXB1dGVkV2VpZ2h0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdmFyIHJlbmRlcmVkQ29sdW1uID0gY29sdW1uLnJlbmRlcigpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlbmRlcmVkQ29sdW1uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3JlbmRlcmVkQ29sdW1ucy5sZW5ndGggPiAwICYmIGNvbHVtbi5zZXBhcmF0b3JFbGVtZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbi5zZXBhcmF0b3JFbGVtZW50LnN0eWxlLmZsZXggPSBcIjAgMCBhdXRvXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFV0aWxzLmFwcGVuZENoaWxkKGVsZW1lbnQsIGNvbHVtbi5zZXBhcmF0b3JFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgVXRpbHMuYXBwZW5kQ2hpbGQoZWxlbWVudCwgcmVuZGVyZWRDb2x1bW4pO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlbmRlcmVkQ29sdW1ucy5wdXNoKGNvbHVtbik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlbmRlcmVkQ29sdW1ucy5sZW5ndGggPiAwID8gZWxlbWVudCA6IHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIENvbHVtblNldC5wcm90b3R5cGUudHJ1bmNhdGVPdmVyZmxvdyA9IGZ1bmN0aW9uIChtYXhIZWlnaHQpIHtcclxuICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gdGhpcy5fY29sdW1uczsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgdmFyIGNvbHVtbiA9IF9hW19pXTtcclxuICAgICAgICAgICAgY29sdW1uWydoYW5kbGVPdmVyZmxvdyddKG1heEhlaWdodCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfTtcclxuICAgIENvbHVtblNldC5wcm90b3R5cGUudW5kb092ZXJmbG93VHJ1bmNhdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gdGhpcy5fY29sdW1uczsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgdmFyIGNvbHVtbiA9IF9hW19pXTtcclxuICAgICAgICAgICAgY29sdW1uWydyZXNldE92ZXJmbG93J10oKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENvbHVtblNldC5wcm90b3R5cGUsIFwiaXNTZWxlY3RhYmxlXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBDb2x1bW5TZXQucHJvdG90eXBlLmludGVybmFsUGFyc2UgPSBmdW5jdGlvbiAoc291cmNlLCBjb250ZXh0KSB7XHJcbiAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5pbnRlcm5hbFBhcnNlLmNhbGwodGhpcywgc291cmNlLCBjb250ZXh0KTtcclxuICAgICAgICB0aGlzLl9jb2x1bW5zID0gW107XHJcbiAgICAgICAgdGhpcy5fcmVuZGVyZWRDb2x1bW5zID0gW107XHJcbiAgICAgICAgdmFyIGpzb25Db2x1bW5zID0gc291cmNlW1wiY29sdW1uc1wiXTtcclxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShqc29uQ29sdW1ucykpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBqc29uQ29sdW1uc18xID0ganNvbkNvbHVtbnM7IF9pIDwganNvbkNvbHVtbnNfMS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBpdGVtID0ganNvbkNvbHVtbnNfMVtfaV07XHJcbiAgICAgICAgICAgICAgICB2YXIgY29sdW1uID0gdGhpcy5jcmVhdGVDb2x1bW5JbnN0YW5jZShpdGVtLCBjb250ZXh0KTtcclxuICAgICAgICAgICAgICAgIGlmIChjb2x1bW4pIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jb2x1bW5zLnB1c2goY29sdW1uKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBDb2x1bW5TZXQucHJvdG90eXBlLmludGVybmFsVG9KU09OID0gZnVuY3Rpb24gKHRhcmdldCwgY29udGV4dCkge1xyXG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUuaW50ZXJuYWxUb0pTT04uY2FsbCh0aGlzLCB0YXJnZXQsIGNvbnRleHQpO1xyXG4gICAgICAgIGNvbnRleHQuc2VyaWFsaXplQXJyYXkodGFyZ2V0LCBcImNvbHVtbnNcIiwgdGhpcy5fY29sdW1ucyk7XHJcbiAgICB9O1xyXG4gICAgQ29sdW1uU2V0LnByb3RvdHlwZS5pc0ZpcnN0RWxlbWVudCA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XHJcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHRoaXMuX2NvbHVtbnM7IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciBjb2x1bW4gPSBfYVtfaV07XHJcbiAgICAgICAgICAgIGlmIChjb2x1bW4uaXNWaXNpYmxlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29sdW1uID09IGVsZW1lbnQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfTtcclxuICAgIENvbHVtblNldC5wcm90b3R5cGUuaXNCbGVlZGluZ0F0VG9wID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmlzQmxlZWRpbmcoKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuX3JlbmRlcmVkQ29sdW1ucyAmJiB0aGlzLl9yZW5kZXJlZENvbHVtbnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gdGhpcy5fY29sdW1uczsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBjb2x1bW4gPSBfYVtfaV07XHJcbiAgICAgICAgICAgICAgICBpZiAoY29sdW1uLmlzQmxlZWRpbmdBdFRvcCgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfTtcclxuICAgIENvbHVtblNldC5wcm90b3R5cGUuaXNCbGVlZGluZ0F0Qm90dG9tID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmlzQmxlZWRpbmcoKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuX3JlbmRlcmVkQ29sdW1ucyAmJiB0aGlzLl9yZW5kZXJlZENvbHVtbnMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gdGhpcy5fY29sdW1uczsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciBjb2x1bW4gPSBfYVtfaV07XHJcbiAgICAgICAgICAgICAgICBpZiAoY29sdW1uLmlzQmxlZWRpbmdBdEJvdHRvbSgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfTtcclxuICAgIENvbHVtblNldC5wcm90b3R5cGUuZ2V0SXRlbUNvdW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9jb2x1bW5zLmxlbmd0aDtcclxuICAgIH07XHJcbiAgICBDb2x1bW5TZXQucHJvdG90eXBlLmdldEZpcnN0VmlzaWJsZVJlbmRlcmVkSXRlbSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAodGhpcy5yZW5kZXJlZEVsZW1lbnQgJiYgdGhpcy5fcmVuZGVyZWRDb2x1bW5zICYmIHRoaXMuX3JlbmRlcmVkQ29sdW1ucy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9yZW5kZXJlZENvbHVtbnNbMF07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBDb2x1bW5TZXQucHJvdG90eXBlLmdldExhc3RWaXNpYmxlUmVuZGVyZWRJdGVtID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLnJlbmRlcmVkRWxlbWVudCAmJiB0aGlzLl9yZW5kZXJlZENvbHVtbnMgJiYgdGhpcy5fcmVuZGVyZWRDb2x1bW5zLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlbmRlcmVkQ29sdW1uc1t0aGlzLl9yZW5kZXJlZENvbHVtbnMubGVuZ3RoIC0gMV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBDb2x1bW5TZXQucHJvdG90eXBlLmdldENvbHVtbkF0ID0gZnVuY3Rpb24gKGluZGV4KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbHVtbnNbaW5kZXhdO1xyXG4gICAgfTtcclxuICAgIENvbHVtblNldC5wcm90b3R5cGUuZ2V0SXRlbUF0ID0gZnVuY3Rpb24gKGluZGV4KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Q29sdW1uQXQoaW5kZXgpO1xyXG4gICAgfTtcclxuICAgIENvbHVtblNldC5wcm90b3R5cGUuZ2V0SnNvblR5cGVOYW1lID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBcIkNvbHVtblNldFwiO1xyXG4gICAgfTtcclxuICAgIENvbHVtblNldC5wcm90b3R5cGUuaW50ZXJuYWxWYWxpZGF0ZVByb3BlcnRpZXMgPSBmdW5jdGlvbiAoY29udGV4dCkge1xyXG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUuaW50ZXJuYWxWYWxpZGF0ZVByb3BlcnRpZXMuY2FsbCh0aGlzLCBjb250ZXh0KTtcclxuICAgICAgICB2YXIgd2VpZ2h0ZWRDb2x1bW5zID0gMDtcclxuICAgICAgICB2YXIgc3RyZXRjaGVkQ29sdW1ucyA9IDA7XHJcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHRoaXMuX2NvbHVtbnM7IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciBjb2x1bW4gPSBfYVtfaV07XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY29sdW1uLndpZHRoID09PSBcIm51bWJlclwiKSB7XHJcbiAgICAgICAgICAgICAgICB3ZWlnaHRlZENvbHVtbnMrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChjb2x1bW4ud2lkdGggPT09IFwic3RyZXRjaFwiKSB7XHJcbiAgICAgICAgICAgICAgICBzdHJldGNoZWRDb2x1bW5zKys7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHdlaWdodGVkQ29sdW1ucyA+IDAgJiYgc3RyZXRjaGVkQ29sdW1ucyA+IDApIHtcclxuICAgICAgICAgICAgY29udGV4dC5hZGRGYWlsdXJlKHRoaXMsIDAgLyogSGludCAqLywgXCJJdCBpcyBub3QgcmVjb21tZW5kZWQgdG8gdXNlIHdlaWdodGVkIGFuZCBzdHJldGNoZWQgY29sdW1ucyBpbiB0aGUgc2FtZSBDb2x1bW5TZXQsIGJlY2F1c2UgaW4gc3VjaCBhIHNpdHVhdGlvbiBzdHJldGNoZWQgY29sdW1ucyB3aWxsIGFsd2F5cyBnZXQgdGhlIG1pbmltdW0gYW1vdW50IG9mIHNwYWNlLlwiKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgQ29sdW1uU2V0LnByb3RvdHlwZS5hZGRDb2x1bW4gPSBmdW5jdGlvbiAoY29sdW1uKSB7XHJcbiAgICAgICAgaWYgKCFjb2x1bW4ucGFyZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2NvbHVtbnMucHVzaChjb2x1bW4pO1xyXG4gICAgICAgICAgICBjb2x1bW4uc2V0UGFyZW50KHRoaXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVGhpcyBjb2x1bW4gYWxyZWFkeSBiZWxvbmdzIHRvIGFub3RoZXIgQ29sdW1uU2V0LlwiKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgQ29sdW1uU2V0LnByb3RvdHlwZS5yZW1vdmVJdGVtID0gZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICBpZiAoaXRlbSBpbnN0YW5jZW9mIENvbHVtbikge1xyXG4gICAgICAgICAgICB2YXIgaXRlbUluZGV4ID0gdGhpcy5fY29sdW1ucy5pbmRleE9mKGl0ZW0pO1xyXG4gICAgICAgICAgICBpZiAoaXRlbUluZGV4ID49IDApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2NvbHVtbnMuc3BsaWNlKGl0ZW1JbmRleCwgMSk7XHJcbiAgICAgICAgICAgICAgICBpdGVtLnNldFBhcmVudCh1bmRlZmluZWQpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVMYXlvdXQoKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH07XHJcbiAgICBDb2x1bW5TZXQucHJvdG90eXBlLmluZGV4T2YgPSBmdW5jdGlvbiAoY2FyZEVsZW1lbnQpIHtcclxuICAgICAgICByZXR1cm4gY2FyZEVsZW1lbnQgaW5zdGFuY2VvZiBDb2x1bW4gPyB0aGlzLl9jb2x1bW5zLmluZGV4T2YoY2FyZEVsZW1lbnQpIDogLTE7XHJcbiAgICB9O1xyXG4gICAgQ29sdW1uU2V0LnByb3RvdHlwZS5pc0xlZnRNb3N0RWxlbWVudCA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbHVtbnMuaW5kZXhPZihlbGVtZW50KSA9PSAwO1xyXG4gICAgfTtcclxuICAgIENvbHVtblNldC5wcm90b3R5cGUuaXNSaWdodE1vc3RFbGVtZW50ID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fY29sdW1ucy5pbmRleE9mKGVsZW1lbnQpID09IHRoaXMuX2NvbHVtbnMubGVuZ3RoIC0gMTtcclxuICAgIH07XHJcbiAgICBDb2x1bW5TZXQucHJvdG90eXBlLmlzVG9wRWxlbWVudCA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbHVtbnMuaW5kZXhPZihlbGVtZW50KSA+PSAwO1xyXG4gICAgfTtcclxuICAgIENvbHVtblNldC5wcm90b3R5cGUuaXNCb3R0b21FbGVtZW50ID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fY29sdW1ucy5pbmRleE9mKGVsZW1lbnQpID49IDA7XHJcbiAgICB9O1xyXG4gICAgQ29sdW1uU2V0LnByb3RvdHlwZS5nZXRBY3Rpb25CeUlkID0gZnVuY3Rpb24gKGlkKSB7XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IHVuZGVmaW5lZDtcclxuICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gdGhpcy5fY29sdW1uczsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgdmFyIGNvbHVtbiA9IF9hW19pXTtcclxuICAgICAgICAgICAgcmVzdWx0ID0gY29sdW1uLmdldEFjdGlvbkJ5SWQoaWQpO1xyXG4gICAgICAgICAgICBpZiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb2x1bW5TZXQucHJvdG90eXBlLCBcImJsZWVkXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QmxlZWQoKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0QmxlZWQodmFsdWUpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENvbHVtblNldC5wcm90b3R5cGUsIFwicGFkZGluZ1wiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFBhZGRpbmcoKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0UGFkZGluZyh2YWx1ZSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ29sdW1uU2V0LnByb3RvdHlwZSwgXCJzZWxlY3RBY3Rpb25cIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fc2VsZWN0QWN0aW9uO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICAgICAgdGhpcy5fc2VsZWN0QWN0aW9uID0gdmFsdWU7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gQ29sdW1uU2V0O1xyXG59KFN0eWxhYmxlQ2FyZEVsZW1lbnRDb250YWluZXIpKTtcclxuZXhwb3J0cy5Db2x1bW5TZXQgPSBDb2x1bW5TZXQ7XHJcbmZ1bmN0aW9uIHJhaXNlSW1hZ2VMb2FkZWRFdmVudChpbWFnZSkge1xyXG4gICAgdmFyIGNhcmQgPSBpbWFnZS5nZXRSb290RWxlbWVudCgpO1xyXG4gICAgdmFyIG9uSW1hZ2VMb2FkZWRIYW5kbGVyID0gKGNhcmQgJiYgY2FyZC5vbkltYWdlTG9hZGVkKSA/IGNhcmQub25JbWFnZUxvYWRlZCA6IEFkYXB0aXZlQ2FyZC5vbkltYWdlTG9hZGVkO1xyXG4gICAgaWYgKG9uSW1hZ2VMb2FkZWRIYW5kbGVyKSB7XHJcbiAgICAgICAgb25JbWFnZUxvYWRlZEhhbmRsZXIoaW1hZ2UpO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIHJhaXNlQW5jaG9yQ2xpY2tlZEV2ZW50KGVsZW1lbnQsIGFuY2hvcikge1xyXG4gICAgdmFyIGNhcmQgPSBlbGVtZW50LmdldFJvb3RFbGVtZW50KCk7XHJcbiAgICB2YXIgb25BbmNob3JDbGlja2VkSGFuZGxlciA9IChjYXJkICYmIGNhcmQub25BbmNob3JDbGlja2VkKSA/IGNhcmQub25BbmNob3JDbGlja2VkIDogQWRhcHRpdmVDYXJkLm9uQW5jaG9yQ2xpY2tlZDtcclxuICAgIHJldHVybiBvbkFuY2hvckNsaWNrZWRIYW5kbGVyICE9PSB1bmRlZmluZWQgPyBvbkFuY2hvckNsaWNrZWRIYW5kbGVyKGVsZW1lbnQsIGFuY2hvcikgOiBmYWxzZTtcclxufVxyXG5mdW5jdGlvbiByYWlzZUV4ZWN1dGVBY3Rpb25FdmVudChhY3Rpb24pIHtcclxuICAgIHZhciBjYXJkID0gYWN0aW9uLnBhcmVudCA/IGFjdGlvbi5wYXJlbnQuZ2V0Um9vdEVsZW1lbnQoKSA6IHVuZGVmaW5lZDtcclxuICAgIHZhciBvbkV4ZWN1dGVBY3Rpb25IYW5kbGVyID0gKGNhcmQgJiYgY2FyZC5vbkV4ZWN1dGVBY3Rpb24pID8gY2FyZC5vbkV4ZWN1dGVBY3Rpb24gOiBBZGFwdGl2ZUNhcmQub25FeGVjdXRlQWN0aW9uO1xyXG4gICAgaWYgKGFjdGlvbi5wcmVwYXJlRm9yRXhlY3V0aW9uKCkgJiYgb25FeGVjdXRlQWN0aW9uSGFuZGxlcikge1xyXG4gICAgICAgIG9uRXhlY3V0ZUFjdGlvbkhhbmRsZXIoYWN0aW9uKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiByYWlzZUlubGluZUNhcmRFeHBhbmRlZEV2ZW50KGFjdGlvbiwgaXNFeHBhbmRlZCkge1xyXG4gICAgdmFyIGNhcmQgPSBhY3Rpb24ucGFyZW50ID8gYWN0aW9uLnBhcmVudC5nZXRSb290RWxlbWVudCgpIDogdW5kZWZpbmVkO1xyXG4gICAgdmFyIG9uSW5saW5lQ2FyZEV4cGFuZGVkSGFuZGxlciA9IChjYXJkICYmIGNhcmQub25JbmxpbmVDYXJkRXhwYW5kZWQpID8gY2FyZC5vbklubGluZUNhcmRFeHBhbmRlZCA6IEFkYXB0aXZlQ2FyZC5vbklubGluZUNhcmRFeHBhbmRlZDtcclxuICAgIGlmIChvbklubGluZUNhcmRFeHBhbmRlZEhhbmRsZXIpIHtcclxuICAgICAgICBvbklubGluZUNhcmRFeHBhbmRlZEhhbmRsZXIoYWN0aW9uLCBpc0V4cGFuZGVkKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiByYWlzZUlucHV0VmFsdWVDaGFuZ2VkRXZlbnQoaW5wdXQpIHtcclxuICAgIHZhciBjYXJkID0gaW5wdXQuZ2V0Um9vdEVsZW1lbnQoKTtcclxuICAgIHZhciBvbklucHV0VmFsdWVDaGFuZ2VkSGFuZGxlciA9IChjYXJkICYmIGNhcmQub25JbnB1dFZhbHVlQ2hhbmdlZCkgPyBjYXJkLm9uSW5wdXRWYWx1ZUNoYW5nZWQgOiBBZGFwdGl2ZUNhcmQub25JbnB1dFZhbHVlQ2hhbmdlZDtcclxuICAgIGlmIChvbklucHV0VmFsdWVDaGFuZ2VkSGFuZGxlcikge1xyXG4gICAgICAgIG9uSW5wdXRWYWx1ZUNoYW5nZWRIYW5kbGVyKGlucHV0KTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiByYWlzZUVsZW1lbnRWaXNpYmlsaXR5Q2hhbmdlZEV2ZW50KGVsZW1lbnQsIHNob3VsZFVwZGF0ZUxheW91dCkge1xyXG4gICAgaWYgKHNob3VsZFVwZGF0ZUxheW91dCA9PT0gdm9pZCAwKSB7IHNob3VsZFVwZGF0ZUxheW91dCA9IHRydWU7IH1cclxuICAgIHZhciByb290RWxlbWVudCA9IGVsZW1lbnQuZ2V0Um9vdEVsZW1lbnQoKTtcclxuICAgIGlmIChzaG91bGRVcGRhdGVMYXlvdXQpIHtcclxuICAgICAgICByb290RWxlbWVudC51cGRhdGVMYXlvdXQoKTtcclxuICAgIH1cclxuICAgIHZhciBjYXJkID0gcm9vdEVsZW1lbnQ7XHJcbiAgICB2YXIgb25FbGVtZW50VmlzaWJpbGl0eUNoYW5nZWRIYW5kbGVyID0gKGNhcmQgJiYgY2FyZC5vbkVsZW1lbnRWaXNpYmlsaXR5Q2hhbmdlZCkgPyBjYXJkLm9uRWxlbWVudFZpc2liaWxpdHlDaGFuZ2VkIDogQWRhcHRpdmVDYXJkLm9uRWxlbWVudFZpc2liaWxpdHlDaGFuZ2VkO1xyXG4gICAgaWYgKG9uRWxlbWVudFZpc2liaWxpdHlDaGFuZ2VkSGFuZGxlciAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgb25FbGVtZW50VmlzaWJpbGl0eUNoYW5nZWRIYW5kbGVyKGVsZW1lbnQpO1xyXG4gICAgfVxyXG59XHJcbnZhciBDb250YWluZXJXaXRoQWN0aW9ucyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhDb250YWluZXJXaXRoQWN0aW9ucywgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIENvbnRhaW5lcldpdGhBY3Rpb25zKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMuX2FjdGlvbkNvbGxlY3Rpb24gPSBuZXcgQWN0aW9uQ29sbGVjdGlvbihfdGhpcyk7XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgQ29udGFpbmVyV2l0aEFjdGlvbnMucHJvdG90eXBlLmludGVybmFsUGFyc2UgPSBmdW5jdGlvbiAoc291cmNlLCBjb250ZXh0KSB7XHJcbiAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5pbnRlcm5hbFBhcnNlLmNhbGwodGhpcywgc291cmNlLCBjb250ZXh0KTtcclxuICAgICAgICB0aGlzLl9hY3Rpb25Db2xsZWN0aW9uLnBhcnNlKHNvdXJjZVtcImFjdGlvbnNcIl0sIGNvbnRleHQpO1xyXG4gICAgfTtcclxuICAgIENvbnRhaW5lcldpdGhBY3Rpb25zLnByb3RvdHlwZS5pbnRlcm5hbFRvSlNPTiA9IGZ1bmN0aW9uICh0YXJnZXQsIGNvbnRleHQpIHtcclxuICAgICAgICBfc3VwZXIucHJvdG90eXBlLmludGVybmFsVG9KU09OLmNhbGwodGhpcywgdGFyZ2V0LCBjb250ZXh0KTtcclxuICAgICAgICB0aGlzLl9hY3Rpb25Db2xsZWN0aW9uLnRvSlNPTih0YXJnZXQsIFwiYWN0aW9uc1wiLCBjb250ZXh0KTtcclxuICAgIH07XHJcbiAgICBDb250YWluZXJXaXRoQWN0aW9ucy5wcm90b3R5cGUuaW50ZXJuYWxSZW5kZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGVsZW1lbnQgPSBfc3VwZXIucHJvdG90eXBlLmludGVybmFsUmVuZGVyLmNhbGwodGhpcyk7XHJcbiAgICAgICAgaWYgKGVsZW1lbnQpIHtcclxuICAgICAgICAgICAgdmFyIHJlbmRlcmVkQWN0aW9ucyA9IHRoaXMuX2FjdGlvbkNvbGxlY3Rpb24ucmVuZGVyKHRoaXMuaG9zdENvbmZpZy5hY3Rpb25zLmFjdGlvbnNPcmllbnRhdGlvbiwgZmFsc2UpO1xyXG4gICAgICAgICAgICBpZiAocmVuZGVyZWRBY3Rpb25zKSB7XHJcbiAgICAgICAgICAgICAgICBVdGlscy5hcHBlbmRDaGlsZChlbGVtZW50LCBVdGlscy5yZW5kZXJTZXBhcmF0aW9uKHRoaXMuaG9zdENvbmZpZywge1xyXG4gICAgICAgICAgICAgICAgICAgIHNwYWNpbmc6IHRoaXMuaG9zdENvbmZpZy5nZXRFZmZlY3RpdmVTcGFjaW5nKHRoaXMuaG9zdENvbmZpZy5hY3Rpb25zLnNwYWNpbmcpXHJcbiAgICAgICAgICAgICAgICB9LCBFbnVtcy5PcmllbnRhdGlvbi5Ib3Jpem9udGFsKSk7XHJcbiAgICAgICAgICAgICAgICBVdGlscy5hcHBlbmRDaGlsZChlbGVtZW50LCByZW5kZXJlZEFjdGlvbnMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnJlbmRlcklmRW1wdHkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQuY2hpbGRyZW4ubGVuZ3RoID4gMCA/IGVsZW1lbnQgOiB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIENvbnRhaW5lcldpdGhBY3Rpb25zLnByb3RvdHlwZS5nZXRIYXNFeHBhbmRlZEFjdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAodGhpcy5yZW5kZXJlZEFjdGlvbkNvdW50ID09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICh0aGlzLnJlbmRlcmVkQWN0aW9uQ291bnQgPT0gMSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fYWN0aW9uQ29sbGVjdGlvbi5leHBhbmRlZEFjdGlvbiAhPT0gdW5kZWZpbmVkICYmICF0aGlzLmhvc3RDb25maWcuYWN0aW9ucy5wcmVFeHBhbmRTaW5nbGVTaG93Q2FyZEFjdGlvbjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hY3Rpb25Db2xsZWN0aW9uLmV4cGFuZGVkQWN0aW9uICE9PSB1bmRlZmluZWQ7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb250YWluZXJXaXRoQWN0aW9ucy5wcm90b3R5cGUsIFwicmVuZGVyZWRBY3Rpb25Db3VudFwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hY3Rpb25Db2xsZWN0aW9uLnJlbmRlcmVkQWN0aW9uQ291bnQ7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ29udGFpbmVyV2l0aEFjdGlvbnMucHJvdG90eXBlLCBcInJlbmRlcklmRW1wdHlcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBDb250YWluZXJXaXRoQWN0aW9ucy5wcm90b3R5cGUuZ2V0QWN0aW9uQ291bnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2FjdGlvbkNvbGxlY3Rpb24uaXRlbXMubGVuZ3RoO1xyXG4gICAgfTtcclxuICAgIENvbnRhaW5lcldpdGhBY3Rpb25zLnByb3RvdHlwZS5nZXRBY3Rpb25BdCA9IGZ1bmN0aW9uIChpbmRleCkge1xyXG4gICAgICAgIGlmIChpbmRleCA+PSAwICYmIGluZGV4IDwgdGhpcy5nZXRBY3Rpb25Db3VudCgpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hY3Rpb25Db2xsZWN0aW9uLml0ZW1zW2luZGV4XTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBfc3VwZXIucHJvdG90eXBlLmdldEFjdGlvbkF0LmNhbGwodGhpcywgaW5kZXgpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBDb250YWluZXJXaXRoQWN0aW9ucy5wcm90b3R5cGUuZ2V0QWN0aW9uQnlJZCA9IGZ1bmN0aW9uIChpZCkge1xyXG4gICAgICAgIHZhciByZXN1bHQgPSB0aGlzLl9hY3Rpb25Db2xsZWN0aW9uLmdldEFjdGlvbkJ5SWQoaWQpO1xyXG4gICAgICAgIHJldHVybiByZXN1bHQgPyByZXN1bHQgOiBfc3VwZXIucHJvdG90eXBlLmdldEFjdGlvbkJ5SWQuY2FsbCh0aGlzLCBpZCk7XHJcbiAgICB9O1xyXG4gICAgQ29udGFpbmVyV2l0aEFjdGlvbnMucHJvdG90eXBlLmludGVybmFsVmFsaWRhdGVQcm9wZXJ0aWVzID0gZnVuY3Rpb24gKGNvbnRleHQpIHtcclxuICAgICAgICBfc3VwZXIucHJvdG90eXBlLmludGVybmFsVmFsaWRhdGVQcm9wZXJ0aWVzLmNhbGwodGhpcywgY29udGV4dCk7XHJcbiAgICAgICAgaWYgKHRoaXMuX2FjdGlvbkNvbGxlY3Rpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5fYWN0aW9uQ29sbGVjdGlvbi52YWxpZGF0ZVByb3BlcnRpZXMoY29udGV4dCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIENvbnRhaW5lcldpdGhBY3Rpb25zLnByb3RvdHlwZS5pc0xhc3RFbGVtZW50ID0gZnVuY3Rpb24gKGVsZW1lbnQpIHtcclxuICAgICAgICByZXR1cm4gX3N1cGVyLnByb3RvdHlwZS5pc0xhc3RFbGVtZW50LmNhbGwodGhpcywgZWxlbWVudCkgJiYgdGhpcy5fYWN0aW9uQ29sbGVjdGlvbi5pdGVtcy5sZW5ndGggPT0gMDtcclxuICAgIH07XHJcbiAgICBDb250YWluZXJXaXRoQWN0aW9ucy5wcm90b3R5cGUuYWRkQWN0aW9uID0gZnVuY3Rpb24gKGFjdGlvbikge1xyXG4gICAgICAgIHRoaXMuX2FjdGlvbkNvbGxlY3Rpb24uYWRkQWN0aW9uKGFjdGlvbik7XHJcbiAgICB9O1xyXG4gICAgQ29udGFpbmVyV2l0aEFjdGlvbnMucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUuY2xlYXIuY2FsbCh0aGlzKTtcclxuICAgICAgICB0aGlzLl9hY3Rpb25Db2xsZWN0aW9uLmNsZWFyKCk7XHJcbiAgICB9O1xyXG4gICAgQ29udGFpbmVyV2l0aEFjdGlvbnMucHJvdG90eXBlLmdldEFsbElucHV0cyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gX3N1cGVyLnByb3RvdHlwZS5nZXRBbGxJbnB1dHMuY2FsbCh0aGlzKS5jb25jYXQodGhpcy5fYWN0aW9uQ29sbGVjdGlvbi5nZXRBbGxJbnB1dHMoKSk7XHJcbiAgICB9O1xyXG4gICAgQ29udGFpbmVyV2l0aEFjdGlvbnMucHJvdG90eXBlLmdldFJlc291cmNlSW5mb3JtYXRpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlci5wcm90b3R5cGUuZ2V0UmVzb3VyY2VJbmZvcm1hdGlvbi5jYWxsKHRoaXMpLmNvbmNhdCh0aGlzLl9hY3Rpb25Db2xsZWN0aW9uLmdldFJlc291cmNlSW5mb3JtYXRpb24oKSk7XHJcbiAgICB9O1xyXG4gICAgQ29udGFpbmVyV2l0aEFjdGlvbnMucHJvdG90eXBlLmlzQmxlZWRpbmdBdEJvdHRvbSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAodGhpcy5fYWN0aW9uQ29sbGVjdGlvbi5yZW5kZXJlZEFjdGlvbkNvdW50ID09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIF9zdXBlci5wcm90b3R5cGUuaXNCbGVlZGluZ0F0Qm90dG9tLmNhbGwodGhpcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5fYWN0aW9uQ29sbGVjdGlvbi5pdGVtcy5sZW5ndGggPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FjdGlvbkNvbGxlY3Rpb24uZXhwYW5kZWRBY3Rpb24gIT09IHVuZGVmaW5lZCAmJiAhdGhpcy5ob3N0Q29uZmlnLmFjdGlvbnMucHJlRXhwYW5kU2luZ2xlU2hvd0NhcmRBY3Rpb247XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fYWN0aW9uQ29sbGVjdGlvbi5leHBhbmRlZEFjdGlvbiAhPT0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb250YWluZXJXaXRoQWN0aW9ucy5wcm90b3R5cGUsIFwiaXNTdGFuZGFsb25lXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIENvbnRhaW5lcldpdGhBY3Rpb25zO1xyXG59KENvbnRhaW5lcikpO1xyXG5leHBvcnRzLkNvbnRhaW5lcldpdGhBY3Rpb25zID0gQ29udGFpbmVyV2l0aEFjdGlvbnM7XHJcbi8vIEBkeW5hbWljXHJcbnZhciBBZGFwdGl2ZUNhcmQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoQWRhcHRpdmVDYXJkLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gQWRhcHRpdmVDYXJkKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLmRlc2lnbk1vZGUgPSBmYWxzZTtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQWRhcHRpdmVDYXJkLCBcInByb2Nlc3NNYXJrZG93blwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlRoZSBwcm9jZXNzTWFya2Rvd24gZXZlbnQgaGFzIGJlZW4gcmVtb3ZlZC4gUGxlYXNlIHVwZGF0ZSB5b3VyIGNvZGUgYW5kIHNldCBvblByb2Nlc3NNYXJrZG93biBpbnN0ZWFkLlwiKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHNldDogZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlRoZSBwcm9jZXNzTWFya2Rvd24gZXZlbnQgaGFzIGJlZW4gcmVtb3ZlZC4gUGxlYXNlIHVwZGF0ZSB5b3VyIGNvZGUgYW5kIHNldCBvblByb2Nlc3NNYXJrZG93biBpbnN0ZWFkLlwiKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIEFkYXB0aXZlQ2FyZC5hcHBseU1hcmtkb3duID0gZnVuY3Rpb24gKHRleHQpIHtcclxuICAgICAgICB2YXIgcmVzdWx0ID0ge1xyXG4gICAgICAgICAgICBkaWRQcm9jZXNzOiBmYWxzZVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKEFkYXB0aXZlQ2FyZC5vblByb2Nlc3NNYXJrZG93bikge1xyXG4gICAgICAgICAgICBBZGFwdGl2ZUNhcmQub25Qcm9jZXNzTWFya2Rvd24odGV4dCwgcmVzdWx0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAod2luZG93Lm1hcmtkb3duaXQpIHtcclxuICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIG1hcmtkb3duaXRcclxuICAgICAgICAgICAgdmFyIG1hcmtkb3duSXQgPSB3aW5kb3cubWFya2Rvd25pdDtcclxuICAgICAgICAgICAgcmVzdWx0Lm91dHB1dEh0bWwgPSBtYXJrZG93bkl0KCkucmVuZGVyKHRleHQpO1xyXG4gICAgICAgICAgICByZXN1bHQuZGlkUHJvY2VzcyA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zb2xlLndhcm4oXCJNYXJrZG93biBwcm9jZXNzaW5nIGlzbid0IGVuYWJsZWQuIFBsZWFzZSBzZWUgaHR0cHM6Ly93d3cubnBtanMuY29tL3BhY2thZ2UvYWRhcHRpdmVjYXJkcyNzdXBwb3J0aW5nLW1hcmtkb3duXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuICAgIEFkYXB0aXZlQ2FyZC5wcm90b3R5cGUuaXNWZXJzaW9uU3VwcG9ydGVkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmJ5cGFzc1ZlcnNpb25DaGVjaykge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHZhciB1bnN1cHBvcnRlZFZlcnNpb24gPSAhdGhpcy52ZXJzaW9uIHx8XHJcbiAgICAgICAgICAgICAgICAhdGhpcy52ZXJzaW9uLmlzVmFsaWQgfHxcclxuICAgICAgICAgICAgICAgICh0aGlzLm1heFZlcnNpb24ubWFqb3IgPCB0aGlzLnZlcnNpb24ubWFqb3IpIHx8XHJcbiAgICAgICAgICAgICAgICAodGhpcy5tYXhWZXJzaW9uLm1ham9yID09IHRoaXMudmVyc2lvbi5tYWpvciAmJiB0aGlzLm1heFZlcnNpb24ubWlub3IgPCB0aGlzLnZlcnNpb24ubWlub3IpO1xyXG4gICAgICAgICAgICByZXR1cm4gIXVuc3VwcG9ydGVkVmVyc2lvbjtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgQWRhcHRpdmVDYXJkLnByb3RvdHlwZS5nZXRJdGVtc0NvbGxlY3Rpb25Qcm9wZXJ0eU5hbWUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIFwiYm9keVwiO1xyXG4gICAgfTtcclxuICAgIEFkYXB0aXZlQ2FyZC5wcm90b3R5cGUuaW50ZXJuYWxQYXJzZSA9IGZ1bmN0aW9uIChzb3VyY2UsIGNvbnRleHQpIHtcclxuICAgICAgICB0aGlzLl9mYWxsYmFja0NhcmQgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgdmFyIGZhbGxiYWNrRWxlbWVudCA9IGNvbnRleHQucGFyc2VFbGVtZW50KHVuZGVmaW5lZCwgc291cmNlW1wiZmFsbGJhY2tcIl0sICF0aGlzLmlzRGVzaWduTW9kZSgpKTtcclxuICAgICAgICBpZiAoZmFsbGJhY2tFbGVtZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2ZhbGxiYWNrQ2FyZCA9IG5ldyBBZGFwdGl2ZUNhcmQoKTtcclxuICAgICAgICAgICAgdGhpcy5fZmFsbGJhY2tDYXJkLmFkZEl0ZW0oZmFsbGJhY2tFbGVtZW50KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5pbnRlcm5hbFBhcnNlLmNhbGwodGhpcywgc291cmNlLCBjb250ZXh0KTtcclxuICAgIH07XHJcbiAgICBBZGFwdGl2ZUNhcmQucHJvdG90eXBlLmludGVybmFsVG9KU09OID0gZnVuY3Rpb24gKHRhcmdldCwgY29udGV4dCkge1xyXG4gICAgICAgIHRoaXMuc2V0VmFsdWUoQWRhcHRpdmVDYXJkLnZlcnNpb25Qcm9wZXJ0eSwgY29udGV4dC50YXJnZXRWZXJzaW9uKTtcclxuICAgICAgICBfc3VwZXIucHJvdG90eXBlLmludGVybmFsVG9KU09OLmNhbGwodGhpcywgdGFyZ2V0LCBjb250ZXh0KTtcclxuICAgIH07XHJcbiAgICBBZGFwdGl2ZUNhcmQucHJvdG90eXBlLmludGVybmFsUmVuZGVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciByZW5kZXJlZEVsZW1lbnQgPSBfc3VwZXIucHJvdG90eXBlLmludGVybmFsUmVuZGVyLmNhbGwodGhpcyk7XHJcbiAgICAgICAgaWYgKHNoYXJlZF8xLkdsb2JhbFNldHRpbmdzLnVzZUFkdmFuY2VkQ2FyZEJvdHRvbVRydW5jYXRpb24gJiYgcmVuZGVyZWRFbGVtZW50KSB7XHJcbiAgICAgICAgICAgIC8vIFVubGlrZSBjb250YWluZXJzLCB0aGUgcm9vdCBjYXJkIGVsZW1lbnQgc2hvdWxkIGJlIGFsbG93ZWQgdG9cclxuICAgICAgICAgICAgLy8gYmUgc2hvcnRlciB0aGFuIGl0cyBjb250ZW50IChvdGhlcndpc2UgdGhlIG92ZXJmbG93IHRydW5jYXRpb25cclxuICAgICAgICAgICAgLy8gbG9naWMgd291bGQgbmV2ZXIgZ2V0IHRyaWdnZXJlZClcclxuICAgICAgICAgICAgcmVuZGVyZWRFbGVtZW50LnN0eWxlLnJlbW92ZVByb3BlcnR5KFwibWluSGVpZ2h0XCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVuZGVyZWRFbGVtZW50O1xyXG4gICAgfTtcclxuICAgIEFkYXB0aXZlQ2FyZC5wcm90b3R5cGUuZ2V0SGFzQmFja2dyb3VuZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH07XHJcbiAgICBBZGFwdGl2ZUNhcmQucHJvdG90eXBlLmdldERlZmF1bHRQYWRkaW5nID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgc2hhcmVkXzEuUGFkZGluZ0RlZmluaXRpb24oRW51bXMuU3BhY2luZy5QYWRkaW5nLCBFbnVtcy5TcGFjaW5nLlBhZGRpbmcsIEVudW1zLlNwYWNpbmcuUGFkZGluZywgRW51bXMuU3BhY2luZy5QYWRkaW5nKTtcclxuICAgIH07XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQWRhcHRpdmVDYXJkLnByb3RvdHlwZSwgXCJyZW5kZXJJZkVtcHR5XCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQWRhcHRpdmVDYXJkLnByb3RvdHlwZSwgXCJieXBhc3NWZXJzaW9uQ2hlY2tcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQWRhcHRpdmVDYXJkLnByb3RvdHlwZSwgXCJhbGxvd0N1c3RvbVN0eWxlXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuaG9zdENvbmZpZy5hZGFwdGl2ZUNhcmQgJiYgdGhpcy5ob3N0Q29uZmlnLmFkYXB0aXZlQ2FyZC5hbGxvd0N1c3RvbVN0eWxlO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEFkYXB0aXZlQ2FyZC5wcm90b3R5cGUsIFwiaGFzQmFja2dyb3VuZFwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgQWRhcHRpdmVDYXJkLnByb3RvdHlwZS5nZXRKc29uVHlwZU5hbWUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIFwiQWRhcHRpdmVDYXJkXCI7XHJcbiAgICB9O1xyXG4gICAgQWRhcHRpdmVDYXJkLnByb3RvdHlwZS5pbnRlcm5hbFZhbGlkYXRlUHJvcGVydGllcyA9IGZ1bmN0aW9uIChjb250ZXh0KSB7XHJcbiAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5pbnRlcm5hbFZhbGlkYXRlUHJvcGVydGllcy5jYWxsKHRoaXMsIGNvbnRleHQpO1xyXG4gICAgICAgIGlmICh0aGlzLmdldFZhbHVlKENhcmRFbGVtZW50LnR5cGVOYW1lUHJvcGVydHkpICE9PSBcIkFkYXB0aXZlQ2FyZFwiKSB7XHJcbiAgICAgICAgICAgIGNvbnRleHQuYWRkRmFpbHVyZSh0aGlzLCA3IC8qIE1pc3NpbmdDYXJkVHlwZSAqLywgXCJJbnZhbGlkIG9yIG1pc3NpbmcgY2FyZCB0eXBlLiBNYWtlIHN1cmUgdGhlIGNhcmQncyB0eXBlIHByb3BlcnR5IGlzIHNldCB0byBcXFwiQWRhcHRpdmVDYXJkXFxcIi5cIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghdGhpcy5ieXBhc3NWZXJzaW9uQ2hlY2sgJiYgIXRoaXMudmVyc2lvbikge1xyXG4gICAgICAgICAgICBjb250ZXh0LmFkZEZhaWx1cmUodGhpcywgOCAvKiBQcm9wZXJ0eUNhbnRCZU51bGwgKi8sIFwiVGhlIHZlcnNpb24gcHJvcGVydHkgbXVzdCBiZSBzcGVjaWZpZWQuXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICghdGhpcy5pc1ZlcnNpb25TdXBwb3J0ZWQoKSkge1xyXG4gICAgICAgICAgICBjb250ZXh0LmFkZEZhaWx1cmUodGhpcywgMTIgLyogVW5zdXBwb3J0ZWRDYXJkVmVyc2lvbiAqLywgXCJUaGUgc3BlY2lmaWVkIGNhcmQgdmVyc2lvbiAoXCIgKyB0aGlzLnZlcnNpb24udG9TdHJpbmcoKSArIFwiKSBpcyBub3Qgc3VwcG9ydGVkLiBUaGUgbWF4aW11bSBzdXBwb3J0ZWQgY2FyZCB2ZXJzaW9uIGlzIFwiICsgdGhpcy5tYXhWZXJzaW9uLnRvU3RyaW5nKCkpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBBZGFwdGl2ZUNhcmQucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uICh0YXJnZXQpIHtcclxuICAgICAgICB2YXIgcmVuZGVyZWRDYXJkO1xyXG4gICAgICAgIGlmICh0aGlzLnNob3VsZEZhbGxiYWNrKCkgJiYgdGhpcy5fZmFsbGJhY2tDYXJkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2ZhbGxiYWNrQ2FyZC5ob3N0Q29uZmlnID0gdGhpcy5ob3N0Q29uZmlnO1xyXG4gICAgICAgICAgICByZW5kZXJlZENhcmQgPSB0aGlzLl9mYWxsYmFja0NhcmQucmVuZGVyKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICByZW5kZXJlZENhcmQgPSBfc3VwZXIucHJvdG90eXBlLnJlbmRlci5jYWxsKHRoaXMpO1xyXG4gICAgICAgICAgICBpZiAocmVuZGVyZWRDYXJkKSB7XHJcbiAgICAgICAgICAgICAgICByZW5kZXJlZENhcmQuY2xhc3NMaXN0LmFkZCh0aGlzLmhvc3RDb25maWcubWFrZUNzc0NsYXNzTmFtZShcImFjLWFkYXB0aXZlQ2FyZFwiKSk7XHJcbiAgICAgICAgICAgICAgICByZW5kZXJlZENhcmQudGFiSW5kZXggPSAwO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc3BlYWspIHtcclxuICAgICAgICAgICAgICAgICAgICByZW5kZXJlZENhcmQuc2V0QXR0cmlidXRlKFwiYXJpYS1sYWJlbFwiLCB0aGlzLnNwZWFrKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGFyZ2V0KSB7XHJcbiAgICAgICAgICAgIFV0aWxzLmFwcGVuZENoaWxkKHRhcmdldCwgcmVuZGVyZWRDYXJkKTtcclxuICAgICAgICAgICAgdGhpcy51cGRhdGVMYXlvdXQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlbmRlcmVkQ2FyZDtcclxuICAgIH07XHJcbiAgICBBZGFwdGl2ZUNhcmQucHJvdG90eXBlLnVwZGF0ZUxheW91dCA9IGZ1bmN0aW9uIChwcm9jZXNzQ2hpbGRyZW4pIHtcclxuICAgICAgICBpZiAocHJvY2Vzc0NoaWxkcmVuID09PSB2b2lkIDApIHsgcHJvY2Vzc0NoaWxkcmVuID0gdHJ1ZTsgfVxyXG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUudXBkYXRlTGF5b3V0LmNhbGwodGhpcywgcHJvY2Vzc0NoaWxkcmVuKTtcclxuICAgICAgICBpZiAoc2hhcmVkXzEuR2xvYmFsU2V0dGluZ3MudXNlQWR2YW5jZWRDYXJkQm90dG9tVHJ1bmNhdGlvbiAmJiB0aGlzLmlzRGlzcGxheWVkKCkpIHtcclxuICAgICAgICAgICAgdmFyIHBhZGRpbmcgPSB0aGlzLmhvc3RDb25maWcuZ2V0RWZmZWN0aXZlU3BhY2luZyhFbnVtcy5TcGFjaW5nLkRlZmF1bHQpO1xyXG4gICAgICAgICAgICB0aGlzWydoYW5kbGVPdmVyZmxvdyddKHRoaXMucmVuZGVyZWRFbGVtZW50Lm9mZnNldEhlaWdodCAtIHBhZGRpbmcpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBBZGFwdGl2ZUNhcmQucHJvdG90eXBlLnNob3VsZEZhbGxiYWNrID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIucHJvdG90eXBlLnNob3VsZEZhbGxiYWNrLmNhbGwodGhpcykgfHwgIXRoaXMuaXNWZXJzaW9uU3VwcG9ydGVkKCk7XHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEFkYXB0aXZlQ2FyZC5wcm90b3R5cGUsIFwiaGFzVmlzaWJsZVNlcGFyYXRvclwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIEFkYXB0aXZlQ2FyZC5zY2hlbWFVcmwgPSBcImh0dHA6Ly9hZGFwdGl2ZWNhcmRzLmlvL3NjaGVtYXMvYWRhcHRpdmUtY2FyZC5qc29uXCI7XHJcbiAgICAvLyNyZWdpb24gU2NoZW1hXHJcbiAgICBBZGFwdGl2ZUNhcmQuJHNjaGVtYVByb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5DdXN0b21Qcm9wZXJ0eShzZXJpYWxpemF0aW9uXzEuVmVyc2lvbnMudjFfMCwgXCIkc2NoZW1hXCIsIGZ1bmN0aW9uIChzZW5kZXIsIHByb3BlcnR5LCBzb3VyY2UsIGNvbnRleHQpIHtcclxuICAgICAgICByZXR1cm4gQWRhcHRpdmVDYXJkLnNjaGVtYVVybDtcclxuICAgIH0sIGZ1bmN0aW9uIChzZW5kZXIsIHByb3BlcnR5LCB0YXJnZXQsIHZhbHVlLCBjb250ZXh0KSB7XHJcbiAgICAgICAgY29udGV4dC5zZXJpYWxpemVWYWx1ZSh0YXJnZXQsIHByb3BlcnR5Lm5hbWUsIEFkYXB0aXZlQ2FyZC5zY2hlbWFVcmwpO1xyXG4gICAgfSk7XHJcbiAgICBBZGFwdGl2ZUNhcmQudmVyc2lvblByb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5DdXN0b21Qcm9wZXJ0eShzZXJpYWxpemF0aW9uXzEuVmVyc2lvbnMudjFfMCwgXCJ2ZXJzaW9uXCIsIGZ1bmN0aW9uIChzZW5kZXIsIHByb3BlcnR5LCBzb3VyY2UsIGNvbnRleHQpIHtcclxuICAgICAgICB2YXIgdmVyc2lvbiA9IHNlcmlhbGl6YXRpb25fMS5WZXJzaW9uLnBhcnNlKHNvdXJjZVtwcm9wZXJ0eS5uYW1lXSwgY29udGV4dCk7XHJcbiAgICAgICAgaWYgKHZlcnNpb24gPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB2ZXJzaW9uID0gc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLmxhdGVzdDtcclxuICAgICAgICAgICAgY29udGV4dC5sb2dQYXJzZUV2ZW50KDYgLyogSW52YWxpZFByb3BlcnR5VmFsdWUgKi8sIFwiSW52YWxpZCBjYXJkIHZlcnNpb24uIERlZmF1bHRpbmcgdG8gbGF0ZXN0IHZlcnNpb24gKFwiICsgdmVyc2lvbi50b1N0cmluZygpICsgXCIpXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdmVyc2lvbjtcclxuICAgIH0sIGZ1bmN0aW9uIChzZW5kZXIsIHByb3BlcnR5LCB0YXJnZXQsIHZhbHVlLCBjb250ZXh0KSB7XHJcbiAgICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgY29udGV4dC5zZXJpYWxpemVWYWx1ZSh0YXJnZXQsIHByb3BlcnR5Lm5hbWUsIHZhbHVlLnRvU3RyaW5nKCkpO1xyXG4gICAgICAgIH1cclxuICAgIH0sIHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8wKTtcclxuICAgIEFkYXB0aXZlQ2FyZC5mYWxsYmFja1RleHRQcm9wZXJ0eSA9IG5ldyBzZXJpYWxpemF0aW9uXzEuU3RyaW5nUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzAsIFwiZmFsbGJhY2tUZXh0XCIpO1xyXG4gICAgQWRhcHRpdmVDYXJkLnNwZWFrUHJvcGVydHkgPSBuZXcgc2VyaWFsaXphdGlvbl8xLlN0cmluZ1Byb3BlcnR5KHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8wLCBcInNwZWFrXCIpO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KEFkYXB0aXZlQ2FyZC52ZXJzaW9uUHJvcGVydHkpXHJcbiAgICBdLCBBZGFwdGl2ZUNhcmQucHJvdG90eXBlLCBcInZlcnNpb25cIiwgdm9pZCAwKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHNlcmlhbGl6YXRpb25fMS5wcm9wZXJ0eShBZGFwdGl2ZUNhcmQuZmFsbGJhY2tUZXh0UHJvcGVydHkpXHJcbiAgICBdLCBBZGFwdGl2ZUNhcmQucHJvdG90eXBlLCBcImZhbGxiYWNrVGV4dFwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KEFkYXB0aXZlQ2FyZC5zcGVha1Byb3BlcnR5KVxyXG4gICAgXSwgQWRhcHRpdmVDYXJkLnByb3RvdHlwZSwgXCJzcGVha1wiLCB2b2lkIDApO1xyXG4gICAgcmV0dXJuIEFkYXB0aXZlQ2FyZDtcclxufShDb250YWluZXJXaXRoQWN0aW9ucykpO1xyXG5leHBvcnRzLkFkYXB0aXZlQ2FyZCA9IEFkYXB0aXZlQ2FyZDtcclxudmFyIElubGluZUFkYXB0aXZlQ2FyZCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhJbmxpbmVBZGFwdGl2ZUNhcmQsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBJbmxpbmVBZGFwdGl2ZUNhcmQoKSB7XHJcbiAgICAgICAgLy8jcmVnaW9uIFNjaGVtYVxyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLnN1cHByZXNzU3R5bGUgPSBmYWxzZTtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICBJbmxpbmVBZGFwdGl2ZUNhcmQucHJvdG90eXBlLmdldFNjaGVtYUtleSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gXCJJbmxpbmVBZGFwdGl2ZUNhcmRcIjtcclxuICAgIH07XHJcbiAgICBJbmxpbmVBZGFwdGl2ZUNhcmQucHJvdG90eXBlLnBvcHVsYXRlU2NoZW1hID0gZnVuY3Rpb24gKHNjaGVtYSkge1xyXG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUucG9wdWxhdGVTY2hlbWEuY2FsbCh0aGlzLCBzY2hlbWEpO1xyXG4gICAgICAgIHNjaGVtYS5yZW1vdmUoQWRhcHRpdmVDYXJkLiRzY2hlbWFQcm9wZXJ0eSwgQWRhcHRpdmVDYXJkLnZlcnNpb25Qcm9wZXJ0eSk7XHJcbiAgICB9O1xyXG4gICAgLy8jZW5kcmVnaW9uXHJcbiAgICBJbmxpbmVBZGFwdGl2ZUNhcmQucHJvdG90eXBlLmdldERlZmF1bHRQYWRkaW5nID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgc2hhcmVkXzEuUGFkZGluZ0RlZmluaXRpb24odGhpcy5zdXBwcmVzc1N0eWxlID8gRW51bXMuU3BhY2luZy5Ob25lIDogRW51bXMuU3BhY2luZy5QYWRkaW5nLCBFbnVtcy5TcGFjaW5nLlBhZGRpbmcsIHRoaXMuc3VwcHJlc3NTdHlsZSA/IEVudW1zLlNwYWNpbmcuTm9uZSA6IEVudW1zLlNwYWNpbmcuUGFkZGluZywgRW51bXMuU3BhY2luZy5QYWRkaW5nKTtcclxuICAgIH07XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoSW5saW5lQWRhcHRpdmVDYXJkLnByb3RvdHlwZSwgXCJieXBhc3NWZXJzaW9uQ2hlY2tcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShJbmxpbmVBZGFwdGl2ZUNhcmQucHJvdG90eXBlLCBcImRlZmF1bHRTdHlsZVwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnN1cHByZXNzU3R5bGUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBFbnVtcy5Db250YWluZXJTdHlsZS5EZWZhdWx0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuaG9zdENvbmZpZy5hY3Rpb25zLnNob3dDYXJkLnN0eWxlID8gdGhpcy5ob3N0Q29uZmlnLmFjdGlvbnMuc2hvd0NhcmQuc3R5bGUgOiBFbnVtcy5Db250YWluZXJTdHlsZS5FbXBoYXNpcztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgSW5saW5lQWRhcHRpdmVDYXJkLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAodGFyZ2V0KSB7XHJcbiAgICAgICAgdmFyIHJlbmRlcmVkQ2FyZCA9IF9zdXBlci5wcm90b3R5cGUucmVuZGVyLmNhbGwodGhpcywgdGFyZ2V0KTtcclxuICAgICAgICBpZiAocmVuZGVyZWRDYXJkKSB7XHJcbiAgICAgICAgICAgIHJlbmRlcmVkQ2FyZC5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxpdmVcIiwgXCJwb2xpdGVcIik7XHJcbiAgICAgICAgICAgIHJlbmRlcmVkQ2FyZC5yZW1vdmVBdHRyaWJ1dGUoXCJ0YWJpbmRleFwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlbmRlcmVkQ2FyZDtcclxuICAgIH07XHJcbiAgICBJbmxpbmVBZGFwdGl2ZUNhcmQucHJvdG90eXBlLmdldEZvcmJpZGRlbkFjdGlvblR5cGVzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBbU2hvd0NhcmRBY3Rpb25dO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBJbmxpbmVBZGFwdGl2ZUNhcmQ7XHJcbn0oQWRhcHRpdmVDYXJkKSk7XHJcbnZhciBHbG9iYWxSZWdpc3RyeSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEdsb2JhbFJlZ2lzdHJ5KCkge1xyXG4gICAgfVxyXG4gICAgR2xvYmFsUmVnaXN0cnkucG9wdWxhdGVXaXRoRGVmYXVsdEVsZW1lbnRzID0gZnVuY3Rpb24gKHJlZ2lzdHJ5KSB7XHJcbiAgICAgICAgcmVnaXN0cnkuY2xlYXIoKTtcclxuICAgICAgICByZWdpc3RyeS5yZWdpc3RlcihcIkNvbnRhaW5lclwiLCBDb250YWluZXIpO1xyXG4gICAgICAgIHJlZ2lzdHJ5LnJlZ2lzdGVyKFwiVGV4dEJsb2NrXCIsIFRleHRCbG9jayk7XHJcbiAgICAgICAgcmVnaXN0cnkucmVnaXN0ZXIoXCJSaWNoVGV4dEJsb2NrXCIsIFJpY2hUZXh0QmxvY2ssIHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8yKTtcclxuICAgICAgICByZWdpc3RyeS5yZWdpc3RlcihcIlRleHRSdW5cIiwgVGV4dFJ1biwgc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzIpO1xyXG4gICAgICAgIHJlZ2lzdHJ5LnJlZ2lzdGVyKFwiSW1hZ2VcIiwgSW1hZ2UpO1xyXG4gICAgICAgIHJlZ2lzdHJ5LnJlZ2lzdGVyKFwiSW1hZ2VTZXRcIiwgSW1hZ2VTZXQpO1xyXG4gICAgICAgIHJlZ2lzdHJ5LnJlZ2lzdGVyKFwiTWVkaWFcIiwgTWVkaWEsIHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8xKTtcclxuICAgICAgICByZWdpc3RyeS5yZWdpc3RlcihcIkZhY3RTZXRcIiwgRmFjdFNldCk7XHJcbiAgICAgICAgcmVnaXN0cnkucmVnaXN0ZXIoXCJDb2x1bW5TZXRcIiwgQ29sdW1uU2V0KTtcclxuICAgICAgICByZWdpc3RyeS5yZWdpc3RlcihcIkFjdGlvblNldFwiLCBBY3Rpb25TZXQsIHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8yKTtcclxuICAgICAgICByZWdpc3RyeS5yZWdpc3RlcihcIklucHV0LlRleHRcIiwgVGV4dElucHV0KTtcclxuICAgICAgICByZWdpc3RyeS5yZWdpc3RlcihcIklucHV0LkRhdGVcIiwgRGF0ZUlucHV0KTtcclxuICAgICAgICByZWdpc3RyeS5yZWdpc3RlcihcIklucHV0LlRpbWVcIiwgVGltZUlucHV0KTtcclxuICAgICAgICByZWdpc3RyeS5yZWdpc3RlcihcIklucHV0Lk51bWJlclwiLCBOdW1iZXJJbnB1dCk7XHJcbiAgICAgICAgcmVnaXN0cnkucmVnaXN0ZXIoXCJJbnB1dC5DaG9pY2VTZXRcIiwgQ2hvaWNlU2V0SW5wdXQpO1xyXG4gICAgICAgIHJlZ2lzdHJ5LnJlZ2lzdGVyKFwiSW5wdXQuVG9nZ2xlXCIsIFRvZ2dsZUlucHV0KTtcclxuICAgIH07XHJcbiAgICBHbG9iYWxSZWdpc3RyeS5wb3B1bGF0ZVdpdGhEZWZhdWx0QWN0aW9ucyA9IGZ1bmN0aW9uIChyZWdpc3RyeSkge1xyXG4gICAgICAgIHJlZ2lzdHJ5LmNsZWFyKCk7XHJcbiAgICAgICAgcmVnaXN0cnkucmVnaXN0ZXIoT3BlblVybEFjdGlvbi5Kc29uVHlwZU5hbWUsIE9wZW5VcmxBY3Rpb24pO1xyXG4gICAgICAgIHJlZ2lzdHJ5LnJlZ2lzdGVyKFN1Ym1pdEFjdGlvbi5Kc29uVHlwZU5hbWUsIFN1Ym1pdEFjdGlvbik7XHJcbiAgICAgICAgcmVnaXN0cnkucmVnaXN0ZXIoU2hvd0NhcmRBY3Rpb24uSnNvblR5cGVOYW1lLCBTaG93Q2FyZEFjdGlvbik7XHJcbiAgICAgICAgcmVnaXN0cnkucmVnaXN0ZXIoVG9nZ2xlVmlzaWJpbGl0eUFjdGlvbi5Kc29uVHlwZU5hbWUsIFRvZ2dsZVZpc2liaWxpdHlBY3Rpb24sIHNlcmlhbGl6YXRpb25fMS5WZXJzaW9ucy52MV8yKTtcclxuICAgIH07XHJcbiAgICBHbG9iYWxSZWdpc3RyeS5yZXNldCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBHbG9iYWxSZWdpc3RyeS5wb3B1bGF0ZVdpdGhEZWZhdWx0RWxlbWVudHMoR2xvYmFsUmVnaXN0cnkuZWxlbWVudHMpO1xyXG4gICAgICAgIEdsb2JhbFJlZ2lzdHJ5LnBvcHVsYXRlV2l0aERlZmF1bHRBY3Rpb25zKEdsb2JhbFJlZ2lzdHJ5LmFjdGlvbnMpO1xyXG4gICAgfTtcclxuICAgIEdsb2JhbFJlZ2lzdHJ5LmVsZW1lbnRzID0gbmV3IHJlZ2lzdHJ5XzEuQ2FyZE9iamVjdFJlZ2lzdHJ5KCk7XHJcbiAgICBHbG9iYWxSZWdpc3RyeS5hY3Rpb25zID0gbmV3IHJlZ2lzdHJ5XzEuQ2FyZE9iamVjdFJlZ2lzdHJ5KCk7XHJcbiAgICByZXR1cm4gR2xvYmFsUmVnaXN0cnk7XHJcbn0oKSk7XHJcbmV4cG9ydHMuR2xvYmFsUmVnaXN0cnkgPSBHbG9iYWxSZWdpc3RyeTtcclxuR2xvYmFsUmVnaXN0cnkucmVzZXQoKTtcclxudmFyIFNlcmlhbGl6YXRpb25Db250ZXh0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKFNlcmlhbGl6YXRpb25Db250ZXh0LCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gU2VyaWFsaXphdGlvbkNvbnRleHQoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgU2VyaWFsaXphdGlvbkNvbnRleHQucHJvdG90eXBlLmludGVybmFsUGFyc2VDYXJkT2JqZWN0ID0gZnVuY3Rpb24gKHBhcmVudCwgc291cmNlLCBmb3JiaWRkZW5UeXBlTmFtZXMsIGFsbG93RmFsbGJhY2ssIGNyZWF0ZUluc3RhbmNlQ2FsbGJhY2ssIGxvZ1BhcnNlRXZlbnQpIHtcclxuICAgICAgICB2YXIgcmVzdWx0ID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIGlmIChzb3VyY2UgJiYgdHlwZW9mIHNvdXJjZSA9PT0gXCJvYmplY3RcIikge1xyXG4gICAgICAgICAgICB2YXIgdHJ5VG9GYWxsYmFjayA9IGZhbHNlO1xyXG4gICAgICAgICAgICB2YXIgdHlwZU5hbWUgPSBVdGlscy5wYXJzZVN0cmluZyhzb3VyY2VbXCJ0eXBlXCJdKTtcclxuICAgICAgICAgICAgaWYgKHR5cGVOYW1lKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZm9yYmlkZGVuVHlwZU5hbWVzLmluZGV4T2YodHlwZU5hbWUpID49IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBsb2dQYXJzZUV2ZW50KHR5cGVOYW1lLCAxIC8qIEZvcmJpZGRlblR5cGUgKi8pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gY3JlYXRlSW5zdGFuY2VDYWxsYmFjayh0eXBlTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHJ5VG9GYWxsYmFjayA9IGFsbG93RmFsbGJhY2s7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ1BhcnNlRXZlbnQodHlwZU5hbWUsIDAgLyogVW5rbm93blR5cGUgKi8pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnNldFBhcmVudChwYXJlbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucGFyc2Uoc291cmNlLCB0aGlzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHJ5VG9GYWxsYmFjayA9IHJlc3VsdC5zaG91bGRGYWxsYmFjaygpICYmIGFsbG93RmFsbGJhY2s7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0cnlUb0ZhbGxiYWNrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmYWxsYmFjayA9IHNvdXJjZVtcImZhbGxiYWNrXCJdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWZhbGxiYWNrICYmIHBhcmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50LnNldFNob3VsZEZhbGxiYWNrKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZmFsbGJhY2sgPT09IFwic3RyaW5nXCIgJiYgZmFsbGJhY2sudG9Mb3dlckNhc2UoKSA9PT0gXCJkcm9wXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgZmFsbGJhY2sgPT09IFwib2JqZWN0XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMuaW50ZXJuYWxQYXJzZUNhcmRPYmplY3QocGFyZW50LCBmYWxsYmFjaywgZm9yYmlkZGVuVHlwZU5hbWVzLCB0cnVlLCBjcmVhdGVJbnN0YW5jZUNhbGxiYWNrLCBsb2dQYXJzZUV2ZW50KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuICAgIFNlcmlhbGl6YXRpb25Db250ZXh0LnByb3RvdHlwZS5jYXJkT2JqZWN0UGFyc2VkID0gZnVuY3Rpb24gKG8sIHNvdXJjZSkge1xyXG4gICAgICAgIGlmIChvIGluc3RhbmNlb2YgQWN0aW9uICYmIHRoaXMub25QYXJzZUFjdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLm9uUGFyc2VBY3Rpb24obywgc291cmNlLCB0aGlzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAobyBpbnN0YW5jZW9mIENhcmRFbGVtZW50ICYmIHRoaXMub25QYXJzZUVsZW1lbnQpIHtcclxuICAgICAgICAgICAgdGhpcy5vblBhcnNlRWxlbWVudChvLCBzb3VyY2UsIHRoaXMpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBTZXJpYWxpemF0aW9uQ29udGV4dC5wcm90b3R5cGUuc2hvdWxkU2VyaWFsaXplID0gZnVuY3Rpb24gKG8pIHtcclxuICAgICAgICBpZiAobyBpbnN0YW5jZW9mIEFjdGlvbikge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5hY3Rpb25SZWdpc3RyeS5maW5kQnlOYW1lKG8uZ2V0SnNvblR5cGVOYW1lKCkpICE9PSB1bmRlZmluZWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKG8gaW5zdGFuY2VvZiBDYXJkRWxlbWVudCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50UmVnaXN0cnkuZmluZEJ5TmFtZShvLmdldEpzb25UeXBlTmFtZSgpKSAhPT0gdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFNlcmlhbGl6YXRpb25Db250ZXh0LnByb3RvdHlwZS5wYXJzZUNhcmRPYmplY3QgPSBmdW5jdGlvbiAocGFyZW50LCBzb3VyY2UsIGZvcmJpZGRlblR5cGVOYW1lcywgYWxsb3dGYWxsYmFjaywgY3JlYXRlSW5zdGFuY2VDYWxsYmFjaywgbG9nUGFyc2VFdmVudCkge1xyXG4gICAgICAgIHZhciByZXN1bHQgPSB0aGlzLmludGVybmFsUGFyc2VDYXJkT2JqZWN0KHBhcmVudCwgc291cmNlLCBmb3JiaWRkZW5UeXBlTmFtZXMsIGFsbG93RmFsbGJhY2ssIGNyZWF0ZUluc3RhbmNlQ2FsbGJhY2ssIGxvZ1BhcnNlRXZlbnQpO1xyXG4gICAgICAgIGlmIChyZXN1bHQgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB0aGlzLmNhcmRPYmplY3RQYXJzZWQocmVzdWx0LCBzb3VyY2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuICAgIFNlcmlhbGl6YXRpb25Db250ZXh0LnByb3RvdHlwZS5wYXJzZUVsZW1lbnQgPSBmdW5jdGlvbiAocGFyZW50LCBzb3VyY2UsIGFsbG93RmFsbGJhY2spIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHJldHVybiB0aGlzLnBhcnNlQ2FyZE9iamVjdChwYXJlbnQsIHNvdXJjZSwgW10sIC8vIEZvcmJpZGRlbiB0eXBlcyBub3Qgc3VwcG9ydGVkIGZvciBlbGVtZW50cyBmb3Igbm93XHJcbiAgICAgICAgYWxsb3dGYWxsYmFjaywgZnVuY3Rpb24gKHR5cGVOYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5lbGVtZW50UmVnaXN0cnkuY3JlYXRlSW5zdGFuY2UodHlwZU5hbWUsIF90aGlzLnRhcmdldFZlcnNpb24pO1xyXG4gICAgICAgIH0sIGZ1bmN0aW9uICh0eXBlTmFtZSwgZXJyb3JUeXBlKSB7XHJcbiAgICAgICAgICAgIGlmIChlcnJvclR5cGUgPT09IDAgLyogVW5rbm93blR5cGUgKi8pIHtcclxuICAgICAgICAgICAgICAgIF90aGlzLmxvZ1BhcnNlRXZlbnQoMTEgLyogVW5rbm93bkVsZW1lbnRUeXBlICovLCBcIlVua25vd24gZWxlbWVudCB0eXBlOiBcIiArIHR5cGVOYW1lICsgXCIuIEZhbGxiYWNrIHdpbGwgYmUgdXNlZCBpZiBwcmVzZW50LlwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIF90aGlzLmxvZ1BhcnNlRXZlbnQoNCAvKiBFbGVtZW50VHlwZU5vdEFsbG93ZWQgKi8sIFwiRWxlbWVudCB0eXBlIFwiICsgdHlwZU5hbWUgKyBcIiBpcyBub3QgYWxsb3dlZCBpbiB0aGlzIGNvbnRleHQuXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgU2VyaWFsaXphdGlvbkNvbnRleHQucHJvdG90eXBlLnBhcnNlQWN0aW9uID0gZnVuY3Rpb24gKHBhcmVudCwgc291cmNlLCBmb3JiaWRkZW5BY3Rpb25UeXBlcywgYWxsb3dGYWxsYmFjaykge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucGFyc2VDYXJkT2JqZWN0KHBhcmVudCwgc291cmNlLCBmb3JiaWRkZW5BY3Rpb25UeXBlcywgYWxsb3dGYWxsYmFjaywgZnVuY3Rpb24gKHR5cGVOYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5hY3Rpb25SZWdpc3RyeS5jcmVhdGVJbnN0YW5jZSh0eXBlTmFtZSwgX3RoaXMudGFyZ2V0VmVyc2lvbik7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKHR5cGVOYW1lLCBlcnJvclR5cGUpIHtcclxuICAgICAgICAgICAgaWYgKGVycm9yVHlwZSA9PSAwIC8qIFVua25vd25UeXBlICovKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGVycm9yOiAxMCAvKiBVbmtub3duQWN0aW9uVHlwZSAqLyxcclxuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiBcIlVua25vd24gYWN0aW9uIHR5cGU6IFwiICsgdHlwZU5hbWUgKyBcIi4gRmFsbGJhY2sgd2lsbCBiZSB1c2VkIGlmIHByZXNlbnQuXCJcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGVycm9yOiAxIC8qIEFjdGlvblR5cGVOb3RBbGxvd2VkICovLFxyXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiQWN0aW9uIHR5cGUgXCIgKyB0eXBlTmFtZSArIFwiIGlzIG5vdCBhbGxvd2VkIGluIHRoaXMgY29udGV4dC5cIlxyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTZXJpYWxpemF0aW9uQ29udGV4dC5wcm90b3R5cGUsIFwiZWxlbWVudFJlZ2lzdHJ5XCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2VsZW1lbnRSZWdpc3RyeSA/IHRoaXMuX2VsZW1lbnRSZWdpc3RyeSA6IEdsb2JhbFJlZ2lzdHJ5LmVsZW1lbnRzO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgLy8gTm90IHVzaW5nIGEgcHJvcGVydHkgc2V0dGVyIGhlcmUgYmVjYXVzZSB0aGUgc2V0dGVyIHNob3VsZCBhY2NlcHQgXCJ1bmRlZmluZWRcIlxyXG4gICAgLy8gd2hlcmVhcyB0aGUgZ2V0dGVyIHNob3VsZCBuZXZlciByZXR1cm4gdW5kZWZpbmVkLlxyXG4gICAgU2VyaWFsaXphdGlvbkNvbnRleHQucHJvdG90eXBlLnNldEVsZW1lbnRSZWdpc3RyeSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgIHRoaXMuX2VsZW1lbnRSZWdpc3RyeSA9IHZhbHVlO1xyXG4gICAgfTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTZXJpYWxpemF0aW9uQ29udGV4dC5wcm90b3R5cGUsIFwiYWN0aW9uUmVnaXN0cnlcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fYWN0aW9uUmVnaXN0cnkgPyB0aGlzLl9hY3Rpb25SZWdpc3RyeSA6IEdsb2JhbFJlZ2lzdHJ5LmFjdGlvbnM7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICAvLyBOb3QgdXNpbmcgYSBwcm9wZXJ0eSBzZXR0ZXIgaGVyZSBiZWNhdXNlIHRoZSBzZXR0ZXIgc2hvdWxkIGFjY2VwdCBcInVuZGVmaW5lZFwiXHJcbiAgICAvLyB3aGVyZWFzIHRoZSBnZXR0ZXIgc2hvdWxkIG5ldmVyIHJldHVybiB1bmRlZmluZWQuXHJcbiAgICBTZXJpYWxpemF0aW9uQ29udGV4dC5wcm90b3R5cGUuc2V0QWN0aW9uUmVnaXN0cnkgPSBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICB0aGlzLl9hY3Rpb25SZWdpc3RyeSA9IHZhbHVlO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBTZXJpYWxpemF0aW9uQ29udGV4dDtcclxufShzZXJpYWxpemF0aW9uXzEuQmFzZVNlcmlhbGl6YXRpb25Db250ZXh0KSk7XHJcbmV4cG9ydHMuU2VyaWFsaXphdGlvbkNvbnRleHQgPSBTZXJpYWxpemF0aW9uQ29udGV4dDtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Y2FyZC1lbGVtZW50cy5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcclxudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xyXG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcclxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxyXG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcclxuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcclxuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxyXG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcclxuICAgIH07XHJcbn0pKCk7XHJcbnZhciBfX2RlY29yYXRlID0gKHRoaXMgJiYgdGhpcy5fX2RlY29yYXRlKSB8fCBmdW5jdGlvbiAoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpIHtcclxuICAgIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGMgPCAzID8gdGFyZ2V0IDogZGVzYyA9PT0gbnVsbCA/IGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KSA6IGRlc2MsIGQ7XHJcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QuZGVjb3JhdGUgPT09IFwiZnVuY3Rpb25cIikgciA9IFJlZmxlY3QuZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpO1xyXG4gICAgZWxzZSBmb3IgKHZhciBpID0gZGVjb3JhdG9ycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgaWYgKGQgPSBkZWNvcmF0b3JzW2ldKSByID0gKGMgPCAzID8gZChyKSA6IGMgPiAzID8gZCh0YXJnZXQsIGtleSwgcikgOiBkKHRhcmdldCwga2V5KSkgfHwgcjtcclxuICAgIHJldHVybiBjID4gMyAmJiByICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgciksIHI7XHJcbn07XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxudmFyIHNoYXJlZF8xID0gcmVxdWlyZShcIi4vc2hhcmVkXCIpO1xyXG52YXIgaG9zdF9jYXBhYmlsaXRpZXNfMSA9IHJlcXVpcmUoXCIuL2hvc3QtY2FwYWJpbGl0aWVzXCIpO1xyXG52YXIgc2VyaWFsaXphdGlvbl8xID0gcmVxdWlyZShcIi4vc2VyaWFsaXphdGlvblwiKTtcclxudmFyIFZhbGlkYXRpb25SZXN1bHRzID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gVmFsaWRhdGlvblJlc3VsdHMoKSB7XHJcbiAgICAgICAgdGhpcy5hbGxJZHMgPSB7fTtcclxuICAgICAgICB0aGlzLnZhbGlkYXRpb25FdmVudHMgPSBbXTtcclxuICAgIH1cclxuICAgIFZhbGlkYXRpb25SZXN1bHRzLnByb3RvdHlwZS5hZGRGYWlsdXJlID0gZnVuY3Rpb24gKGNhcmRPYmplY3QsIGV2ZW50LCBtZXNzYWdlKSB7XHJcbiAgICAgICAgdGhpcy52YWxpZGF0aW9uRXZlbnRzLnB1c2goe1xyXG4gICAgICAgICAgICBwaGFzZTogMiAvKiBWYWxpZGF0aW9uICovLFxyXG4gICAgICAgICAgICBzb3VyY2U6IGNhcmRPYmplY3QsXHJcbiAgICAgICAgICAgIGV2ZW50OiBldmVudCxcclxuICAgICAgICAgICAgbWVzc2FnZTogbWVzc2FnZVxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBWYWxpZGF0aW9uUmVzdWx0cztcclxufSgpKTtcclxuZXhwb3J0cy5WYWxpZGF0aW9uUmVzdWx0cyA9IFZhbGlkYXRpb25SZXN1bHRzO1xyXG52YXIgQ2FyZE9iamVjdCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhDYXJkT2JqZWN0LCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gQ2FyZE9iamVjdCgpIHtcclxuICAgICAgICAvLyNyZWdpb24gU2NoZW1hXHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XHJcbiAgICAgICAgLy8jZW5kcmVnaW9uXHJcbiAgICAgICAgX3RoaXMuX3Nob3VsZEZhbGxiYWNrID0gZmFsc2U7XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgQ2FyZE9iamVjdC5wcm90b3R5cGUuZ2V0U2NoZW1hS2V5ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmdldEpzb25UeXBlTmFtZSgpO1xyXG4gICAgfTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDYXJkT2JqZWN0LnByb3RvdHlwZSwgXCJyZXF1aXJlc1wiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFZhbHVlKENhcmRPYmplY3QucmVxdWlyZXNQcm9wZXJ0eSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBDYXJkT2JqZWN0LnByb3RvdHlwZS5wcmVQcm9jZXNzUHJvcGVydHlWYWx1ZSA9IGZ1bmN0aW9uIChwcm9wZXJ0eSwgcHJvcGVydHlWYWx1ZSkge1xyXG4gICAgICAgIHZhciB2YWx1ZSA9IHByb3BlcnR5VmFsdWUgPT09IHVuZGVmaW5lZCA/IHRoaXMuZ2V0VmFsdWUocHJvcGVydHkpIDogcHJvcGVydHlWYWx1ZTtcclxuICAgICAgICBpZiAoc2hhcmVkXzEuR2xvYmFsU2V0dGluZ3MuYWxsb3dQcmVQcm9jZXNzaW5nUHJvcGVydHlWYWx1ZXMpIHtcclxuICAgICAgICAgICAgdmFyIGN1cnJlbnRPYmplY3QgPSB0aGlzO1xyXG4gICAgICAgICAgICB3aGlsZSAoY3VycmVudE9iamVjdCAmJiAhY3VycmVudE9iamVjdC5vblByZVByb2Nlc3NQcm9wZXJ0eVZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50T2JqZWN0ID0gY3VycmVudE9iamVjdC5wYXJlbnQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGN1cnJlbnRPYmplY3QgJiYgY3VycmVudE9iamVjdC5vblByZVByb2Nlc3NQcm9wZXJ0eVZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY3VycmVudE9iamVjdC5vblByZVByb2Nlc3NQcm9wZXJ0eVZhbHVlKHRoaXMsIHByb3BlcnR5LCB2YWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgfTtcclxuICAgIENhcmRPYmplY3QucHJvdG90eXBlLnNldFBhcmVudCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xyXG4gICAgICAgIHRoaXMuX3BhcmVudCA9IHZhbHVlO1xyXG4gICAgfTtcclxuICAgIENhcmRPYmplY3QucHJvdG90eXBlLnNldFNob3VsZEZhbGxiYWNrID0gZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy5fc2hvdWxkRmFsbGJhY2sgPSB2YWx1ZTtcclxuICAgIH07XHJcbiAgICBDYXJkT2JqZWN0LnByb3RvdHlwZS5zaG91bGRGYWxsYmFjayA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc2hvdWxkRmFsbGJhY2sgfHwgIXRoaXMucmVxdWlyZXMuYXJlQWxsTWV0KHRoaXMuaG9zdENvbmZpZy5ob3N0Q2FwYWJpbGl0aWVzKTtcclxuICAgIH07XHJcbiAgICBDYXJkT2JqZWN0LnByb3RvdHlwZS5nZXRSb290T2JqZWN0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciByb290T2JqZWN0ID0gdGhpcztcclxuICAgICAgICB3aGlsZSAocm9vdE9iamVjdC5wYXJlbnQpIHtcclxuICAgICAgICAgICAgcm9vdE9iamVjdCA9IHJvb3RPYmplY3QucGFyZW50O1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcm9vdE9iamVjdDtcclxuICAgIH07XHJcbiAgICBDYXJkT2JqZWN0LnByb3RvdHlwZS5pbnRlcm5hbFZhbGlkYXRlUHJvcGVydGllcyA9IGZ1bmN0aW9uIChjb250ZXh0KSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaWQpIHtcclxuICAgICAgICAgICAgaWYgKGNvbnRleHQuYWxsSWRzLmhhc093blByb3BlcnR5KHRoaXMuaWQpKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY29udGV4dC5hbGxJZHNbdGhpcy5pZF0gPT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRleHQuYWRkRmFpbHVyZSh0aGlzLCAxMyAvKiBEdXBsaWNhdGVJZCAqLywgXCJEdXBsaWNhdGUgSWQ6IFwiICsgdGhpcy5pZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjb250ZXh0LmFsbElkc1t0aGlzLmlkXSArPSAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29udGV4dC5hbGxJZHNbdGhpcy5pZF0gPSAxO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIENhcmRPYmplY3QucHJvdG90eXBlLnZhbGlkYXRlUHJvcGVydGllcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFZhbGlkYXRpb25SZXN1bHRzKCk7XHJcbiAgICAgICAgdGhpcy5pbnRlcm5hbFZhbGlkYXRlUHJvcGVydGllcyhyZXN1bHQpO1xyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENhcmRPYmplY3QucHJvdG90eXBlLCBcInBhcmVudFwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9wYXJlbnQ7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ2FyZE9iamVjdC5wcm90b3R5cGUsIFwicmVuZGVyZWRFbGVtZW50XCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3JlbmRlcmVkRWxlbWVudDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIENhcmRPYmplY3QudHlwZU5hbWVQcm9wZXJ0eSA9IG5ldyBzZXJpYWxpemF0aW9uXzEuU3RyaW5nUHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzAsIFwidHlwZVwiLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCBmdW5jdGlvbiAoc2VuZGVyKSB7XHJcbiAgICAgICAgcmV0dXJuIHNlbmRlci5nZXRKc29uVHlwZU5hbWUoKTtcclxuICAgIH0pO1xyXG4gICAgQ2FyZE9iamVjdC5pZFByb3BlcnR5ID0gbmV3IHNlcmlhbGl6YXRpb25fMS5TdHJpbmdQcm9wZXJ0eShzZXJpYWxpemF0aW9uXzEuVmVyc2lvbnMudjFfMCwgXCJpZFwiKTtcclxuICAgIENhcmRPYmplY3QucmVxdWlyZXNQcm9wZXJ0eSA9IG5ldyBzZXJpYWxpemF0aW9uXzEuU2VyaWFsaXphYmxlT2JqZWN0UHJvcGVydHkoc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzIsIFwicmVxdWlyZXNcIiwgaG9zdF9jYXBhYmlsaXRpZXNfMS5Ib3N0Q2FwYWJpbGl0aWVzKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHNlcmlhbGl6YXRpb25fMS5wcm9wZXJ0eShDYXJkT2JqZWN0LmlkUHJvcGVydHkpXHJcbiAgICBdLCBDYXJkT2JqZWN0LnByb3RvdHlwZSwgXCJpZFwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgc2VyaWFsaXphdGlvbl8xLnByb3BlcnR5KENhcmRPYmplY3QucmVxdWlyZXNQcm9wZXJ0eSlcclxuICAgIF0sIENhcmRPYmplY3QucHJvdG90eXBlLCBcInJlcXVpcmVzXCIsIG51bGwpO1xyXG4gICAgcmV0dXJuIENhcmRPYmplY3Q7XHJcbn0oc2VyaWFsaXphdGlvbl8xLlNlcmlhbGl6YWJsZU9iamVjdCkpO1xyXG5leHBvcnRzLkNhcmRPYmplY3QgPSBDYXJkT2JqZWN0O1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1jYXJkLW9iamVjdC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcclxuLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS5cclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG4vLyBOb3RlIHRoZSBcIndlaXJkXCIgd2F5IHRoZXNlIHJlYWRvbmx5IGZpZWxkcyBhcmUgZGVjbGFyZWQgaXMgdG8gd29yayBhcm91bmRcclxuLy8gYSBicmVha2luZyBjaGFuZ2UgaW50cm9kdWNlZCBpbiBUUyAzLjEgd3J0IGQudHMgZ2VuZXJhdGlvbi4gRE8gTk9UIENIQU5HRVxyXG4vLyBhbmQgYWRvcHQgdGhpcyBzeW50YXggZm9yIGFsbCBvdGhlciBzdGF0aWMgcmVhZG9ubHkgZmllbGRzLlxyXG52YXIgQWN0aW9uU3R5bGUgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBBY3Rpb25TdHlsZSgpIHtcclxuICAgIH1cclxuICAgIEFjdGlvblN0eWxlLkRlZmF1bHQgPSBcImRlZmF1bHRcIjtcclxuICAgIEFjdGlvblN0eWxlLlBvc2l0aXZlID0gXCJwb3NpdGl2ZVwiO1xyXG4gICAgQWN0aW9uU3R5bGUuRGVzdHJ1Y3RpdmUgPSBcImRlc3RydWN0aXZlXCI7XHJcbiAgICByZXR1cm4gQWN0aW9uU3R5bGU7XHJcbn0oKSk7XHJcbmV4cG9ydHMuQWN0aW9uU3R5bGUgPSBBY3Rpb25TdHlsZTtcclxudmFyIFNpemU7XHJcbihmdW5jdGlvbiAoU2l6ZSkge1xyXG4gICAgU2l6ZVtTaXplW1wiQXV0b1wiXSA9IDBdID0gXCJBdXRvXCI7XHJcbiAgICBTaXplW1NpemVbXCJTdHJldGNoXCJdID0gMV0gPSBcIlN0cmV0Y2hcIjtcclxuICAgIFNpemVbU2l6ZVtcIlNtYWxsXCJdID0gMl0gPSBcIlNtYWxsXCI7XHJcbiAgICBTaXplW1NpemVbXCJNZWRpdW1cIl0gPSAzXSA9IFwiTWVkaXVtXCI7XHJcbiAgICBTaXplW1NpemVbXCJMYXJnZVwiXSA9IDRdID0gXCJMYXJnZVwiO1xyXG59KShTaXplID0gZXhwb3J0cy5TaXplIHx8IChleHBvcnRzLlNpemUgPSB7fSkpO1xyXG52YXIgU2l6ZVVuaXQ7XHJcbihmdW5jdGlvbiAoU2l6ZVVuaXQpIHtcclxuICAgIFNpemVVbml0W1NpemVVbml0W1wiV2VpZ2h0XCJdID0gMF0gPSBcIldlaWdodFwiO1xyXG4gICAgU2l6ZVVuaXRbU2l6ZVVuaXRbXCJQaXhlbFwiXSA9IDFdID0gXCJQaXhlbFwiO1xyXG59KShTaXplVW5pdCA9IGV4cG9ydHMuU2l6ZVVuaXQgfHwgKGV4cG9ydHMuU2l6ZVVuaXQgPSB7fSkpO1xyXG52YXIgVGV4dFNpemU7XHJcbihmdW5jdGlvbiAoVGV4dFNpemUpIHtcclxuICAgIFRleHRTaXplW1RleHRTaXplW1wiU21hbGxcIl0gPSAwXSA9IFwiU21hbGxcIjtcclxuICAgIFRleHRTaXplW1RleHRTaXplW1wiRGVmYXVsdFwiXSA9IDFdID0gXCJEZWZhdWx0XCI7XHJcbiAgICBUZXh0U2l6ZVtUZXh0U2l6ZVtcIk1lZGl1bVwiXSA9IDJdID0gXCJNZWRpdW1cIjtcclxuICAgIFRleHRTaXplW1RleHRTaXplW1wiTGFyZ2VcIl0gPSAzXSA9IFwiTGFyZ2VcIjtcclxuICAgIFRleHRTaXplW1RleHRTaXplW1wiRXh0cmFMYXJnZVwiXSA9IDRdID0gXCJFeHRyYUxhcmdlXCI7XHJcbn0pKFRleHRTaXplID0gZXhwb3J0cy5UZXh0U2l6ZSB8fCAoZXhwb3J0cy5UZXh0U2l6ZSA9IHt9KSk7XHJcbnZhciBUZXh0V2VpZ2h0O1xyXG4oZnVuY3Rpb24gKFRleHRXZWlnaHQpIHtcclxuICAgIFRleHRXZWlnaHRbVGV4dFdlaWdodFtcIkxpZ2h0ZXJcIl0gPSAwXSA9IFwiTGlnaHRlclwiO1xyXG4gICAgVGV4dFdlaWdodFtUZXh0V2VpZ2h0W1wiRGVmYXVsdFwiXSA9IDFdID0gXCJEZWZhdWx0XCI7XHJcbiAgICBUZXh0V2VpZ2h0W1RleHRXZWlnaHRbXCJCb2xkZXJcIl0gPSAyXSA9IFwiQm9sZGVyXCI7XHJcbn0pKFRleHRXZWlnaHQgPSBleHBvcnRzLlRleHRXZWlnaHQgfHwgKGV4cG9ydHMuVGV4dFdlaWdodCA9IHt9KSk7XHJcbnZhciBGb250VHlwZTtcclxuKGZ1bmN0aW9uIChGb250VHlwZSkge1xyXG4gICAgRm9udFR5cGVbRm9udFR5cGVbXCJEZWZhdWx0XCJdID0gMF0gPSBcIkRlZmF1bHRcIjtcclxuICAgIEZvbnRUeXBlW0ZvbnRUeXBlW1wiTW9ub3NwYWNlXCJdID0gMV0gPSBcIk1vbm9zcGFjZVwiO1xyXG59KShGb250VHlwZSA9IGV4cG9ydHMuRm9udFR5cGUgfHwgKGV4cG9ydHMuRm9udFR5cGUgPSB7fSkpO1xyXG52YXIgU3BhY2luZztcclxuKGZ1bmN0aW9uIChTcGFjaW5nKSB7XHJcbiAgICBTcGFjaW5nW1NwYWNpbmdbXCJOb25lXCJdID0gMF0gPSBcIk5vbmVcIjtcclxuICAgIFNwYWNpbmdbU3BhY2luZ1tcIlNtYWxsXCJdID0gMV0gPSBcIlNtYWxsXCI7XHJcbiAgICBTcGFjaW5nW1NwYWNpbmdbXCJEZWZhdWx0XCJdID0gMl0gPSBcIkRlZmF1bHRcIjtcclxuICAgIFNwYWNpbmdbU3BhY2luZ1tcIk1lZGl1bVwiXSA9IDNdID0gXCJNZWRpdW1cIjtcclxuICAgIFNwYWNpbmdbU3BhY2luZ1tcIkxhcmdlXCJdID0gNF0gPSBcIkxhcmdlXCI7XHJcbiAgICBTcGFjaW5nW1NwYWNpbmdbXCJFeHRyYUxhcmdlXCJdID0gNV0gPSBcIkV4dHJhTGFyZ2VcIjtcclxuICAgIFNwYWNpbmdbU3BhY2luZ1tcIlBhZGRpbmdcIl0gPSA2XSA9IFwiUGFkZGluZ1wiO1xyXG59KShTcGFjaW5nID0gZXhwb3J0cy5TcGFjaW5nIHx8IChleHBvcnRzLlNwYWNpbmcgPSB7fSkpO1xyXG52YXIgVGV4dENvbG9yO1xyXG4oZnVuY3Rpb24gKFRleHRDb2xvcikge1xyXG4gICAgVGV4dENvbG9yW1RleHRDb2xvcltcIkRlZmF1bHRcIl0gPSAwXSA9IFwiRGVmYXVsdFwiO1xyXG4gICAgVGV4dENvbG9yW1RleHRDb2xvcltcIkRhcmtcIl0gPSAxXSA9IFwiRGFya1wiO1xyXG4gICAgVGV4dENvbG9yW1RleHRDb2xvcltcIkxpZ2h0XCJdID0gMl0gPSBcIkxpZ2h0XCI7XHJcbiAgICBUZXh0Q29sb3JbVGV4dENvbG9yW1wiQWNjZW50XCJdID0gM10gPSBcIkFjY2VudFwiO1xyXG4gICAgVGV4dENvbG9yW1RleHRDb2xvcltcIkdvb2RcIl0gPSA0XSA9IFwiR29vZFwiO1xyXG4gICAgVGV4dENvbG9yW1RleHRDb2xvcltcIldhcm5pbmdcIl0gPSA1XSA9IFwiV2FybmluZ1wiO1xyXG4gICAgVGV4dENvbG9yW1RleHRDb2xvcltcIkF0dGVudGlvblwiXSA9IDZdID0gXCJBdHRlbnRpb25cIjtcclxufSkoVGV4dENvbG9yID0gZXhwb3J0cy5UZXh0Q29sb3IgfHwgKGV4cG9ydHMuVGV4dENvbG9yID0ge30pKTtcclxudmFyIEhvcml6b250YWxBbGlnbm1lbnQ7XHJcbihmdW5jdGlvbiAoSG9yaXpvbnRhbEFsaWdubWVudCkge1xyXG4gICAgSG9yaXpvbnRhbEFsaWdubWVudFtIb3Jpem9udGFsQWxpZ25tZW50W1wiTGVmdFwiXSA9IDBdID0gXCJMZWZ0XCI7XHJcbiAgICBIb3Jpem9udGFsQWxpZ25tZW50W0hvcml6b250YWxBbGlnbm1lbnRbXCJDZW50ZXJcIl0gPSAxXSA9IFwiQ2VudGVyXCI7XHJcbiAgICBIb3Jpem9udGFsQWxpZ25tZW50W0hvcml6b250YWxBbGlnbm1lbnRbXCJSaWdodFwiXSA9IDJdID0gXCJSaWdodFwiO1xyXG59KShIb3Jpem9udGFsQWxpZ25tZW50ID0gZXhwb3J0cy5Ib3Jpem9udGFsQWxpZ25tZW50IHx8IChleHBvcnRzLkhvcml6b250YWxBbGlnbm1lbnQgPSB7fSkpO1xyXG52YXIgVmVydGljYWxBbGlnbm1lbnQ7XHJcbihmdW5jdGlvbiAoVmVydGljYWxBbGlnbm1lbnQpIHtcclxuICAgIFZlcnRpY2FsQWxpZ25tZW50W1ZlcnRpY2FsQWxpZ25tZW50W1wiVG9wXCJdID0gMF0gPSBcIlRvcFwiO1xyXG4gICAgVmVydGljYWxBbGlnbm1lbnRbVmVydGljYWxBbGlnbm1lbnRbXCJDZW50ZXJcIl0gPSAxXSA9IFwiQ2VudGVyXCI7XHJcbiAgICBWZXJ0aWNhbEFsaWdubWVudFtWZXJ0aWNhbEFsaWdubWVudFtcIkJvdHRvbVwiXSA9IDJdID0gXCJCb3R0b21cIjtcclxufSkoVmVydGljYWxBbGlnbm1lbnQgPSBleHBvcnRzLlZlcnRpY2FsQWxpZ25tZW50IHx8IChleHBvcnRzLlZlcnRpY2FsQWxpZ25tZW50ID0ge30pKTtcclxudmFyIEFjdGlvbkFsaWdubWVudDtcclxuKGZ1bmN0aW9uIChBY3Rpb25BbGlnbm1lbnQpIHtcclxuICAgIEFjdGlvbkFsaWdubWVudFtBY3Rpb25BbGlnbm1lbnRbXCJMZWZ0XCJdID0gMF0gPSBcIkxlZnRcIjtcclxuICAgIEFjdGlvbkFsaWdubWVudFtBY3Rpb25BbGlnbm1lbnRbXCJDZW50ZXJcIl0gPSAxXSA9IFwiQ2VudGVyXCI7XHJcbiAgICBBY3Rpb25BbGlnbm1lbnRbQWN0aW9uQWxpZ25tZW50W1wiUmlnaHRcIl0gPSAyXSA9IFwiUmlnaHRcIjtcclxuICAgIEFjdGlvbkFsaWdubWVudFtBY3Rpb25BbGlnbm1lbnRbXCJTdHJldGNoXCJdID0gM10gPSBcIlN0cmV0Y2hcIjtcclxufSkoQWN0aW9uQWxpZ25tZW50ID0gZXhwb3J0cy5BY3Rpb25BbGlnbm1lbnQgfHwgKGV4cG9ydHMuQWN0aW9uQWxpZ25tZW50ID0ge30pKTtcclxudmFyIEltYWdlU3R5bGU7XHJcbihmdW5jdGlvbiAoSW1hZ2VTdHlsZSkge1xyXG4gICAgSW1hZ2VTdHlsZVtJbWFnZVN0eWxlW1wiRGVmYXVsdFwiXSA9IDBdID0gXCJEZWZhdWx0XCI7XHJcbiAgICBJbWFnZVN0eWxlW0ltYWdlU3R5bGVbXCJQZXJzb25cIl0gPSAxXSA9IFwiUGVyc29uXCI7XHJcbn0pKEltYWdlU3R5bGUgPSBleHBvcnRzLkltYWdlU3R5bGUgfHwgKGV4cG9ydHMuSW1hZ2VTdHlsZSA9IHt9KSk7XHJcbnZhciBTaG93Q2FyZEFjdGlvbk1vZGU7XHJcbihmdW5jdGlvbiAoU2hvd0NhcmRBY3Rpb25Nb2RlKSB7XHJcbiAgICBTaG93Q2FyZEFjdGlvbk1vZGVbU2hvd0NhcmRBY3Rpb25Nb2RlW1wiSW5saW5lXCJdID0gMF0gPSBcIklubGluZVwiO1xyXG4gICAgU2hvd0NhcmRBY3Rpb25Nb2RlW1Nob3dDYXJkQWN0aW9uTW9kZVtcIlBvcHVwXCJdID0gMV0gPSBcIlBvcHVwXCI7XHJcbn0pKFNob3dDYXJkQWN0aW9uTW9kZSA9IGV4cG9ydHMuU2hvd0NhcmRBY3Rpb25Nb2RlIHx8IChleHBvcnRzLlNob3dDYXJkQWN0aW9uTW9kZSA9IHt9KSk7XHJcbnZhciBPcmllbnRhdGlvbjtcclxuKGZ1bmN0aW9uIChPcmllbnRhdGlvbikge1xyXG4gICAgT3JpZW50YXRpb25bT3JpZW50YXRpb25bXCJIb3Jpem9udGFsXCJdID0gMF0gPSBcIkhvcml6b250YWxcIjtcclxuICAgIE9yaWVudGF0aW9uW09yaWVudGF0aW9uW1wiVmVydGljYWxcIl0gPSAxXSA9IFwiVmVydGljYWxcIjtcclxufSkoT3JpZW50YXRpb24gPSBleHBvcnRzLk9yaWVudGF0aW9uIHx8IChleHBvcnRzLk9yaWVudGF0aW9uID0ge30pKTtcclxudmFyIEZpbGxNb2RlO1xyXG4oZnVuY3Rpb24gKEZpbGxNb2RlKSB7XHJcbiAgICBGaWxsTW9kZVtGaWxsTW9kZVtcIkNvdmVyXCJdID0gMF0gPSBcIkNvdmVyXCI7XHJcbiAgICBGaWxsTW9kZVtGaWxsTW9kZVtcIlJlcGVhdEhvcml6b250YWxseVwiXSA9IDFdID0gXCJSZXBlYXRIb3Jpem9udGFsbHlcIjtcclxuICAgIEZpbGxNb2RlW0ZpbGxNb2RlW1wiUmVwZWF0VmVydGljYWxseVwiXSA9IDJdID0gXCJSZXBlYXRWZXJ0aWNhbGx5XCI7XHJcbiAgICBGaWxsTW9kZVtGaWxsTW9kZVtcIlJlcGVhdFwiXSA9IDNdID0gXCJSZXBlYXRcIjtcclxufSkoRmlsbE1vZGUgPSBleHBvcnRzLkZpbGxNb2RlIHx8IChleHBvcnRzLkZpbGxNb2RlID0ge30pKTtcclxudmFyIEFjdGlvbkljb25QbGFjZW1lbnQ7XHJcbihmdW5jdGlvbiAoQWN0aW9uSWNvblBsYWNlbWVudCkge1xyXG4gICAgQWN0aW9uSWNvblBsYWNlbWVudFtBY3Rpb25JY29uUGxhY2VtZW50W1wiTGVmdE9mVGl0bGVcIl0gPSAwXSA9IFwiTGVmdE9mVGl0bGVcIjtcclxuICAgIEFjdGlvbkljb25QbGFjZW1lbnRbQWN0aW9uSWNvblBsYWNlbWVudFtcIkFib3ZlVGl0bGVcIl0gPSAxXSA9IFwiQWJvdmVUaXRsZVwiO1xyXG59KShBY3Rpb25JY29uUGxhY2VtZW50ID0gZXhwb3J0cy5BY3Rpb25JY29uUGxhY2VtZW50IHx8IChleHBvcnRzLkFjdGlvbkljb25QbGFjZW1lbnQgPSB7fSkpO1xyXG52YXIgSW5wdXRUZXh0U3R5bGU7XHJcbihmdW5jdGlvbiAoSW5wdXRUZXh0U3R5bGUpIHtcclxuICAgIElucHV0VGV4dFN0eWxlW0lucHV0VGV4dFN0eWxlW1wiVGV4dFwiXSA9IDBdID0gXCJUZXh0XCI7XHJcbiAgICBJbnB1dFRleHRTdHlsZVtJbnB1dFRleHRTdHlsZVtcIlRlbFwiXSA9IDFdID0gXCJUZWxcIjtcclxuICAgIElucHV0VGV4dFN0eWxlW0lucHV0VGV4dFN0eWxlW1wiVXJsXCJdID0gMl0gPSBcIlVybFwiO1xyXG4gICAgSW5wdXRUZXh0U3R5bGVbSW5wdXRUZXh0U3R5bGVbXCJFbWFpbFwiXSA9IDNdID0gXCJFbWFpbFwiO1xyXG59KShJbnB1dFRleHRTdHlsZSA9IGV4cG9ydHMuSW5wdXRUZXh0U3R5bGUgfHwgKGV4cG9ydHMuSW5wdXRUZXh0U3R5bGUgPSB7fSkpO1xyXG52YXIgSW5wdXRWYWxpZGF0aW9uTmVjZXNzaXR5O1xyXG4oZnVuY3Rpb24gKElucHV0VmFsaWRhdGlvbk5lY2Vzc2l0eSkge1xyXG4gICAgSW5wdXRWYWxpZGF0aW9uTmVjZXNzaXR5W0lucHV0VmFsaWRhdGlvbk5lY2Vzc2l0eVtcIk9wdGlvbmFsXCJdID0gMF0gPSBcIk9wdGlvbmFsXCI7XHJcbiAgICBJbnB1dFZhbGlkYXRpb25OZWNlc3NpdHlbSW5wdXRWYWxpZGF0aW9uTmVjZXNzaXR5W1wiUmVxdWlyZWRcIl0gPSAxXSA9IFwiUmVxdWlyZWRcIjtcclxuICAgIElucHV0VmFsaWRhdGlvbk5lY2Vzc2l0eVtJbnB1dFZhbGlkYXRpb25OZWNlc3NpdHlbXCJSZXF1aXJlZFdpdGhWaXN1YWxDdWVcIl0gPSAyXSA9IFwiUmVxdWlyZWRXaXRoVmlzdWFsQ3VlXCI7XHJcbn0pKElucHV0VmFsaWRhdGlvbk5lY2Vzc2l0eSA9IGV4cG9ydHMuSW5wdXRWYWxpZGF0aW9uTmVjZXNzaXR5IHx8IChleHBvcnRzLklucHV0VmFsaWRhdGlvbk5lY2Vzc2l0eSA9IHt9KSk7XHJcbi8qXHJcbiAgICBUaGlzIHNob3VsZCByZWFsbHkgYmUgYSBzdHJpbmcgZW51bSwgZS5nLlxyXG5cclxuICAgICAgICBleHBvcnQgZW51bSBDb250YWluZXJTdHlsZSB7XHJcbiAgICAgICAgICAgIERlZmF1bHQgPSBcImRlZmF1bHRcIixcclxuICAgICAgICAgICAgRW1waGFzaXMgPSBcImVtcGhhc2lzXCJcclxuICAgICAgICB9XHJcblxyXG4gICAgSG93ZXZlciwgc29tZSBob3N0cyBkbyBub3QgdXNlIGEgdmVyc2lvbiBvZiBUeXBlU2NyaXB0XHJcbiAgICByZWNlbnQgZW5vdWdoIHRvIHVuZGVyc3RhbmQgc3RyaW5nIGVudW1zLiBUaGlzIGlzXHJcbiAgICBhIGNvbXBhdGlibGUgY29uc3RydWN0IHRoYXQgZG9lcyBub3QgcmVxdWlyZSB1c2luZ1xyXG4gICAgYSBtb3JlIHJlY2VudCB2ZXJzaW9uIG9mIFR5cGVTY3JpcHQuXHJcblxyXG4gICAgQWxzbyBub3RlIHRoZSBcIndlaXJkXCIgd2F5IHRoZXNlIHJlYWRvbmx5IGZpZWxkcyBhcmUgZGVjbGFyZWQgaXMgdG8gd29yayBhcm91bmRcclxuICAgIGEgYnJlYWtpbmcgY2hhbmdlIGludHJvZHVjZWQgaW4gVFMgMy4xIHdydCBkLnRzIGdlbmVyYXRpb24uIERPIE5PVCBDSEFOR0VcclxuICAgIGFuZCBhZG9wdCB0aGlzIHN5bnRheCBmb3IgYWxsIG90aGVyIHN0YXRpYyByZWFkb25seSBmaWVsZHMuXHJcbiovXHJcbnZhciBDb250YWluZXJTdHlsZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIENvbnRhaW5lclN0eWxlKCkge1xyXG4gICAgfVxyXG4gICAgQ29udGFpbmVyU3R5bGUuRGVmYXVsdCA9IFwiZGVmYXVsdFwiO1xyXG4gICAgQ29udGFpbmVyU3R5bGUuRW1waGFzaXMgPSBcImVtcGhhc2lzXCI7XHJcbiAgICBDb250YWluZXJTdHlsZS5BY2NlbnQgPSBcImFjY2VudFwiO1xyXG4gICAgQ29udGFpbmVyU3R5bGUuR29vZCA9IFwiZ29vZFwiO1xyXG4gICAgQ29udGFpbmVyU3R5bGUuQXR0ZW50aW9uID0gXCJhdHRlbnRpb25cIjtcclxuICAgIENvbnRhaW5lclN0eWxlLldhcm5pbmcgPSBcIndhcm5pbmdcIjtcclxuICAgIHJldHVybiBDb250YWluZXJTdHlsZTtcclxufSgpKTtcclxuZXhwb3J0cy5Db250YWluZXJTdHlsZSA9IENvbnRhaW5lclN0eWxlO1xyXG4vLyMgc291cmNlTWFwcGluZ1VSTD1lbnVtcy5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcclxudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xyXG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcclxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxyXG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcclxuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcclxuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxyXG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcclxuICAgIH07XHJcbn0pKCk7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuLy8gQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbi8vIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS5cclxudmFyIHNlcmlhbGl6YXRpb25fMSA9IHJlcXVpcmUoXCIuL3NlcmlhbGl6YXRpb25cIik7XHJcbnZhciBIb3N0Q2FwYWJpbGl0aWVzID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKEhvc3RDYXBhYmlsaXRpZXMsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBIb3N0Q2FwYWJpbGl0aWVzKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLl9jYXBhYmlsaXRpZXMgPSB7fTtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICBIb3N0Q2FwYWJpbGl0aWVzLnByb3RvdHlwZS5nZXRTY2hlbWFLZXkgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIFwiSG9zdENhcGFiaWxpdGllc1wiO1xyXG4gICAgfTtcclxuICAgIEhvc3RDYXBhYmlsaXRpZXMucHJvdG90eXBlLmludGVybmFsUGFyc2UgPSBmdW5jdGlvbiAoc291cmNlLCBjb250ZXh0KSB7XHJcbiAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5pbnRlcm5hbFBhcnNlLmNhbGwodGhpcywgc291cmNlLCBjb250ZXh0KTtcclxuICAgICAgICBpZiAoc291cmNlKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIG5hbWVfMSBpbiBzb3VyY2UpIHtcclxuICAgICAgICAgICAgICAgIHZhciBqc29uVmVyc2lvbiA9IHNvdXJjZVtuYW1lXzFdO1xyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBqc29uVmVyc2lvbiA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChqc29uVmVyc2lvbiA9PSBcIipcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZENhcGFiaWxpdHkobmFtZV8xLCBcIipcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmVyc2lvbiA9IHNlcmlhbGl6YXRpb25fMS5WZXJzaW9uLnBhcnNlKGpzb25WZXJzaW9uLCBjb250ZXh0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZlcnNpb24gJiYgdmVyc2lvbi5pc1ZhbGlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZENhcGFiaWxpdHkobmFtZV8xLCB2ZXJzaW9uKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBIb3N0Q2FwYWJpbGl0aWVzLnByb3RvdHlwZS5pbnRlcm5hbFRvSlNPTiA9IGZ1bmN0aW9uICh0YXJnZXQsIGNvbnRleHQpIHtcclxuICAgICAgICBfc3VwZXIucHJvdG90eXBlLmludGVybmFsVG9KU09OLmNhbGwodGhpcywgdGFyZ2V0LCBjb250ZXh0KTtcclxuICAgICAgICBmb3IgKHZhciBrZXkgaW4gdGhpcy5fY2FwYWJpbGl0aWVzKSB7XHJcbiAgICAgICAgICAgIHRhcmdldFtrZXldID0gdGhpcy5fY2FwYWJpbGl0aWVzW2tleV07XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEhvc3RDYXBhYmlsaXRpZXMucHJvdG90eXBlLmFkZENhcGFiaWxpdHkgPSBmdW5jdGlvbiAobmFtZSwgdmVyc2lvbikge1xyXG4gICAgICAgIHRoaXMuX2NhcGFiaWxpdGllc1tuYW1lXSA9IHZlcnNpb247XHJcbiAgICB9O1xyXG4gICAgSG9zdENhcGFiaWxpdGllcy5wcm90b3R5cGUucmVtb3ZlQ2FwYWJpbGl0eSA9IGZ1bmN0aW9uIChuYW1lKSB7XHJcbiAgICAgICAgZGVsZXRlIHRoaXMuX2NhcGFiaWxpdGllc1tuYW1lXTtcclxuICAgIH07XHJcbiAgICBIb3N0Q2FwYWJpbGl0aWVzLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLl9jYXBhYmlsaXRpZXMgPSB7fTtcclxuICAgIH07XHJcbiAgICBIb3N0Q2FwYWJpbGl0aWVzLnByb3RvdHlwZS5oYXNDYXBhYmlsaXR5ID0gZnVuY3Rpb24gKG5hbWUsIHZlcnNpb24pIHtcclxuICAgICAgICBpZiAodGhpcy5fY2FwYWJpbGl0aWVzLmhhc093blByb3BlcnR5KG5hbWUpKSB7XHJcbiAgICAgICAgICAgIGlmICh2ZXJzaW9uID09IFwiKlwiIHx8IHRoaXMuX2NhcGFiaWxpdGllc1tuYW1lXSA9PSBcIipcIikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHZlcnNpb24uY29tcGFyZVRvKHRoaXMuX2NhcGFiaWxpdGllc1tuYW1lXSkgPD0gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfTtcclxuICAgIEhvc3RDYXBhYmlsaXRpZXMucHJvdG90eXBlLmFyZUFsbE1ldCA9IGZ1bmN0aW9uIChob3N0Q2FwYWJpbGl0aWVzKSB7XHJcbiAgICAgICAgZm9yICh2YXIgY2FwYWJpbGl0eU5hbWUgaW4gdGhpcy5fY2FwYWJpbGl0aWVzKSB7XHJcbiAgICAgICAgICAgIGlmICghaG9zdENhcGFiaWxpdGllcy5oYXNDYXBhYmlsaXR5KGNhcGFiaWxpdHlOYW1lLCB0aGlzLl9jYXBhYmlsaXRpZXNbY2FwYWJpbGl0eU5hbWVdKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBIb3N0Q2FwYWJpbGl0aWVzO1xyXG59KHNlcmlhbGl6YXRpb25fMS5TZXJpYWxpemFibGVPYmplY3QpKTtcclxuZXhwb3J0cy5Ib3N0Q2FwYWJpbGl0aWVzID0gSG9zdENhcGFiaWxpdGllcztcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aG9zdC1jYXBhYmlsaXRpZXMuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcclxuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XHJcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcclxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XHJcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XHJcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cclxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XHJcbiAgICB9O1xyXG59KSgpO1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbnZhciBFbnVtcyA9IHJlcXVpcmUoXCIuL2VudW1zXCIpO1xyXG52YXIgVXRpbHMgPSByZXF1aXJlKFwiLi91dGlsc1wiKTtcclxudmFyIFNoYXJlZCA9IHJlcXVpcmUoXCIuL3NoYXJlZFwiKTtcclxudmFyIGhvc3RfY2FwYWJpbGl0aWVzXzEgPSByZXF1aXJlKFwiLi9ob3N0LWNhcGFiaWxpdGllc1wiKTtcclxuZnVuY3Rpb24gcGFyc2VIb3N0Q29uZmlnRW51bSh0YXJnZXRFbnVtLCB2YWx1ZSwgZGVmYXVsdFZhbHVlKSB7XHJcbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgdmFyIHBhcnNlZFZhbHVlID0gVXRpbHMucGFyc2VFbnVtKHRhcmdldEVudW0sIHZhbHVlLCBkZWZhdWx0VmFsdWUpO1xyXG4gICAgICAgIHJldHVybiBwYXJzZWRWYWx1ZSAhPT0gdW5kZWZpbmVkID8gcGFyc2VkVmFsdWUgOiBkZWZhdWx0VmFsdWU7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09IFwibnVtYmVyXCIpIHtcclxuICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICByZXR1cm4gZGVmYXVsdFZhbHVlO1xyXG4gICAgfVxyXG59XHJcbnZhciBDb2xvckRlZmluaXRpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBDb2xvckRlZmluaXRpb24oZGVmYXVsdENvbG9yLCBzdWJ0bGVDb2xvcikge1xyXG4gICAgICAgIHRoaXMuZGVmYXVsdCA9IFwiIzAwMDAwMFwiO1xyXG4gICAgICAgIHRoaXMuc3VidGxlID0gXCIjNjY2NjY2XCI7XHJcbiAgICAgICAgaWYgKGRlZmF1bHRDb2xvcikge1xyXG4gICAgICAgICAgICB0aGlzLmRlZmF1bHQgPSBkZWZhdWx0Q29sb3I7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChzdWJ0bGVDb2xvcikge1xyXG4gICAgICAgICAgICB0aGlzLnN1YnRsZSA9IHN1YnRsZUNvbG9yO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIENvbG9yRGVmaW5pdGlvbi5wcm90b3R5cGUucGFyc2UgPSBmdW5jdGlvbiAob2JqKSB7XHJcbiAgICAgICAgaWYgKG9iaikge1xyXG4gICAgICAgICAgICB0aGlzLmRlZmF1bHQgPSBvYmpbXCJkZWZhdWx0XCJdIHx8IHRoaXMuZGVmYXVsdDtcclxuICAgICAgICAgICAgdGhpcy5zdWJ0bGUgPSBvYmpbXCJzdWJ0bGVcIl0gfHwgdGhpcy5zdWJ0bGU7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIHJldHVybiBDb2xvckRlZmluaXRpb247XHJcbn0oKSk7XHJcbmV4cG9ydHMuQ29sb3JEZWZpbml0aW9uID0gQ29sb3JEZWZpbml0aW9uO1xyXG52YXIgVGV4dENvbG9yRGVmaW5pdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhUZXh0Q29sb3JEZWZpbml0aW9uLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gVGV4dENvbG9yRGVmaW5pdGlvbigpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgICAgICBfdGhpcy5oaWdobGlnaHRDb2xvcnMgPSBuZXcgQ29sb3JEZWZpbml0aW9uKFwiIzIyMDAwMDAwXCIsIFwiIzExMDAwMDAwXCIpO1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIFRleHRDb2xvckRlZmluaXRpb24ucHJvdG90eXBlLnBhcnNlID0gZnVuY3Rpb24gKG9iaikge1xyXG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUucGFyc2UuY2FsbCh0aGlzLCBvYmopO1xyXG4gICAgICAgIGlmIChvYmopIHtcclxuICAgICAgICAgICAgdGhpcy5oaWdobGlnaHRDb2xvcnMucGFyc2Uob2JqW1wiaGlnaGxpZ2h0Q29sb3JzXCJdKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFRleHRDb2xvckRlZmluaXRpb247XHJcbn0oQ29sb3JEZWZpbml0aW9uKSk7XHJcbmV4cG9ydHMuVGV4dENvbG9yRGVmaW5pdGlvbiA9IFRleHRDb2xvckRlZmluaXRpb247XHJcbnZhciBBZGFwdGl2ZUNhcmRDb25maWcgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBBZGFwdGl2ZUNhcmRDb25maWcob2JqKSB7XHJcbiAgICAgICAgdGhpcy5hbGxvd0N1c3RvbVN0eWxlID0gZmFsc2U7XHJcbiAgICAgICAgaWYgKG9iaikge1xyXG4gICAgICAgICAgICB0aGlzLmFsbG93Q3VzdG9tU3R5bGUgPSBvYmpbXCJhbGxvd0N1c3RvbVN0eWxlXCJdIHx8IHRoaXMuYWxsb3dDdXN0b21TdHlsZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gQWRhcHRpdmVDYXJkQ29uZmlnO1xyXG59KCkpO1xyXG5leHBvcnRzLkFkYXB0aXZlQ2FyZENvbmZpZyA9IEFkYXB0aXZlQ2FyZENvbmZpZztcclxudmFyIEltYWdlU2V0Q29uZmlnID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gSW1hZ2VTZXRDb25maWcob2JqKSB7XHJcbiAgICAgICAgdGhpcy5pbWFnZVNpemUgPSBFbnVtcy5TaXplLk1lZGl1bTtcclxuICAgICAgICB0aGlzLm1heEltYWdlSGVpZ2h0ID0gMTAwO1xyXG4gICAgICAgIGlmIChvYmopIHtcclxuICAgICAgICAgICAgdGhpcy5pbWFnZVNpemUgPSBvYmpbXCJpbWFnZVNpemVcIl0gIT0gbnVsbCA/IG9ialtcImltYWdlU2l6ZVwiXSA6IHRoaXMuaW1hZ2VTaXplO1xyXG4gICAgICAgICAgICB0aGlzLm1heEltYWdlSGVpZ2h0ID0gVXRpbHMucGFyc2VOdW1iZXIob2JqW1wibWF4SW1hZ2VIZWlnaHRcIl0sIDEwMCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgSW1hZ2VTZXRDb25maWcucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBpbWFnZVNpemU6IEVudW1zLlNpemVbdGhpcy5pbWFnZVNpemVdLFxyXG4gICAgICAgICAgICBtYXhJbWFnZUhlaWdodDogdGhpcy5tYXhJbWFnZUhlaWdodFxyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIEltYWdlU2V0Q29uZmlnO1xyXG59KCkpO1xyXG5leHBvcnRzLkltYWdlU2V0Q29uZmlnID0gSW1hZ2VTZXRDb25maWc7XHJcbnZhciBNZWRpYUNvbmZpZyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIE1lZGlhQ29uZmlnKG9iaikge1xyXG4gICAgICAgIHRoaXMuYWxsb3dJbmxpbmVQbGF5YmFjayA9IHRydWU7XHJcbiAgICAgICAgaWYgKG9iaikge1xyXG4gICAgICAgICAgICB0aGlzLmRlZmF1bHRQb3N0ZXIgPSBvYmpbXCJkZWZhdWx0UG9zdGVyXCJdO1xyXG4gICAgICAgICAgICB0aGlzLmFsbG93SW5saW5lUGxheWJhY2sgPSBvYmpbXCJhbGxvd0lubGluZVBsYXliYWNrXCJdIHx8IHRoaXMuYWxsb3dJbmxpbmVQbGF5YmFjaztcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBNZWRpYUNvbmZpZy5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIGRlZmF1bHRQb3N0ZXI6IHRoaXMuZGVmYXVsdFBvc3RlcixcclxuICAgICAgICAgICAgYWxsb3dJbmxpbmVQbGF5YmFjazogdGhpcy5hbGxvd0lubGluZVBsYXliYWNrXHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gTWVkaWFDb25maWc7XHJcbn0oKSk7XHJcbmV4cG9ydHMuTWVkaWFDb25maWcgPSBNZWRpYUNvbmZpZztcclxudmFyIEZhY3RUZXh0RGVmaW5pdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEZhY3RUZXh0RGVmaW5pdGlvbihvYmopIHtcclxuICAgICAgICB0aGlzLnNpemUgPSBFbnVtcy5UZXh0U2l6ZS5EZWZhdWx0O1xyXG4gICAgICAgIHRoaXMuY29sb3IgPSBFbnVtcy5UZXh0Q29sb3IuRGVmYXVsdDtcclxuICAgICAgICB0aGlzLmlzU3VidGxlID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy53ZWlnaHQgPSBFbnVtcy5UZXh0V2VpZ2h0LkRlZmF1bHQ7XHJcbiAgICAgICAgdGhpcy53cmFwID0gdHJ1ZTtcclxuICAgICAgICBpZiAob2JqKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2l6ZSA9IHBhcnNlSG9zdENvbmZpZ0VudW0oRW51bXMuVGV4dFNpemUsIG9ialtcInNpemVcIl0sIEVudW1zLlRleHRTaXplLkRlZmF1bHQpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbG9yID0gcGFyc2VIb3N0Q29uZmlnRW51bShFbnVtcy5UZXh0Q29sb3IsIG9ialtcImNvbG9yXCJdLCBFbnVtcy5UZXh0Q29sb3IuRGVmYXVsdCk7XHJcbiAgICAgICAgICAgIHRoaXMuaXNTdWJ0bGUgPSBvYmpbXCJpc1N1YnRsZVwiXSB8fCB0aGlzLmlzU3VidGxlO1xyXG4gICAgICAgICAgICB0aGlzLndlaWdodCA9IHBhcnNlSG9zdENvbmZpZ0VudW0oRW51bXMuVGV4dFdlaWdodCwgb2JqW1wid2VpZ2h0XCJdLCB0aGlzLmdldERlZmF1bHRXZWlnaHQoKSk7XHJcbiAgICAgICAgICAgIHRoaXMud3JhcCA9IG9ialtcIndyYXBcIl0gIT0gbnVsbCA/IG9ialtcIndyYXBcIl0gOiB0aGlzLndyYXA7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgO1xyXG4gICAgRmFjdFRleHREZWZpbml0aW9uLnByb3RvdHlwZS5nZXREZWZhdWx0V2VpZ2h0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBFbnVtcy5UZXh0V2VpZ2h0LkRlZmF1bHQ7XHJcbiAgICB9O1xyXG4gICAgRmFjdFRleHREZWZpbml0aW9uLnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgc2l6ZTogRW51bXMuVGV4dFNpemVbdGhpcy5zaXplXSxcclxuICAgICAgICAgICAgY29sb3I6IEVudW1zLlRleHRDb2xvclt0aGlzLmNvbG9yXSxcclxuICAgICAgICAgICAgaXNTdWJ0bGU6IHRoaXMuaXNTdWJ0bGUsXHJcbiAgICAgICAgICAgIHdlaWdodDogRW51bXMuVGV4dFdlaWdodFt0aGlzLndlaWdodF0sXHJcbiAgICAgICAgICAgIHdyYXA6IHRoaXMud3JhcFxyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIEZhY3RUZXh0RGVmaW5pdGlvbjtcclxufSgpKTtcclxuZXhwb3J0cy5GYWN0VGV4dERlZmluaXRpb24gPSBGYWN0VGV4dERlZmluaXRpb247XHJcbnZhciBGYWN0VGl0bGVEZWZpbml0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKEZhY3RUaXRsZURlZmluaXRpb24sIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBGYWN0VGl0bGVEZWZpbml0aW9uKG9iaikge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIG9iaikgfHwgdGhpcztcclxuICAgICAgICBfdGhpcy5tYXhXaWR0aCA9IDE1MDtcclxuICAgICAgICBfdGhpcy53ZWlnaHQgPSBFbnVtcy5UZXh0V2VpZ2h0LkJvbGRlcjtcclxuICAgICAgICBpZiAob2JqKSB7XHJcbiAgICAgICAgICAgIF90aGlzLm1heFdpZHRoID0gb2JqW1wibWF4V2lkdGhcIl0gIT0gbnVsbCA/IG9ialtcIm1heFdpZHRoXCJdIDogX3RoaXMubWF4V2lkdGg7XHJcbiAgICAgICAgICAgIF90aGlzLndlaWdodCA9IHBhcnNlSG9zdENvbmZpZ0VudW0oRW51bXMuVGV4dFdlaWdodCwgb2JqW1wid2VpZ2h0XCJdLCBFbnVtcy5UZXh0V2VpZ2h0LkJvbGRlcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIEZhY3RUaXRsZURlZmluaXRpb24ucHJvdG90eXBlLmdldERlZmF1bHRXZWlnaHQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIEVudW1zLlRleHRXZWlnaHQuQm9sZGVyO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBGYWN0VGl0bGVEZWZpbml0aW9uO1xyXG59KEZhY3RUZXh0RGVmaW5pdGlvbikpO1xyXG5leHBvcnRzLkZhY3RUaXRsZURlZmluaXRpb24gPSBGYWN0VGl0bGVEZWZpbml0aW9uO1xyXG52YXIgRmFjdFNldENvbmZpZyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEZhY3RTZXRDb25maWcob2JqKSB7XHJcbiAgICAgICAgdGhpcy50aXRsZSA9IG5ldyBGYWN0VGl0bGVEZWZpbml0aW9uKCk7XHJcbiAgICAgICAgdGhpcy52YWx1ZSA9IG5ldyBGYWN0VGV4dERlZmluaXRpb24oKTtcclxuICAgICAgICB0aGlzLnNwYWNpbmcgPSAxMDtcclxuICAgICAgICBpZiAob2JqKSB7XHJcbiAgICAgICAgICAgIHRoaXMudGl0bGUgPSBuZXcgRmFjdFRpdGxlRGVmaW5pdGlvbihvYmpbXCJ0aXRsZVwiXSk7XHJcbiAgICAgICAgICAgIHRoaXMudmFsdWUgPSBuZXcgRmFjdFRleHREZWZpbml0aW9uKG9ialtcInZhbHVlXCJdKTtcclxuICAgICAgICAgICAgdGhpcy5zcGFjaW5nID0gb2JqLnNwYWNpbmcgJiYgb2JqLnNwYWNpbmcgIT0gbnVsbCA/IG9iai5zcGFjaW5nICYmIG9iai5zcGFjaW5nIDogdGhpcy5zcGFjaW5nO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBGYWN0U2V0Q29uZmlnO1xyXG59KCkpO1xyXG5leHBvcnRzLkZhY3RTZXRDb25maWcgPSBGYWN0U2V0Q29uZmlnO1xyXG52YXIgU2hvd0NhcmRBY3Rpb25Db25maWcgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBTaG93Q2FyZEFjdGlvbkNvbmZpZyhvYmopIHtcclxuICAgICAgICB0aGlzLmFjdGlvbk1vZGUgPSBFbnVtcy5TaG93Q2FyZEFjdGlvbk1vZGUuSW5saW5lO1xyXG4gICAgICAgIHRoaXMuaW5saW5lVG9wTWFyZ2luID0gMTY7XHJcbiAgICAgICAgdGhpcy5zdHlsZSA9IEVudW1zLkNvbnRhaW5lclN0eWxlLkVtcGhhc2lzO1xyXG4gICAgICAgIGlmIChvYmopIHtcclxuICAgICAgICAgICAgdGhpcy5hY3Rpb25Nb2RlID0gcGFyc2VIb3N0Q29uZmlnRW51bShFbnVtcy5TaG93Q2FyZEFjdGlvbk1vZGUsIG9ialtcImFjdGlvbk1vZGVcIl0sIEVudW1zLlNob3dDYXJkQWN0aW9uTW9kZS5JbmxpbmUpO1xyXG4gICAgICAgICAgICB0aGlzLmlubGluZVRvcE1hcmdpbiA9IG9ialtcImlubGluZVRvcE1hcmdpblwiXSAhPSBudWxsID8gb2JqW1wiaW5saW5lVG9wTWFyZ2luXCJdIDogdGhpcy5pbmxpbmVUb3BNYXJnaW47XHJcbiAgICAgICAgICAgIHRoaXMuc3R5bGUgPSBvYmpbXCJzdHlsZVwiXSAmJiB0eXBlb2Ygb2JqW1wic3R5bGVcIl0gPT09IFwic3RyaW5nXCIgPyBvYmpbXCJzdHlsZVwiXSA6IEVudW1zLkNvbnRhaW5lclN0eWxlLkVtcGhhc2lzO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIFNob3dDYXJkQWN0aW9uQ29uZmlnLnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgYWN0aW9uTW9kZTogRW51bXMuU2hvd0NhcmRBY3Rpb25Nb2RlW3RoaXMuYWN0aW9uTW9kZV0sXHJcbiAgICAgICAgICAgIGlubGluZVRvcE1hcmdpbjogdGhpcy5pbmxpbmVUb3BNYXJnaW4sXHJcbiAgICAgICAgICAgIHN0eWxlOiB0aGlzLnN0eWxlXHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gU2hvd0NhcmRBY3Rpb25Db25maWc7XHJcbn0oKSk7XHJcbmV4cG9ydHMuU2hvd0NhcmRBY3Rpb25Db25maWcgPSBTaG93Q2FyZEFjdGlvbkNvbmZpZztcclxudmFyIEFjdGlvbnNDb25maWcgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBBY3Rpb25zQ29uZmlnKG9iaikge1xyXG4gICAgICAgIHRoaXMubWF4QWN0aW9ucyA9IDU7XHJcbiAgICAgICAgdGhpcy5zcGFjaW5nID0gRW51bXMuU3BhY2luZy5EZWZhdWx0O1xyXG4gICAgICAgIHRoaXMuYnV0dG9uU3BhY2luZyA9IDIwO1xyXG4gICAgICAgIHRoaXMuc2hvd0NhcmQgPSBuZXcgU2hvd0NhcmRBY3Rpb25Db25maWcoKTtcclxuICAgICAgICB0aGlzLnByZUV4cGFuZFNpbmdsZVNob3dDYXJkQWN0aW9uID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5hY3Rpb25zT3JpZW50YXRpb24gPSBFbnVtcy5PcmllbnRhdGlvbi5Ib3Jpem9udGFsO1xyXG4gICAgICAgIHRoaXMuYWN0aW9uQWxpZ25tZW50ID0gRW51bXMuQWN0aW9uQWxpZ25tZW50LkxlZnQ7XHJcbiAgICAgICAgdGhpcy5pY29uUGxhY2VtZW50ID0gRW51bXMuQWN0aW9uSWNvblBsYWNlbWVudC5MZWZ0T2ZUaXRsZTtcclxuICAgICAgICB0aGlzLmFsbG93VGl0bGVUb1dyYXAgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmljb25TaXplID0gMTY7XHJcbiAgICAgICAgaWYgKG9iaikge1xyXG4gICAgICAgICAgICB0aGlzLm1heEFjdGlvbnMgPSBvYmpbXCJtYXhBY3Rpb25zXCJdICE9IG51bGwgPyBvYmpbXCJtYXhBY3Rpb25zXCJdIDogdGhpcy5tYXhBY3Rpb25zO1xyXG4gICAgICAgICAgICB0aGlzLnNwYWNpbmcgPSBwYXJzZUhvc3RDb25maWdFbnVtKEVudW1zLlNwYWNpbmcsIG9iai5zcGFjaW5nICYmIG9iai5zcGFjaW5nLCBFbnVtcy5TcGFjaW5nLkRlZmF1bHQpO1xyXG4gICAgICAgICAgICB0aGlzLmJ1dHRvblNwYWNpbmcgPSBvYmpbXCJidXR0b25TcGFjaW5nXCJdICE9IG51bGwgPyBvYmpbXCJidXR0b25TcGFjaW5nXCJdIDogdGhpcy5idXR0b25TcGFjaW5nO1xyXG4gICAgICAgICAgICB0aGlzLnNob3dDYXJkID0gbmV3IFNob3dDYXJkQWN0aW9uQ29uZmlnKG9ialtcInNob3dDYXJkXCJdKTtcclxuICAgICAgICAgICAgdGhpcy5wcmVFeHBhbmRTaW5nbGVTaG93Q2FyZEFjdGlvbiA9IFV0aWxzLnBhcnNlQm9vbChvYmpbXCJwcmVFeHBhbmRTaW5nbGVTaG93Q2FyZEFjdGlvblwiXSwgZmFsc2UpO1xyXG4gICAgICAgICAgICB0aGlzLmFjdGlvbnNPcmllbnRhdGlvbiA9IHBhcnNlSG9zdENvbmZpZ0VudW0oRW51bXMuT3JpZW50YXRpb24sIG9ialtcImFjdGlvbnNPcmllbnRhdGlvblwiXSwgRW51bXMuT3JpZW50YXRpb24uSG9yaXpvbnRhbCk7XHJcbiAgICAgICAgICAgIHRoaXMuYWN0aW9uQWxpZ25tZW50ID0gcGFyc2VIb3N0Q29uZmlnRW51bShFbnVtcy5BY3Rpb25BbGlnbm1lbnQsIG9ialtcImFjdGlvbkFsaWdubWVudFwiXSwgRW51bXMuQWN0aW9uQWxpZ25tZW50LkxlZnQpO1xyXG4gICAgICAgICAgICB0aGlzLmljb25QbGFjZW1lbnQgPSBwYXJzZUhvc3RDb25maWdFbnVtKEVudW1zLkFjdGlvbkljb25QbGFjZW1lbnQsIG9ialtcImljb25QbGFjZW1lbnRcIl0sIEVudW1zLkFjdGlvbkljb25QbGFjZW1lbnQuTGVmdE9mVGl0bGUpO1xyXG4gICAgICAgICAgICB0aGlzLmFsbG93VGl0bGVUb1dyYXAgPSBvYmpbXCJhbGxvd1RpdGxlVG9XcmFwXCJdICE9IG51bGwgPyBvYmpbXCJhbGxvd1RpdGxlVG9XcmFwXCJdIDogdGhpcy5hbGxvd1RpdGxlVG9XcmFwO1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHNpemVBbmRVbml0ID0gU2hhcmVkLlNpemVBbmRVbml0LnBhcnNlKG9ialtcImljb25TaXplXCJdKTtcclxuICAgICAgICAgICAgICAgIGlmIChzaXplQW5kVW5pdC51bml0ID09IEVudW1zLlNpemVVbml0LlBpeGVsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pY29uU2l6ZSA9IHNpemVBbmRVbml0LnBoeXNpY2FsU2l6ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICAgICAgLy8gU3dhbGxvdyB0aGlzLCBrZWVwIGRlZmF1bHQgaWNvbiBzaXplXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBBY3Rpb25zQ29uZmlnLnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgbWF4QWN0aW9uczogdGhpcy5tYXhBY3Rpb25zLFxyXG4gICAgICAgICAgICBzcGFjaW5nOiBFbnVtcy5TcGFjaW5nW3RoaXMuc3BhY2luZ10sXHJcbiAgICAgICAgICAgIGJ1dHRvblNwYWNpbmc6IHRoaXMuYnV0dG9uU3BhY2luZyxcclxuICAgICAgICAgICAgc2hvd0NhcmQ6IHRoaXMuc2hvd0NhcmQsXHJcbiAgICAgICAgICAgIHByZUV4cGFuZFNpbmdsZVNob3dDYXJkQWN0aW9uOiB0aGlzLnByZUV4cGFuZFNpbmdsZVNob3dDYXJkQWN0aW9uLFxyXG4gICAgICAgICAgICBhY3Rpb25zT3JpZW50YXRpb246IEVudW1zLk9yaWVudGF0aW9uW3RoaXMuYWN0aW9uc09yaWVudGF0aW9uXSxcclxuICAgICAgICAgICAgYWN0aW9uQWxpZ25tZW50OiBFbnVtcy5BY3Rpb25BbGlnbm1lbnRbdGhpcy5hY3Rpb25BbGlnbm1lbnRdXHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gQWN0aW9uc0NvbmZpZztcclxufSgpKTtcclxuZXhwb3J0cy5BY3Rpb25zQ29uZmlnID0gQWN0aW9uc0NvbmZpZztcclxudmFyIENvbG9yU2V0RGVmaW5pdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIENvbG9yU2V0RGVmaW5pdGlvbihvYmopIHtcclxuICAgICAgICB0aGlzLmRlZmF1bHQgPSBuZXcgVGV4dENvbG9yRGVmaW5pdGlvbigpO1xyXG4gICAgICAgIHRoaXMuZGFyayA9IG5ldyBUZXh0Q29sb3JEZWZpbml0aW9uKCk7XHJcbiAgICAgICAgdGhpcy5saWdodCA9IG5ldyBUZXh0Q29sb3JEZWZpbml0aW9uKCk7XHJcbiAgICAgICAgdGhpcy5hY2NlbnQgPSBuZXcgVGV4dENvbG9yRGVmaW5pdGlvbigpO1xyXG4gICAgICAgIHRoaXMuZ29vZCA9IG5ldyBUZXh0Q29sb3JEZWZpbml0aW9uKCk7XHJcbiAgICAgICAgdGhpcy53YXJuaW5nID0gbmV3IFRleHRDb2xvckRlZmluaXRpb24oKTtcclxuICAgICAgICB0aGlzLmF0dGVudGlvbiA9IG5ldyBUZXh0Q29sb3JEZWZpbml0aW9uKCk7XHJcbiAgICAgICAgdGhpcy5wYXJzZShvYmopO1xyXG4gICAgfVxyXG4gICAgQ29sb3JTZXREZWZpbml0aW9uLnByb3RvdHlwZS5wYXJzZVNpbmdsZUNvbG9yID0gZnVuY3Rpb24gKG9iaiwgcHJvcGVydHlOYW1lKSB7XHJcbiAgICAgICAgaWYgKG9iaikge1xyXG4gICAgICAgICAgICB0aGlzW3Byb3BlcnR5TmFtZV0ucGFyc2Uob2JqW3Byb3BlcnR5TmFtZV0pO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBDb2xvclNldERlZmluaXRpb24ucHJvdG90eXBlLnBhcnNlID0gZnVuY3Rpb24gKG9iaikge1xyXG4gICAgICAgIGlmIChvYmopIHtcclxuICAgICAgICAgICAgdGhpcy5wYXJzZVNpbmdsZUNvbG9yKG9iaiwgXCJkZWZhdWx0XCIpO1xyXG4gICAgICAgICAgICB0aGlzLnBhcnNlU2luZ2xlQ29sb3Iob2JqLCBcImRhcmtcIik7XHJcbiAgICAgICAgICAgIHRoaXMucGFyc2VTaW5nbGVDb2xvcihvYmosIFwibGlnaHRcIik7XHJcbiAgICAgICAgICAgIHRoaXMucGFyc2VTaW5nbGVDb2xvcihvYmosIFwiYWNjZW50XCIpO1xyXG4gICAgICAgICAgICB0aGlzLnBhcnNlU2luZ2xlQ29sb3Iob2JqLCBcImdvb2RcIik7XHJcbiAgICAgICAgICAgIHRoaXMucGFyc2VTaW5nbGVDb2xvcihvYmosIFwid2FybmluZ1wiKTtcclxuICAgICAgICAgICAgdGhpcy5wYXJzZVNpbmdsZUNvbG9yKG9iaiwgXCJhdHRlbnRpb25cIik7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIHJldHVybiBDb2xvclNldERlZmluaXRpb247XHJcbn0oKSk7XHJcbmV4cG9ydHMuQ29sb3JTZXREZWZpbml0aW9uID0gQ29sb3JTZXREZWZpbml0aW9uO1xyXG52YXIgQ29udGFpbmVyU3R5bGVEZWZpbml0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQ29udGFpbmVyU3R5bGVEZWZpbml0aW9uKG9iaikge1xyXG4gICAgICAgIHRoaXMuZm9yZWdyb3VuZENvbG9ycyA9IG5ldyBDb2xvclNldERlZmluaXRpb24oe1xyXG4gICAgICAgICAgICBcImRlZmF1bHRcIjogeyBkZWZhdWx0OiBcIiMzMzMzMzNcIiwgc3VidGxlOiBcIiNFRTMzMzMzM1wiIH0sXHJcbiAgICAgICAgICAgIFwiZGFya1wiOiB7IGRlZmF1bHQ6IFwiIzAwMDAwMFwiLCBzdWJ0bGU6IFwiIzY2MDAwMDAwXCIgfSxcclxuICAgICAgICAgICAgXCJsaWdodFwiOiB7IGRlZmF1bHQ6IFwiI0ZGRkZGRlwiLCBzdWJ0bGU6IFwiIzMzMDAwMDAwXCIgfSxcclxuICAgICAgICAgICAgXCJhY2NlbnRcIjogeyBkZWZhdWx0OiBcIiMyRTg5RkNcIiwgc3VidGxlOiBcIiM4ODJFODlGQ1wiIH0sXHJcbiAgICAgICAgICAgIFwiZ29vZFwiOiB7IGRlZmF1bHQ6IFwiIzU0QTI1NFwiLCBzdWJ0bGU6IFwiI0RENTRBMjU0XCIgfSxcclxuICAgICAgICAgICAgXCJ3YXJuaW5nXCI6IHsgZGVmYXVsdDogXCIjRTY5NTAwXCIsIHN1YnRsZTogXCIjRERFNjk1MDBcIiB9LFxyXG4gICAgICAgICAgICBcImF0dGVudGlvblwiOiB7IGRlZmF1bHQ6IFwiI0NDMzMwMFwiLCBzdWJ0bGU6IFwiI0REQ0MzMzAwXCIgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMucGFyc2Uob2JqKTtcclxuICAgIH1cclxuICAgIENvbnRhaW5lclN0eWxlRGVmaW5pdGlvbi5wcm90b3R5cGUucGFyc2UgPSBmdW5jdGlvbiAob2JqKSB7XHJcbiAgICAgICAgaWYgKG9iaikge1xyXG4gICAgICAgICAgICB0aGlzLmJhY2tncm91bmRDb2xvciA9IG9ialtcImJhY2tncm91bmRDb2xvclwiXTtcclxuICAgICAgICAgICAgdGhpcy5mb3JlZ3JvdW5kQ29sb3JzLnBhcnNlKG9ialtcImZvcmVncm91bmRDb2xvcnNcIl0pO1xyXG4gICAgICAgICAgICB0aGlzLmhpZ2hsaWdodEJhY2tncm91bmRDb2xvciA9IG9ialtcImhpZ2hsaWdodEJhY2tncm91bmRDb2xvclwiXTtcclxuICAgICAgICAgICAgdGhpcy5oaWdobGlnaHRGb3JlZ3JvdW5kQ29sb3IgPSBvYmpbXCJoaWdobGlnaHRGb3JlZ3JvdW5kQ29sb3JcIl07XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb250YWluZXJTdHlsZURlZmluaXRpb24ucHJvdG90eXBlLCBcImlzQnVpbHRJblwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIHJldHVybiBDb250YWluZXJTdHlsZURlZmluaXRpb247XHJcbn0oKSk7XHJcbmV4cG9ydHMuQ29udGFpbmVyU3R5bGVEZWZpbml0aW9uID0gQ29udGFpbmVyU3R5bGVEZWZpbml0aW9uO1xyXG52YXIgQnVpbHRJbkNvbnRhaW5lclN0eWxlRGVmaW5pdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhCdWlsdEluQ29udGFpbmVyU3R5bGVEZWZpbml0aW9uLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gQnVpbHRJbkNvbnRhaW5lclN0eWxlRGVmaW5pdGlvbigpIHtcclxuICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XHJcbiAgICB9XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQnVpbHRJbkNvbnRhaW5lclN0eWxlRGVmaW5pdGlvbi5wcm90b3R5cGUsIFwiaXNCdWlsdEluXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gQnVpbHRJbkNvbnRhaW5lclN0eWxlRGVmaW5pdGlvbjtcclxufShDb250YWluZXJTdHlsZURlZmluaXRpb24pKTtcclxudmFyIENvbnRhaW5lclN0eWxlU2V0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQ29udGFpbmVyU3R5bGVTZXQob2JqKSB7XHJcbiAgICAgICAgdGhpcy5fYWxsU3R5bGVzID0ge307XHJcbiAgICAgICAgdGhpcy5fYWxsU3R5bGVzW0VudW1zLkNvbnRhaW5lclN0eWxlLkRlZmF1bHRdID0gbmV3IEJ1aWx0SW5Db250YWluZXJTdHlsZURlZmluaXRpb24oKTtcclxuICAgICAgICB0aGlzLl9hbGxTdHlsZXNbRW51bXMuQ29udGFpbmVyU3R5bGUuRW1waGFzaXNdID0gbmV3IEJ1aWx0SW5Db250YWluZXJTdHlsZURlZmluaXRpb24oKTtcclxuICAgICAgICB0aGlzLl9hbGxTdHlsZXNbRW51bXMuQ29udGFpbmVyU3R5bGUuQWNjZW50XSA9IG5ldyBCdWlsdEluQ29udGFpbmVyU3R5bGVEZWZpbml0aW9uKCk7XHJcbiAgICAgICAgdGhpcy5fYWxsU3R5bGVzW0VudW1zLkNvbnRhaW5lclN0eWxlLkdvb2RdID0gbmV3IEJ1aWx0SW5Db250YWluZXJTdHlsZURlZmluaXRpb24oKTtcclxuICAgICAgICB0aGlzLl9hbGxTdHlsZXNbRW51bXMuQ29udGFpbmVyU3R5bGUuQXR0ZW50aW9uXSA9IG5ldyBCdWlsdEluQ29udGFpbmVyU3R5bGVEZWZpbml0aW9uKCk7XHJcbiAgICAgICAgdGhpcy5fYWxsU3R5bGVzW0VudW1zLkNvbnRhaW5lclN0eWxlLldhcm5pbmddID0gbmV3IEJ1aWx0SW5Db250YWluZXJTdHlsZURlZmluaXRpb24oKTtcclxuICAgICAgICBpZiAob2JqKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2FsbFN0eWxlc1tFbnVtcy5Db250YWluZXJTdHlsZS5EZWZhdWx0XS5wYXJzZShvYmpbRW51bXMuQ29udGFpbmVyU3R5bGUuRGVmYXVsdF0pO1xyXG4gICAgICAgICAgICB0aGlzLl9hbGxTdHlsZXNbRW51bXMuQ29udGFpbmVyU3R5bGUuRW1waGFzaXNdLnBhcnNlKG9ialtFbnVtcy5Db250YWluZXJTdHlsZS5FbXBoYXNpc10pO1xyXG4gICAgICAgICAgICB0aGlzLl9hbGxTdHlsZXNbRW51bXMuQ29udGFpbmVyU3R5bGUuQWNjZW50XS5wYXJzZShvYmpbRW51bXMuQ29udGFpbmVyU3R5bGUuQWNjZW50XSk7XHJcbiAgICAgICAgICAgIHRoaXMuX2FsbFN0eWxlc1tFbnVtcy5Db250YWluZXJTdHlsZS5Hb29kXS5wYXJzZShvYmpbRW51bXMuQ29udGFpbmVyU3R5bGUuR29vZF0pO1xyXG4gICAgICAgICAgICB0aGlzLl9hbGxTdHlsZXNbRW51bXMuQ29udGFpbmVyU3R5bGUuQXR0ZW50aW9uXS5wYXJzZShvYmpbRW51bXMuQ29udGFpbmVyU3R5bGUuQXR0ZW50aW9uXSk7XHJcbiAgICAgICAgICAgIHRoaXMuX2FsbFN0eWxlc1tFbnVtcy5Db250YWluZXJTdHlsZS5XYXJuaW5nXS5wYXJzZShvYmpbRW51bXMuQ29udGFpbmVyU3R5bGUuV2FybmluZ10pO1xyXG4gICAgICAgICAgICB2YXIgY3VzdG9tU3R5bGVBcnJheSA9IG9ialtcImN1c3RvbVN0eWxlc1wiXTtcclxuICAgICAgICAgICAgaWYgKGN1c3RvbVN0eWxlQXJyYXkgJiYgQXJyYXkuaXNBcnJheShjdXN0b21TdHlsZUFycmF5KSkge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBjdXN0b21TdHlsZUFycmF5XzEgPSBjdXN0b21TdHlsZUFycmF5OyBfaSA8IGN1c3RvbVN0eWxlQXJyYXlfMS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY3VzdG9tU3R5bGUgPSBjdXN0b21TdHlsZUFycmF5XzFbX2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjdXN0b21TdHlsZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc3R5bGVOYW1lID0gY3VzdG9tU3R5bGVbXCJuYW1lXCJdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3R5bGVOYW1lICYmIHR5cGVvZiBzdHlsZU5hbWUgPT09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9hbGxTdHlsZXMuaGFzT3duUHJvcGVydHkoc3R5bGVOYW1lKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2FsbFN0eWxlc1tzdHlsZU5hbWVdLnBhcnNlKGN1c3RvbVN0eWxlW1wic3R5bGVcIl0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fYWxsU3R5bGVzW3N0eWxlTmFtZV0gPSBuZXcgQ29udGFpbmVyU3R5bGVEZWZpbml0aW9uKGN1c3RvbVN0eWxlW1wic3R5bGVcIl0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgQ29udGFpbmVyU3R5bGVTZXQucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHZhciBjdXN0b21TdHlsZUFycmF5ID0gW107XHJcbiAgICAgICAgT2JqZWN0LmtleXModGhpcy5fYWxsU3R5bGVzKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcclxuICAgICAgICAgICAgaWYgKCFfdGhpcy5fYWxsU3R5bGVzW2tleV0uaXNCdWlsdEluKSB7XHJcbiAgICAgICAgICAgICAgICBjdXN0b21TdHlsZUFycmF5LnB1c2goe1xyXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IGtleSxcclxuICAgICAgICAgICAgICAgICAgICBzdHlsZTogX3RoaXMuX2FsbFN0eWxlc1trZXldXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHZhciByZXN1bHQgPSB7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IHRoaXMuZGVmYXVsdCxcclxuICAgICAgICAgICAgZW1waGFzaXM6IHRoaXMuZW1waGFzaXNcclxuICAgICAgICB9O1xyXG4gICAgICAgIGlmIChjdXN0b21TdHlsZUFycmF5Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgcmVzdWx0LmN1c3RvbVN0eWxlcyA9IGN1c3RvbVN0eWxlQXJyYXk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9O1xyXG4gICAgQ29udGFpbmVyU3R5bGVTZXQucHJvdG90eXBlLmdldFN0eWxlQnlOYW1lID0gZnVuY3Rpb24gKG5hbWUsIGRlZmF1bHRWYWx1ZSkge1xyXG4gICAgICAgIGlmIChuYW1lICYmIHRoaXMuX2FsbFN0eWxlcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fYWxsU3R5bGVzW25hbWVdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRWYWx1ZSA/IGRlZmF1bHRWYWx1ZSA6IHRoaXMuX2FsbFN0eWxlc1tFbnVtcy5Db250YWluZXJTdHlsZS5EZWZhdWx0XTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENvbnRhaW5lclN0eWxlU2V0LnByb3RvdHlwZSwgXCJkZWZhdWx0XCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FsbFN0eWxlc1tFbnVtcy5Db250YWluZXJTdHlsZS5EZWZhdWx0XTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDb250YWluZXJTdHlsZVNldC5wcm90b3R5cGUsIFwiZW1waGFzaXNcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fYWxsU3R5bGVzW0VudW1zLkNvbnRhaW5lclN0eWxlLkVtcGhhc2lzXTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIHJldHVybiBDb250YWluZXJTdHlsZVNldDtcclxufSgpKTtcclxuZXhwb3J0cy5Db250YWluZXJTdHlsZVNldCA9IENvbnRhaW5lclN0eWxlU2V0O1xyXG52YXIgRm9udFR5cGVEZWZpbml0aW9uID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gRm9udFR5cGVEZWZpbml0aW9uKGZvbnRGYW1pbHkpIHtcclxuICAgICAgICB0aGlzLmZvbnRGYW1pbHkgPSBcIlNlZ29lIFVJLFNlZ29lLFNlZ29lIFdQLEhlbHZldGljYSBOZXVlLEhlbHZldGljYSxzYW5zLXNlcmlmXCI7XHJcbiAgICAgICAgdGhpcy5mb250U2l6ZXMgPSB7XHJcbiAgICAgICAgICAgIHNtYWxsOiAxMixcclxuICAgICAgICAgICAgZGVmYXVsdDogMTQsXHJcbiAgICAgICAgICAgIG1lZGl1bTogMTcsXHJcbiAgICAgICAgICAgIGxhcmdlOiAyMSxcclxuICAgICAgICAgICAgZXh0cmFMYXJnZTogMjZcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMuZm9udFdlaWdodHMgPSB7XHJcbiAgICAgICAgICAgIGxpZ2h0ZXI6IDIwMCxcclxuICAgICAgICAgICAgZGVmYXVsdDogNDAwLFxyXG4gICAgICAgICAgICBib2xkZXI6IDYwMFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKGZvbnRGYW1pbHkpIHtcclxuICAgICAgICAgICAgdGhpcy5mb250RmFtaWx5ID0gZm9udEZhbWlseTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBGb250VHlwZURlZmluaXRpb24ucHJvdG90eXBlLnBhcnNlID0gZnVuY3Rpb24gKG9iaikge1xyXG4gICAgICAgIHRoaXMuZm9udEZhbWlseSA9IG9ialtcImZvbnRGYW1pbHlcIl0gfHwgdGhpcy5mb250RmFtaWx5O1xyXG4gICAgICAgIHRoaXMuZm9udFNpemVzID0ge1xyXG4gICAgICAgICAgICBzbWFsbDogb2JqLmZvbnRTaXplcyAmJiBvYmouZm9udFNpemVzW1wic21hbGxcIl0gfHwgdGhpcy5mb250U2l6ZXMuc21hbGwsXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IG9iai5mb250U2l6ZXMgJiYgb2JqLmZvbnRTaXplc1tcImRlZmF1bHRcIl0gfHwgdGhpcy5mb250U2l6ZXMuZGVmYXVsdCxcclxuICAgICAgICAgICAgbWVkaXVtOiBvYmouZm9udFNpemVzICYmIG9iai5mb250U2l6ZXNbXCJtZWRpdW1cIl0gfHwgdGhpcy5mb250U2l6ZXMubWVkaXVtLFxyXG4gICAgICAgICAgICBsYXJnZTogb2JqLmZvbnRTaXplcyAmJiBvYmouZm9udFNpemVzW1wibGFyZ2VcIl0gfHwgdGhpcy5mb250U2l6ZXMubGFyZ2UsXHJcbiAgICAgICAgICAgIGV4dHJhTGFyZ2U6IG9iai5mb250U2l6ZXMgJiYgb2JqLmZvbnRTaXplc1tcImV4dHJhTGFyZ2VcIl0gfHwgdGhpcy5mb250U2l6ZXMuZXh0cmFMYXJnZVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy5mb250V2VpZ2h0cyA9IHtcclxuICAgICAgICAgICAgbGlnaHRlcjogb2JqLmZvbnRXZWlnaHRzICYmIG9iai5mb250V2VpZ2h0c1tcImxpZ2h0ZXJcIl0gfHwgdGhpcy5mb250V2VpZ2h0cy5saWdodGVyLFxyXG4gICAgICAgICAgICBkZWZhdWx0OiBvYmouZm9udFdlaWdodHMgJiYgb2JqLmZvbnRXZWlnaHRzW1wiZGVmYXVsdFwiXSB8fCB0aGlzLmZvbnRXZWlnaHRzLmRlZmF1bHQsXHJcbiAgICAgICAgICAgIGJvbGRlcjogb2JqLmZvbnRXZWlnaHRzICYmIG9iai5mb250V2VpZ2h0c1tcImJvbGRlclwiXSB8fCB0aGlzLmZvbnRXZWlnaHRzLmJvbGRlclxyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG4gICAgRm9udFR5cGVEZWZpbml0aW9uLm1vbm9zcGFjZSA9IG5ldyBGb250VHlwZURlZmluaXRpb24oXCInQ291cmllciBOZXcnLCBDb3VyaWVyLCBtb25vc3BhY2VcIik7XHJcbiAgICByZXR1cm4gRm9udFR5cGVEZWZpbml0aW9uO1xyXG59KCkpO1xyXG5leHBvcnRzLkZvbnRUeXBlRGVmaW5pdGlvbiA9IEZvbnRUeXBlRGVmaW5pdGlvbjtcclxudmFyIEZvbnRUeXBlU2V0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gRm9udFR5cGVTZXQob2JqKSB7XHJcbiAgICAgICAgdGhpcy5kZWZhdWx0ID0gbmV3IEZvbnRUeXBlRGVmaW5pdGlvbigpO1xyXG4gICAgICAgIHRoaXMubW9ub3NwYWNlID0gbmV3IEZvbnRUeXBlRGVmaW5pdGlvbihcIidDb3VyaWVyIE5ldycsIENvdXJpZXIsIG1vbm9zcGFjZVwiKTtcclxuICAgICAgICBpZiAob2JqKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGVmYXVsdC5wYXJzZShvYmpbXCJkZWZhdWx0XCJdKTtcclxuICAgICAgICAgICAgdGhpcy5tb25vc3BhY2UucGFyc2Uob2JqW1wibW9ub3NwYWNlXCJdKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBGb250VHlwZVNldC5wcm90b3R5cGUuZ2V0U3R5bGVEZWZpbml0aW9uID0gZnVuY3Rpb24gKHN0eWxlKSB7XHJcbiAgICAgICAgc3dpdGNoIChzdHlsZSkge1xyXG4gICAgICAgICAgICBjYXNlIEVudW1zLkZvbnRUeXBlLk1vbm9zcGFjZTpcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLm1vbm9zcGFjZTtcclxuICAgICAgICAgICAgY2FzZSBFbnVtcy5Gb250VHlwZS5EZWZhdWx0OlxyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGVmYXVsdDtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIEZvbnRUeXBlU2V0O1xyXG59KCkpO1xyXG5leHBvcnRzLkZvbnRUeXBlU2V0ID0gRm9udFR5cGVTZXQ7XHJcbnZhciBIb3N0Q29uZmlnID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gSG9zdENvbmZpZyhvYmopIHtcclxuICAgICAgICB0aGlzLmhvc3RDYXBhYmlsaXRpZXMgPSBuZXcgaG9zdF9jYXBhYmlsaXRpZXNfMS5Ib3N0Q2FwYWJpbGl0aWVzKCk7XHJcbiAgICAgICAgdGhpcy5jaG9pY2VTZXRJbnB1dFZhbHVlU2VwYXJhdG9yID0gXCIsXCI7XHJcbiAgICAgICAgdGhpcy5zdXBwb3J0c0ludGVyYWN0aXZpdHkgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuc3BhY2luZyA9IHtcclxuICAgICAgICAgICAgc21hbGw6IDMsXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IDgsXHJcbiAgICAgICAgICAgIG1lZGl1bTogMjAsXHJcbiAgICAgICAgICAgIGxhcmdlOiAzMCxcclxuICAgICAgICAgICAgZXh0cmFMYXJnZTogNDAsXHJcbiAgICAgICAgICAgIHBhZGRpbmc6IDE1XHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLnNlcGFyYXRvciA9IHtcclxuICAgICAgICAgICAgbGluZVRoaWNrbmVzczogMSxcclxuICAgICAgICAgICAgbGluZUNvbG9yOiBcIiNFRUVFRUVcIlxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy5pbWFnZVNpemVzID0ge1xyXG4gICAgICAgICAgICBzbWFsbDogNDAsXHJcbiAgICAgICAgICAgIG1lZGl1bTogODAsXHJcbiAgICAgICAgICAgIGxhcmdlOiAxNjBcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyU3R5bGVzID0gbmV3IENvbnRhaW5lclN0eWxlU2V0KCk7XHJcbiAgICAgICAgdGhpcy5hY3Rpb25zID0gbmV3IEFjdGlvbnNDb25maWcoKTtcclxuICAgICAgICB0aGlzLmFkYXB0aXZlQ2FyZCA9IG5ldyBBZGFwdGl2ZUNhcmRDb25maWcoKTtcclxuICAgICAgICB0aGlzLmltYWdlU2V0ID0gbmV3IEltYWdlU2V0Q29uZmlnKCk7XHJcbiAgICAgICAgdGhpcy5tZWRpYSA9IG5ldyBNZWRpYUNvbmZpZygpO1xyXG4gICAgICAgIHRoaXMuZmFjdFNldCA9IG5ldyBGYWN0U2V0Q29uZmlnKCk7XHJcbiAgICAgICAgdGhpcy5hbHdheXNBbGxvd0JsZWVkID0gZmFsc2U7XHJcbiAgICAgICAgaWYgKG9iaikge1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIG9iaiA9PT0gXCJzdHJpbmdcIiB8fCBvYmogaW5zdGFuY2VvZiBTdHJpbmcpIHtcclxuICAgICAgICAgICAgICAgIG9iaiA9IEpTT04ucGFyc2Uob2JqKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmNob2ljZVNldElucHV0VmFsdWVTZXBhcmF0b3IgPSAob2JqICYmIHR5cGVvZiBvYmpbXCJjaG9pY2VTZXRJbnB1dFZhbHVlU2VwYXJhdG9yXCJdID09PSBcInN0cmluZ1wiKSA/IG9ialtcImNob2ljZVNldElucHV0VmFsdWVTZXBhcmF0b3JcIl0gOiB0aGlzLmNob2ljZVNldElucHV0VmFsdWVTZXBhcmF0b3I7XHJcbiAgICAgICAgICAgIHRoaXMuc3VwcG9ydHNJbnRlcmFjdGl2aXR5ID0gKG9iaiAmJiB0eXBlb2Ygb2JqW1wic3VwcG9ydHNJbnRlcmFjdGl2aXR5XCJdID09PSBcImJvb2xlYW5cIikgPyBvYmpbXCJzdXBwb3J0c0ludGVyYWN0aXZpdHlcIl0gOiB0aGlzLnN1cHBvcnRzSW50ZXJhY3Rpdml0eTtcclxuICAgICAgICAgICAgdGhpcy5fbGVnYWN5Rm9udFR5cGUgPSBuZXcgRm9udFR5cGVEZWZpbml0aW9uKCk7XHJcbiAgICAgICAgICAgIHRoaXMuX2xlZ2FjeUZvbnRUeXBlLnBhcnNlKG9iaik7XHJcbiAgICAgICAgICAgIGlmIChvYmouZm9udFR5cGVzKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZvbnRUeXBlcyA9IG5ldyBGb250VHlwZVNldChvYmouZm9udFR5cGVzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAob2JqLmxpbmVIZWlnaHRzKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxpbmVIZWlnaHRzID0ge1xyXG4gICAgICAgICAgICAgICAgICAgIHNtYWxsOiBvYmoubGluZUhlaWdodHNbXCJzbWFsbFwiXSxcclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiBvYmoubGluZUhlaWdodHNbXCJkZWZhdWx0XCJdLFxyXG4gICAgICAgICAgICAgICAgICAgIG1lZGl1bTogb2JqLmxpbmVIZWlnaHRzW1wibWVkaXVtXCJdLFxyXG4gICAgICAgICAgICAgICAgICAgIGxhcmdlOiBvYmoubGluZUhlaWdodHNbXCJsYXJnZVwiXSxcclxuICAgICAgICAgICAgICAgICAgICBleHRyYUxhcmdlOiBvYmoubGluZUhlaWdodHNbXCJleHRyYUxhcmdlXCJdXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIDtcclxuICAgICAgICAgICAgdGhpcy5pbWFnZVNpemVzID0ge1xyXG4gICAgICAgICAgICAgICAgc21hbGw6IG9iai5pbWFnZVNpemVzICYmIG9iai5pbWFnZVNpemVzW1wic21hbGxcIl0gfHwgdGhpcy5pbWFnZVNpemVzLnNtYWxsLFxyXG4gICAgICAgICAgICAgICAgbWVkaXVtOiBvYmouaW1hZ2VTaXplcyAmJiBvYmouaW1hZ2VTaXplc1tcIm1lZGl1bVwiXSB8fCB0aGlzLmltYWdlU2l6ZXMubWVkaXVtLFxyXG4gICAgICAgICAgICAgICAgbGFyZ2U6IG9iai5pbWFnZVNpemVzICYmIG9iai5pbWFnZVNpemVzW1wibGFyZ2VcIl0gfHwgdGhpcy5pbWFnZVNpemVzLmxhcmdlLFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRhaW5lclN0eWxlcyA9IG5ldyBDb250YWluZXJTdHlsZVNldChvYmpbXCJjb250YWluZXJTdHlsZXNcIl0pO1xyXG4gICAgICAgICAgICB0aGlzLnNwYWNpbmcgPSB7XHJcbiAgICAgICAgICAgICAgICBzbWFsbDogb2JqLnNwYWNpbmcgJiYgb2JqLnNwYWNpbmdbXCJzbWFsbFwiXSB8fCB0aGlzLnNwYWNpbmcuc21hbGwsXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiBvYmouc3BhY2luZyAmJiBvYmouc3BhY2luZ1tcImRlZmF1bHRcIl0gfHwgdGhpcy5zcGFjaW5nLmRlZmF1bHQsXHJcbiAgICAgICAgICAgICAgICBtZWRpdW06IG9iai5zcGFjaW5nICYmIG9iai5zcGFjaW5nW1wibWVkaXVtXCJdIHx8IHRoaXMuc3BhY2luZy5tZWRpdW0sXHJcbiAgICAgICAgICAgICAgICBsYXJnZTogb2JqLnNwYWNpbmcgJiYgb2JqLnNwYWNpbmdbXCJsYXJnZVwiXSB8fCB0aGlzLnNwYWNpbmcubGFyZ2UsXHJcbiAgICAgICAgICAgICAgICBleHRyYUxhcmdlOiBvYmouc3BhY2luZyAmJiBvYmouc3BhY2luZ1tcImV4dHJhTGFyZ2VcIl0gfHwgdGhpcy5zcGFjaW5nLmV4dHJhTGFyZ2UsXHJcbiAgICAgICAgICAgICAgICBwYWRkaW5nOiBvYmouc3BhY2luZyAmJiBvYmouc3BhY2luZ1tcInBhZGRpbmdcIl0gfHwgdGhpcy5zcGFjaW5nLnBhZGRpbmdcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5zZXBhcmF0b3IgPSB7XHJcbiAgICAgICAgICAgICAgICBsaW5lVGhpY2tuZXNzOiBvYmouc2VwYXJhdG9yICYmIG9iai5zZXBhcmF0b3JbXCJsaW5lVGhpY2tuZXNzXCJdIHx8IHRoaXMuc2VwYXJhdG9yLmxpbmVUaGlja25lc3MsXHJcbiAgICAgICAgICAgICAgICBsaW5lQ29sb3I6IG9iai5zZXBhcmF0b3IgJiYgb2JqLnNlcGFyYXRvcltcImxpbmVDb2xvclwiXSB8fCB0aGlzLnNlcGFyYXRvci5saW5lQ29sb3JcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgdGhpcy5hY3Rpb25zID0gbmV3IEFjdGlvbnNDb25maWcob2JqLmFjdGlvbnMgfHwgdGhpcy5hY3Rpb25zKTtcclxuICAgICAgICAgICAgdGhpcy5hZGFwdGl2ZUNhcmQgPSBuZXcgQWRhcHRpdmVDYXJkQ29uZmlnKG9iai5hZGFwdGl2ZUNhcmQgfHwgdGhpcy5hZGFwdGl2ZUNhcmQpO1xyXG4gICAgICAgICAgICB0aGlzLmltYWdlU2V0ID0gbmV3IEltYWdlU2V0Q29uZmlnKG9ialtcImltYWdlU2V0XCJdKTtcclxuICAgICAgICAgICAgdGhpcy5mYWN0U2V0ID0gbmV3IEZhY3RTZXRDb25maWcob2JqW1wiZmFjdFNldFwiXSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgSG9zdENvbmZpZy5wcm90b3R5cGUuZ2V0Rm9udFR5cGVEZWZpbml0aW9uID0gZnVuY3Rpb24gKHN0eWxlKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZm9udFR5cGVzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmZvbnRUeXBlcy5nZXRTdHlsZURlZmluaXRpb24oc3R5bGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHN0eWxlID09IEVudW1zLkZvbnRUeXBlLk1vbm9zcGFjZSA/IEZvbnRUeXBlRGVmaW5pdGlvbi5tb25vc3BhY2UgOiB0aGlzLl9sZWdhY3lGb250VHlwZTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgSG9zdENvbmZpZy5wcm90b3R5cGUuZ2V0RWZmZWN0aXZlU3BhY2luZyA9IGZ1bmN0aW9uIChzcGFjaW5nKSB7XHJcbiAgICAgICAgc3dpdGNoIChzcGFjaW5nKSB7XHJcbiAgICAgICAgICAgIGNhc2UgRW51bXMuU3BhY2luZy5TbWFsbDpcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNwYWNpbmcuc21hbGw7XHJcbiAgICAgICAgICAgIGNhc2UgRW51bXMuU3BhY2luZy5EZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3BhY2luZy5kZWZhdWx0O1xyXG4gICAgICAgICAgICBjYXNlIEVudW1zLlNwYWNpbmcuTWVkaXVtOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3BhY2luZy5tZWRpdW07XHJcbiAgICAgICAgICAgIGNhc2UgRW51bXMuU3BhY2luZy5MYXJnZTpcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNwYWNpbmcubGFyZ2U7XHJcbiAgICAgICAgICAgIGNhc2UgRW51bXMuU3BhY2luZy5FeHRyYUxhcmdlOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3BhY2luZy5leHRyYUxhcmdlO1xyXG4gICAgICAgICAgICBjYXNlIEVudW1zLlNwYWNpbmcuUGFkZGluZzpcclxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNwYWNpbmcucGFkZGluZztcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHJldHVybiAwO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBIb3N0Q29uZmlnLnByb3RvdHlwZS5wYWRkaW5nRGVmaW5pdGlvblRvU3BhY2luZ0RlZmluaXRpb24gPSBmdW5jdGlvbiAocGFkZGluZ0RlZmluaXRpb24pIHtcclxuICAgICAgICByZXR1cm4gbmV3IFNoYXJlZC5TcGFjaW5nRGVmaW5pdGlvbih0aGlzLmdldEVmZmVjdGl2ZVNwYWNpbmcocGFkZGluZ0RlZmluaXRpb24udG9wKSwgdGhpcy5nZXRFZmZlY3RpdmVTcGFjaW5nKHBhZGRpbmdEZWZpbml0aW9uLnJpZ2h0KSwgdGhpcy5nZXRFZmZlY3RpdmVTcGFjaW5nKHBhZGRpbmdEZWZpbml0aW9uLmJvdHRvbSksIHRoaXMuZ2V0RWZmZWN0aXZlU3BhY2luZyhwYWRkaW5nRGVmaW5pdGlvbi5sZWZ0KSk7XHJcbiAgICB9O1xyXG4gICAgSG9zdENvbmZpZy5wcm90b3R5cGUubWFrZUNzc0NsYXNzTmFtZXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGNsYXNzTmFtZXMgPSBbXTtcclxuICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgICAgICBjbGFzc05hbWVzW19pXSA9IGFyZ3VtZW50c1tfaV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciByZXN1bHQgPSBbXTtcclxuICAgICAgICBmb3IgKHZhciBfYSA9IDAsIGNsYXNzTmFtZXNfMSA9IGNsYXNzTmFtZXM7IF9hIDwgY2xhc3NOYW1lc18xLmxlbmd0aDsgX2ErKykge1xyXG4gICAgICAgICAgICB2YXIgY2xhc3NOYW1lID0gY2xhc3NOYW1lc18xW19hXTtcclxuICAgICAgICAgICAgcmVzdWx0LnB1c2goKHRoaXMuY3NzQ2xhc3NOYW1lUHJlZml4ID8gdGhpcy5jc3NDbGFzc05hbWVQcmVmaXggKyBcIi1cIiA6IFwiXCIpICsgY2xhc3NOYW1lKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH07XHJcbiAgICBIb3N0Q29uZmlnLnByb3RvdHlwZS5tYWtlQ3NzQ2xhc3NOYW1lID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBjbGFzc05hbWVzID0gW107XHJcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgY2xhc3NOYW1lc1tfaV0gPSBhcmd1bWVudHNbX2ldO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgcmVzdWx0ID0gdGhpcy5tYWtlQ3NzQ2xhc3NOYW1lcy5hcHBseSh0aGlzLCBjbGFzc05hbWVzKS5qb2luKFwiIFwiKTtcclxuICAgICAgICByZXR1cm4gcmVzdWx0ID8gcmVzdWx0IDogXCJcIjtcclxuICAgIH07XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoSG9zdENvbmZpZy5wcm90b3R5cGUsIFwiZm9udEZhbWlseVwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9sZWdhY3lGb250VHlwZS5mb250RmFtaWx5O1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICAgICAgdGhpcy5fbGVnYWN5Rm9udFR5cGUuZm9udEZhbWlseSA9IHZhbHVlO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEhvc3RDb25maWcucHJvdG90eXBlLCBcImZvbnRTaXplc1wiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9sZWdhY3lGb250VHlwZS5mb250U2l6ZXM7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoSG9zdENvbmZpZy5wcm90b3R5cGUsIFwiZm9udFdlaWdodHNcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fbGVnYWN5Rm9udFR5cGUuZm9udFdlaWdodHM7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gSG9zdENvbmZpZztcclxufSgpKTtcclxuZXhwb3J0cy5Ib3N0Q29uZmlnID0gSG9zdENvbmZpZztcclxuZXhwb3J0cy5kZWZhdWx0SG9zdENvbmZpZyA9IG5ldyBIb3N0Q29uZmlnKHtcclxuICAgIHN1cHBvcnRzSW50ZXJhY3Rpdml0eTogdHJ1ZSxcclxuICAgIHNwYWNpbmc6IHtcclxuICAgICAgICBzbWFsbDogMTAsXHJcbiAgICAgICAgZGVmYXVsdDogMjAsXHJcbiAgICAgICAgbWVkaXVtOiAzMCxcclxuICAgICAgICBsYXJnZTogNDAsXHJcbiAgICAgICAgZXh0cmFMYXJnZTogNTAsXHJcbiAgICAgICAgcGFkZGluZzogMjBcclxuICAgIH0sXHJcbiAgICBzZXBhcmF0b3I6IHtcclxuICAgICAgICBsaW5lVGhpY2tuZXNzOiAxLFxyXG4gICAgICAgIGxpbmVDb2xvcjogXCIjRUVFRUVFXCJcclxuICAgIH0sXHJcbiAgICBmb250VHlwZXM6IHtcclxuICAgICAgICBkZWZhdWx0OiB7XHJcbiAgICAgICAgICAgIGZvbnRGYW1pbHk6IFwiJ1NlZ29lIFVJJywgVGFob21hLCBHZW5ldmEsIFZlcmRhbmEsIHNhbnMtc2VyaWZcIixcclxuICAgICAgICAgICAgZm9udFNpemVzOiB7XHJcbiAgICAgICAgICAgICAgICBzbWFsbDogMTIsXHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiAxNCxcclxuICAgICAgICAgICAgICAgIG1lZGl1bTogMTcsXHJcbiAgICAgICAgICAgICAgICBsYXJnZTogMjEsXHJcbiAgICAgICAgICAgICAgICBleHRyYUxhcmdlOiAyNlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBmb250V2VpZ2h0czoge1xyXG4gICAgICAgICAgICAgICAgbGlnaHRlcjogMjAwLFxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDogNDAwLFxyXG4gICAgICAgICAgICAgICAgYm9sZGVyOiA2MDBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbW9ub3NwYWNlOiB7XHJcbiAgICAgICAgICAgIGZvbnRGYW1pbHk6IFwiJ0NvdXJpZXIgTmV3JywgQ291cmllciwgbW9ub3NwYWNlXCIsXHJcbiAgICAgICAgICAgIGZvbnRTaXplczoge1xyXG4gICAgICAgICAgICAgICAgc21hbGw6IDEyLFxyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDogMTQsXHJcbiAgICAgICAgICAgICAgICBtZWRpdW06IDE3LFxyXG4gICAgICAgICAgICAgICAgbGFyZ2U6IDIxLFxyXG4gICAgICAgICAgICAgICAgZXh0cmFMYXJnZTogMjZcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZm9udFdlaWdodHM6IHtcclxuICAgICAgICAgICAgICAgIGxpZ2h0ZXI6IDIwMCxcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6IDQwMCxcclxuICAgICAgICAgICAgICAgIGJvbGRlcjogNjAwXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgaW1hZ2VTaXplczoge1xyXG4gICAgICAgIHNtYWxsOiA0MCxcclxuICAgICAgICBtZWRpdW06IDgwLFxyXG4gICAgICAgIGxhcmdlOiAxNjBcclxuICAgIH0sXHJcbiAgICBjb250YWluZXJTdHlsZXM6IHtcclxuICAgICAgICBkZWZhdWx0OiB7XHJcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogXCIjRkZGRkZGXCIsXHJcbiAgICAgICAgICAgIGZvcmVncm91bmRDb2xvcnM6IHtcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiBcIiMzMzMzMzNcIixcclxuICAgICAgICAgICAgICAgICAgICBzdWJ0bGU6IFwiI0VFMzMzMzMzXCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBkYXJrOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogXCIjMDAwMDAwXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgc3VidGxlOiBcIiM2NjAwMDAwMFwiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgbGlnaHQ6IHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiBcIiNGRkZGRkZcIixcclxuICAgICAgICAgICAgICAgICAgICBzdWJ0bGU6IFwiIzMzMDAwMDAwXCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBhY2NlbnQ6IHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiBcIiMyRTg5RkNcIixcclxuICAgICAgICAgICAgICAgICAgICBzdWJ0bGU6IFwiIzg4MkU4OUZDXCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBhdHRlbnRpb246IHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiBcIiNjYzMzMDBcIixcclxuICAgICAgICAgICAgICAgICAgICBzdWJ0bGU6IFwiI0REY2MzMzAwXCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBnb29kOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogXCIjNTRhMjU0XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgc3VidGxlOiBcIiNERDU0YTI1NFwiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgd2FybmluZzoge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IFwiI2U2OTUwMFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHN1YnRsZTogXCIjRERlNjk1MDBcIlxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbXBoYXNpczoge1xyXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IFwiIzA4MDAwMDAwXCIsXHJcbiAgICAgICAgICAgIGZvcmVncm91bmRDb2xvcnM6IHtcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiBcIiMzMzMzMzNcIixcclxuICAgICAgICAgICAgICAgICAgICBzdWJ0bGU6IFwiI0VFMzMzMzMzXCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBkYXJrOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogXCIjMDAwMDAwXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgc3VidGxlOiBcIiM2NjAwMDAwMFwiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgbGlnaHQ6IHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiBcIiNGRkZGRkZcIixcclxuICAgICAgICAgICAgICAgICAgICBzdWJ0bGU6IFwiIzMzMDAwMDAwXCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBhY2NlbnQ6IHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiBcIiMyRTg5RkNcIixcclxuICAgICAgICAgICAgICAgICAgICBzdWJ0bGU6IFwiIzg4MkU4OUZDXCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBhdHRlbnRpb246IHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiBcIiNjYzMzMDBcIixcclxuICAgICAgICAgICAgICAgICAgICBzdWJ0bGU6IFwiI0REY2MzMzAwXCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBnb29kOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogXCIjNTRhMjU0XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgc3VidGxlOiBcIiNERDU0YTI1NFwiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgd2FybmluZzoge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IFwiI2U2OTUwMFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHN1YnRsZTogXCIjRERlNjk1MDBcIlxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgICBhY2NlbnQ6IHtcclxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBcIiNDN0RFRjlcIixcclxuICAgICAgICAgICAgZm9yZWdyb3VuZENvbG9yczoge1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDoge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IFwiIzMzMzMzM1wiLFxyXG4gICAgICAgICAgICAgICAgICAgIHN1YnRsZTogXCIjRUUzMzMzMzNcIlxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGRhcms6IHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiBcIiMwMDAwMDBcIixcclxuICAgICAgICAgICAgICAgICAgICBzdWJ0bGU6IFwiIzY2MDAwMDAwXCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBsaWdodDoge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IFwiI0ZGRkZGRlwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHN1YnRsZTogXCIjMzMwMDAwMDBcIlxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGFjY2VudDoge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IFwiIzJFODlGQ1wiLFxyXG4gICAgICAgICAgICAgICAgICAgIHN1YnRsZTogXCIjODgyRTg5RkNcIlxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGF0dGVudGlvbjoge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IFwiI2NjMzMwMFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHN1YnRsZTogXCIjRERjYzMzMDBcIlxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGdvb2Q6IHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiBcIiM1NGEyNTRcIixcclxuICAgICAgICAgICAgICAgICAgICBzdWJ0bGU6IFwiI0RENTRhMjU0XCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB3YXJuaW5nOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogXCIjZTY5NTAwXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgc3VidGxlOiBcIiNERGU2OTUwMFwiXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIGdvb2Q6IHtcclxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBcIiNDQ0ZGQ0NcIixcclxuICAgICAgICAgICAgZm9yZWdyb3VuZENvbG9yczoge1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDoge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IFwiIzMzMzMzM1wiLFxyXG4gICAgICAgICAgICAgICAgICAgIHN1YnRsZTogXCIjRUUzMzMzMzNcIlxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGRhcms6IHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiBcIiMwMDAwMDBcIixcclxuICAgICAgICAgICAgICAgICAgICBzdWJ0bGU6IFwiIzY2MDAwMDAwXCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBsaWdodDoge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IFwiI0ZGRkZGRlwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHN1YnRsZTogXCIjMzMwMDAwMDBcIlxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGFjY2VudDoge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IFwiIzJFODlGQ1wiLFxyXG4gICAgICAgICAgICAgICAgICAgIHN1YnRsZTogXCIjODgyRTg5RkNcIlxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGF0dGVudGlvbjoge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IFwiI2NjMzMwMFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHN1YnRsZTogXCIjRERjYzMzMDBcIlxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGdvb2Q6IHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiBcIiM1NGEyNTRcIixcclxuICAgICAgICAgICAgICAgICAgICBzdWJ0bGU6IFwiI0RENTRhMjU0XCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB3YXJuaW5nOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogXCIjZTY5NTAwXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgc3VidGxlOiBcIiNERGU2OTUwMFwiXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIGF0dGVudGlvbjoge1xyXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IFwiI0ZGQzVCMlwiLFxyXG4gICAgICAgICAgICBmb3JlZ3JvdW5kQ29sb3JzOiB7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogXCIjMzMzMzMzXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgc3VidGxlOiBcIiNFRTMzMzMzM1wiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgZGFyazoge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IFwiIzAwMDAwMFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHN1YnRsZTogXCIjNjYwMDAwMDBcIlxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGxpZ2h0OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogXCIjRkZGRkZGXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgc3VidGxlOiBcIiMzMzAwMDAwMFwiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgYWNjZW50OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogXCIjMkU4OUZDXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgc3VidGxlOiBcIiM4ODJFODlGQ1wiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgYXR0ZW50aW9uOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogXCIjY2MzMzAwXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgc3VidGxlOiBcIiNERGNjMzMwMFwiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgZ29vZDoge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IFwiIzU0YTI1NFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHN1YnRsZTogXCIjREQ1NGEyNTRcIlxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHdhcm5pbmc6IHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiBcIiNlNjk1MDBcIixcclxuICAgICAgICAgICAgICAgICAgICBzdWJ0bGU6IFwiI0REZTY5NTAwXCJcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgd2FybmluZzoge1xyXG4gICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IFwiI0ZGRTJCMlwiLFxyXG4gICAgICAgICAgICBmb3JlZ3JvdW5kQ29sb3JzOiB7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogXCIjMzMzMzMzXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgc3VidGxlOiBcIiNFRTMzMzMzM1wiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgZGFyazoge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IFwiIzAwMDAwMFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHN1YnRsZTogXCIjNjYwMDAwMDBcIlxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGxpZ2h0OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogXCIjRkZGRkZGXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgc3VidGxlOiBcIiMzMzAwMDAwMFwiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgYWNjZW50OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogXCIjMkU4OUZDXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgc3VidGxlOiBcIiM4ODJFODlGQ1wiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgYXR0ZW50aW9uOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogXCIjY2MzMzAwXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgc3VidGxlOiBcIiNERGNjMzMwMFwiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgZ29vZDoge1xyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IFwiIzU0YTI1NFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHN1YnRsZTogXCIjREQ1NGEyNTRcIlxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHdhcm5pbmc6IHtcclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiBcIiNlNjk1MDBcIixcclxuICAgICAgICAgICAgICAgICAgICBzdWJ0bGU6IFwiI0REZTY5NTAwXCJcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBhY3Rpb25zOiB7XHJcbiAgICAgICAgbWF4QWN0aW9uczogNSxcclxuICAgICAgICBzcGFjaW5nOiBFbnVtcy5TcGFjaW5nLkRlZmF1bHQsXHJcbiAgICAgICAgYnV0dG9uU3BhY2luZzogMTAsXHJcbiAgICAgICAgc2hvd0NhcmQ6IHtcclxuICAgICAgICAgICAgYWN0aW9uTW9kZTogRW51bXMuU2hvd0NhcmRBY3Rpb25Nb2RlLklubGluZSxcclxuICAgICAgICAgICAgaW5saW5lVG9wTWFyZ2luOiAxNlxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgYWN0aW9uc09yaWVudGF0aW9uOiBFbnVtcy5PcmllbnRhdGlvbi5Ib3Jpem9udGFsLFxyXG4gICAgICAgIGFjdGlvbkFsaWdubWVudDogRW51bXMuQWN0aW9uQWxpZ25tZW50LkxlZnRcclxuICAgIH0sXHJcbiAgICBhZGFwdGl2ZUNhcmQ6IHtcclxuICAgICAgICBhbGxvd0N1c3RvbVN0eWxlOiBmYWxzZVxyXG4gICAgfSxcclxuICAgIGltYWdlU2V0OiB7XHJcbiAgICAgICAgaW1hZ2VTaXplOiBFbnVtcy5TaXplLk1lZGl1bSxcclxuICAgICAgICBtYXhJbWFnZUhlaWdodDogMTAwXHJcbiAgICB9LFxyXG4gICAgZmFjdFNldDoge1xyXG4gICAgICAgIHRpdGxlOiB7XHJcbiAgICAgICAgICAgIGNvbG9yOiBFbnVtcy5UZXh0Q29sb3IuRGVmYXVsdCxcclxuICAgICAgICAgICAgc2l6ZTogRW51bXMuVGV4dFNpemUuRGVmYXVsdCxcclxuICAgICAgICAgICAgaXNTdWJ0bGU6IGZhbHNlLFxyXG4gICAgICAgICAgICB3ZWlnaHQ6IEVudW1zLlRleHRXZWlnaHQuQm9sZGVyLFxyXG4gICAgICAgICAgICB3cmFwOiB0cnVlLFxyXG4gICAgICAgICAgICBtYXhXaWR0aDogMTUwLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdmFsdWU6IHtcclxuICAgICAgICAgICAgY29sb3I6IEVudW1zLlRleHRDb2xvci5EZWZhdWx0LFxyXG4gICAgICAgICAgICBzaXplOiBFbnVtcy5UZXh0U2l6ZS5EZWZhdWx0LFxyXG4gICAgICAgICAgICBpc1N1YnRsZTogZmFsc2UsXHJcbiAgICAgICAgICAgIHdlaWdodDogRW51bXMuVGV4dFdlaWdodC5EZWZhdWx0LFxyXG4gICAgICAgICAgICB3cmFwOiB0cnVlLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgc3BhY2luZzogMTBcclxuICAgIH1cclxufSk7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWhvc3QtY29uZmlnLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbnZhciBzZXJpYWxpemF0aW9uXzEgPSByZXF1aXJlKFwiLi9zZXJpYWxpemF0aW9uXCIpO1xyXG52YXIgQ2FyZE9iamVjdFJlZ2lzdHJ5ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQ2FyZE9iamVjdFJlZ2lzdHJ5KCkge1xyXG4gICAgICAgIHRoaXMuX2l0ZW1zID0ge307XHJcbiAgICB9XHJcbiAgICBDYXJkT2JqZWN0UmVnaXN0cnkucHJvdG90eXBlLmZpbmRCeU5hbWUgPSBmdW5jdGlvbiAodHlwZU5hbWUpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5faXRlbXMuaGFzT3duUHJvcGVydHkodHlwZU5hbWUpID8gdGhpcy5faXRlbXNbdHlwZU5hbWVdIDogdW5kZWZpbmVkO1xyXG4gICAgfTtcclxuICAgIENhcmRPYmplY3RSZWdpc3RyeS5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5faXRlbXMgPSB7fTtcclxuICAgIH07XHJcbiAgICBDYXJkT2JqZWN0UmVnaXN0cnkucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKHR5cGVOYW1lLCBvYmplY3RUeXBlLCBzY2hlbWFWZXJzaW9uKSB7XHJcbiAgICAgICAgaWYgKHNjaGVtYVZlcnNpb24gPT09IHZvaWQgMCkgeyBzY2hlbWFWZXJzaW9uID0gc2VyaWFsaXphdGlvbl8xLlZlcnNpb25zLnYxXzA7IH1cclxuICAgICAgICB2YXIgcmVnaXN0cmF0aW9uSW5mbyA9IHRoaXMuZmluZEJ5TmFtZSh0eXBlTmFtZSk7XHJcbiAgICAgICAgaWYgKHJlZ2lzdHJhdGlvbkluZm8gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICByZWdpc3RyYXRpb25JbmZvLm9iamVjdFR5cGUgPSBvYmplY3RUeXBlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmVnaXN0cmF0aW9uSW5mbyA9IHtcclxuICAgICAgICAgICAgICAgIHR5cGVOYW1lOiB0eXBlTmFtZSxcclxuICAgICAgICAgICAgICAgIG9iamVjdFR5cGU6IG9iamVjdFR5cGUsXHJcbiAgICAgICAgICAgICAgICBzY2hlbWFWZXJzaW9uOiBzY2hlbWFWZXJzaW9uXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX2l0ZW1zW3R5cGVOYW1lXSA9IHJlZ2lzdHJhdGlvbkluZm87XHJcbiAgICB9O1xyXG4gICAgQ2FyZE9iamVjdFJlZ2lzdHJ5LnByb3RvdHlwZS51bnJlZ2lzdGVyID0gZnVuY3Rpb24gKHR5cGVOYW1lKSB7XHJcbiAgICAgICAgZGVsZXRlIHRoaXMuX2l0ZW1zW3R5cGVOYW1lXTtcclxuICAgIH07XHJcbiAgICBDYXJkT2JqZWN0UmVnaXN0cnkucHJvdG90eXBlLmNyZWF0ZUluc3RhbmNlID0gZnVuY3Rpb24gKHR5cGVOYW1lLCB0YXJnZXRWZXJzaW9uKSB7XHJcbiAgICAgICAgdmFyIHJlZ2lzdHJhdGlvbkluZm8gPSB0aGlzLmZpbmRCeU5hbWUodHlwZU5hbWUpO1xyXG4gICAgICAgIHJldHVybiAocmVnaXN0cmF0aW9uSW5mbyAmJiByZWdpc3RyYXRpb25JbmZvLnNjaGVtYVZlcnNpb24uY29tcGFyZVRvKHRhcmdldFZlcnNpb24pIDw9IDApID8gbmV3IHJlZ2lzdHJhdGlvbkluZm8ub2JqZWN0VHlwZSgpIDogdW5kZWZpbmVkO1xyXG4gICAgfTtcclxuICAgIENhcmRPYmplY3RSZWdpc3RyeS5wcm90b3R5cGUuZ2V0SXRlbUNvdW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBPYmplY3Qua2V5cyh0aGlzLl9pdGVtcykubGVuZ3RoO1xyXG4gICAgfTtcclxuICAgIENhcmRPYmplY3RSZWdpc3RyeS5wcm90b3R5cGUuZ2V0SXRlbUF0ID0gZnVuY3Rpb24gKGluZGV4KSB7XHJcbiAgICAgICAgcmV0dXJuIE9iamVjdC52YWx1ZXModGhpcy5faXRlbXMpW2luZGV4XTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gQ2FyZE9iamVjdFJlZ2lzdHJ5O1xyXG59KCkpO1xyXG5leHBvcnRzLkNhcmRPYmplY3RSZWdpc3RyeSA9IENhcmRPYmplY3RSZWdpc3RyeTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cmVnaXN0cnkuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcclxuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XHJcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcclxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XHJcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XHJcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cclxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XHJcbiAgICB9O1xyXG59KSgpO1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbnZhciBzaGFyZWRfMSA9IHJlcXVpcmUoXCIuL3NoYXJlZFwiKTtcclxudmFyIFV0aWxzID0gcmVxdWlyZShcIi4vdXRpbHNcIik7XHJcbnZhciBFbnVtcyA9IHJlcXVpcmUoXCIuL2VudW1zXCIpO1xyXG52YXIgVmVyc2lvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFZlcnNpb24obWFqb3IsIG1pbm9yLCBsYWJlbCkge1xyXG4gICAgICAgIGlmIChtYWpvciA9PT0gdm9pZCAwKSB7IG1ham9yID0gMTsgfVxyXG4gICAgICAgIGlmIChtaW5vciA9PT0gdm9pZCAwKSB7IG1pbm9yID0gMTsgfVxyXG4gICAgICAgIHRoaXMuX2lzVmFsaWQgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuX21ham9yID0gbWFqb3I7XHJcbiAgICAgICAgdGhpcy5fbWlub3IgPSBtaW5vcjtcclxuICAgICAgICB0aGlzLl9sYWJlbCA9IGxhYmVsO1xyXG4gICAgfVxyXG4gICAgVmVyc2lvbi5wYXJzZSA9IGZ1bmN0aW9uICh2ZXJzaW9uU3RyaW5nLCBjb250ZXh0KSB7XHJcbiAgICAgICAgaWYgKCF2ZXJzaW9uU3RyaW5nKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciByZXN1bHQgPSBuZXcgVmVyc2lvbigpO1xyXG4gICAgICAgIHJlc3VsdC5fdmVyc2lvblN0cmluZyA9IHZlcnNpb25TdHJpbmc7XHJcbiAgICAgICAgdmFyIHJlZ0V4ID0gLyhcXGQrKS4oXFxkKykvZ2k7XHJcbiAgICAgICAgdmFyIG1hdGNoZXMgPSByZWdFeC5leGVjKHZlcnNpb25TdHJpbmcpO1xyXG4gICAgICAgIGlmIChtYXRjaGVzICE9IG51bGwgJiYgbWF0Y2hlcy5sZW5ndGggPT0gMykge1xyXG4gICAgICAgICAgICByZXN1bHQuX21ham9yID0gcGFyc2VJbnQobWF0Y2hlc1sxXSk7XHJcbiAgICAgICAgICAgIHJlc3VsdC5fbWlub3IgPSBwYXJzZUludChtYXRjaGVzWzJdKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJlc3VsdC5faXNWYWxpZCA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXJlc3VsdC5faXNWYWxpZCkge1xyXG4gICAgICAgICAgICBjb250ZXh0LmxvZ1BhcnNlRXZlbnQoNiAvKiBJbnZhbGlkUHJvcGVydHlWYWx1ZSAqLywgXCJJbnZhbGlkIHZlcnNpb24gc3RyaW5nOiBcIiArIHJlc3VsdC5fdmVyc2lvblN0cmluZyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9O1xyXG4gICAgVmVyc2lvbi5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuICF0aGlzLl9pc1ZhbGlkID8gdGhpcy5fdmVyc2lvblN0cmluZyA6IHRoaXMuX21ham9yICsgXCIuXCIgKyB0aGlzLl9taW5vcjtcclxuICAgIH07XHJcbiAgICBWZXJzaW9uLnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudG9TdHJpbmcoKTtcclxuICAgIH07XHJcbiAgICBWZXJzaW9uLnByb3RvdHlwZS5jb21wYXJlVG8gPSBmdW5jdGlvbiAob3RoZXJWZXJzaW9uKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzVmFsaWQgfHwgIW90aGVyVmVyc2lvbi5pc1ZhbGlkKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCBjb21wYXJlIGludmFsaWQgdmVyc2lvbi5cIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLm1ham9yID4gb3RoZXJWZXJzaW9uLm1ham9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAxO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICh0aGlzLm1ham9yIDwgb3RoZXJWZXJzaW9uLm1ham9yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAtMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAodGhpcy5taW5vciA+IG90aGVyVmVyc2lvbi5taW5vcikge1xyXG4gICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAodGhpcy5taW5vciA8IG90aGVyVmVyc2lvbi5taW5vcikge1xyXG4gICAgICAgICAgICByZXR1cm4gLTE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAwO1xyXG4gICAgfTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShWZXJzaW9uLnByb3RvdHlwZSwgXCJsYWJlbFwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9sYWJlbCA/IHRoaXMuX2xhYmVsIDogdGhpcy50b1N0cmluZygpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFZlcnNpb24ucHJvdG90eXBlLCBcIm1ham9yXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21ham9yO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFZlcnNpb24ucHJvdG90eXBlLCBcIm1pbm9yXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21pbm9yO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFZlcnNpb24ucHJvdG90eXBlLCBcImlzVmFsaWRcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5faXNWYWxpZDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIHJldHVybiBWZXJzaW9uO1xyXG59KCkpO1xyXG5leHBvcnRzLlZlcnNpb24gPSBWZXJzaW9uO1xyXG52YXIgVmVyc2lvbnMgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBWZXJzaW9ucygpIHtcclxuICAgIH1cclxuICAgIFZlcnNpb25zLnYxXzAgPSBuZXcgVmVyc2lvbigxLCAwKTtcclxuICAgIFZlcnNpb25zLnYxXzEgPSBuZXcgVmVyc2lvbigxLCAxKTtcclxuICAgIFZlcnNpb25zLnYxXzIgPSBuZXcgVmVyc2lvbigxLCAyKTtcclxuICAgIFZlcnNpb25zLmxhdGVzdCA9IFZlcnNpb25zLnYxXzI7XHJcbiAgICBWZXJzaW9ucy52TmV4dCA9IG5ldyBWZXJzaW9uKDEwMDAsIDAsIFwidk5leHRcIik7XHJcbiAgICByZXR1cm4gVmVyc2lvbnM7XHJcbn0oKSk7XHJcbmV4cG9ydHMuVmVyc2lvbnMgPSBWZXJzaW9ucztcclxuZnVuY3Rpb24gaXNWZXJzaW9uTGVzc09yRXF1YWwodmVyc2lvbiwgdGFyZ2V0VmVyc2lvbikge1xyXG4gICAgaWYgKHZlcnNpb24gaW5zdGFuY2VvZiBWZXJzaW9uKSB7XHJcbiAgICAgICAgaWYgKHRhcmdldFZlcnNpb24gaW5zdGFuY2VvZiBWZXJzaW9uKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0YXJnZXRWZXJzaW9uLmNvbXBhcmVUbyh2ZXJzaW9uKSA+PSAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgLy8gVGFyZ2V0IHZlcnNpb24gaXMgKlxyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICAvLyBWZXJzaW9uIGlzICpcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxufVxyXG5leHBvcnRzLmlzVmVyc2lvbkxlc3NPckVxdWFsID0gaXNWZXJzaW9uTGVzc09yRXF1YWw7XHJcbnZhciBCYXNlU2VyaWFsaXphdGlvbkNvbnRleHQgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBCYXNlU2VyaWFsaXphdGlvbkNvbnRleHQodGFyZ2V0VmVyc2lvbikge1xyXG4gICAgICAgIGlmICh0YXJnZXRWZXJzaW9uID09PSB2b2lkIDApIHsgdGFyZ2V0VmVyc2lvbiA9IFZlcnNpb25zLmxhdGVzdDsgfVxyXG4gICAgICAgIHRoaXMudGFyZ2V0VmVyc2lvbiA9IHRhcmdldFZlcnNpb247XHJcbiAgICAgICAgdGhpcy5fdmFsaWRhdGlvbkV2ZW50cyA9IFtdO1xyXG4gICAgfVxyXG4gICAgQmFzZVNlcmlhbGl6YXRpb25Db250ZXh0LnByb3RvdHlwZS5zZXJpYWxpemVWYWx1ZSA9IGZ1bmN0aW9uICh0YXJnZXQsIHByb3BlcnR5TmFtZSwgcHJvcGVydHlWYWx1ZSwgZGVmYXVsdFZhbHVlKSB7XHJcbiAgICAgICAgaWYgKGRlZmF1bHRWYWx1ZSA9PT0gdm9pZCAwKSB7IGRlZmF1bHRWYWx1ZSA9IHVuZGVmaW5lZDsgfVxyXG4gICAgICAgIGlmIChwcm9wZXJ0eVZhbHVlID09PSBudWxsIHx8IHByb3BlcnR5VmFsdWUgPT09IHVuZGVmaW5lZCB8fCBwcm9wZXJ0eVZhbHVlID09PSBkZWZhdWx0VmFsdWUpIHtcclxuICAgICAgICAgICAgZGVsZXRlIHRhcmdldFtwcm9wZXJ0eU5hbWVdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGFyZ2V0W3Byb3BlcnR5TmFtZV0gPSBwcm9wZXJ0eVZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBCYXNlU2VyaWFsaXphdGlvbkNvbnRleHQucHJvdG90eXBlLnNlcmlhbGl6ZU51bWJlciA9IGZ1bmN0aW9uICh0YXJnZXQsIHByb3BlcnR5TmFtZSwgcHJvcGVydHlWYWx1ZSwgZGVmYXVsdFZhbHVlKSB7XHJcbiAgICAgICAgaWYgKGRlZmF1bHRWYWx1ZSA9PT0gdm9pZCAwKSB7IGRlZmF1bHRWYWx1ZSA9IHVuZGVmaW5lZDsgfVxyXG4gICAgICAgIGlmIChwcm9wZXJ0eVZhbHVlID09PSBudWxsIHx8IHByb3BlcnR5VmFsdWUgPT09IHVuZGVmaW5lZCB8fCBwcm9wZXJ0eVZhbHVlID09PSBkZWZhdWx0VmFsdWUgfHwgaXNOYU4ocHJvcGVydHlWYWx1ZSkpIHtcclxuICAgICAgICAgICAgZGVsZXRlIHRhcmdldFtwcm9wZXJ0eU5hbWVdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGFyZ2V0W3Byb3BlcnR5TmFtZV0gPSBwcm9wZXJ0eVZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBCYXNlU2VyaWFsaXphdGlvbkNvbnRleHQucHJvdG90eXBlLnNlcmlhbGl6ZUVudW0gPSBmdW5jdGlvbiAoZW51bVR5cGUsIHRhcmdldCwgcHJvcGVydHlOYW1lLCBwcm9wZXJ0eVZhbHVlLCBkZWZhdWx0VmFsdWUpIHtcclxuICAgICAgICBpZiAoZGVmYXVsdFZhbHVlID09PSB2b2lkIDApIHsgZGVmYXVsdFZhbHVlID0gdW5kZWZpbmVkOyB9XHJcbiAgICAgICAgdmFyIHRhcmdldFZhbHVlID0gdGFyZ2V0W3Byb3BlcnR5TmFtZV07XHJcbiAgICAgICAgdmFyIGNhbkRlbGV0ZVRhcmdldCA9IHRhcmdldFZhbHVlID09IHVuZGVmaW5lZCA/IHRydWUgOiBlbnVtVHlwZVt0YXJnZXRWYWx1ZV0gIT09IHVuZGVmaW5lZDtcclxuICAgICAgICBpZiAocHJvcGVydHlWYWx1ZSA9PSBkZWZhdWx0VmFsdWUpIHtcclxuICAgICAgICAgICAgaWYgKGNhbkRlbGV0ZVRhcmdldCkge1xyXG4gICAgICAgICAgICAgICAgZGVsZXRlIHRhcmdldFtwcm9wZXJ0eU5hbWVdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAocHJvcGVydHlWYWx1ZSA9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIGlmIChjYW5EZWxldGVUYXJnZXQpIHtcclxuICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGFyZ2V0W3Byb3BlcnR5TmFtZV07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0YXJnZXRbcHJvcGVydHlOYW1lXSA9IGVudW1UeXBlW3Byb3BlcnR5VmFsdWVdO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEJhc2VTZXJpYWxpemF0aW9uQ29udGV4dC5wcm90b3R5cGUuc2VyaWFsaXplQXJyYXkgPSBmdW5jdGlvbiAodGFyZ2V0LCBwcm9wZXJ0eU5hbWUsIHByb3BlcnR5VmFsdWUpIHtcclxuICAgICAgICB2YXIgaXRlbXMgPSBbXTtcclxuICAgICAgICBpZiAocHJvcGVydHlWYWx1ZSkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIHByb3BlcnR5VmFsdWVfMSA9IHByb3BlcnR5VmFsdWU7IF9pIDwgcHJvcGVydHlWYWx1ZV8xLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBwcm9wZXJ0eVZhbHVlXzFbX2ldO1xyXG4gICAgICAgICAgICAgICAgdmFyIHNlcmlhbGl6ZWRJdGVtID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0gaW5zdGFuY2VvZiBTZXJpYWxpemFibGVPYmplY3QpIHtcclxuICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkSXRlbSA9IGl0ZW0udG9KU09OKHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoaXRlbS50b0pTT04pIHtcclxuICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkSXRlbSA9IGl0ZW0udG9KU09OKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBzZXJpYWxpemVkSXRlbSA9IGl0ZW07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoc2VyaWFsaXplZEl0ZW0gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goc2VyaWFsaXplZEl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpdGVtcy5sZW5ndGggPT0gMCkge1xyXG4gICAgICAgICAgICBpZiAodGFyZ2V0Lmhhc093blByb3BlcnR5KHByb3BlcnR5TmFtZSkgJiYgQXJyYXkuaXNBcnJheSh0YXJnZXRbcHJvcGVydHlOYW1lXSkpIHtcclxuICAgICAgICAgICAgICAgIGRlbGV0ZSB0YXJnZXRbcHJvcGVydHlOYW1lXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5zZXJpYWxpemVWYWx1ZSh0YXJnZXQsIHByb3BlcnR5TmFtZSwgaXRlbXMpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBCYXNlU2VyaWFsaXphdGlvbkNvbnRleHQucHJvdG90eXBlLmNsZWFyRXZlbnRzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuX3ZhbGlkYXRpb25FdmVudHMgPSBbXTtcclxuICAgIH07XHJcbiAgICBCYXNlU2VyaWFsaXphdGlvbkNvbnRleHQucHJvdG90eXBlLmxvZ0V2ZW50ID0gZnVuY3Rpb24gKHBoYXNlLCBldmVudCwgbWVzc2FnZSwgc291cmNlKSB7XHJcbiAgICAgICAgdGhpcy5fdmFsaWRhdGlvbkV2ZW50cy5wdXNoKHtcclxuICAgICAgICAgICAgcGhhc2U6IHBoYXNlLFxyXG4gICAgICAgICAgICBldmVudDogZXZlbnQsXHJcbiAgICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2VcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBCYXNlU2VyaWFsaXphdGlvbkNvbnRleHQucHJvdG90eXBlLmxvZ1BhcnNlRXZlbnQgPSBmdW5jdGlvbiAoZXZlbnQsIG1lc3NhZ2UsIHNvdXJjZSkge1xyXG4gICAgICAgIHRoaXMubG9nRXZlbnQoMCAvKiBQYXJzZSAqLywgZXZlbnQsIG1lc3NhZ2UsIHNvdXJjZSk7XHJcbiAgICB9O1xyXG4gICAgQmFzZVNlcmlhbGl6YXRpb25Db250ZXh0LnByb3RvdHlwZS5nZXRFdmVudEF0ID0gZnVuY3Rpb24gKGluZGV4KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbGlkYXRpb25FdmVudHNbaW5kZXhdO1xyXG4gICAgfTtcclxuICAgIEJhc2VTZXJpYWxpemF0aW9uQ29udGV4dC5wcm90b3R5cGUuc2hvdWxkU2VyaWFsaXplID0gZnVuY3Rpb24gKG8pIHtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH07XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQmFzZVNlcmlhbGl6YXRpb25Db250ZXh0LnByb3RvdHlwZSwgXCJldmVudENvdW50XCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbGlkYXRpb25FdmVudHMubGVuZ3RoO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIEJhc2VTZXJpYWxpemF0aW9uQ29udGV4dDtcclxufSgpKTtcclxuZXhwb3J0cy5CYXNlU2VyaWFsaXphdGlvbkNvbnRleHQgPSBCYXNlU2VyaWFsaXphdGlvbkNvbnRleHQ7XHJcbnZhciBTaW1wbGVTZXJpYWxpemF0aW9uQ29udGV4dCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhTaW1wbGVTZXJpYWxpemF0aW9uQ29udGV4dCwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIFNpbXBsZVNlcmlhbGl6YXRpb25Db250ZXh0KCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgIH1cclxuICAgIHJldHVybiBTaW1wbGVTZXJpYWxpemF0aW9uQ29udGV4dDtcclxufShCYXNlU2VyaWFsaXphdGlvbkNvbnRleHQpKTtcclxudmFyIFByb3BlcnR5RGVmaW5pdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFByb3BlcnR5RGVmaW5pdGlvbih0YXJnZXRWZXJzaW9uLCBuYW1lLCBkZWZhdWx0VmFsdWUsIG9uR2V0SW5pdGlhbFZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy50YXJnZXRWZXJzaW9uID0gdGFyZ2V0VmVyc2lvbjtcclxuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xyXG4gICAgICAgIHRoaXMuZGVmYXVsdFZhbHVlID0gZGVmYXVsdFZhbHVlO1xyXG4gICAgICAgIHRoaXMub25HZXRJbml0aWFsVmFsdWUgPSBvbkdldEluaXRpYWxWYWx1ZTtcclxuICAgIH1cclxuICAgIFByb3BlcnR5RGVmaW5pdGlvbi5wcm90b3R5cGUuZ2V0SW50ZXJuYWxOYW1lID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLm5hbWU7XHJcbiAgICB9O1xyXG4gICAgUHJvcGVydHlEZWZpbml0aW9uLnByb3RvdHlwZS5wYXJzZSA9IGZ1bmN0aW9uIChzZW5kZXIsIHNvdXJjZSwgY29udGV4dCkge1xyXG4gICAgICAgIHJldHVybiBzb3VyY2VbdGhpcy5uYW1lXTtcclxuICAgIH07XHJcbiAgICBQcm9wZXJ0eURlZmluaXRpb24ucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uIChzZW5kZXIsIHRhcmdldCwgdmFsdWUsIGNvbnRleHQpIHtcclxuICAgICAgICBjb250ZXh0LnNlcmlhbGl6ZVZhbHVlKHRhcmdldCwgdGhpcy5uYW1lLCB2YWx1ZSwgdGhpcy5kZWZhdWx0VmFsdWUpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBQcm9wZXJ0eURlZmluaXRpb247XHJcbn0oKSk7XHJcbmV4cG9ydHMuUHJvcGVydHlEZWZpbml0aW9uID0gUHJvcGVydHlEZWZpbml0aW9uO1xyXG52YXIgU3RyaW5nUHJvcGVydHkgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoU3RyaW5nUHJvcGVydHksIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBTdHJpbmdQcm9wZXJ0eSh0YXJnZXRWZXJzaW9uLCBuYW1lLCB0cmVhdEVtcHR5QXNVbmRlZmluZWQsIHJlZ0V4LCBkZWZhdWx0VmFsdWUsIG9uR2V0SW5pdGlhbFZhbHVlKSB7XHJcbiAgICAgICAgaWYgKHRyZWF0RW1wdHlBc1VuZGVmaW5lZCA9PT0gdm9pZCAwKSB7IHRyZWF0RW1wdHlBc1VuZGVmaW5lZCA9IHRydWU7IH1cclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCB0YXJnZXRWZXJzaW9uLCBuYW1lLCBkZWZhdWx0VmFsdWUsIG9uR2V0SW5pdGlhbFZhbHVlKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLnRhcmdldFZlcnNpb24gPSB0YXJnZXRWZXJzaW9uO1xyXG4gICAgICAgIF90aGlzLm5hbWUgPSBuYW1lO1xyXG4gICAgICAgIF90aGlzLnRyZWF0RW1wdHlBc1VuZGVmaW5lZCA9IHRyZWF0RW1wdHlBc1VuZGVmaW5lZDtcclxuICAgICAgICBfdGhpcy5yZWdFeCA9IHJlZ0V4O1xyXG4gICAgICAgIF90aGlzLmRlZmF1bHRWYWx1ZSA9IGRlZmF1bHRWYWx1ZTtcclxuICAgICAgICBfdGhpcy5vbkdldEluaXRpYWxWYWx1ZSA9IG9uR2V0SW5pdGlhbFZhbHVlO1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIFN0cmluZ1Byb3BlcnR5LnByb3RvdHlwZS5wYXJzZSA9IGZ1bmN0aW9uIChzZW5kZXIsIHNvdXJjZSwgY29udGV4dCkge1xyXG4gICAgICAgIHZhciBwYXJzZWRWYWx1ZSA9IFV0aWxzLnBhcnNlU3RyaW5nKHNvdXJjZVt0aGlzLm5hbWVdLCB0aGlzLmRlZmF1bHRWYWx1ZSk7XHJcbiAgICAgICAgdmFyIGlzVW5kZWZpbmVkID0gcGFyc2VkVmFsdWUgPT09IHVuZGVmaW5lZCB8fCAocGFyc2VkVmFsdWUgPT09IFwiXCIgJiYgdGhpcy50cmVhdEVtcHR5QXNVbmRlZmluZWQpO1xyXG4gICAgICAgIGlmICghaXNVbmRlZmluZWQgJiYgdGhpcy5yZWdFeCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHZhciBtYXRjaGVzID0gdGhpcy5yZWdFeC5leGVjKHBhcnNlZFZhbHVlKTtcclxuICAgICAgICAgICAgaWYgKCFtYXRjaGVzKSB7XHJcbiAgICAgICAgICAgICAgICBjb250ZXh0LmxvZ1BhcnNlRXZlbnQoNiAvKiBJbnZhbGlkUHJvcGVydHlWYWx1ZSAqLywgXCJJbnZhbGlkIFxcXCJcIiArIHRoaXMubmFtZSArIFwiXFxcIiB2YWx1ZSBcXFwiXCIgKyBwYXJzZWRWYWx1ZSArIFwiXFxcIlwiLCBzZW5kZXIpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcGFyc2VkVmFsdWU7XHJcbiAgICB9O1xyXG4gICAgU3RyaW5nUHJvcGVydHkucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uIChzZW5kZXIsIHRhcmdldCwgdmFsdWUsIGNvbnRleHQpIHtcclxuICAgICAgICBjb250ZXh0LnNlcmlhbGl6ZVZhbHVlKHRhcmdldCwgdGhpcy5uYW1lLCB2YWx1ZSA9PT0gXCJcIiAmJiB0aGlzLnRyZWF0RW1wdHlBc1VuZGVmaW5lZCA/IHVuZGVmaW5lZCA6IHZhbHVlLCB0aGlzLmRlZmF1bHRWYWx1ZSk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFN0cmluZ1Byb3BlcnR5O1xyXG59KFByb3BlcnR5RGVmaW5pdGlvbikpO1xyXG5leHBvcnRzLlN0cmluZ1Byb3BlcnR5ID0gU3RyaW5nUHJvcGVydHk7XHJcbnZhciBCb29sUHJvcGVydHkgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoQm9vbFByb3BlcnR5LCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gQm9vbFByb3BlcnR5KCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgIH1cclxuICAgIEJvb2xQcm9wZXJ0eS5wcm90b3R5cGUucGFyc2UgPSBmdW5jdGlvbiAoc2VuZGVyLCBzb3VyY2UsIGNvbnRleHQpIHtcclxuICAgICAgICByZXR1cm4gVXRpbHMucGFyc2VCb29sKHNvdXJjZVt0aGlzLm5hbWVdLCB0aGlzLmRlZmF1bHRWYWx1ZSk7XHJcbiAgICB9O1xyXG4gICAgQm9vbFByb3BlcnR5LnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiAoc2VuZGVyLCB0YXJnZXQsIHZhbHVlLCBjb250ZXh0KSB7XHJcbiAgICAgICAgY29udGV4dC5zZXJpYWxpemVWYWx1ZSh0YXJnZXQsIHRoaXMubmFtZSwgdmFsdWUsIHRoaXMuZGVmYXVsdFZhbHVlKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gQm9vbFByb3BlcnR5O1xyXG59KFByb3BlcnR5RGVmaW5pdGlvbikpO1xyXG5leHBvcnRzLkJvb2xQcm9wZXJ0eSA9IEJvb2xQcm9wZXJ0eTtcclxudmFyIE51bVByb3BlcnR5ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKE51bVByb3BlcnR5LCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gTnVtUHJvcGVydHkoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgTnVtUHJvcGVydHkucHJvdG90eXBlLnBhcnNlID0gZnVuY3Rpb24gKHNlbmRlciwgc291cmNlLCBjb250ZXh0KSB7XHJcbiAgICAgICAgcmV0dXJuIFV0aWxzLnBhcnNlTnVtYmVyKHNvdXJjZVt0aGlzLm5hbWVdLCB0aGlzLmRlZmF1bHRWYWx1ZSk7XHJcbiAgICB9O1xyXG4gICAgTnVtUHJvcGVydHkucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uIChzZW5kZXIsIHRhcmdldCwgdmFsdWUsIGNvbnRleHQpIHtcclxuICAgICAgICBjb250ZXh0LnNlcmlhbGl6ZU51bWJlcih0YXJnZXQsIHRoaXMubmFtZSwgdmFsdWUsIHRoaXMuZGVmYXVsdFZhbHVlKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gTnVtUHJvcGVydHk7XHJcbn0oUHJvcGVydHlEZWZpbml0aW9uKSk7XHJcbmV4cG9ydHMuTnVtUHJvcGVydHkgPSBOdW1Qcm9wZXJ0eTtcclxudmFyIFBpeGVsU2l6ZVByb3BlcnR5ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKFBpeGVsU2l6ZVByb3BlcnR5LCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gUGl4ZWxTaXplUHJvcGVydHkoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgUGl4ZWxTaXplUHJvcGVydHkucHJvdG90eXBlLnBhcnNlID0gZnVuY3Rpb24gKHNlbmRlciwgc291cmNlLCBjb250ZXh0KSB7XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IHVuZGVmaW5lZDtcclxuICAgICAgICB2YXIgdmFsdWUgPSBzb3VyY2VbdGhpcy5uYW1lXTtcclxuICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgIHZhciBpc1ZhbGlkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc2l6ZSA9IHNoYXJlZF8xLlNpemVBbmRVbml0LnBhcnNlKHZhbHVlLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIGlmIChzaXplLnVuaXQgPT0gRW51bXMuU2l6ZVVuaXQuUGl4ZWwpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBzaXplLnBoeXNpY2FsU2l6ZTtcclxuICAgICAgICAgICAgICAgICAgICBpc1ZhbGlkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXRjaCAoX2EpIHtcclxuICAgICAgICAgICAgICAgIC8vIERvIG5vdGhpbmcuIEEgcGFyc2UgZXJyb3IgaXMgZW1pdHRlZCBiZWxvd1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghaXNWYWxpZCkge1xyXG4gICAgICAgICAgICAgICAgY29udGV4dC5sb2dQYXJzZUV2ZW50KDYgLyogSW52YWxpZFByb3BlcnR5VmFsdWUgKi8sIFwiSW52YWxpZCBcXFwibWluSGVpZ2h0XFxcIiB2YWx1ZTogXCIgKyBzb3VyY2VbdGhpcy5uYW1lXSwgc2VuZGVyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuICAgIFBpeGVsU2l6ZVByb3BlcnR5LnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiAoc2VuZGVyLCB0YXJnZXQsIHZhbHVlLCBjb250ZXh0KSB7XHJcbiAgICAgICAgY29udGV4dC5zZXJpYWxpemVWYWx1ZSh0YXJnZXQsIHRoaXMubmFtZSwgdHlwZW9mIHZhbHVlID09PSBcIm51bWJlclwiICYmICFpc05hTih2YWx1ZSkgPyB2YWx1ZSArIFwicHhcIiA6IHVuZGVmaW5lZCk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFBpeGVsU2l6ZVByb3BlcnR5O1xyXG59KFByb3BlcnR5RGVmaW5pdGlvbikpO1xyXG5leHBvcnRzLlBpeGVsU2l6ZVByb3BlcnR5ID0gUGl4ZWxTaXplUHJvcGVydHk7XHJcbnZhciBTdHJpbmdBcnJheVByb3BlcnR5ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKFN0cmluZ0FycmF5UHJvcGVydHksIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBTdHJpbmdBcnJheVByb3BlcnR5KHRhcmdldFZlcnNpb24sIG5hbWUsIGRlZmF1bHRWYWx1ZSwgb25HZXRJbml0aWFsVmFsdWUpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCB0YXJnZXRWZXJzaW9uLCBuYW1lLCBkZWZhdWx0VmFsdWUsIG9uR2V0SW5pdGlhbFZhbHVlKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLnRhcmdldFZlcnNpb24gPSB0YXJnZXRWZXJzaW9uO1xyXG4gICAgICAgIF90aGlzLm5hbWUgPSBuYW1lO1xyXG4gICAgICAgIF90aGlzLmRlZmF1bHRWYWx1ZSA9IGRlZmF1bHRWYWx1ZTtcclxuICAgICAgICBfdGhpcy5vbkdldEluaXRpYWxWYWx1ZSA9IG9uR2V0SW5pdGlhbFZhbHVlO1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIFN0cmluZ0FycmF5UHJvcGVydHkucHJvdG90eXBlLnBhcnNlID0gZnVuY3Rpb24gKHNlbmRlciwgc291cmNlLCBjb250ZXh0KSB7XHJcbiAgICAgICAgdmFyIHNvdXJjZVZhbHVlID0gc291cmNlW3RoaXMubmFtZV07XHJcbiAgICAgICAgaWYgKHNvdXJjZVZhbHVlID09PSB1bmRlZmluZWQgfHwgIUFycmF5LmlzQXJyYXkoc291cmNlVmFsdWUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmRlZmF1bHRWYWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IFtdO1xyXG4gICAgICAgIGZvciAodmFyIF9pID0gMCwgc291cmNlVmFsdWVfMSA9IHNvdXJjZVZhbHVlOyBfaSA8IHNvdXJjZVZhbHVlXzEubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IHNvdXJjZVZhbHVlXzFbX2ldO1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh2YWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjb250ZXh0LmxvZ1BhcnNlRXZlbnQoNiAvKiBJbnZhbGlkUHJvcGVydHlWYWx1ZSAqLywgXCJJbnZhbGlkIGFycmF5IHZhbHVlIFxcXCJcIiArIHZhbHVlICsgXCJcXFwiIG9mIHR5cGUgXFxcIlwiICsgdHlwZW9mIHZhbHVlICsgXCJcXFwiIGlnbm9yZWQgZm9yIFxcXCJcIiArIHRoaXMubmFtZSArIFwiXFxcIi5cIiwgc2VuZGVyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuICAgIFN0cmluZ0FycmF5UHJvcGVydHkucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uIChzZW5kZXIsIHRhcmdldCwgdmFsdWUsIGNvbnRleHQpIHtcclxuICAgICAgICBjb250ZXh0LnNlcmlhbGl6ZUFycmF5KHRhcmdldCwgdGhpcy5uYW1lLCB2YWx1ZSk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFN0cmluZ0FycmF5UHJvcGVydHk7XHJcbn0oUHJvcGVydHlEZWZpbml0aW9uKSk7XHJcbmV4cG9ydHMuU3RyaW5nQXJyYXlQcm9wZXJ0eSA9IFN0cmluZ0FycmF5UHJvcGVydHk7XHJcbnZhciBWYWx1ZVNldFByb3BlcnR5ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKFZhbHVlU2V0UHJvcGVydHksIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBWYWx1ZVNldFByb3BlcnR5KHRhcmdldFZlcnNpb24sIG5hbWUsIHZhbHVlcywgZGVmYXVsdFZhbHVlLCBvbkdldEluaXRpYWxWYWx1ZSkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHRhcmdldFZlcnNpb24sIG5hbWUsIGRlZmF1bHRWYWx1ZSwgb25HZXRJbml0aWFsVmFsdWUpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMudGFyZ2V0VmVyc2lvbiA9IHRhcmdldFZlcnNpb247XHJcbiAgICAgICAgX3RoaXMubmFtZSA9IG5hbWU7XHJcbiAgICAgICAgX3RoaXMudmFsdWVzID0gdmFsdWVzO1xyXG4gICAgICAgIF90aGlzLmRlZmF1bHRWYWx1ZSA9IGRlZmF1bHRWYWx1ZTtcclxuICAgICAgICBfdGhpcy5vbkdldEluaXRpYWxWYWx1ZSA9IG9uR2V0SW5pdGlhbFZhbHVlO1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIFZhbHVlU2V0UHJvcGVydHkucHJvdG90eXBlLnBhcnNlID0gZnVuY3Rpb24gKHNlbmRlciwgc291cmNlLCBjb250ZXh0KSB7XHJcbiAgICAgICAgdmFyIHNvdXJjZVZhbHVlID0gc291cmNlW3RoaXMubmFtZV07XHJcbiAgICAgICAgaWYgKHNvdXJjZVZhbHVlID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGVmYXVsdFZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodHlwZW9mIHNvdXJjZVZhbHVlID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSB0aGlzLnZhbHVlczsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgICAgIHZhciB2ZXJzaW9uZWRWYWx1ZSA9IF9hW19pXTtcclxuICAgICAgICAgICAgICAgIGlmIChzb3VyY2VWYWx1ZS50b0xvd2VyQ2FzZSgpID09PSB2ZXJzaW9uZWRWYWx1ZS52YWx1ZS50b0xvd2VyQ2FzZSgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHRhcmdldFZlcnNpb24gPSB2ZXJzaW9uZWRWYWx1ZS50YXJnZXRWZXJzaW9uID8gdmVyc2lvbmVkVmFsdWUudGFyZ2V0VmVyc2lvbiA6IHRoaXMudGFyZ2V0VmVyc2lvbjtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0VmVyc2lvbi5jb21wYXJlVG8oY29udGV4dC50YXJnZXRWZXJzaW9uKSA8PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2ZXJzaW9uZWRWYWx1ZS52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQubG9nUGFyc2VFdmVudCg2IC8qIEludmFsaWRQcm9wZXJ0eVZhbHVlICovLCBcIlxcXCJcIiArIHRoaXMubmFtZSArIFwiXFxcIiB2YWx1ZSBcXFwiXCIgKyBzb3VyY2VWYWx1ZSArIFwiXFxcIiBpcyBzdXBwb3J0ZWQgaW4gdmVyc2lvbiBcIiArIHRhcmdldFZlcnNpb24udG9TdHJpbmcoKSArIFwiLCBidXQgeW91IGFyZSB1c2luZyB2ZXJzaW9uIFwiICsgY29udGV4dC50YXJnZXRWZXJzaW9uLnRvU3RyaW5nKCksIHNlbmRlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRlZmF1bHRWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgY29udGV4dC5sb2dQYXJzZUV2ZW50KDYgLyogSW52YWxpZFByb3BlcnR5VmFsdWUgKi8sIFwiSW52YWxpZCBcXFwiXCIgKyB0aGlzLm5hbWUgKyBcIlxcXCIgdmFsdWUgXFxcIlwiICsgc291cmNlVmFsdWUgKyBcIlxcXCJcIiwgc2VuZGVyKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5kZWZhdWx0VmFsdWU7XHJcbiAgICB9O1xyXG4gICAgVmFsdWVTZXRQcm9wZXJ0eS5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gKHNlbmRlciwgdGFyZ2V0LCB2YWx1ZSwgY29udGV4dCkge1xyXG4gICAgICAgIHZhciB2YWx1ZUZvdW5kID0gZmFsc2U7XHJcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHRoaXMudmFsdWVzOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgICAgICB2YXIgdmVyc2lvbmVkVmFsdWUgPSBfYVtfaV07XHJcbiAgICAgICAgICAgIGlmICh2ZXJzaW9uZWRWYWx1ZS52YWx1ZSA9PT0gdmFsdWUpIHtcclxuICAgICAgICAgICAgICAgIHZhciB0YXJnZXRWZXJzaW9uID0gdmVyc2lvbmVkVmFsdWUudGFyZ2V0VmVyc2lvbiA/IHZlcnNpb25lZFZhbHVlLnRhcmdldFZlcnNpb24gOiB0aGlzLnRhcmdldFZlcnNpb247XHJcbiAgICAgICAgICAgICAgICBpZiAodGFyZ2V0VmVyc2lvbi5jb21wYXJlVG8oY29udGV4dC50YXJnZXRWZXJzaW9uKSA8PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVGb3VuZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmxvZ0V2ZW50KDEgLyogVG9KU09OICovLCA2IC8qIEludmFsaWRQcm9wZXJ0eVZhbHVlICovLCBcIlxcXCJcIiArIHRoaXMubmFtZSArIFwiXFxcIiB2YWx1ZSBcXFwiXCIgKyB2YWx1ZSArIFwiXFxcIiBpcyBzdXBwb3J0ZWQgaW4gdmVyc2lvbiBcIiArIHRhcmdldFZlcnNpb24udG9TdHJpbmcoKSArIFwiLCBidXQgeW91IGFyZSB1c2luZyB2ZXJzaW9uIFwiICsgY29udGV4dC50YXJnZXRWZXJzaW9uLnRvU3RyaW5nKCksIHNlbmRlcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgY29udGV4dC5zZXJpYWxpemVWYWx1ZSh0YXJnZXQsIHRoaXMubmFtZSwgdmFsdWVGb3VuZCA/IHZhbHVlIDogdW5kZWZpbmVkLCB0aGlzLmRlZmF1bHRWYWx1ZSk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFZhbHVlU2V0UHJvcGVydHk7XHJcbn0oUHJvcGVydHlEZWZpbml0aW9uKSk7XHJcbmV4cG9ydHMuVmFsdWVTZXRQcm9wZXJ0eSA9IFZhbHVlU2V0UHJvcGVydHk7XHJcbnZhciBFbnVtUHJvcGVydHkgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoRW51bVByb3BlcnR5LCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gRW51bVByb3BlcnR5KHRhcmdldFZlcnNpb24sIG5hbWUsIGVudW1UeXBlLCBkZWZhdWx0VmFsdWUsIHZhbHVlcywgb25HZXRJbml0aWFsVmFsdWUpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCB0YXJnZXRWZXJzaW9uLCBuYW1lLCBkZWZhdWx0VmFsdWUsIG9uR2V0SW5pdGlhbFZhbHVlKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLnRhcmdldFZlcnNpb24gPSB0YXJnZXRWZXJzaW9uO1xyXG4gICAgICAgIF90aGlzLm5hbWUgPSBuYW1lO1xyXG4gICAgICAgIF90aGlzLmVudW1UeXBlID0gZW51bVR5cGU7XHJcbiAgICAgICAgX3RoaXMuZGVmYXVsdFZhbHVlID0gZGVmYXVsdFZhbHVlO1xyXG4gICAgICAgIF90aGlzLm9uR2V0SW5pdGlhbFZhbHVlID0gb25HZXRJbml0aWFsVmFsdWU7XHJcbiAgICAgICAgX3RoaXMuX3ZhbHVlcyA9IFtdO1xyXG4gICAgICAgIGlmICghdmFsdWVzKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBlbnVtVHlwZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGtleUFzTnVtYmVyID0gcGFyc2VJbnQoa2V5LCAxMCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoa2V5QXNOdW1iZXIgPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLl92YWx1ZXMucHVzaCh7IHZhbHVlOiBrZXlBc051bWJlciB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgX3RoaXMuX3ZhbHVlcyA9IHZhbHVlcztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgRW51bVByb3BlcnR5LnByb3RvdHlwZS5wYXJzZSA9IGZ1bmN0aW9uIChzZW5kZXIsIHNvdXJjZSwgY29udGV4dCkge1xyXG4gICAgICAgIHZhciBzb3VyY2VWYWx1ZSA9IHNvdXJjZVt0aGlzLm5hbWVdO1xyXG4gICAgICAgIGlmICh0eXBlb2Ygc291cmNlVmFsdWUgIT09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGVmYXVsdFZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgZW51bVZhbHVlID0gVXRpbHMuZ2V0RW51bVZhbHVlQnlOYW1lKHRoaXMuZW51bVR5cGUsIHNvdXJjZVZhbHVlKTtcclxuICAgICAgICBpZiAoZW51bVZhbHVlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHRoaXMudmFsdWVzOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHZlcnNpb25lZFZhbHVlID0gX2FbX2ldO1xyXG4gICAgICAgICAgICAgICAgaWYgKHZlcnNpb25lZFZhbHVlLnZhbHVlID09PSBlbnVtVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0VmVyc2lvbiA9IHZlcnNpb25lZFZhbHVlLnRhcmdldFZlcnNpb24gPyB2ZXJzaW9uZWRWYWx1ZS50YXJnZXRWZXJzaW9uIDogdGhpcy50YXJnZXRWZXJzaW9uO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXRWZXJzaW9uLmNvbXBhcmVUbyhjb250ZXh0LnRhcmdldFZlcnNpb24pIDw9IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVudW1WYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQubG9nUGFyc2VFdmVudCg2IC8qIEludmFsaWRQcm9wZXJ0eVZhbHVlICovLCBcIlxcXCJcIiArIHRoaXMubmFtZSArIFwiXFxcIiB2YWx1ZSBcXFwiXCIgKyBzb3VyY2VWYWx1ZSArIFwiXFxcIiBpcyBzdXBwb3J0ZWQgaW4gdmVyc2lvbiBcIiArIHRhcmdldFZlcnNpb24udG9TdHJpbmcoKSArIFwiLCBidXQgeW91IGFyZSB1c2luZyB2ZXJzaW9uIFwiICsgY29udGV4dC50YXJnZXRWZXJzaW9uLnRvU3RyaW5nKCksIHNlbmRlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRlZmF1bHRWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgY29udGV4dC5sb2dQYXJzZUV2ZW50KDYgLyogSW52YWxpZFByb3BlcnR5VmFsdWUgKi8sIFwiSW52YWxpZCBcXFwiXCIgKyB0aGlzLm5hbWUgKyBcIlxcXCIgdmFsdWUgXFxcIlwiICsgc291cmNlVmFsdWUgKyBcIlxcXCJcIiwgc2VuZGVyKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5kZWZhdWx0VmFsdWU7XHJcbiAgICB9O1xyXG4gICAgRW51bVByb3BlcnR5LnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiAoc2VuZGVyLCB0YXJnZXQsIHZhbHVlLCBjb250ZXh0KSB7XHJcbiAgICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgdmFyIHZhbHVlRm91bmQgPSBmYWxzZTtcclxuICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHRoaXMudmFsdWVzOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHZlcnNpb25lZFZhbHVlID0gX2FbX2ldO1xyXG4gICAgICAgICAgICAgICAgaWYgKHZlcnNpb25lZFZhbHVlLnZhbHVlID09PSB2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0YXJnZXRWZXJzaW9uID0gdmVyc2lvbmVkVmFsdWUudGFyZ2V0VmVyc2lvbiA/IHZlcnNpb25lZFZhbHVlLnRhcmdldFZlcnNpb24gOiB0aGlzLnRhcmdldFZlcnNpb247XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldFZlcnNpb24uY29tcGFyZVRvKGNvbnRleHQudGFyZ2V0VmVyc2lvbikgPD0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZUZvdW5kID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmxvZ0V2ZW50KDEgLyogVG9KU09OICovLCA2IC8qIEludmFsaWRQcm9wZXJ0eVZhbHVlICovLCBcIkludmFsaWQgXFxcIlwiICsgdGhpcy5uYW1lICsgXCJcXFwiIHZhbHVlIFxcXCJcIiArIHZhbHVlICsgXCJcXFwiXCIsIHNlbmRlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh2YWx1ZUZvdW5kKSB7XHJcbiAgICAgICAgICAgICAgICBjb250ZXh0LnNlcmlhbGl6ZUVudW0odGhpcy5lbnVtVHlwZSwgdGFyZ2V0LCB0aGlzLm5hbWUsIHZhbHVlLCB0aGlzLmRlZmF1bHRWYWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEVudW1Qcm9wZXJ0eS5wcm90b3R5cGUsIFwidmFsdWVzXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3ZhbHVlcztcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIHJldHVybiBFbnVtUHJvcGVydHk7XHJcbn0oUHJvcGVydHlEZWZpbml0aW9uKSk7XHJcbmV4cG9ydHMuRW51bVByb3BlcnR5ID0gRW51bVByb3BlcnR5O1xyXG52YXIgU2VyaWFsaXphYmxlT2JqZWN0UHJvcGVydHkgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoU2VyaWFsaXphYmxlT2JqZWN0UHJvcGVydHksIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBTZXJpYWxpemFibGVPYmplY3RQcm9wZXJ0eSh0YXJnZXRWZXJzaW9uLCBuYW1lLCBvYmplY3RUeXBlLCBudWxsYWJsZSkge1xyXG4gICAgICAgIGlmIChudWxsYWJsZSA9PT0gdm9pZCAwKSB7IG51bGxhYmxlID0gZmFsc2U7IH1cclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCB0YXJnZXRWZXJzaW9uLCBuYW1lLCB1bmRlZmluZWQsIGZ1bmN0aW9uIChzZW5kZXIpIHsgcmV0dXJuIF90aGlzLm51bGxhYmxlID8gdW5kZWZpbmVkIDogbmV3IF90aGlzLm9iamVjdFR5cGUoKTsgfSkgfHwgdGhpcztcclxuICAgICAgICBfdGhpcy50YXJnZXRWZXJzaW9uID0gdGFyZ2V0VmVyc2lvbjtcclxuICAgICAgICBfdGhpcy5uYW1lID0gbmFtZTtcclxuICAgICAgICBfdGhpcy5vYmplY3RUeXBlID0gb2JqZWN0VHlwZTtcclxuICAgICAgICBfdGhpcy5udWxsYWJsZSA9IG51bGxhYmxlO1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIFNlcmlhbGl6YWJsZU9iamVjdFByb3BlcnR5LnByb3RvdHlwZS5wYXJzZSA9IGZ1bmN0aW9uIChzZW5kZXIsIHNvdXJjZSwgY29udGV4dCkge1xyXG4gICAgICAgIHZhciBzb3VyY2VWYWx1ZSA9IHNvdXJjZVt0aGlzLm5hbWVdO1xyXG4gICAgICAgIGlmIChzb3VyY2VWYWx1ZSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLm9uR2V0SW5pdGlhbFZhbHVlID8gdGhpcy5vbkdldEluaXRpYWxWYWx1ZShzZW5kZXIpIDogdGhpcy5kZWZhdWx0VmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciByZXN1bHQgPSBuZXcgdGhpcy5vYmplY3RUeXBlKCk7XHJcbiAgICAgICAgcmVzdWx0LnBhcnNlKHNvdXJjZVZhbHVlLCBjb250ZXh0KTtcclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuICAgIFNlcmlhbGl6YWJsZU9iamVjdFByb3BlcnR5LnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiAoc2VuZGVyLCB0YXJnZXQsIHZhbHVlLCBjb250ZXh0KSB7XHJcbiAgICAgICAgdmFyIHNlcmlhbGl6ZWRWYWx1ZSA9IHZhbHVlICE9PSB1bmRlZmluZWQgPyB2YWx1ZS50b0pTT04oY29udGV4dCkgOiB2YWx1ZTtcclxuICAgICAgICBpZiAodHlwZW9mIHNlcmlhbGl6ZWRWYWx1ZSA9PT0gXCJvYmplY3RcIiAmJiBPYmplY3Qua2V5cyhzZXJpYWxpemVkVmFsdWUpLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICBzZXJpYWxpemVkVmFsdWUgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUudG9KU09OLmNhbGwodGhpcywgc2VuZGVyLCB0YXJnZXQsIHNlcmlhbGl6ZWRWYWx1ZSwgY29udGV4dCk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFNlcmlhbGl6YWJsZU9iamVjdFByb3BlcnR5O1xyXG59KFByb3BlcnR5RGVmaW5pdGlvbikpO1xyXG5leHBvcnRzLlNlcmlhbGl6YWJsZU9iamVjdFByb3BlcnR5ID0gU2VyaWFsaXphYmxlT2JqZWN0UHJvcGVydHk7XHJcbnZhciBTZXJpYWxpemFibGVPYmplY3RDb2xsZWN0aW9uUHJvcGVydHkgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoU2VyaWFsaXphYmxlT2JqZWN0Q29sbGVjdGlvblByb3BlcnR5LCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gU2VyaWFsaXphYmxlT2JqZWN0Q29sbGVjdGlvblByb3BlcnR5KHRhcmdldFZlcnNpb24sIG5hbWUsIG9iamVjdFR5cGUsIG9uSXRlbUFkZGVkKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgdGFyZ2V0VmVyc2lvbiwgbmFtZSwgdW5kZWZpbmVkLCBmdW5jdGlvbiAoc2VuZGVyKSB7IHJldHVybiBbXTsgfSkgfHwgdGhpcztcclxuICAgICAgICBfdGhpcy50YXJnZXRWZXJzaW9uID0gdGFyZ2V0VmVyc2lvbjtcclxuICAgICAgICBfdGhpcy5uYW1lID0gbmFtZTtcclxuICAgICAgICBfdGhpcy5vYmplY3RUeXBlID0gb2JqZWN0VHlwZTtcclxuICAgICAgICBfdGhpcy5vbkl0ZW1BZGRlZCA9IG9uSXRlbUFkZGVkO1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIFNlcmlhbGl6YWJsZU9iamVjdENvbGxlY3Rpb25Qcm9wZXJ0eS5wcm90b3R5cGUucGFyc2UgPSBmdW5jdGlvbiAoc2VuZGVyLCBzb3VyY2UsIGNvbnRleHQpIHtcclxuICAgICAgICB2YXIgcmVzdWx0ID0gW107XHJcbiAgICAgICAgdmFyIHNvdXJjZUNvbGxlY3Rpb24gPSBzb3VyY2VbdGhpcy5uYW1lXTtcclxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShzb3VyY2VDb2xsZWN0aW9uKSkge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIHNvdXJjZUNvbGxlY3Rpb25fMSA9IHNvdXJjZUNvbGxlY3Rpb247IF9pIDwgc291cmNlQ29sbGVjdGlvbl8xLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHNvdXJjZUl0ZW0gPSBzb3VyY2VDb2xsZWN0aW9uXzFbX2ldO1xyXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBuZXcgdGhpcy5vYmplY3RUeXBlKCk7XHJcbiAgICAgICAgICAgICAgICBpdGVtLnBhcnNlKHNvdXJjZUl0ZW0sIGNvbnRleHQpO1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goaXRlbSk7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5vbkl0ZW1BZGRlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMub25JdGVtQWRkZWQoc2VuZGVyLCBpdGVtKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0Lmxlbmd0aCA+IDAgPyByZXN1bHQgOiAodGhpcy5vbkdldEluaXRpYWxWYWx1ZSA/IHRoaXMub25HZXRJbml0aWFsVmFsdWUoc2VuZGVyKSA6IHVuZGVmaW5lZCk7XHJcbiAgICB9O1xyXG4gICAgU2VyaWFsaXphYmxlT2JqZWN0Q29sbGVjdGlvblByb3BlcnR5LnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiAoc2VuZGVyLCB0YXJnZXQsIHZhbHVlLCBjb250ZXh0KSB7XHJcbiAgICAgICAgY29udGV4dC5zZXJpYWxpemVBcnJheSh0YXJnZXQsIHRoaXMubmFtZSwgdmFsdWUpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBTZXJpYWxpemFibGVPYmplY3RDb2xsZWN0aW9uUHJvcGVydHk7XHJcbn0oUHJvcGVydHlEZWZpbml0aW9uKSk7XHJcbmV4cG9ydHMuU2VyaWFsaXphYmxlT2JqZWN0Q29sbGVjdGlvblByb3BlcnR5ID0gU2VyaWFsaXphYmxlT2JqZWN0Q29sbGVjdGlvblByb3BlcnR5O1xyXG52YXIgQ3VzdG9tUHJvcGVydHkgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoQ3VzdG9tUHJvcGVydHksIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBDdXN0b21Qcm9wZXJ0eSh0YXJnZXRWZXJzaW9uLCBuYW1lLCBvblBhcnNlLCBvblRvSlNPTiwgZGVmYXVsdFZhbHVlLCBvbkdldEluaXRpYWxWYWx1ZSkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHRhcmdldFZlcnNpb24sIG5hbWUsIGRlZmF1bHRWYWx1ZSwgb25HZXRJbml0aWFsVmFsdWUpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMudGFyZ2V0VmVyc2lvbiA9IHRhcmdldFZlcnNpb247XHJcbiAgICAgICAgX3RoaXMubmFtZSA9IG5hbWU7XHJcbiAgICAgICAgX3RoaXMub25QYXJzZSA9IG9uUGFyc2U7XHJcbiAgICAgICAgX3RoaXMub25Ub0pTT04gPSBvblRvSlNPTjtcclxuICAgICAgICBfdGhpcy5kZWZhdWx0VmFsdWUgPSBkZWZhdWx0VmFsdWU7XHJcbiAgICAgICAgX3RoaXMub25HZXRJbml0aWFsVmFsdWUgPSBvbkdldEluaXRpYWxWYWx1ZTtcclxuICAgICAgICBpZiAoIV90aGlzLm9uUGFyc2UpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ3VzdG9tUHJvcGVydHlEZWZpbml0aW9uIGluc3RhbmNlcyBtdXN0IGhhdmUgYW4gb25QYXJzZSBoYW5kbGVyLlwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCFfdGhpcy5vblRvSlNPTikge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDdXN0b21Qcm9wZXJ0eURlZmluaXRpb24gaW5zdGFuY2VzIG11c3QgaGF2ZSBhbiBvblRvSlNPTiBoYW5kbGVyLlwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgQ3VzdG9tUHJvcGVydHkucHJvdG90eXBlLnBhcnNlID0gZnVuY3Rpb24gKHNlbmRlciwgc291cmNlLCBjb250ZXh0KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMub25QYXJzZShzZW5kZXIsIHRoaXMsIHNvdXJjZSwgY29udGV4dCk7XHJcbiAgICB9O1xyXG4gICAgQ3VzdG9tUHJvcGVydHkucHJvdG90eXBlLnRvSlNPTiA9IGZ1bmN0aW9uIChzZW5kZXIsIHRhcmdldCwgdmFsdWUsIGNvbnRleHQpIHtcclxuICAgICAgICB0aGlzLm9uVG9KU09OKHNlbmRlciwgdGhpcywgdGFyZ2V0LCB2YWx1ZSwgY29udGV4dCk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIEN1c3RvbVByb3BlcnR5O1xyXG59KFByb3BlcnR5RGVmaW5pdGlvbikpO1xyXG5leHBvcnRzLkN1c3RvbVByb3BlcnR5ID0gQ3VzdG9tUHJvcGVydHk7XHJcbnZhciBTZXJpYWxpemFibGVPYmplY3RTY2hlbWEgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBTZXJpYWxpemFibGVPYmplY3RTY2hlbWEoKSB7XHJcbiAgICAgICAgdGhpcy5fcHJvcGVydGllcyA9IFtdO1xyXG4gICAgfVxyXG4gICAgU2VyaWFsaXphYmxlT2JqZWN0U2NoZW1hLnByb3RvdHlwZS5pbmRleE9mID0gZnVuY3Rpb24gKHByb3BlcnR5KSB7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLl9wcm9wZXJ0aWVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9wcm9wZXJ0aWVzW2ldID09PSBwcm9wZXJ0eSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIC0xO1xyXG4gICAgfTtcclxuICAgIFNlcmlhbGl6YWJsZU9iamVjdFNjaGVtYS5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBwcm9wZXJ0aWVzID0gW107XHJcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgcHJvcGVydGllc1tfaV0gPSBhcmd1bWVudHNbX2ldO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BlcnRpZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuaW5kZXhPZihwcm9wZXJ0aWVzW2ldKSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX3Byb3BlcnRpZXMucHVzaChwcm9wZXJ0aWVzW2ldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBTZXJpYWxpemFibGVPYmplY3RTY2hlbWEucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgcHJvcGVydGllcyA9IFtdO1xyXG4gICAgICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgICAgIHByb3BlcnRpZXNbX2ldID0gYXJndW1lbnRzW19pXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yICh2YXIgX2EgPSAwLCBwcm9wZXJ0aWVzXzEgPSBwcm9wZXJ0aWVzOyBfYSA8IHByb3BlcnRpZXNfMS5sZW5ndGg7IF9hKyspIHtcclxuICAgICAgICAgICAgdmFyIHByb3BlcnR5XzEgPSBwcm9wZXJ0aWVzXzFbX2FdO1xyXG4gICAgICAgICAgICB3aGlsZSAodHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gdGhpcy5pbmRleE9mKHByb3BlcnR5XzEpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGluZGV4ID49IDApIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9wcm9wZXJ0aWVzLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBTZXJpYWxpemFibGVPYmplY3RTY2hlbWEucHJvdG90eXBlLmdldEl0ZW1BdCA9IGZ1bmN0aW9uIChpbmRleCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9wcm9wZXJ0aWVzW2luZGV4XTtcclxuICAgIH07XHJcbiAgICBTZXJpYWxpemFibGVPYmplY3RTY2hlbWEucHJvdG90eXBlLmdldENvdW50ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9wcm9wZXJ0aWVzLmxlbmd0aDtcclxuICAgIH07XHJcbiAgICByZXR1cm4gU2VyaWFsaXphYmxlT2JqZWN0U2NoZW1hO1xyXG59KCkpO1xyXG5leHBvcnRzLlNlcmlhbGl6YWJsZU9iamVjdFNjaGVtYSA9IFNlcmlhbGl6YWJsZU9iamVjdFNjaGVtYTtcclxuLy8gVGhpcyBpcyBhIGRlY29yYXRvciBmdW5jdGlvbiwgdXNlZCB0byBtYXAgU2VyaWFsaXphYmxlT2JqZWN0IGRlc2NlbmRhbnQgY2xhc3MgbWVtYmVycyB0b1xyXG4vLyBzY2hlbWEgcHJvcGVydGllc1xyXG5mdW5jdGlvbiBwcm9wZXJ0eShwcm9wZXJ0eSkge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQsIHByb3BlcnR5S2V5KSB7XHJcbiAgICAgICAgdmFyIGRlc2NyaXB0b3IgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwgcHJvcGVydHlLZXkpIHx8IHt9O1xyXG4gICAgICAgIGlmICghZGVzY3JpcHRvci5nZXQgJiYgIWRlc2NyaXB0b3Iuc2V0KSB7XHJcbiAgICAgICAgICAgIGRlc2NyaXB0b3IuZ2V0ID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5nZXRWYWx1ZShwcm9wZXJ0eSk7IH07XHJcbiAgICAgICAgICAgIGRlc2NyaXB0b3Iuc2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7IHRoaXMuc2V0VmFsdWUocHJvcGVydHksIHZhbHVlKTsgfTtcclxuICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgcHJvcGVydHlLZXksIGRlc2NyaXB0b3IpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn1cclxuZXhwb3J0cy5wcm9wZXJ0eSA9IHByb3BlcnR5O1xyXG52YXIgU2VyaWFsaXphYmxlT2JqZWN0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gU2VyaWFsaXphYmxlT2JqZWN0KCkge1xyXG4gICAgICAgIHRoaXMuX3Byb3BlcnR5QmFnID0ge307XHJcbiAgICAgICAgdGhpcy5fcmF3UHJvcGVydGllcyA9IHt9O1xyXG4gICAgICAgIHRoaXMubWF4VmVyc2lvbiA9IFZlcnNpb25zLmxhdGVzdDtcclxuICAgICAgICB2YXIgcyA9IHRoaXMuZ2V0U2NoZW1hKCk7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzLmdldENvdW50KCk7IGkrKykge1xyXG4gICAgICAgICAgICB2YXIgcHJvcGVydHlfMiA9IHMuZ2V0SXRlbUF0KGkpO1xyXG4gICAgICAgICAgICBpZiAocHJvcGVydHlfMi5vbkdldEluaXRpYWxWYWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRWYWx1ZShwcm9wZXJ0eV8yLCBwcm9wZXJ0eV8yLm9uR2V0SW5pdGlhbFZhbHVlKHRoaXMpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIFNlcmlhbGl6YWJsZU9iamVjdC5wcm90b3R5cGUucG9wdWxhdGVTY2hlbWEgPSBmdW5jdGlvbiAoc2NoZW1hKSB7XHJcbiAgICAgICAgdmFyIGN0b3IgPSB0aGlzLmNvbnN0cnVjdG9yO1xyXG4gICAgICAgIGZvciAodmFyIHByb3BlcnR5TmFtZSBpbiBjdG9yKSB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcHJvcGVydHlWYWx1ZSA9IGN0b3JbcHJvcGVydHlOYW1lXTtcclxuICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0eVZhbHVlIGluc3RhbmNlb2YgUHJvcGVydHlEZWZpbml0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NoZW1hLmFkZChwcm9wZXJ0eVZhbHVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXRjaCAoX2EpIHtcclxuICAgICAgICAgICAgICAgIC8vIElmIGEgcHJvcGVydHkgaGFwcGVucyB0byBoYXZlIGEgZ2V0dGVyIGZ1bmN0aW9uIGFuZFxyXG4gICAgICAgICAgICAgICAgLy8gaXQgdGhyb3dzIGFuIGV4Y2VwdGlvbiwgd2UgbmVlZCB0byBjYXRjaCBpdCBoZXJlXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKFNlcmlhbGl6YWJsZU9iamVjdC5vblJlZ2lzdGVyQ3VzdG9tUHJvcGVydGllcykge1xyXG4gICAgICAgICAgICBTZXJpYWxpemFibGVPYmplY3Qub25SZWdpc3RlckN1c3RvbVByb3BlcnRpZXModGhpcywgc2NoZW1hKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgU2VyaWFsaXphYmxlT2JqZWN0LnByb3RvdHlwZS5nZXRWYWx1ZSA9IGZ1bmN0aW9uIChwcm9wZXJ0eSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9wcm9wZXJ0eUJhZy5oYXNPd25Qcm9wZXJ0eShwcm9wZXJ0eS5nZXRJbnRlcm5hbE5hbWUoKSkgPyB0aGlzLl9wcm9wZXJ0eUJhZ1twcm9wZXJ0eS5nZXRJbnRlcm5hbE5hbWUoKV0gOiBwcm9wZXJ0eS5kZWZhdWx0VmFsdWU7XHJcbiAgICB9O1xyXG4gICAgU2VyaWFsaXphYmxlT2JqZWN0LnByb3RvdHlwZS5zZXRWYWx1ZSA9IGZ1bmN0aW9uIChwcm9wZXJ0eSwgdmFsdWUpIHtcclxuICAgICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICBkZWxldGUgdGhpcy5fcHJvcGVydHlCYWdbcHJvcGVydHkuZ2V0SW50ZXJuYWxOYW1lKCldO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5fcHJvcGVydHlCYWdbcHJvcGVydHkuZ2V0SW50ZXJuYWxOYW1lKCldID0gdmFsdWU7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFNlcmlhbGl6YWJsZU9iamVjdC5wcm90b3R5cGUuaW50ZXJuYWxQYXJzZSA9IGZ1bmN0aW9uIChzb3VyY2UsIGNvbnRleHQpIHtcclxuICAgICAgICB0aGlzLl9wcm9wZXJ0eUJhZyA9IHt9O1xyXG4gICAgICAgIHRoaXMuX3Jhd1Byb3BlcnRpZXMgPSBzaGFyZWRfMS5HbG9iYWxTZXR0aW5ncy5lbmFibGVGdWxsSnNvblJvdW5kVHJpcCA/IChzb3VyY2UgPyBzb3VyY2UgOiB7fSkgOiB7fTtcclxuICAgICAgICBpZiAoc291cmNlKSB7XHJcbiAgICAgICAgICAgIHZhciBzID0gdGhpcy5nZXRTY2hlbWEoKTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzLmdldENvdW50KCk7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHByb3BlcnR5XzMgPSBzLmdldEl0ZW1BdChpKTtcclxuICAgICAgICAgICAgICAgIHZhciBwcm9wZXJ0eVZhbHVlID0gcHJvcGVydHlfMy5vbkdldEluaXRpYWxWYWx1ZSA/IHByb3BlcnR5XzMub25HZXRJbml0aWFsVmFsdWUodGhpcykgOiB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgICAgICBpZiAoc291cmNlLmhhc093blByb3BlcnR5KHByb3BlcnR5XzMubmFtZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocHJvcGVydHlfMy50YXJnZXRWZXJzaW9uLmNvbXBhcmVUbyhjb250ZXh0LnRhcmdldFZlcnNpb24pIDw9IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlWYWx1ZSA9IHByb3BlcnR5XzMucGFyc2UodGhpcywgc291cmNlLCBjb250ZXh0KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQubG9nUGFyc2VFdmVudCgxNCAvKiBVbnN1cHBvcnRlZFByb3BlcnR5ICovLCBcIlByb3BlcnR5IFxcXCJcIiArIHByb3BlcnR5XzMubmFtZSArIFwiXFxcIiBpcyBzdXBwb3J0ZWQgaW4gdmVyc2lvbiBcIiArIHByb3BlcnR5XzMudGFyZ2V0VmVyc2lvbi50b1N0cmluZygpICsgXCIsIGJ1dCB5b3UgYXJlIHVzaW5nIHZlcnNpb24gXCIgKyBjb250ZXh0LnRhcmdldFZlcnNpb24udG9TdHJpbmcoKSwgdGhpcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRWYWx1ZShwcm9wZXJ0eV8zLCBwcm9wZXJ0eVZhbHVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5yZXNldERlZmF1bHRWYWx1ZXMoKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgU2VyaWFsaXphYmxlT2JqZWN0LnByb3RvdHlwZS5pbnRlcm5hbFRvSlNPTiA9IGZ1bmN0aW9uICh0YXJnZXQsIGNvbnRleHQpIHtcclxuICAgICAgICB2YXIgcyA9IHRoaXMuZ2V0U2NoZW1hKCk7XHJcbiAgICAgICAgdmFyIHNlcmlhbGl6ZWRQcm9wZXJ0aWVzID0gW107XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzLmdldENvdW50KCk7IGkrKykge1xyXG4gICAgICAgICAgICB2YXIgcHJvcGVydHlfNCA9IHMuZ2V0SXRlbUF0KGkpO1xyXG4gICAgICAgICAgICAvLyBBdm9pZCBzZXJpYWxpemluZyB0aGUgc2FtZSBwcm9wZXJ0eSBtdWx0aXBsZSB0aW1lcy4gVGhpcyBpcyBuZWNlc3NhcnlcclxuICAgICAgICAgICAgLy8gYmVjYXVzZSBzb21lIHByb3BlcnR5IGRlZmluaXRpb25zIG1hcCB0byB0aGUgc2FtZSB1bmRlcmx5aW5nIHNjaGVtYVxyXG4gICAgICAgICAgICAvLyBwcm9wZXJ0eVxyXG4gICAgICAgICAgICBpZiAocHJvcGVydHlfNC50YXJnZXRWZXJzaW9uLmNvbXBhcmVUbyhjb250ZXh0LnRhcmdldFZlcnNpb24pIDw9IDAgJiYgc2VyaWFsaXplZFByb3BlcnRpZXMuaW5kZXhPZihwcm9wZXJ0eV80Lm5hbWUpID09PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgcHJvcGVydHlfNC50b0pTT04odGhpcywgdGFyZ2V0LCB0aGlzLmdldFZhbHVlKHByb3BlcnR5XzQpLCBjb250ZXh0KTtcclxuICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWRQcm9wZXJ0aWVzLnB1c2gocHJvcGVydHlfNC5uYW1lKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBTZXJpYWxpemFibGVPYmplY3QucHJvdG90eXBlLnBhcnNlID0gZnVuY3Rpb24gKHNvdXJjZSwgY29udGV4dCkge1xyXG4gICAgICAgIHRoaXMuaW50ZXJuYWxQYXJzZShzb3VyY2UsIGNvbnRleHQgPyBjb250ZXh0IDogbmV3IFNpbXBsZVNlcmlhbGl6YXRpb25Db250ZXh0KCkpO1xyXG4gICAgfTtcclxuICAgIFNlcmlhbGl6YWJsZU9iamVjdC5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gKGNvbnRleHQpIHtcclxuICAgICAgICB2YXIgZWZmZWN0aXZlQ29udGV4dCA9IGNvbnRleHQgPyBjb250ZXh0IDogbmV3IFNpbXBsZVNlcmlhbGl6YXRpb25Db250ZXh0KCk7XHJcbiAgICAgICAgaWYgKGVmZmVjdGl2ZUNvbnRleHQuc2hvdWxkU2VyaWFsaXplKHRoaXMpKSB7XHJcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSB2b2lkIDA7XHJcbiAgICAgICAgICAgIGlmIChzaGFyZWRfMS5HbG9iYWxTZXR0aW5ncy5lbmFibGVGdWxsSnNvblJvdW5kVHJpcCAmJiB0aGlzLl9yYXdQcm9wZXJ0aWVzICYmIHR5cGVvZiB0aGlzLl9yYXdQcm9wZXJ0aWVzID09PSBcIm9iamVjdFwiKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgPSB0aGlzLl9yYXdQcm9wZXJ0aWVzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID0ge307XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5pbnRlcm5hbFRvSlNPTihyZXN1bHQsIGVmZmVjdGl2ZUNvbnRleHQpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgU2VyaWFsaXphYmxlT2JqZWN0LnByb3RvdHlwZS5oYXNEZWZhdWx0VmFsdWUgPSBmdW5jdGlvbiAocHJvcGVydHkpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRWYWx1ZShwcm9wZXJ0eSkgPT09IHByb3BlcnR5LmRlZmF1bHRWYWx1ZTtcclxuICAgIH07XHJcbiAgICBTZXJpYWxpemFibGVPYmplY3QucHJvdG90eXBlLmhhc0FsbERlZmF1bHRWYWx1ZXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHMgPSB0aGlzLmdldFNjaGVtYSgpO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcy5nZXRDb3VudCgpOyBpKyspIHtcclxuICAgICAgICAgICAgdmFyIHByb3BlcnR5XzUgPSBzLmdldEl0ZW1BdChpKTtcclxuICAgICAgICAgICAgaWYgKCF0aGlzLmhhc0RlZmF1bHRWYWx1ZShwcm9wZXJ0eV81KSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfTtcclxuICAgIFNlcmlhbGl6YWJsZU9iamVjdC5wcm90b3R5cGUucmVzZXREZWZhdWx0VmFsdWVzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBzID0gdGhpcy5nZXRTY2hlbWEoKTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHMuZ2V0Q291bnQoKTsgaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciBwcm9wZXJ0eV82ID0gcy5nZXRJdGVtQXQoaSk7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0VmFsdWUocHJvcGVydHlfNiwgcHJvcGVydHlfNi5kZWZhdWx0VmFsdWUpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBTZXJpYWxpemFibGVPYmplY3QucHJvdG90eXBlLnNldEN1c3RvbVByb3BlcnR5ID0gZnVuY3Rpb24gKG5hbWUsIHZhbHVlKSB7XHJcbiAgICAgICAgdmFyIHNob3VsZERlbGV0ZVByb3BlcnR5ID0gKHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIiAmJiAhdmFsdWUpIHx8IHZhbHVlID09PSB1bmRlZmluZWQgfHwgdmFsdWUgPT09IG51bGw7XHJcbiAgICAgICAgaWYgKHNob3VsZERlbGV0ZVByb3BlcnR5KSB7XHJcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9yYXdQcm9wZXJ0aWVzW25hbWVdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5fcmF3UHJvcGVydGllc1tuYW1lXSA9IHZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBTZXJpYWxpemFibGVPYmplY3QucHJvdG90eXBlLmdldEN1c3RvbVByb3BlcnR5ID0gZnVuY3Rpb24gKG5hbWUpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fcmF3UHJvcGVydGllc1tuYW1lXTtcclxuICAgIH07XHJcbiAgICBTZXJpYWxpemFibGVPYmplY3QucHJvdG90eXBlLmdldFNjaGVtYSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgc2NoZW1hID0gU2VyaWFsaXphYmxlT2JqZWN0Ll9zY2hlbWFDYWNoZVt0aGlzLmdldFNjaGVtYUtleSgpXTtcclxuICAgICAgICBpZiAoIXNjaGVtYSkge1xyXG4gICAgICAgICAgICBzY2hlbWEgPSBuZXcgU2VyaWFsaXphYmxlT2JqZWN0U2NoZW1hKCk7XHJcbiAgICAgICAgICAgIHRoaXMucG9wdWxhdGVTY2hlbWEoc2NoZW1hKTtcclxuICAgICAgICAgICAgU2VyaWFsaXphYmxlT2JqZWN0Ll9zY2hlbWFDYWNoZVt0aGlzLmdldFNjaGVtYUtleSgpXSA9IHNjaGVtYTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHNjaGVtYTtcclxuICAgIH07XHJcbiAgICBTZXJpYWxpemFibGVPYmplY3QuX3NjaGVtYUNhY2hlID0ge307XHJcbiAgICByZXR1cm4gU2VyaWFsaXphYmxlT2JqZWN0O1xyXG59KCkpO1xyXG5leHBvcnRzLlNlcmlhbGl6YWJsZU9iamVjdCA9IFNlcmlhbGl6YWJsZU9iamVjdDtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9c2VyaWFsaXphdGlvbi5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG4vLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG52YXIgRW51bXMgPSByZXF1aXJlKFwiLi9lbnVtc1wiKTtcclxudmFyIEdsb2JhbFNldHRpbmdzID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gR2xvYmFsU2V0dGluZ3MoKSB7XHJcbiAgICB9XHJcbiAgICBHbG9iYWxTZXR0aW5ncy51c2VBZHZhbmNlZFRleHRCbG9ja1RydW5jYXRpb24gPSB0cnVlO1xyXG4gICAgR2xvYmFsU2V0dGluZ3MudXNlQWR2YW5jZWRDYXJkQm90dG9tVHJ1bmNhdGlvbiA9IGZhbHNlO1xyXG4gICAgR2xvYmFsU2V0dGluZ3MudXNlTWFya2Rvd25JblJhZGlvQnV0dG9uQW5kQ2hlY2tib3ggPSB0cnVlO1xyXG4gICAgR2xvYmFsU2V0dGluZ3MuYWxsb3dNYXJrRm9yVGV4dEhpZ2hsaWdodGluZyA9IGZhbHNlO1xyXG4gICAgR2xvYmFsU2V0dGluZ3MuYWx3YXlzQmxlZWRTZXBhcmF0b3JzID0gZmFsc2U7XHJcbiAgICBHbG9iYWxTZXR0aW5ncy5lbmFibGVGdWxsSnNvblJvdW5kVHJpcCA9IGZhbHNlO1xyXG4gICAgR2xvYmFsU2V0dGluZ3MudXNlQnVpbHRJbklucHV0VmFsaWRhdGlvbiA9IHRydWU7XHJcbiAgICBHbG9iYWxTZXR0aW5ncy5kaXNwbGF5SW5wdXRWYWxpZGF0aW9uRXJyb3JzID0gdHJ1ZTtcclxuICAgIEdsb2JhbFNldHRpbmdzLmFsbG93UHJlUHJvY2Vzc2luZ1Byb3BlcnR5VmFsdWVzID0gZmFsc2U7XHJcbiAgICByZXR1cm4gR2xvYmFsU2V0dGluZ3M7XHJcbn0oKSk7XHJcbmV4cG9ydHMuR2xvYmFsU2V0dGluZ3MgPSBHbG9iYWxTZXR0aW5ncztcclxuZXhwb3J0cy5Db250ZW50VHlwZXMgPSB7XHJcbiAgICBhcHBsaWNhdGlvbkpzb246IFwiYXBwbGljYXRpb24vanNvblwiLFxyXG4gICAgYXBwbGljYXRpb25YV3d3Rm9ybVVybGVuY29kZWQ6IFwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCJcclxufTtcclxudmFyIFN0cmluZ1dpdGhTdWJzdGl0dXRpb25zID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gU3RyaW5nV2l0aFN1YnN0aXR1dGlvbnMoKSB7XHJcbiAgICAgICAgdGhpcy5faXNQcm9jZXNzZWQgPSBmYWxzZTtcclxuICAgIH1cclxuICAgIFN0cmluZ1dpdGhTdWJzdGl0dXRpb25zLnByb3RvdHlwZS5nZXRSZWZlcmVuY2VkSW5wdXRzID0gZnVuY3Rpb24gKGlucHV0cywgcmVmZXJlbmNlZElucHV0cykge1xyXG4gICAgICAgIGlmICghcmVmZXJlbmNlZElucHV0cykge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGUgcmVmZXJlbmNlZElucHV0cyBwYXJhbWV0ZXIgY2Fubm90IGJlIG51bGwuXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKHZhciBfaSA9IDAsIGlucHV0c18xID0gaW5wdXRzOyBfaSA8IGlucHV0c18xLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgICAgICB2YXIgaW5wdXQgPSBpbnB1dHNfMVtfaV07XHJcbiAgICAgICAgICAgIHZhciBtYXRjaGVzID0gbmV3IFJlZ0V4cChcIlxcXFx7ezJ9KFwiICsgaW5wdXQuaWQgKyBcIikudmFsdWVcXFxcfXsyfVwiLCBcImdpXCIpLmV4ZWModGhpcy5fb3JpZ2luYWwpO1xyXG4gICAgICAgICAgICBpZiAobWF0Y2hlcyAhPSBudWxsICYmIGlucHV0LmlkKSB7XHJcbiAgICAgICAgICAgICAgICByZWZlcmVuY2VkSW5wdXRzW2lucHV0LmlkXSA9IGlucHV0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFN0cmluZ1dpdGhTdWJzdGl0dXRpb25zLnByb3RvdHlwZS5zdWJzdGl0dXRlSW5wdXRWYWx1ZXMgPSBmdW5jdGlvbiAoaW5wdXRzLCBjb250ZW50VHlwZSkge1xyXG4gICAgICAgIHRoaXMuX3Byb2Nlc3NlZCA9IHRoaXMuX29yaWdpbmFsO1xyXG4gICAgICAgIGlmICh0aGlzLl9vcmlnaW5hbCkge1xyXG4gICAgICAgICAgICB2YXIgcmVnRXggPSAvXFx7ezJ9KFthLXowLTlfJEBdKykudmFsdWVcXH17Mn0vZ2k7XHJcbiAgICAgICAgICAgIHZhciBtYXRjaGVzID0gdm9pZCAwO1xyXG4gICAgICAgICAgICB3aGlsZSAoKG1hdGNoZXMgPSByZWdFeC5leGVjKHRoaXMuX29yaWdpbmFsKSkgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSBPYmplY3Qua2V5cyhpbnB1dHMpOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBrZXkgPSBfYVtfaV07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGtleS50b0xvd2VyQ2FzZSgpID09IG1hdGNoZXNbMV0udG9Mb3dlckNhc2UoKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWF0Y2hlZElucHV0ID0gaW5wdXRzW2tleV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZUZvclJlcGxhY2UgPSBcIlwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobWF0Y2hlZElucHV0LnZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZUZvclJlcGxhY2UgPSBtYXRjaGVkSW5wdXQudmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRlbnRUeXBlID09PSBleHBvcnRzLkNvbnRlbnRUeXBlcy5hcHBsaWNhdGlvbkpzb24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlRm9yUmVwbGFjZSA9IEpTT04uc3RyaW5naWZ5KHZhbHVlRm9yUmVwbGFjZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZUZvclJlcGxhY2UgPSB2YWx1ZUZvclJlcGxhY2Uuc2xpY2UoMSwgLTEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNvbnRlbnRUeXBlID09PSBleHBvcnRzLkNvbnRlbnRUeXBlcy5hcHBsaWNhdGlvblhXd3dGb3JtVXJsZW5jb2RlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVGb3JSZXBsYWNlID0gZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlRm9yUmVwbGFjZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcHJvY2Vzc2VkID0gdGhpcy5fcHJvY2Vzc2VkLnJlcGxhY2UobWF0Y2hlc1swXSwgdmFsdWVGb3JSZXBsYWNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX2lzUHJvY2Vzc2VkID0gdHJ1ZTtcclxuICAgIH07XHJcbiAgICBTdHJpbmdXaXRoU3Vic3RpdHV0aW9ucy5wcm90b3R5cGUuZ2V0T3JpZ2luYWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX29yaWdpbmFsO1xyXG4gICAgfTtcclxuICAgIFN0cmluZ1dpdGhTdWJzdGl0dXRpb25zLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLl9pc1Byb2Nlc3NlZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fb3JpZ2luYWw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fcHJvY2Vzc2VkO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBTdHJpbmdXaXRoU3Vic3RpdHV0aW9ucy5wcm90b3R5cGUuc2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy5fb3JpZ2luYWwgPSB2YWx1ZTtcclxuICAgICAgICB0aGlzLl9pc1Byb2Nlc3NlZCA9IGZhbHNlO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBTdHJpbmdXaXRoU3Vic3RpdHV0aW9ucztcclxufSgpKTtcclxuZXhwb3J0cy5TdHJpbmdXaXRoU3Vic3RpdHV0aW9ucyA9IFN0cmluZ1dpdGhTdWJzdGl0dXRpb25zO1xyXG52YXIgU3BhY2luZ0RlZmluaXRpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBTcGFjaW5nRGVmaW5pdGlvbih0b3AsIHJpZ2h0LCBib3R0b20sIGxlZnQpIHtcclxuICAgICAgICBpZiAodG9wID09PSB2b2lkIDApIHsgdG9wID0gMDsgfVxyXG4gICAgICAgIGlmIChyaWdodCA9PT0gdm9pZCAwKSB7IHJpZ2h0ID0gMDsgfVxyXG4gICAgICAgIGlmIChib3R0b20gPT09IHZvaWQgMCkgeyBib3R0b20gPSAwOyB9XHJcbiAgICAgICAgaWYgKGxlZnQgPT09IHZvaWQgMCkgeyBsZWZ0ID0gMDsgfVxyXG4gICAgICAgIHRoaXMubGVmdCA9IDA7XHJcbiAgICAgICAgdGhpcy50b3AgPSAwO1xyXG4gICAgICAgIHRoaXMucmlnaHQgPSAwO1xyXG4gICAgICAgIHRoaXMuYm90dG9tID0gMDtcclxuICAgICAgICB0aGlzLnRvcCA9IHRvcDtcclxuICAgICAgICB0aGlzLnJpZ2h0ID0gcmlnaHQ7XHJcbiAgICAgICAgdGhpcy5ib3R0b20gPSBib3R0b207XHJcbiAgICAgICAgdGhpcy5sZWZ0ID0gbGVmdDtcclxuICAgIH1cclxuICAgIHJldHVybiBTcGFjaW5nRGVmaW5pdGlvbjtcclxufSgpKTtcclxuZXhwb3J0cy5TcGFjaW5nRGVmaW5pdGlvbiA9IFNwYWNpbmdEZWZpbml0aW9uO1xyXG52YXIgUGFkZGluZ0RlZmluaXRpb24gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBQYWRkaW5nRGVmaW5pdGlvbih0b3AsIHJpZ2h0LCBib3R0b20sIGxlZnQpIHtcclxuICAgICAgICBpZiAodG9wID09PSB2b2lkIDApIHsgdG9wID0gRW51bXMuU3BhY2luZy5Ob25lOyB9XHJcbiAgICAgICAgaWYgKHJpZ2h0ID09PSB2b2lkIDApIHsgcmlnaHQgPSBFbnVtcy5TcGFjaW5nLk5vbmU7IH1cclxuICAgICAgICBpZiAoYm90dG9tID09PSB2b2lkIDApIHsgYm90dG9tID0gRW51bXMuU3BhY2luZy5Ob25lOyB9XHJcbiAgICAgICAgaWYgKGxlZnQgPT09IHZvaWQgMCkgeyBsZWZ0ID0gRW51bXMuU3BhY2luZy5Ob25lOyB9XHJcbiAgICAgICAgdGhpcy50b3AgPSBFbnVtcy5TcGFjaW5nLk5vbmU7XHJcbiAgICAgICAgdGhpcy5yaWdodCA9IEVudW1zLlNwYWNpbmcuTm9uZTtcclxuICAgICAgICB0aGlzLmJvdHRvbSA9IEVudW1zLlNwYWNpbmcuTm9uZTtcclxuICAgICAgICB0aGlzLmxlZnQgPSBFbnVtcy5TcGFjaW5nLk5vbmU7XHJcbiAgICAgICAgdGhpcy50b3AgPSB0b3A7XHJcbiAgICAgICAgdGhpcy5yaWdodCA9IHJpZ2h0O1xyXG4gICAgICAgIHRoaXMuYm90dG9tID0gYm90dG9tO1xyXG4gICAgICAgIHRoaXMubGVmdCA9IGxlZnQ7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gUGFkZGluZ0RlZmluaXRpb247XHJcbn0oKSk7XHJcbmV4cG9ydHMuUGFkZGluZ0RlZmluaXRpb24gPSBQYWRkaW5nRGVmaW5pdGlvbjtcclxudmFyIFNpemVBbmRVbml0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gU2l6ZUFuZFVuaXQocGh5c2ljYWxTaXplLCB1bml0KSB7XHJcbiAgICAgICAgdGhpcy5waHlzaWNhbFNpemUgPSBwaHlzaWNhbFNpemU7XHJcbiAgICAgICAgdGhpcy51bml0ID0gdW5pdDtcclxuICAgIH1cclxuICAgIFNpemVBbmRVbml0LnBhcnNlID0gZnVuY3Rpb24gKGlucHV0LCByZXF1aXJlVW5pdFNwZWNpZmllcikge1xyXG4gICAgICAgIGlmIChyZXF1aXJlVW5pdFNwZWNpZmllciA9PT0gdm9pZCAwKSB7IHJlcXVpcmVVbml0U3BlY2lmaWVyID0gZmFsc2U7IH1cclxuICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IFNpemVBbmRVbml0KDAsIEVudW1zLlNpemVVbml0LldlaWdodCk7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBpbnB1dCA9PT0gXCJudW1iZXJcIikge1xyXG4gICAgICAgICAgICByZXN1bHQucGh5c2ljYWxTaXplID0gaW5wdXQ7XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHR5cGVvZiBpbnB1dCA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICB2YXIgcmVnRXhwID0gL14oWzAtOV0rKShweHxcXCopPyQvZztcclxuICAgICAgICAgICAgdmFyIG1hdGNoZXMgPSByZWdFeHAuZXhlYyhpbnB1dCk7XHJcbiAgICAgICAgICAgIHZhciBleHBlY3RlZE1hdGNoQ291bnQgPSByZXF1aXJlVW5pdFNwZWNpZmllciA/IDMgOiAyO1xyXG4gICAgICAgICAgICBpZiAobWF0Y2hlcyAmJiBtYXRjaGVzLmxlbmd0aCA+PSBleHBlY3RlZE1hdGNoQ291bnQpIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5waHlzaWNhbFNpemUgPSBwYXJzZUludChtYXRjaGVzWzFdKTtcclxuICAgICAgICAgICAgICAgIGlmIChtYXRjaGVzLmxlbmd0aCA9PSAzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGNoZXNbMl0gPT0gXCJweFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC51bml0ID0gRW51bXMuU2l6ZVVuaXQuUGl4ZWw7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHNpemU6IFwiICsgaW5wdXQpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBTaXplQW5kVW5pdDtcclxufSgpKTtcclxuZXhwb3J0cy5TaXplQW5kVW5pdCA9IFNpemVBbmRVbml0O1xyXG4vKipcclxuICogRmFzdCBVVUlEIGdlbmVyYXRvciwgUkZDNDEyMiB2ZXJzaW9uIDQgY29tcGxpYW50LlxyXG4gKiBAYXV0aG9yIEplZmYgV2FyZCAoamN3YXJkLmNvbSkuXHJcbiAqIEBsaWNlbnNlIE1JVCBsaWNlbnNlXHJcbiAqIEBsaW5rIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTA1MDM0L2hvdy10by1jcmVhdGUtYS1ndWlkLXV1aWQtaW4tamF2YXNjcmlwdC8yMTk2MzEzNiMyMTk2MzEzNlxyXG4gKiovXHJcbnZhciBVVUlEID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gVVVJRCgpIHtcclxuICAgIH1cclxuICAgIFVVSUQuZ2VuZXJhdGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGQwID0gTWF0aC5yYW5kb20oKSAqIDB4ZmZmZmZmZmYgfCAwO1xyXG4gICAgICAgIHZhciBkMSA9IE1hdGgucmFuZG9tKCkgKiAweGZmZmZmZmZmIHwgMDtcclxuICAgICAgICB2YXIgZDIgPSBNYXRoLnJhbmRvbSgpICogMHhmZmZmZmZmZiB8IDA7XHJcbiAgICAgICAgdmFyIGQzID0gTWF0aC5yYW5kb20oKSAqIDB4ZmZmZmZmZmYgfCAwO1xyXG4gICAgICAgIHJldHVybiBVVUlELmx1dFtkMCAmIDB4ZmZdICsgVVVJRC5sdXRbZDAgPj4gOCAmIDB4ZmZdICsgVVVJRC5sdXRbZDAgPj4gMTYgJiAweGZmXSArIFVVSUQubHV0W2QwID4+IDI0ICYgMHhmZl0gKyAnLScgK1xyXG4gICAgICAgICAgICBVVUlELmx1dFtkMSAmIDB4ZmZdICsgVVVJRC5sdXRbZDEgPj4gOCAmIDB4ZmZdICsgJy0nICsgVVVJRC5sdXRbZDEgPj4gMTYgJiAweDBmIHwgMHg0MF0gKyBVVUlELmx1dFtkMSA+PiAyNCAmIDB4ZmZdICsgJy0nICtcclxuICAgICAgICAgICAgVVVJRC5sdXRbZDIgJiAweDNmIHwgMHg4MF0gKyBVVUlELmx1dFtkMiA+PiA4ICYgMHhmZl0gKyAnLScgKyBVVUlELmx1dFtkMiA+PiAxNiAmIDB4ZmZdICsgVVVJRC5sdXRbZDIgPj4gMjQgJiAweGZmXSArXHJcbiAgICAgICAgICAgIFVVSUQubHV0W2QzICYgMHhmZl0gKyBVVUlELmx1dFtkMyA+PiA4ICYgMHhmZl0gKyBVVUlELmx1dFtkMyA+PiAxNiAmIDB4ZmZdICsgVVVJRC5sdXRbZDMgPj4gMjQgJiAweGZmXTtcclxuICAgIH07XHJcbiAgICBVVUlELmluaXRpYWxpemUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAyNTY7IGkrKykge1xyXG4gICAgICAgICAgICBVVUlELmx1dFtpXSA9IChpIDwgMTYgPyAnMCcgOiAnJykgKyBpLnRvU3RyaW5nKDE2KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgVVVJRC5sdXQgPSBbXTtcclxuICAgIHJldHVybiBVVUlEO1xyXG59KCkpO1xyXG5leHBvcnRzLlVVSUQgPSBVVUlEO1xyXG5VVUlELmluaXRpYWxpemUoKTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9c2hhcmVkLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xyXG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XHJcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxyXG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xyXG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xyXG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XHJcbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xyXG4gICAgfTtcclxufSkoKTtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG4vLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG52YXIgQWJzdHJhY3RUZXh0Rm9ybWF0dGVyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQWJzdHJhY3RUZXh0Rm9ybWF0dGVyKHJlZ3VsYXJFeHByZXNzaW9uKSB7XHJcbiAgICAgICAgdGhpcy5fcmVndWxhckV4cHJlc3Npb24gPSByZWd1bGFyRXhwcmVzc2lvbjtcclxuICAgIH1cclxuICAgIEFic3RyYWN0VGV4dEZvcm1hdHRlci5wcm90b3R5cGUuZm9ybWF0ID0gZnVuY3Rpb24gKGxhbmcsIGlucHV0KSB7XHJcbiAgICAgICAgdmFyIG1hdGNoZXM7XHJcbiAgICAgICAgaWYgKGlucHV0KSB7XHJcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBpbnB1dDtcclxuICAgICAgICAgICAgd2hpbGUgKChtYXRjaGVzID0gdGhpcy5fcmVndWxhckV4cHJlc3Npb24uZXhlYyhpbnB1dCkpICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdC5yZXBsYWNlKG1hdGNoZXNbMF0sIHRoaXMuaW50ZXJuYWxGb3JtYXQobGFuZywgbWF0Y2hlcykpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIDtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBpbnB1dDtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIEFic3RyYWN0VGV4dEZvcm1hdHRlcjtcclxufSgpKTtcclxudmFyIERhdGVGb3JtYXR0ZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoRGF0ZUZvcm1hdHRlciwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIERhdGVGb3JtYXR0ZXIoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgRGF0ZUZvcm1hdHRlci5wcm90b3R5cGUuaW50ZXJuYWxGb3JtYXQgPSBmdW5jdGlvbiAobGFuZywgbWF0Y2hlcykge1xyXG4gICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoRGF0ZS5wYXJzZShtYXRjaGVzWzFdKSk7XHJcbiAgICAgICAgdmFyIGZvcm1hdCA9IG1hdGNoZXNbMl0gIT0gdW5kZWZpbmVkID8gbWF0Y2hlc1syXS50b0xvd2VyQ2FzZSgpIDogXCJjb21wYWN0XCI7XHJcbiAgICAgICAgaWYgKGZvcm1hdCAhPSBcImNvbXBhY3RcIikge1xyXG4gICAgICAgICAgICByZXR1cm4gZGF0ZS50b0xvY2FsZURhdGVTdHJpbmcobGFuZywgeyBkYXk6IFwibnVtZXJpY1wiLCB3ZWVrZGF5OiBmb3JtYXQsIG1vbnRoOiBmb3JtYXQsIHllYXI6IFwibnVtZXJpY1wiIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGUudG9Mb2NhbGVEYXRlU3RyaW5nKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIHJldHVybiBEYXRlRm9ybWF0dGVyO1xyXG59KEFic3RyYWN0VGV4dEZvcm1hdHRlcikpO1xyXG52YXIgVGltZUZvcm1hdHRlciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhUaW1lRm9ybWF0dGVyLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gVGltZUZvcm1hdHRlcigpIHtcclxuICAgICAgICByZXR1cm4gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XHJcbiAgICB9XHJcbiAgICBUaW1lRm9ybWF0dGVyLnByb3RvdHlwZS5pbnRlcm5hbEZvcm1hdCA9IGZ1bmN0aW9uIChsYW5nLCBtYXRjaGVzKSB7XHJcbiAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZShEYXRlLnBhcnNlKG1hdGNoZXNbMV0pKTtcclxuICAgICAgICByZXR1cm4gZGF0ZS50b0xvY2FsZVRpbWVTdHJpbmcobGFuZywgeyBob3VyOiAnbnVtZXJpYycsIG1pbnV0ZTogJzItZGlnaXQnIH0pO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBUaW1lRm9ybWF0dGVyO1xyXG59KEFic3RyYWN0VGV4dEZvcm1hdHRlcikpO1xyXG5mdW5jdGlvbiBmb3JtYXRUZXh0KGxhbmcsIHRleHQpIHtcclxuICAgIHZhciBmb3JtYXR0ZXJzID0gW1xyXG4gICAgICAgIG5ldyBEYXRlRm9ybWF0dGVyKC9cXHt7Mn1EQVRFXFwoKFxcZHs0fS1cXGR7Mn0tXFxkezJ9VFxcZHsyfTpcXGR7Mn06XFxkezJ9KD86WnwoPzooPzotfFxcKylcXGR7Mn06XFxkezJ9KSkpKD86LCA/KENPTVBBQ1R8TE9OR3xTSE9SVCkpP1xcKVxcfXsyfS9nKSxcclxuICAgICAgICBuZXcgVGltZUZvcm1hdHRlcigvXFx7ezJ9VElNRVxcKChcXGR7NH0tXFxkezJ9LVxcZHsyfVRcXGR7Mn06XFxkezJ9OlxcZHsyfSg/Olp8KD86KD86LXxcXCspXFxkezJ9OlxcZHsyfSkpKVxcKVxcfXsyfS9nKVxyXG4gICAgXTtcclxuICAgIHZhciByZXN1bHQgPSB0ZXh0O1xyXG4gICAgZm9yICh2YXIgX2kgPSAwLCBmb3JtYXR0ZXJzXzEgPSBmb3JtYXR0ZXJzOyBfaSA8IGZvcm1hdHRlcnNfMS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICB2YXIgZm9ybWF0dGVyID0gZm9ybWF0dGVyc18xW19pXTtcclxuICAgICAgICByZXN1bHQgPSBmb3JtYXR0ZXIuZm9ybWF0KGxhbmcsIHJlc3VsdCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG59XHJcbmV4cG9ydHMuZm9ybWF0VGV4dCA9IGZvcm1hdFRleHQ7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXRleHQtZm9ybWF0dGVycy5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG4vLyBDb3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuLy8gTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLlxyXG52YXIgRW51bXMgPSByZXF1aXJlKFwiLi9lbnVtc1wiKTtcclxudmFyIFNoYXJlZCA9IHJlcXVpcmUoXCIuL3NoYXJlZFwiKTtcclxuZnVuY3Rpb24gZ2VuZXJhdGVVbmlxdWVJZCgpIHtcclxuICAgIHJldHVybiBcIl9fYWMtXCIgKyBTaGFyZWQuVVVJRC5nZW5lcmF0ZSgpO1xyXG59XHJcbmV4cG9ydHMuZ2VuZXJhdGVVbmlxdWVJZCA9IGdlbmVyYXRlVW5pcXVlSWQ7XHJcbmZ1bmN0aW9uIGFwcGVuZENoaWxkKG5vZGUsIGNoaWxkKSB7XHJcbiAgICBpZiAoY2hpbGQpIHtcclxuICAgICAgICBub2RlLmFwcGVuZENoaWxkKGNoaWxkKTtcclxuICAgIH1cclxufVxyXG5leHBvcnRzLmFwcGVuZENoaWxkID0gYXBwZW5kQ2hpbGQ7XHJcbmZ1bmN0aW9uIHBhcnNlU3RyaW5nKG9iaiwgZGVmYXVsdFZhbHVlKSB7XHJcbiAgICByZXR1cm4gdHlwZW9mIG9iaiA9PT0gXCJzdHJpbmdcIiA/IG9iaiA6IGRlZmF1bHRWYWx1ZTtcclxufVxyXG5leHBvcnRzLnBhcnNlU3RyaW5nID0gcGFyc2VTdHJpbmc7XHJcbmZ1bmN0aW9uIHBhcnNlTnVtYmVyKG9iaiwgZGVmYXVsdFZhbHVlKSB7XHJcbiAgICByZXR1cm4gdHlwZW9mIG9iaiA9PT0gXCJudW1iZXJcIiA/IG9iaiA6IGRlZmF1bHRWYWx1ZTtcclxufVxyXG5leHBvcnRzLnBhcnNlTnVtYmVyID0gcGFyc2VOdW1iZXI7XHJcbmZ1bmN0aW9uIHBhcnNlQm9vbCh2YWx1ZSwgZGVmYXVsdFZhbHVlKSB7XHJcbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSBcImJvb2xlYW5cIikge1xyXG4gICAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgIHN3aXRjaCAodmFsdWUudG9Mb3dlckNhc2UoKSkge1xyXG4gICAgICAgICAgICBjYXNlIFwidHJ1ZVwiOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIGNhc2UgXCJmYWxzZVwiOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRWYWx1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZGVmYXVsdFZhbHVlO1xyXG59XHJcbmV4cG9ydHMucGFyc2VCb29sID0gcGFyc2VCb29sO1xyXG5mdW5jdGlvbiBnZXRFbnVtVmFsdWVCeU5hbWUoZW51bVR5cGUsIG5hbWUpIHtcclxuICAgIGZvciAodmFyIGtleSBpbiBlbnVtVHlwZSkge1xyXG4gICAgICAgIHZhciBrZXlBc051bWJlciA9IHBhcnNlSW50KGtleSwgMTApO1xyXG4gICAgICAgIGlmIChrZXlBc051bWJlciA+PSAwKSB7XHJcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGVudW1UeXBlW2tleV07XHJcbiAgICAgICAgICAgIGlmICh2YWx1ZSAmJiB0eXBlb2YgdmFsdWUgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUudG9Mb3dlckNhc2UoKSA9PT0gbmFtZS50b0xvd2VyQ2FzZSgpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ga2V5QXNOdW1iZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG59XHJcbmV4cG9ydHMuZ2V0RW51bVZhbHVlQnlOYW1lID0gZ2V0RW51bVZhbHVlQnlOYW1lO1xyXG5mdW5jdGlvbiBwYXJzZUVudW0oZW51bVR5cGUsIG5hbWUsIGRlZmF1bHRWYWx1ZSkge1xyXG4gICAgaWYgKCFuYW1lKSB7XHJcbiAgICAgICAgcmV0dXJuIGRlZmF1bHRWYWx1ZTtcclxuICAgIH1cclxuICAgIHZhciBlbnVtVmFsdWUgPSBnZXRFbnVtVmFsdWVCeU5hbWUoZW51bVR5cGUsIG5hbWUpO1xyXG4gICAgcmV0dXJuIGVudW1WYWx1ZSAhPT0gdW5kZWZpbmVkID8gZW51bVZhbHVlIDogZGVmYXVsdFZhbHVlO1xyXG59XHJcbmV4cG9ydHMucGFyc2VFbnVtID0gcGFyc2VFbnVtO1xyXG5mdW5jdGlvbiByZW5kZXJTZXBhcmF0aW9uKGhvc3RDb25maWcsIHNlcGFyYXRpb25EZWZpbml0aW9uLCBvcmllbnRhdGlvbikge1xyXG4gICAgaWYgKHNlcGFyYXRpb25EZWZpbml0aW9uLnNwYWNpbmcgPiAwIHx8IChzZXBhcmF0aW9uRGVmaW5pdGlvbi5saW5lVGhpY2tuZXNzICYmIHNlcGFyYXRpb25EZWZpbml0aW9uLmxpbmVUaGlja25lc3MgPiAwKSkge1xyXG4gICAgICAgIHZhciBzZXBhcmF0b3IgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgIHNlcGFyYXRvci5jbGFzc05hbWUgPSBob3N0Q29uZmlnLm1ha2VDc3NDbGFzc05hbWUoXCJhYy1cIiArIChvcmllbnRhdGlvbiA9PSBFbnVtcy5PcmllbnRhdGlvbi5Ib3Jpem9udGFsID8gXCJob3Jpem9udGFsXCIgOiBcInZlcnRpY2FsXCIpICsgXCItc2VwYXJhdG9yXCIpO1xyXG4gICAgICAgIHZhciBjb2xvciA9IHNlcGFyYXRpb25EZWZpbml0aW9uLmxpbmVDb2xvciA/IHN0cmluZ1RvQ3NzQ29sb3Ioc2VwYXJhdGlvbkRlZmluaXRpb24ubGluZUNvbG9yKSA6IFwiXCI7XHJcbiAgICAgICAgaWYgKG9yaWVudGF0aW9uID09IEVudW1zLk9yaWVudGF0aW9uLkhvcml6b250YWwpIHtcclxuICAgICAgICAgICAgaWYgKHNlcGFyYXRpb25EZWZpbml0aW9uLmxpbmVUaGlja25lc3MpIHtcclxuICAgICAgICAgICAgICAgIHNlcGFyYXRvci5zdHlsZS5wYWRkaW5nVG9wID0gKHNlcGFyYXRpb25EZWZpbml0aW9uLnNwYWNpbmcgLyAyKSArIFwicHhcIjtcclxuICAgICAgICAgICAgICAgIHNlcGFyYXRvci5zdHlsZS5tYXJnaW5Cb3R0b20gPSAoc2VwYXJhdGlvbkRlZmluaXRpb24uc3BhY2luZyAvIDIpICsgXCJweFwiO1xyXG4gICAgICAgICAgICAgICAgc2VwYXJhdG9yLnN0eWxlLmJvcmRlckJvdHRvbSA9IHNlcGFyYXRpb25EZWZpbml0aW9uLmxpbmVUaGlja25lc3MgKyBcInB4IHNvbGlkIFwiICsgY29sb3I7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzZXBhcmF0b3Iuc3R5bGUuaGVpZ2h0ID0gc2VwYXJhdGlvbkRlZmluaXRpb24uc3BhY2luZyArIFwicHhcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKHNlcGFyYXRpb25EZWZpbml0aW9uLmxpbmVUaGlja25lc3MpIHtcclxuICAgICAgICAgICAgICAgIHNlcGFyYXRvci5zdHlsZS5wYWRkaW5nTGVmdCA9IChzZXBhcmF0aW9uRGVmaW5pdGlvbi5zcGFjaW5nIC8gMikgKyBcInB4XCI7XHJcbiAgICAgICAgICAgICAgICBzZXBhcmF0b3Iuc3R5bGUubWFyZ2luUmlnaHQgPSAoc2VwYXJhdGlvbkRlZmluaXRpb24uc3BhY2luZyAvIDIpICsgXCJweFwiO1xyXG4gICAgICAgICAgICAgICAgc2VwYXJhdG9yLnN0eWxlLmJvcmRlclJpZ2h0ID0gc2VwYXJhdGlvbkRlZmluaXRpb24ubGluZVRoaWNrbmVzcyArIFwicHggc29saWQgXCIgKyBjb2xvcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHNlcGFyYXRvci5zdHlsZS53aWR0aCA9IHNlcGFyYXRpb25EZWZpbml0aW9uLnNwYWNpbmcgKyBcInB4XCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgc2VwYXJhdG9yLnN0eWxlLm92ZXJmbG93ID0gXCJoaWRkZW5cIjtcclxuICAgICAgICBzZXBhcmF0b3Iuc3R5bGUuZmxleCA9IFwiMCAwIGF1dG9cIjtcclxuICAgICAgICByZXR1cm4gc2VwYXJhdG9yO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgIH1cclxufVxyXG5leHBvcnRzLnJlbmRlclNlcGFyYXRpb24gPSByZW5kZXJTZXBhcmF0aW9uO1xyXG5mdW5jdGlvbiBzdHJpbmdUb0Nzc0NvbG9yKGNvbG9yKSB7XHJcbiAgICBpZiAoY29sb3IpIHtcclxuICAgICAgICB2YXIgcmVnRXggPSAvIyhbMC05QS1GXXsyfSkoWzAtOUEtRl17Mn0pKFswLTlBLUZdezJ9KShbMC05QS1GXXsyfSk/L2dpO1xyXG4gICAgICAgIHZhciBtYXRjaGVzID0gcmVnRXguZXhlYyhjb2xvcik7XHJcbiAgICAgICAgaWYgKG1hdGNoZXMgJiYgbWF0Y2hlc1s0XSkge1xyXG4gICAgICAgICAgICB2YXIgYSA9IHBhcnNlSW50KG1hdGNoZXNbMV0sIDE2KSAvIDI1NTtcclxuICAgICAgICAgICAgdmFyIHIgPSBwYXJzZUludChtYXRjaGVzWzJdLCAxNik7XHJcbiAgICAgICAgICAgIHZhciBnID0gcGFyc2VJbnQobWF0Y2hlc1szXSwgMTYpO1xyXG4gICAgICAgICAgICB2YXIgYiA9IHBhcnNlSW50KG1hdGNoZXNbNF0sIDE2KTtcclxuICAgICAgICAgICAgcmV0dXJuIFwicmdiYShcIiArIHIgKyBcIixcIiArIGcgKyBcIixcIiArIGIgKyBcIixcIiArIGEgKyBcIilcIjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gY29sb3I7XHJcbn1cclxuZXhwb3J0cy5zdHJpbmdUb0Nzc0NvbG9yID0gc3RyaW5nVG9Dc3NDb2xvcjtcclxuZnVuY3Rpb24gdHJ1bmNhdGUoZWxlbWVudCwgbWF4SGVpZ2h0LCBsaW5lSGVpZ2h0KSB7XHJcbiAgICB2YXIgZml0cyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAvLyBBbGxvdyBhIG9uZSBwaXhlbCBvdmVyZmxvdyB0byBhY2NvdW50IGZvciByb3VuZGluZyBkaWZmZXJlbmNlc1xyXG4gICAgICAgIC8vIGJldHdlZW4gYnJvd3NlcnNcclxuICAgICAgICByZXR1cm4gbWF4SGVpZ2h0IC0gZWxlbWVudC5zY3JvbGxIZWlnaHQgPj0gLTEuMDtcclxuICAgIH07XHJcbiAgICBpZiAoZml0cygpKVxyXG4gICAgICAgIHJldHVybjtcclxuICAgIHZhciBmdWxsVGV4dCA9IGVsZW1lbnQuaW5uZXJIVE1MO1xyXG4gICAgdmFyIHRydW5jYXRlQXQgPSBmdW5jdGlvbiAoaWR4KSB7XHJcbiAgICAgICAgZWxlbWVudC5pbm5lckhUTUwgPSBmdWxsVGV4dC5zdWJzdHJpbmcoMCwgaWR4KSArICcuLi4nO1xyXG4gICAgfTtcclxuICAgIHZhciBicmVha2FibGVJbmRpY2VzID0gZmluZEJyZWFrYWJsZUluZGljZXMoZnVsbFRleHQpO1xyXG4gICAgdmFyIGxvID0gMDtcclxuICAgIHZhciBoaSA9IGJyZWFrYWJsZUluZGljZXMubGVuZ3RoO1xyXG4gICAgdmFyIGJlc3RCcmVha0lkeCA9IDA7XHJcbiAgICAvLyBEbyBhIGJpbmFyeSBzZWFyY2ggZm9yIHRoZSBsb25nZXN0IHN0cmluZyB0aGF0IGZpdHNcclxuICAgIHdoaWxlIChsbyA8IGhpKSB7XHJcbiAgICAgICAgdmFyIG1pZCA9IE1hdGguZmxvb3IoKGxvICsgaGkpIC8gMik7XHJcbiAgICAgICAgdHJ1bmNhdGVBdChicmVha2FibGVJbmRpY2VzW21pZF0pO1xyXG4gICAgICAgIGlmIChmaXRzKCkpIHtcclxuICAgICAgICAgICAgYmVzdEJyZWFrSWR4ID0gYnJlYWthYmxlSW5kaWNlc1ttaWRdO1xyXG4gICAgICAgICAgICBsbyA9IG1pZCArIDE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBoaSA9IG1pZDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICB0cnVuY2F0ZUF0KGJlc3RCcmVha0lkeCk7XHJcbiAgICAvLyBJZiB3ZSBoYXZlIGV4dHJhIHJvb20sIHRyeSB0byBleHBhbmQgdGhlIHN0cmluZyBsZXR0ZXIgYnkgbGV0dGVyXHJcbiAgICAvLyAoY292ZXJzIHRoZSBjYXNlIHdoZXJlIHdlIGhhdmUgdG8gYnJlYWsgaW4gdGhlIG1pZGRsZSBvZiBhIGxvbmcgd29yZClcclxuICAgIGlmIChsaW5lSGVpZ2h0ICYmIG1heEhlaWdodCAtIGVsZW1lbnQuc2Nyb2xsSGVpZ2h0ID49IGxpbmVIZWlnaHQgLSAxLjApIHtcclxuICAgICAgICB2YXIgaWR4ID0gZmluZE5leHRDaGFyYWN0ZXIoZnVsbFRleHQsIGJlc3RCcmVha0lkeCk7XHJcbiAgICAgICAgd2hpbGUgKGlkeCA8IGZ1bGxUZXh0Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICB0cnVuY2F0ZUF0KGlkeCk7XHJcbiAgICAgICAgICAgIGlmIChmaXRzKCkpIHtcclxuICAgICAgICAgICAgICAgIGJlc3RCcmVha0lkeCA9IGlkeDtcclxuICAgICAgICAgICAgICAgIGlkeCA9IGZpbmROZXh0Q2hhcmFjdGVyKGZ1bGxUZXh0LCBpZHgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdHJ1bmNhdGVBdChiZXN0QnJlYWtJZHgpO1xyXG4gICAgfVxyXG59XHJcbmV4cG9ydHMudHJ1bmNhdGUgPSB0cnVuY2F0ZTtcclxuZnVuY3Rpb24gZmluZEJyZWFrYWJsZUluZGljZXMoaHRtbCkge1xyXG4gICAgdmFyIHJlc3VsdHMgPSBbXTtcclxuICAgIHZhciBpZHggPSBmaW5kTmV4dENoYXJhY3RlcihodG1sLCAtMSk7XHJcbiAgICB3aGlsZSAoaWR4IDwgaHRtbC5sZW5ndGgpIHtcclxuICAgICAgICBpZiAoaHRtbFtpZHhdID09ICcgJykge1xyXG4gICAgICAgICAgICByZXN1bHRzLnB1c2goaWR4KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWR4ID0gZmluZE5leHRDaGFyYWN0ZXIoaHRtbCwgaWR4KTtcclxuICAgIH1cclxuICAgIHJldHVybiByZXN1bHRzO1xyXG59XHJcbmZ1bmN0aW9uIGZpbmROZXh0Q2hhcmFjdGVyKGh0bWwsIGN1cnJJZHgpIHtcclxuICAgIGN1cnJJZHggKz0gMTtcclxuICAgIC8vIElmIHdlIGZvdW5kIHRoZSBzdGFydCBvZiBhbiBIVE1MIHRhZywga2VlcCBhZHZhbmNpbmcgdW50aWwgd2UgZ2V0XHJcbiAgICAvLyBwYXN0IGl0LCBzbyB3ZSBkb24ndCBlbmQgdXAgdHJ1bmNhdGluZyBpbiB0aGUgbWlkZGxlIG9mIHRoZSB0YWdcclxuICAgIHdoaWxlIChjdXJySWR4IDwgaHRtbC5sZW5ndGggJiYgaHRtbFtjdXJySWR4XSA9PSAnPCcpIHtcclxuICAgICAgICB3aGlsZSAoY3VycklkeCA8IGh0bWwubGVuZ3RoICYmIGh0bWxbY3VycklkeCsrXSAhPSAnPicpXHJcbiAgICAgICAgICAgIDtcclxuICAgIH1cclxuICAgIHJldHVybiBjdXJySWR4O1xyXG59XHJcbmZ1bmN0aW9uIGdldEZpdFN0YXR1cyhlbGVtZW50LCBjb250YWluZXJFbmQpIHtcclxuICAgIHZhciBzdGFydCA9IGVsZW1lbnQub2Zmc2V0VG9wO1xyXG4gICAgdmFyIGVuZCA9IHN0YXJ0ICsgZWxlbWVudC5jbGllbnRIZWlnaHQ7XHJcbiAgICBpZiAoZW5kIDw9IGNvbnRhaW5lckVuZCkge1xyXG4gICAgICAgIHJldHVybiAwIC8qIEZ1bGx5SW5Db250YWluZXIgKi87XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmIChzdGFydCA8IGNvbnRhaW5lckVuZCkge1xyXG4gICAgICAgIHJldHVybiAxIC8qIE92ZXJmbG93aW5nICovO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIDIgLyogRnVsbHlPdXRPZkNvbnRhaW5lciAqLztcclxuICAgIH1cclxufVxyXG5leHBvcnRzLmdldEZpdFN0YXR1cyA9IGdldEZpdFN0YXR1cztcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dXRpbHMuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbmZ1bmN0aW9uIF9fZXhwb3J0KG0pIHtcclxuICAgIGZvciAodmFyIHAgaW4gbSkgaWYgKCFleHBvcnRzLmhhc093blByb3BlcnR5KHApKSBleHBvcnRzW3BdID0gbVtwXTtcclxufVxyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbl9fZXhwb3J0KHJlcXVpcmUoXCIuL2V4cHJlc3Npb24tcGFyc2VyXCIpKTtcclxuX19leHBvcnQocmVxdWlyZShcIi4vdGVtcGxhdGUtZW5naW5lXCIpKTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YWRhcHRpdmVjYXJkcy10ZW1wbGF0aW5nLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xyXG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XHJcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxyXG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XHJcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xyXG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xyXG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XHJcbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xyXG4gICAgfTtcclxufSkoKTtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG52YXIgb3JkZXJlZE9wZXJhdG9ycyA9IFtcclxuICAgIFwiL1wiLFxyXG4gICAgXCIqXCIsXHJcbiAgICBcIi1cIixcclxuICAgIFwiK1wiLFxyXG4gICAgXCI9PVwiLFxyXG4gICAgXCIhPVwiLFxyXG4gICAgXCI8XCIsXHJcbiAgICBcIjw9XCIsXHJcbiAgICBcIj5cIixcclxuICAgIFwiPj1cIlxyXG5dO1xyXG52YXIgbGl0ZXJhbHMgPSBbXHJcbiAgICBcImlkZW50aWZpZXJcIixcclxuICAgIFwic3RyaW5nXCIsXHJcbiAgICBcIm51bWJlclwiLFxyXG4gICAgXCJib29sZWFuXCJcclxuXTtcclxudmFyIFRva2VuaXplciA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFRva2VuaXplcigpIHtcclxuICAgIH1cclxuICAgIFRva2VuaXplci5pbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIFRva2VuaXplci5ydWxlcy5wdXNoKHsgdG9rZW5UeXBlOiB1bmRlZmluZWQsIHJlZ0V4OiAvXlxccy8gfSwgeyB0b2tlblR5cGU6IFwie1wiLCByZWdFeDogL157LyB9LCB7IHRva2VuVHlwZTogXCI/I1wiLCByZWdFeDogL15cXD8jLyB9LCB7IHRva2VuVHlwZTogXCJ9XCIsIHJlZ0V4OiAvXn0vIH0sIHsgdG9rZW5UeXBlOiBcIltcIiwgcmVnRXg6IC9eXFxbLyB9LCB7IHRva2VuVHlwZTogXCJdXCIsIHJlZ0V4OiAvXlxcXS8gfSwgeyB0b2tlblR5cGU6IFwiKFwiLCByZWdFeDogL15cXCgvIH0sIHsgdG9rZW5UeXBlOiBcIilcIiwgcmVnRXg6IC9eXFwpLyB9LCB7IHRva2VuVHlwZTogXCJib29sZWFuXCIsIHJlZ0V4OiAvXnRydWV8XmZhbHNlLyB9LCB7IHRva2VuVHlwZTogXCJpZGVudGlmaWVyXCIsIHJlZ0V4OiAvXlskYS16X10rL2kgfSwgeyB0b2tlblR5cGU6IFwiLlwiLCByZWdFeDogL15cXC4vIH0sIHsgdG9rZW5UeXBlOiBcIixcIiwgcmVnRXg6IC9eLC8gfSwgeyB0b2tlblR5cGU6IFwiK1wiLCByZWdFeDogL15cXCsvIH0sIHsgdG9rZW5UeXBlOiBcIi1cIiwgcmVnRXg6IC9eLS8gfSwgeyB0b2tlblR5cGU6IFwiKlwiLCByZWdFeDogL15cXCovIH0sIHsgdG9rZW5UeXBlOiBcIi9cIiwgcmVnRXg6IC9eXFwvLyB9LCB7IHRva2VuVHlwZTogXCI9PVwiLCByZWdFeDogL149PS8gfSwgeyB0b2tlblR5cGU6IFwiIT1cIiwgcmVnRXg6IC9eIT0vIH0sIHsgdG9rZW5UeXBlOiBcIjw9XCIsIHJlZ0V4OiAvXjw9LyB9LCB7IHRva2VuVHlwZTogXCI8XCIsIHJlZ0V4OiAvXjwvIH0sIHsgdG9rZW5UeXBlOiBcIj49XCIsIHJlZ0V4OiAvXj49LyB9LCB7IHRva2VuVHlwZTogXCI+XCIsIHJlZ0V4OiAvXj4vIH0sIHsgdG9rZW5UeXBlOiBcInN0cmluZ1wiLCByZWdFeDogL15cIihbXlwiXSopXCIvIH0sIHsgdG9rZW5UeXBlOiBcInN0cmluZ1wiLCByZWdFeDogL14nKFteJ10qKScvIH0sIHsgdG9rZW5UeXBlOiBcIm51bWJlclwiLCByZWdFeDogL15cXGQqXFwuP1xcZCsvIH0pO1xyXG4gICAgfTtcclxuICAgIFRva2VuaXplci5wYXJzZSA9IGZ1bmN0aW9uIChleHByZXNzaW9uKSB7XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IFtdO1xyXG4gICAgICAgIHZhciBpID0gMDtcclxuICAgICAgICB3aGlsZSAoaSA8IGV4cHJlc3Npb24ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHZhciBzdWJFeHByZXNzaW9uID0gZXhwcmVzc2lvbi5zdWJzdHJpbmcoaSk7XHJcbiAgICAgICAgICAgIHZhciBtYXRjaEZvdW5kID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSBUb2tlbml6ZXIucnVsZXM7IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgcnVsZSA9IF9hW19pXTtcclxuICAgICAgICAgICAgICAgIHZhciBtYXRjaGVzID0gcnVsZS5yZWdFeC5leGVjKHN1YkV4cHJlc3Npb24pO1xyXG4gICAgICAgICAgICAgICAgaWYgKG1hdGNoZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAobWF0Y2hlcy5sZW5ndGggPiAyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkEgdG9rZW5pemVyIHJ1bGUgbWF0Y2hlZCBtb3JlIHRoYW4gb25lIGdyb3VwLlwiKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJ1bGUudG9rZW5UeXBlICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBydWxlLnRva2VuVHlwZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBtYXRjaGVzW21hdGNoZXMubGVuZ3RoID09IDEgPyAwIDogMV0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbFBvc2l0aW9uOiBpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpICs9IG1hdGNoZXNbMF0ubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgICAgIG1hdGNoRm91bmQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghbWF0Y2hGb3VuZCkge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5leHBlY3RlZCBjaGFyYWN0ZXIgXCIgKyBzdWJFeHByZXNzaW9uWzBdICsgXCIgYXQgcG9zaXRpb24gXCIgKyBpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuICAgIFRva2VuaXplci5ydWxlcyA9IFtdO1xyXG4gICAgcmV0dXJuIFRva2VuaXplcjtcclxufSgpKTtcclxuVG9rZW5pemVyLmluaXQoKTtcclxuZnVuY3Rpb24gZW5zdXJlVmFsdWVUeXBlKHZhbHVlKSB7XHJcbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSBcIm51bWJlclwiIHx8IHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIiB8fCB0eXBlb2YgdmFsdWUgPT09IFwiYm9vbGVhblwiKSB7XHJcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgfVxyXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCB2YWx1ZSB0eXBlOiBcIiArIHR5cGVvZiB2YWx1ZSk7XHJcbn1cclxudmFyIEV2YWx1YXRpb25Db250ZXh0ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gRXZhbHVhdGlvbkNvbnRleHQoKSB7XHJcbiAgICAgICAgdGhpcy5fZnVuY3Rpb25zID0ge307XHJcbiAgICAgICAgdGhpcy5fc3RhdGVTdGFjayA9IFtdO1xyXG4gICAgfVxyXG4gICAgRXZhbHVhdGlvbkNvbnRleHQuaW5pdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBFdmFsdWF0aW9uQ29udGV4dC5fYnVpbHRJbkZ1bmN0aW9uc1tcInN1YnN0clwiXSA9IGZ1bmN0aW9uIChzLCBpbmRleCwgY291bnQpIHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBzID09PSBcInN0cmluZ1wiICYmIHR5cGVvZiBpbmRleCA9PT0gXCJudW1iZXJcIiAmJiB0eXBlb2YgY291bnQgPT09IFwibnVtYmVyXCIpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAocy5zdWJzdHIoaW5kZXgsIGNvdW50KSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgRXZhbHVhdGlvbkNvbnRleHQuX2J1aWx0SW5GdW5jdGlvbnNbXCJKU09OLnBhcnNlXCJdID0gZnVuY3Rpb24gKGlucHV0KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKGlucHV0KTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIEV2YWx1YXRpb25Db250ZXh0Ll9idWlsdEluRnVuY3Rpb25zW1wiaWZcIl0gPSBmdW5jdGlvbiAoY29uZGl0aW9uLCBpZlRydWUsIGlmRmFsc2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGNvbmRpdGlvbiA/IGlmVHJ1ZSA6IGlmRmFsc2U7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBFdmFsdWF0aW9uQ29udGV4dC5fYnVpbHRJbkZ1bmN0aW9uc1tcInRvVXBwZXJcIl0gPSBmdW5jdGlvbiAoaW5wdXQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiBpbnB1dCA9PT0gXCJzdHJpbmdcIiA/IGlucHV0LnRvVXBwZXJDYXNlKCkgOiBpbnB1dDtcclxuICAgICAgICB9O1xyXG4gICAgICAgIEV2YWx1YXRpb25Db250ZXh0Ll9idWlsdEluRnVuY3Rpb25zW1widG9Mb3dlclwiXSA9IGZ1bmN0aW9uIChpbnB1dCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdHlwZW9mIGlucHV0ID09PSBcInN0cmluZ1wiID8gaW5wdXQudG9Mb3dlckNhc2UoKSA6IGlucHV0O1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgRXZhbHVhdGlvbkNvbnRleHQuX2J1aWx0SW5GdW5jdGlvbnNbXCJEYXRlLmZvcm1hdFwiXSA9IGZ1bmN0aW9uIChpbnB1dCwgZm9ybWF0KSB7XHJcbiAgICAgICAgICAgIHZhciBhY2NlcHRlZEZvcm1hdHMgPSBbXCJsb25nXCIsIFwic2hvcnRcIiwgXCJjb21wYWN0XCJdO1xyXG4gICAgICAgICAgICB2YXIgaW5wdXRBc051bWJlcjtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBpbnB1dCA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICAgICAgaW5wdXRBc051bWJlciA9IERhdGUucGFyc2UoaW5wdXQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBpbnB1dCA9PT0gXCJudW1iZXJcIikge1xyXG4gICAgICAgICAgICAgICAgaW5wdXRBc051bWJlciA9IGlucHV0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGlucHV0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoaW5wdXRBc051bWJlcik7XHJcbiAgICAgICAgICAgIHZhciBlZmZlY3RpdmVGb3JtYXQgPSBcImNvbXBhY3RcIjtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBmb3JtYXQgPT09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICAgICAgICAgIGVmZmVjdGl2ZUZvcm1hdCA9IGZvcm1hdC50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGFjY2VwdGVkRm9ybWF0cy5pbmRleE9mKGVmZmVjdGl2ZUZvcm1hdCkgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWZmZWN0aXZlRm9ybWF0ID0gXCJjb21wYWN0XCI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGVmZmVjdGl2ZUZvcm1hdCA9PT0gXCJjb21wYWN0XCIgPyBkYXRlLnRvTG9jYWxlRGF0ZVN0cmluZygpIDogZGF0ZS50b0xvY2FsZURhdGVTdHJpbmcodW5kZWZpbmVkLCB7IGRheTogXCJudW1lcmljXCIsIHdlZWtkYXk6IGVmZmVjdGl2ZUZvcm1hdCwgbW9udGg6IGVmZmVjdGl2ZUZvcm1hdCwgeWVhcjogXCJudW1lcmljXCIgfSk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICBFdmFsdWF0aW9uQ29udGV4dC5fYnVpbHRJbkZ1bmN0aW9uc1tcIlRpbWUuZm9ybWF0XCJdID0gZnVuY3Rpb24gKGlucHV0KSB7XHJcbiAgICAgICAgICAgIHZhciBpbnB1dEFzTnVtYmVyO1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIGlucHV0ID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgICAgICBpbnB1dEFzTnVtYmVyID0gRGF0ZS5wYXJzZShpbnB1dCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIGlucHV0ID09PSBcIm51bWJlclwiKSB7XHJcbiAgICAgICAgICAgICAgICBpbnB1dEFzTnVtYmVyID0gaW5wdXQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaW5wdXQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZShpbnB1dEFzTnVtYmVyKTtcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGUudG9Mb2NhbGVUaW1lU3RyaW5nKHVuZGVmaW5lZCwgeyBob3VyOiAnbnVtZXJpYycsIG1pbnV0ZTogJzItZGlnaXQnIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG4gICAgRXZhbHVhdGlvbkNvbnRleHQucHJvdG90eXBlLnJlZ2lzdGVyRnVuY3Rpb24gPSBmdW5jdGlvbiAobmFtZSwgY2FsbGJhY2spIHtcclxuICAgICAgICB0aGlzLl9mdW5jdGlvbnNbbmFtZV0gPSBjYWxsYmFjaztcclxuICAgIH07XHJcbiAgICBFdmFsdWF0aW9uQ29udGV4dC5wcm90b3R5cGUudW5yZWdpc3RlckZ1bmN0aW9uID0gZnVuY3Rpb24gKG5hbWUpIHtcclxuICAgICAgICBkZWxldGUgdGhpcy5fZnVuY3Rpb25zW25hbWVdO1xyXG4gICAgfTtcclxuICAgIEV2YWx1YXRpb25Db250ZXh0LnByb3RvdHlwZS5nZXRGdW5jdGlvbiA9IGZ1bmN0aW9uIChuYW1lKSB7XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IHRoaXMuX2Z1bmN0aW9uc1tuYW1lXTtcclxuICAgICAgICBpZiAocmVzdWx0ID09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICByZXN1bHQgPSBFdmFsdWF0aW9uQ29udGV4dC5fYnVpbHRJbkZ1bmN0aW9uc1tuYW1lXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH07XHJcbiAgICBFdmFsdWF0aW9uQ29udGV4dC5wcm90b3R5cGUuaXNSZXNlcnZlZEZpZWxkID0gZnVuY3Rpb24gKG5hbWUpIHtcclxuICAgICAgICByZXR1cm4gRXZhbHVhdGlvbkNvbnRleHQuX3Jlc2VydmVkRmllbGRzLmluZGV4T2YobmFtZSkgPj0gMDtcclxuICAgIH07XHJcbiAgICBFdmFsdWF0aW9uQ29udGV4dC5wcm90b3R5cGUuc2F2ZVN0YXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuX3N0YXRlU3RhY2sucHVzaCh7ICRkYXRhOiB0aGlzLiRkYXRhLCAkaW5kZXg6IHRoaXMuJGluZGV4IH0pO1xyXG4gICAgfTtcclxuICAgIEV2YWx1YXRpb25Db250ZXh0LnByb3RvdHlwZS5yZXN0b3JlTGFzdFN0YXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9zdGF0ZVN0YWNrLmxlbmd0aCA9PSAwKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlRoZXJlIGlzIG5vIGV2YWx1YXRpb24gY29udGV4dCBzdGF0ZSB0byByZXN0b3JlLlwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHNhdmVkQ29udGV4dCA9IHRoaXMuX3N0YXRlU3RhY2sucG9wKCk7XHJcbiAgICAgICAgdGhpcy4kZGF0YSA9IHNhdmVkQ29udGV4dC4kZGF0YTtcclxuICAgICAgICB0aGlzLiRpbmRleCA9IHNhdmVkQ29udGV4dC4kaW5kZXg7XHJcbiAgICB9O1xyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEV2YWx1YXRpb25Db250ZXh0LnByb3RvdHlwZSwgXCJjdXJyZW50RGF0YUNvbnRleHRcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy4kZGF0YSAhPSB1bmRlZmluZWQgPyB0aGlzLiRkYXRhIDogdGhpcy4kcm9vdDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIEV2YWx1YXRpb25Db250ZXh0Ll9yZXNlcnZlZEZpZWxkcyA9IFtcIiRkYXRhXCIsIFwiJHJvb3RcIiwgXCIkaW5kZXhcIl07XHJcbiAgICBFdmFsdWF0aW9uQ29udGV4dC5fYnVpbHRJbkZ1bmN0aW9ucyA9IHt9O1xyXG4gICAgcmV0dXJuIEV2YWx1YXRpb25Db250ZXh0O1xyXG59KCkpO1xyXG5leHBvcnRzLkV2YWx1YXRpb25Db250ZXh0ID0gRXZhbHVhdGlvbkNvbnRleHQ7XHJcbkV2YWx1YXRpb25Db250ZXh0LmluaXQoKTtcclxudmFyIEV2YWx1YXRpb25Ob2RlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gRXZhbHVhdGlvbk5vZGUoKSB7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gRXZhbHVhdGlvbk5vZGU7XHJcbn0oKSk7XHJcbnZhciBFeHByZXNzaW9uTm9kZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhFeHByZXNzaW9uTm9kZSwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIEV4cHJlc3Npb25Ob2RlKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLm5vZGVzID0gW107XHJcbiAgICAgICAgX3RoaXMuYWxsb3dOdWxsID0gdHJ1ZTtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICBFeHByZXNzaW9uTm9kZS5wcm90b3R5cGUuZXZhbHVhdGUgPSBmdW5jdGlvbiAoY29udGV4dCkge1xyXG4gICAgICAgIHZhciBvcGVyYXRvclByaW9yaXR5R3JvdXBzID0gW1xyXG4gICAgICAgICAgICBbXCIvXCIsIFwiKlwiXSxcclxuICAgICAgICAgICAgW1wiLVwiLCBcIitcIl0sXHJcbiAgICAgICAgICAgIFtcIj09XCIsIFwiIT1cIiwgXCI8XCIsIFwiPD1cIiwgXCI+XCIsIFwiPj1cIl1cclxuICAgICAgICBdO1xyXG4gICAgICAgIHZhciBub2Rlc0NvcHkgPSB0aGlzLm5vZGVzO1xyXG4gICAgICAgIGZvciAodmFyIF9pID0gMCwgb3BlcmF0b3JQcmlvcml0eUdyb3Vwc18xID0gb3BlcmF0b3JQcmlvcml0eUdyb3VwczsgX2kgPCBvcGVyYXRvclByaW9yaXR5R3JvdXBzXzEubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgICAgIHZhciBwcmlvcml0eUdyb3VwID0gb3BlcmF0b3JQcmlvcml0eUdyb3Vwc18xW19pXTtcclxuICAgICAgICAgICAgdmFyIGkgPSAwO1xyXG4gICAgICAgICAgICB3aGlsZSAoaSA8IG5vZGVzQ29weS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBub2RlID0gbm9kZXNDb3B5W2ldO1xyXG4gICAgICAgICAgICAgICAgaWYgKG5vZGUgaW5zdGFuY2VvZiBPcGVyYXRvck5vZGUgJiYgcHJpb3JpdHlHcm91cC5pbmRleE9mKG5vZGUub3BlcmF0b3IpID49IDApIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbGVmdCA9IGVuc3VyZVZhbHVlVHlwZShub2Rlc0NvcHlbaSAtIDFdLmV2YWx1YXRlKGNvbnRleHQpKTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgcmlnaHQgPSBlbnN1cmVWYWx1ZVR5cGUobm9kZXNDb3B5W2kgKyAxXS5ldmFsdWF0ZShjb250ZXh0KSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBsZWZ0ICE9PSB0eXBlb2YgcmlnaHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW5jb21wYXRpYmxlIG9wZXJhbmRzIFwiICsgbGVmdCArIFwiIGFuZCBcIiArIHJpZ2h0ICsgXCIgZm9yIG9wZXJhdG9yIFwiICsgbm9kZS5vcGVyYXRvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSB2b2lkIDA7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBsZWZ0ID09PSBcIm51bWJlclwiICYmIHR5cGVvZiByaWdodCA9PT0gXCJudW1iZXJcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKG5vZGUub3BlcmF0b3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCIvXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gbGVmdCAvIHJpZ2h0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIipcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBsZWZ0ICogcmlnaHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiLVwiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGxlZnQgLSByaWdodDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCIrXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gbGVmdCArIHJpZ2h0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbGVmdCA9PT0gXCJzdHJpbmdcIiAmJiB0eXBlb2YgcmlnaHQgPT09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChub2RlLm9wZXJhdG9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiK1wiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGxlZnQgKyByaWdodDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKG5vZGUub3BlcmF0b3IpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIj09XCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBsZWZ0ID09IHJpZ2h0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCIhPVwiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gbGVmdCAhPSByaWdodDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiPFwiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gbGVmdCA8IHJpZ2h0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCI8PVwiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gbGVmdCA8PSByaWdodDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiPlwiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gbGVmdCA+IHJpZ2h0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCI+PVwiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gbGVmdCA+PSByaWdodDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIHNob3VsZCBuZXZlciBoYXBwZW5cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgbm9kZXNDb3B5LnNwbGljZShpIC0gMSwgMywgbmV3IExpdGVyYWxOb2RlKHJlc3VsdCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGktLTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBub2Rlc0NvcHlbMF0uZXZhbHVhdGUoY29udGV4dCk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIEV4cHJlc3Npb25Ob2RlO1xyXG59KEV2YWx1YXRpb25Ob2RlKSk7XHJcbnZhciBJZGVudGlmaWVyTm9kZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhJZGVudGlmaWVyTm9kZSwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIElkZW50aWZpZXJOb2RlKCkge1xyXG4gICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgIH1cclxuICAgIElkZW50aWZpZXJOb2RlLnByb3RvdHlwZS5ldmFsdWF0ZSA9IGZ1bmN0aW9uIChjb250ZXh0KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaWRlbnRpZmllcjtcclxuICAgIH07XHJcbiAgICByZXR1cm4gSWRlbnRpZmllck5vZGU7XHJcbn0oRXZhbHVhdGlvbk5vZGUpKTtcclxudmFyIEluZGV4ZXJOb2RlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKEluZGV4ZXJOb2RlLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gSW5kZXhlck5vZGUoKSB7XHJcbiAgICAgICAgcmV0dXJuIF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgfVxyXG4gICAgSW5kZXhlck5vZGUucHJvdG90eXBlLmV2YWx1YXRlID0gZnVuY3Rpb24gKGNvbnRleHQpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5pbmRleC5ldmFsdWF0ZShjb250ZXh0KTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gSW5kZXhlck5vZGU7XHJcbn0oRXZhbHVhdGlvbk5vZGUpKTtcclxudmFyIEZ1bmN0aW9uQ2FsbE5vZGUgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoRnVuY3Rpb25DYWxsTm9kZSwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIEZ1bmN0aW9uQ2FsbE5vZGUoKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyICE9PSBudWxsICYmIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpIHx8IHRoaXM7XHJcbiAgICAgICAgX3RoaXMuZnVuY3Rpb25OYW1lID0gbnVsbDtcclxuICAgICAgICBfdGhpcy5wYXJhbWV0ZXJzID0gW107XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgRnVuY3Rpb25DYWxsTm9kZS5wcm90b3R5cGUuZXZhbHVhdGUgPSBmdW5jdGlvbiAoY29udGV4dCkge1xyXG4gICAgICAgIHZhciBjYWxsYmFjayA9IGNvbnRleHQuZ2V0RnVuY3Rpb24odGhpcy5mdW5jdGlvbk5hbWUpO1xyXG4gICAgICAgIGlmIChjYWxsYmFjayAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgdmFyIGV2YWx1YXRlZFBhcmFtcyA9IFtdO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gdGhpcy5wYXJhbWV0ZXJzOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHBhcmFtID0gX2FbX2ldO1xyXG4gICAgICAgICAgICAgICAgZXZhbHVhdGVkUGFyYW1zLnB1c2gocGFyYW0uZXZhbHVhdGUoY29udGV4dCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBjYWxsYmFjay5hcHBseSh2b2lkIDAsIGV2YWx1YXRlZFBhcmFtcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlVuZGVmaW5lZCBmdW5jdGlvbjogXCIgKyB0aGlzLmZ1bmN0aW9uTmFtZSk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIEZ1bmN0aW9uQ2FsbE5vZGU7XHJcbn0oRXZhbHVhdGlvbk5vZGUpKTtcclxudmFyIExpdGVyYWxOb2RlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKExpdGVyYWxOb2RlLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gTGl0ZXJhbE5vZGUodmFsdWUpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLnZhbHVlID0gdmFsdWU7XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgTGl0ZXJhbE5vZGUucHJvdG90eXBlLmV2YWx1YXRlID0gZnVuY3Rpb24gKGNvbnRleHQpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy52YWx1ZTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gTGl0ZXJhbE5vZGU7XHJcbn0oRXZhbHVhdGlvbk5vZGUpKTtcclxudmFyIE9wZXJhdG9yTm9kZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhPcGVyYXRvck5vZGUsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBPcGVyYXRvck5vZGUob3BlcmF0b3IpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLm9wZXJhdG9yID0gb3BlcmF0b3I7XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgT3BlcmF0b3JOb2RlLnByb3RvdHlwZS5ldmFsdWF0ZSA9IGZ1bmN0aW9uIChjb250ZXh0KSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQW4gb3BlcmF0b3IgY2Fubm90IGJlIGV2YWx1YXRlZCBvbiBpdHMgb3duLlwiKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gT3BlcmF0b3JOb2RlO1xyXG59KEV2YWx1YXRpb25Ob2RlKSk7XHJcbnZhciBQYXRoTm9kZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhQYXRoTm9kZSwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIFBhdGhOb2RlKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLnBhcnRzID0gW107XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgUGF0aE5vZGUucHJvdG90eXBlLmV2YWx1YXRlID0gZnVuY3Rpb24gKGNvbnRleHQpIHtcclxuICAgICAgICB2YXIgcmVzdWx0ID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHZhciBpbmRleCA9IDA7XHJcbiAgICAgICAgd2hpbGUgKGluZGV4IDwgdGhpcy5wYXJ0cy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdmFyIHBhcnQgPSB0aGlzLnBhcnRzW2luZGV4XTtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIGlmIChwYXJ0IGluc3RhbmNlb2YgSWRlbnRpZmllck5vZGUgJiYgaW5kZXggPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHN3aXRjaCAocGFydC5pZGVudGlmaWVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCIkcm9vdFwiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gY29udGV4dC4kcm9vdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiJGRhdGFcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGNvbnRleHQuY3VycmVudERhdGFDb250ZXh0O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCIkaW5kZXhcIjpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IGNvbnRleHQuJGluZGV4O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBjb250ZXh0LmN1cnJlbnREYXRhQ29udGV4dFtwYXJ0LmlkZW50aWZpZXJdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcnRWYWx1ZSA9IHBhcnQuZXZhbHVhdGUoY29udGV4dCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4ID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gcGFydFZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gdHlwZW9mIHBhcnRWYWx1ZSAhPT0gXCJib29sZWFuXCIgPyByZXN1bHRbcGFydFZhbHVlXSA6IHJlc3VsdFtwYXJ0VmFsdWUudG9TdHJpbmcoKV07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGluZGV4Kys7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFBhdGhOb2RlO1xyXG59KEV2YWx1YXRpb25Ob2RlKSk7XHJcbnZhciBFeHByZXNzaW9uUGFyc2VyID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gRXhwcmVzc2lvblBhcnNlcih0b2tlbnMpIHtcclxuICAgICAgICB0aGlzLl9pbmRleCA9IDA7XHJcbiAgICAgICAgdGhpcy5fdG9rZW5zID0gdG9rZW5zO1xyXG4gICAgfVxyXG4gICAgRXhwcmVzc2lvblBhcnNlci5wcm90b3R5cGUudW5leHBlY3RlZFRva2VuID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlVuZXhwZWN0ZWQgdG9rZW4gXCIgKyB0aGlzLmN1cnJlbnQudmFsdWUgKyBcIiBhdCBwb3NpdGlvbiBcIiArIHRoaXMuY3VycmVudC5vcmlnaW5hbFBvc2l0aW9uICsgXCIuXCIpO1xyXG4gICAgfTtcclxuICAgIEV4cHJlc3Npb25QYXJzZXIucHJvdG90eXBlLnVuZXhwZWN0ZWRFb2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5leHBlY3RlZCBlbmQgb2YgZXhwcmVzc2lvbi5cIik7XHJcbiAgICB9O1xyXG4gICAgRXhwcmVzc2lvblBhcnNlci5wcm90b3R5cGUubW92ZU5leHQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5faW5kZXgrKztcclxuICAgIH07XHJcbiAgICBFeHByZXNzaW9uUGFyc2VyLnByb3RvdHlwZS5wYXJzZVRva2VuID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBleHBlY3RlZFRva2VuVHlwZXMgPSBbXTtcclxuICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgICAgICBleHBlY3RlZFRva2VuVHlwZXNbX2ldID0gYXJndW1lbnRzW19pXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuZW9lKSB7XHJcbiAgICAgICAgICAgIHRoaXMudW5leHBlY3RlZEVvZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgY3VycmVudFRva2VuID0gdGhpcy5jdXJyZW50O1xyXG4gICAgICAgIGlmIChleHBlY3RlZFRva2VuVHlwZXMuaW5kZXhPZih0aGlzLmN1cnJlbnQudHlwZSkgPCAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMudW5leHBlY3RlZFRva2VuKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMubW92ZU5leHQoKTtcclxuICAgICAgICByZXR1cm4gY3VycmVudFRva2VuO1xyXG4gICAgfTtcclxuICAgIEV4cHJlc3Npb25QYXJzZXIucHJvdG90eXBlLnBhcnNlT3B0aW9uYWxUb2tlbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgZXhwZWN0ZWRUb2tlblR5cGVzID0gW107XHJcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgZXhwZWN0ZWRUb2tlblR5cGVzW19pXSA9IGFyZ3VtZW50c1tfaV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmVvZSkge1xyXG4gICAgICAgICAgICB0aGlzLnVuZXhwZWN0ZWRFb2UoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoZXhwZWN0ZWRUb2tlblR5cGVzLmluZGV4T2YodGhpcy5jdXJyZW50LnR5cGUpIDwgMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLm1vdmVOZXh0KCk7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBFeHByZXNzaW9uUGFyc2VyLnByb3RvdHlwZS5wYXJzZUZ1bmN0aW9uQ2FsbCA9IGZ1bmN0aW9uIChmdW5jdGlvbk5hbWUpIHtcclxuICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IEZ1bmN0aW9uQ2FsbE5vZGUoKTtcclxuICAgICAgICByZXN1bHQuZnVuY3Rpb25OYW1lID0gZnVuY3Rpb25OYW1lO1xyXG4gICAgICAgIHRoaXMucGFyc2VUb2tlbihcIihcIik7XHJcbiAgICAgICAgdmFyIGZpcnN0UGFyYW1ldGVyID0gdGhpcy5wYXJzZUV4cHJlc3Npb24oKTtcclxuICAgICAgICB2YXIgbW9yZVBhcmFtZXRlcnMgPSBmYWxzZTtcclxuICAgICAgICBpZiAoZmlyc3RQYXJhbWV0ZXIpIHtcclxuICAgICAgICAgICAgcmVzdWx0LnBhcmFtZXRlcnMucHVzaChmaXJzdFBhcmFtZXRlcik7XHJcbiAgICAgICAgICAgIGRvIHtcclxuICAgICAgICAgICAgICAgIG1vcmVQYXJhbWV0ZXJzID0gdGhpcy5wYXJzZU9wdGlvbmFsVG9rZW4oXCIsXCIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKG1vcmVQYXJhbWV0ZXJzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmFtZXRlciA9IHRoaXMucGFyc2VFeHByZXNzaW9uKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnBhcmFtZXRlcnMucHVzaChwYXJhbWV0ZXIpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IHdoaWxlIChtb3JlUGFyYW1ldGVycyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucGFyc2VUb2tlbihcIilcIik7XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH07XHJcbiAgICBFeHByZXNzaW9uUGFyc2VyLnByb3RvdHlwZS5wYXJzZUlkZW50aWZpZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBJZGVudGlmaWVyTm9kZSgpO1xyXG4gICAgICAgIHJlc3VsdC5pZGVudGlmaWVyID0gdGhpcy5jdXJyZW50LnZhbHVlO1xyXG4gICAgICAgIHRoaXMubW92ZU5leHQoKTtcclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuICAgIEV4cHJlc3Npb25QYXJzZXIucHJvdG90eXBlLnBhcnNlSW5kZXhlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IEluZGV4ZXJOb2RlKCk7XHJcbiAgICAgICAgdGhpcy5wYXJzZVRva2VuKFwiW1wiKTtcclxuICAgICAgICByZXN1bHQuaW5kZXggPSB0aGlzLnBhcnNlRXhwcmVzc2lvbigpO1xyXG4gICAgICAgIHRoaXMucGFyc2VUb2tlbihcIl1cIik7XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH07XHJcbiAgICBFeHByZXNzaW9uUGFyc2VyLnByb3RvdHlwZS5wYXJzZVBhdGggPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBQYXRoTm9kZSgpO1xyXG4gICAgICAgIHZhciBleHBlY3RlZE5leHRUb2tlblR5cGVzID0gW1wiaWRlbnRpZmllclwiLCBcIihcIl07XHJcbiAgICAgICAgd2hpbGUgKCF0aGlzLmVvZSkge1xyXG4gICAgICAgICAgICBpZiAoZXhwZWN0ZWROZXh0VG9rZW5UeXBlcy5pbmRleE9mKHRoaXMuY3VycmVudC50eXBlKSA8IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc3dpdGNoICh0aGlzLmN1cnJlbnQudHlwZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcIihcIjpcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnBhcnRzLmxlbmd0aCA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZU5leHQoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnBhcnRzLnB1c2godGhpcy5wYXJzZUV4cHJlc3Npb24oKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGFyc2VUb2tlbihcIilcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZnVuY3Rpb25OYW1lID0gXCJcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHJlc3VsdC5wYXJ0czsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwYXJ0ID0gX2FbX2ldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEocGFydCBpbnN0YW5jZW9mIElkZW50aWZpZXJOb2RlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudW5leHBlY3RlZFRva2VuKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZnVuY3Rpb25OYW1lICE9IFwiXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbk5hbWUgKz0gXCIuXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbk5hbWUgKz0gcGFydC5pZGVudGlmaWVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wYXJ0cyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucGFydHMucHVzaCh0aGlzLnBhcnNlRnVuY3Rpb25DYWxsKGZ1bmN0aW9uTmFtZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBleHBlY3RlZE5leHRUb2tlblR5cGVzID0gW1wiLlwiLCBcIltcIl07XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiW1wiOlxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wYXJ0cy5wdXNoKHRoaXMucGFyc2VJbmRleGVyKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGV4cGVjdGVkTmV4dFRva2VuVHlwZXMgPSBbXCIuXCIsIFwiKFwiLCBcIltcIl07XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiaWRlbnRpZmllclwiOlxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wYXJ0cy5wdXNoKHRoaXMucGFyc2VJZGVudGlmaWVyKCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGV4cGVjdGVkTmV4dFRva2VuVHlwZXMgPSBbXCIuXCIsIFwiKFwiLCBcIltcIl07XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiLlwiOlxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZU5leHQoKTtcclxuICAgICAgICAgICAgICAgICAgICBleHBlY3RlZE5leHRUb2tlblR5cGVzID0gW1wiaWRlbnRpZmllclwiXTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgZXhwZWN0ZWROZXh0VG9rZW5UeXBlcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEV4cHJlc3Npb25QYXJzZXIucHJvdG90eXBlLnBhcnNlRXhwcmVzc2lvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgcmVzdWx0ID0gbmV3IEV4cHJlc3Npb25Ob2RlKCk7XHJcbiAgICAgICAgdmFyIGV4cGVjdGVkTmV4dFRva2VuVHlwZXMgPSBsaXRlcmFscy5jb25jYXQoXCIoXCIsIFwiK1wiLCBcIi1cIik7XHJcbiAgICAgICAgd2hpbGUgKCF0aGlzLmVvZSkge1xyXG4gICAgICAgICAgICBpZiAoZXhwZWN0ZWROZXh0VG9rZW5UeXBlcy5pbmRleE9mKHRoaXMuY3VycmVudC50eXBlKSA8IDApIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQubm9kZXMubGVuZ3RoID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVuZXhwZWN0ZWRUb2tlbigpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBzd2l0Y2ggKHRoaXMuY3VycmVudC50eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiKFwiOlxyXG4gICAgICAgICAgICAgICAgY2FzZSBcImlkZW50aWZpZXJcIjpcclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQubm9kZXMucHVzaCh0aGlzLnBhcnNlUGF0aCgpKTtcclxuICAgICAgICAgICAgICAgICAgICBleHBlY3RlZE5leHRUb2tlblR5cGVzID0gb3JkZXJlZE9wZXJhdG9ycztcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJzdHJpbmdcIjpcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJudW1iZXJcIjpcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJib29sZWFuXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudC50eXBlID09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0Lm5vZGVzLnB1c2gobmV3IExpdGVyYWxOb2RlKHRoaXMuY3VycmVudC52YWx1ZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0aGlzLmN1cnJlbnQudHlwZSA9PSBcIm51bWJlclwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5ub2Rlcy5wdXNoKG5ldyBMaXRlcmFsTm9kZShwYXJzZUZsb2F0KHRoaXMuY3VycmVudC52YWx1ZSkpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5ub2Rlcy5wdXNoKG5ldyBMaXRlcmFsTm9kZSh0aGlzLmN1cnJlbnQudmFsdWUgPT09IFwidHJ1ZVwiKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZU5leHQoKTtcclxuICAgICAgICAgICAgICAgICAgICBleHBlY3RlZE5leHRUb2tlblR5cGVzID0gb3JkZXJlZE9wZXJhdG9ycztcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgXCItXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5ub2Rlcy5sZW5ndGggPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQubm9kZXMucHVzaChuZXcgTGl0ZXJhbE5vZGUoLTEpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0Lm5vZGVzLnB1c2gobmV3IE9wZXJhdG9yTm9kZShcIipcIikpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBleHBlY3RlZE5leHRUb2tlblR5cGVzID0gW1wiaWRlbnRpZmllclwiLCBcIm51bWJlclwiLCBcIihcIl07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQubm9kZXMucHVzaChuZXcgT3BlcmF0b3JOb2RlKHRoaXMuY3VycmVudC50eXBlKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdGVkTmV4dFRva2VuVHlwZXMgPSBsaXRlcmFscy5jb25jYXQoXCIoXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVOZXh0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiK1wiOlxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQubm9kZXMubGVuZ3RoID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZXhwZWN0ZWROZXh0VG9rZW5UeXBlcyA9IGxpdGVyYWxzLmNvbmNhdChcIihcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQubm9kZXMucHVzaChuZXcgT3BlcmF0b3JOb2RlKHRoaXMuY3VycmVudC50eXBlKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdGVkTmV4dFRva2VuVHlwZXMgPSBsaXRlcmFscy5jb25jYXQoXCIoXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVOZXh0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiKlwiOlxyXG4gICAgICAgICAgICAgICAgY2FzZSBcIi9cIjpcclxuICAgICAgICAgICAgICAgIGNhc2UgXCI9PVwiOlxyXG4gICAgICAgICAgICAgICAgY2FzZSBcIiE9XCI6XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiPFwiOlxyXG4gICAgICAgICAgICAgICAgY2FzZSBcIjw9XCI6XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiPlwiOlxyXG4gICAgICAgICAgICAgICAgY2FzZSBcIj49XCI6XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0Lm5vZGVzLnB1c2gobmV3IE9wZXJhdG9yTm9kZSh0aGlzLmN1cnJlbnQudHlwZSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZU5leHQoKTtcclxuICAgICAgICAgICAgICAgICAgICBleHBlY3RlZE5leHRUb2tlblR5cGVzID0gbGl0ZXJhbHMuY29uY2F0KFwiKFwiKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgZXhwZWN0ZWROZXh0VG9rZW5UeXBlcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShFeHByZXNzaW9uUGFyc2VyLnByb3RvdHlwZSwgXCJlb2VcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5faW5kZXggPj0gdGhpcy5fdG9rZW5zLmxlbmd0aDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShFeHByZXNzaW9uUGFyc2VyLnByb3RvdHlwZSwgXCJjdXJyZW50XCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Rva2Vuc1t0aGlzLl9pbmRleF07XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBFeHByZXNzaW9uUGFyc2VyLnBhcnNlQmluZGluZyA9IGZ1bmN0aW9uIChiaW5kaW5nRXhwcmVzc2lvbikge1xyXG4gICAgICAgIHZhciBwYXJzZXIgPSBuZXcgRXhwcmVzc2lvblBhcnNlcihUb2tlbml6ZXIucGFyc2UoYmluZGluZ0V4cHJlc3Npb24pKTtcclxuICAgICAgICBwYXJzZXIucGFyc2VUb2tlbihcIntcIik7XHJcbiAgICAgICAgdmFyIGFsbG93TnVsbCA9ICFwYXJzZXIucGFyc2VPcHRpb25hbFRva2VuKFwiPyNcIik7XHJcbiAgICAgICAgdmFyIGV4cHJlc3Npb24gPSBwYXJzZXIucGFyc2VFeHByZXNzaW9uKCk7XHJcbiAgICAgICAgcGFyc2VyLnBhcnNlVG9rZW4oXCJ9XCIpO1xyXG4gICAgICAgIHJldHVybiBuZXcgQmluZGluZyhleHByZXNzaW9uLCBhbGxvd051bGwpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBFeHByZXNzaW9uUGFyc2VyO1xyXG59KCkpO1xyXG5leHBvcnRzLkV4cHJlc3Npb25QYXJzZXIgPSBFeHByZXNzaW9uUGFyc2VyO1xyXG52YXIgQmluZGluZyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEJpbmRpbmcoZXhwcmVzc2lvbiwgYWxsb3dOdWxsKSB7XHJcbiAgICAgICAgaWYgKGFsbG93TnVsbCA9PT0gdm9pZCAwKSB7IGFsbG93TnVsbCA9IHRydWU7IH1cclxuICAgICAgICB0aGlzLmV4cHJlc3Npb24gPSBleHByZXNzaW9uO1xyXG4gICAgICAgIHRoaXMuYWxsb3dOdWxsID0gYWxsb3dOdWxsO1xyXG4gICAgfVxyXG4gICAgQmluZGluZy5wcm90b3R5cGUuZXZhbHVhdGUgPSBmdW5jdGlvbiAoY29udGV4dCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmV4cHJlc3Npb24uZXZhbHVhdGUoY29udGV4dCk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIEJpbmRpbmc7XHJcbn0oKSk7XHJcbmV4cG9ydHMuQmluZGluZyA9IEJpbmRpbmc7XHJcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWV4cHJlc3Npb24tcGFyc2VyLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbi8vIENvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxyXG4vLyBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIExpY2Vuc2UuXHJcbnZhciBleHByZXNzaW9uX3BhcnNlcl8xID0gcmVxdWlyZShcIi4vZXhwcmVzc2lvbi1wYXJzZXJcIik7XHJcbnZhciBUZW1wbGF0aXplZFN0cmluZyA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFRlbXBsYXRpemVkU3RyaW5nKCkge1xyXG4gICAgICAgIHRoaXMuX3BhcnRzID0gW107XHJcbiAgICAgICAgdGhpcy5fc2hvdWxkRHJvcE93bmVyID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBUZW1wbGF0aXplZFN0cmluZy5wYXJzZSA9IGZ1bmN0aW9uIChzKSB7XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IG5ldyBUZW1wbGF0aXplZFN0cmluZygpO1xyXG4gICAgICAgIHZhciBpID0gMDtcclxuICAgICAgICBkbyB7XHJcbiAgICAgICAgICAgIHZhciBleHByZXNzaW9uRm91bmQgPSBmYWxzZTtcclxuICAgICAgICAgICAgdmFyIHN0YXJ0ID0gaTtcclxuICAgICAgICAgICAgdmFyIGxvb3AgPSB2b2lkIDA7XHJcbiAgICAgICAgICAgIGRvIHtcclxuICAgICAgICAgICAgICAgIGxvb3AgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHN0YXJ0ID0gcy5pbmRleE9mKFwie1wiLCBzdGFydCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoc3RhcnQgPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzdGFydCArIDEgPCBzLmxlbmd0aCAmJiBzW3N0YXJ0ICsgMV0gPT0gXCJ7XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQgKz0gMjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9vcCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9IHdoaWxlIChsb29wKTtcclxuICAgICAgICAgICAgaWYgKHN0YXJ0ID49IDApIHtcclxuICAgICAgICAgICAgICAgIHZhciBlbmQgPSBzLmluZGV4T2YoXCJ9XCIsIHN0YXJ0KTtcclxuICAgICAgICAgICAgICAgIGlmIChlbmQgPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGV4cHJlc3Npb25Gb3VuZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXJ0ID4gaSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuX3BhcnRzLnB1c2gocy5zdWJzdHJpbmcoaSwgc3RhcnQpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGJpbmRuZ0V4cHJlc3Npb24gPSBzLnN1YnN0cmluZyhzdGFydCwgZW5kICsgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcnQgPSB2b2lkIDA7XHJcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGFydCA9IGV4cHJlc3Npb25fcGFyc2VyXzEuRXhwcmVzc2lvblBhcnNlci5wYXJzZUJpbmRpbmcoYmluZG5nRXhwcmVzc2lvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcnQgPSBiaW5kbmdFeHByZXNzaW9uO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQuX3BhcnRzLnB1c2gocGFydCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaSA9IGVuZCArIDE7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKCFleHByZXNzaW9uRm91bmQpIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5fcGFydHMucHVzaChzLnN1YnN0cihpKSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gd2hpbGUgKGkgPCBzLmxlbmd0aCk7XHJcbiAgICAgICAgaWYgKHJlc3VsdC5fcGFydHMubGVuZ3RoID09IDEgJiYgdHlwZW9mIHJlc3VsdC5fcGFydHNbMF0gPT09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5fcGFydHNbMF07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBUZW1wbGF0aXplZFN0cmluZy5wcm90b3R5cGUuZXZhbEV4cHJlc3Npb24gPSBmdW5jdGlvbiAoYmluZGluZ0V4cHJlc3Npb24sIGNvbnRleHQpIHtcclxuICAgICAgICB2YXIgcmVzdWx0ID0gYmluZGluZ0V4cHJlc3Npb24uZXZhbHVhdGUoY29udGV4dCk7XHJcbiAgICAgICAgaWYgKHJlc3VsdCA9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5fc2hvdWxkRHJvcE93bmVyID0gdGhpcy5fc2hvdWxkRHJvcE93bmVyIHx8ICFiaW5kaW5nRXhwcmVzc2lvbi5hbGxvd051bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9O1xyXG4gICAgVGVtcGxhdGl6ZWRTdHJpbmcucHJvdG90eXBlLmludGVybmFsRXZhbHVhdGUgPSBmdW5jdGlvbiAoY29udGV4dCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9wYXJ0cy5sZW5ndGggPT0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICh0aGlzLl9wYXJ0cy5sZW5ndGggPT0gMSkge1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIHRoaXMuX3BhcnRzWzBdID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fcGFydHNbMF07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5ldmFsRXhwcmVzc2lvbih0aGlzLl9wYXJ0c1swXSwgY29udGV4dCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHZhciBzID0gXCJcIjtcclxuICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IHRoaXMuX3BhcnRzOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHBhcnQgPSBfYVtfaV07XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHBhcnQgPT09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBzICs9IHBhcnQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBzICs9IHRoaXMuZXZhbEV4cHJlc3Npb24ocGFydCwgY29udGV4dCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHM7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFRlbXBsYXRpemVkU3RyaW5nLnByb3RvdHlwZS5ldmFsdWF0ZSA9IGZ1bmN0aW9uIChjb250ZXh0KSB7XHJcbiAgICAgICAgdGhpcy5fc2hvdWxkRHJvcE93bmVyID0gZmFsc2U7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuaW50ZXJuYWxFdmFsdWF0ZShjb250ZXh0KTtcclxuICAgIH07XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoVGVtcGxhdGl6ZWRTdHJpbmcucHJvdG90eXBlLCBcInNob3VsZERyb3BPd25lclwiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zaG91bGREcm9wT3duZXI7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gVGVtcGxhdGl6ZWRTdHJpbmc7XHJcbn0oKSk7XHJcbmV4cG9ydHMuVGVtcGxhdGl6ZWRTdHJpbmcgPSBUZW1wbGF0aXplZFN0cmluZztcclxudmFyIFRlbXBsYXRlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gVGVtcGxhdGUocGF5bG9hZCkge1xyXG4gICAgICAgIHRoaXMucHJlcGFyZWRQYXlsb2FkID0gVGVtcGxhdGUucHJlcGFyZShwYXlsb2FkKTtcclxuICAgIH1cclxuICAgIFRlbXBsYXRlLnByZXBhcmUgPSBmdW5jdGlvbiAobm9kZSkge1xyXG4gICAgICAgIGlmICh0eXBlb2Ygbm9kZSA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICByZXR1cm4gVGVtcGxhdGl6ZWRTdHJpbmcucGFyc2Uobm9kZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHR5cGVvZiBub2RlID09PSBcIm9iamVjdFwiICYmIG5vZGUgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShub2RlKSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IFtdO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBub2RlXzEgPSBub2RlOyBfaSA8IG5vZGVfMS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IG5vZGVfMVtfaV07XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goVGVtcGxhdGUucHJlcGFyZShpdGVtKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhub2RlKTtcclxuICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSB7fTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIF9hID0gMCwga2V5c18xID0ga2V5czsgX2EgPCBrZXlzXzEubGVuZ3RoOyBfYSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGtleSA9IGtleXNfMVtfYV07XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0W2tleV0gPSBUZW1wbGF0ZS5wcmVwYXJlKG5vZGVba2V5XSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gbm9kZTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgVGVtcGxhdGUucHJvdG90eXBlLmV4cGFuZFNpbmdsZU9iamVjdCA9IGZ1bmN0aW9uIChub2RlKSB7XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IHt9O1xyXG4gICAgICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMobm9kZSk7XHJcbiAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBrZXlzXzIgPSBrZXlzOyBfaSA8IGtleXNfMi5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgdmFyIGtleSA9IGtleXNfMltfaV07XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5fY29udGV4dC5pc1Jlc2VydmVkRmllbGQoa2V5KSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gdGhpcy5pbnRlcm5hbEV4cGFuZChub2RlW2tleV0pO1xyXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlICE9IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdFtrZXldID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH07XHJcbiAgICBUZW1wbGF0ZS5wcm90b3R5cGUuaW50ZXJuYWxFeHBhbmQgPSBmdW5jdGlvbiAobm9kZSkge1xyXG4gICAgICAgIHZhciByZXN1bHQ7XHJcbiAgICAgICAgdGhpcy5fY29udGV4dC5zYXZlU3RhdGUoKTtcclxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShub2RlKSkge1xyXG4gICAgICAgICAgICB2YXIgaXRlbUFycmF5ID0gW107XHJcbiAgICAgICAgICAgIGZvciAodmFyIF9pID0gMCwgbm9kZV8yID0gbm9kZTsgX2kgPCBub2RlXzIubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IG5vZGVfMltfaV07XHJcbiAgICAgICAgICAgICAgICB2YXIgZXhwYW5kZWRJdGVtID0gdGhpcy5pbnRlcm5hbEV4cGFuZChpdGVtKTtcclxuICAgICAgICAgICAgICAgIGlmIChleHBhbmRlZEl0ZW0gIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGV4cGFuZGVkSXRlbSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbUFycmF5ID0gaXRlbUFycmF5LmNvbmNhdChleHBhbmRlZEl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbUFycmF5LnB1c2goZXhwYW5kZWRJdGVtKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmVzdWx0ID0gaXRlbUFycmF5O1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChub2RlIGluc3RhbmNlb2YgVGVtcGxhdGl6ZWRTdHJpbmcpIHtcclxuICAgICAgICAgICAgcmVzdWx0ID0gbm9kZS5ldmFsdWF0ZSh0aGlzLl9jb250ZXh0KTtcclxuICAgICAgICAgICAgaWYgKG5vZGUuc2hvdWxkRHJvcE93bmVyKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHR5cGVvZiBub2RlID09PSBcIm9iamVjdFwiICYmIG5vZGUgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICB2YXIgZHJvcE9iamVjdCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB2YXIgd2hlbiA9IG5vZGVbXCIkd2hlblwiXTtcclxuICAgICAgICAgICAgaWYgKHdoZW4gaW5zdGFuY2VvZiBUZW1wbGF0aXplZFN0cmluZykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHdoZW5WYWx1ZSA9IHdoZW4uZXZhbHVhdGUodGhpcy5fY29udGV4dCk7XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHdoZW5WYWx1ZSA9PT0gXCJib29sZWFuXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBkcm9wT2JqZWN0ID0gIXdoZW5WYWx1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoIWRyb3BPYmplY3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciBkYXRhQ29udGV4dCA9IG5vZGVbXCIkZGF0YVwiXTtcclxuICAgICAgICAgICAgICAgIGlmIChkYXRhQ29udGV4dCAhPSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGF0YUNvbnRleHQgaW5zdGFuY2VvZiBUZW1wbGF0aXplZFN0cmluZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhQ29udGV4dCA9IGRhdGFDb250ZXh0LmV2YWx1YXRlKHRoaXMuX2NvbnRleHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShkYXRhQ29udGV4dCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gW107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGF0YUNvbnRleHQubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2NvbnRleHQuJGRhdGEgPSBkYXRhQ29udGV4dFtpXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2NvbnRleHQuJGluZGV4ID0gaTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBleHBhbmRlZE9iamVjdCA9IHRoaXMuZXhwYW5kU2luZ2xlT2JqZWN0KG5vZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV4cGFuZGVkT2JqZWN0ICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucHVzaChleHBhbmRlZE9iamVjdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2NvbnRleHQuJGRhdGEgPSBkYXRhQ29udGV4dDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gdGhpcy5leHBhbmRTaW5nbGVPYmplY3Qobm9kZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gdGhpcy5leHBhbmRTaW5nbGVPYmplY3Qobm9kZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICByZXN1bHQgPSBub2RlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLl9jb250ZXh0LnJlc3RvcmVMYXN0U3RhdGUoKTtcclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfTtcclxuICAgIFRlbXBsYXRlLnByb3RvdHlwZS5leHBhbmQgPSBmdW5jdGlvbiAoY29udGV4dCkge1xyXG4gICAgICAgIHRoaXMuX2NvbnRleHQgPSBjb250ZXh0O1xyXG4gICAgICAgIHJldHVybiB0aGlzLmludGVybmFsRXhwYW5kKHRoaXMucHJlcGFyZWRQYXlsb2FkKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gVGVtcGxhdGU7XHJcbn0oKSk7XHJcbmV4cG9ydHMuVGVtcGxhdGUgPSBUZW1wbGF0ZTtcclxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9dGVtcGxhdGUtZW5naW5lLmpzLm1hcCIsImV4cG9ydCAqIGZyb20gXCIuL2NvcmVcIjtcclxuZXhwb3J0ICogZnJvbSBcIi4vY2hhbm5lbC1hZGFwdGVyXCI7XHJcbmV4cG9ydCAqIGZyb20gXCIuL2h0dHAtY2hhbm5lbC1hZGFwdGVyXCI7XHJcbmV4cG9ydCAqIGZyb20gXCIuL2ludm9rZS1hY3Rpdml0eVwiXHJcbiIsImltcG9ydCB7IEFjdGl2aXR5UmVzcG9uc2UsIEFjdGl2aXR5UmVxdWVzdCB9IGZyb20gXCIuL2ludm9rZS1hY3Rpdml0eVwiO1xyXG5cclxuZXhwb3J0IGFic3RyYWN0IGNsYXNzIENoYW5uZWxBZGFwdGVyIHtcclxuICAgIGFic3RyYWN0IGFzeW5jIHNlbmRSZXF1ZXN0QXN5bmMocmVxdWVzdDogQWN0aXZpdHlSZXF1ZXN0KTogUHJvbWlzZTxBY3Rpdml0eVJlc3BvbnNlPjtcclxufVxyXG4iLCJpbXBvcnQgKiBhcyBBZGFwdGl2ZSBmcm9tIFwiYWRhcHRpdmVjYXJkc1wiO1xyXG5pbXBvcnQgKiBhcyBUZW1wbGF0aW5nIGZyb20gXCJhZGFwdGl2ZWNhcmRzLXRlbXBsYXRpbmdcIjtcclxuaW1wb3J0IHsgQ2hhbm5lbEFkYXB0ZXIgfSBmcm9tIFwiLi9jaGFubmVsLWFkYXB0ZXJcIjtcclxuaW1wb3J0IHsgQWN0aXZpdHlTdGF0dXMsIEFjdGl2aXR5UmVzcG9uc2UsIEFjdGl2aXR5UmVxdWVzdCwgQWN0aXZpdHlJbnZvY2F0aW9uQ29udGV4dCB9IGZyb20gXCIuL2ludm9rZS1hY3Rpdml0eVwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIEV4ZWN1dGVBY3Rpb24gZXh0ZW5kcyBBZGFwdGl2ZS5TdWJtaXRBY3Rpb24ge1xyXG4gICAgLy8jcmVnaW9uIFNjaGVtYVxyXG5cclxuICAgIHN0YXRpYyByZWFkb25seSB2ZXJiUHJvcGVydHkgPSBuZXcgQWRhcHRpdmUuU3RyaW5nUHJvcGVydHkoQWRhcHRpdmUuVmVyc2lvbnMudjFfMiwgXCJ2ZXJiXCIpO1xyXG5cclxuICAgIEBBZGFwdGl2ZS5wcm9wZXJ0eShFeGVjdXRlQWN0aW9uLnZlcmJQcm9wZXJ0eSlcclxuICAgIHZlcmI6IHN0cmluZztcclxuXHJcbiAgICAvLyNlbmRyZWdpb25cclxuXHJcbiAgICBnZXRKc29uVHlwZU5hbWUoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gXCJBY3Rpb24uRXhlY3V0ZVwiO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgQXV0b1JlZnJlc2hBY3Rpb25Qcm9wZXJ0eSBleHRlbmRzIEFkYXB0aXZlLlByb3BlcnR5RGVmaW5pdGlvbiB7XHJcbiAgICBwYXJzZShzZW5kZXI6IEF1dG9SZWZyZXNoRGVmaW5pdGlvbiwgc291cmNlOiBBZGFwdGl2ZS5Qcm9wZXJ0eUJhZywgY29udGV4dDogQWRhcHRpdmUuU2VyaWFsaXphdGlvbkNvbnRleHQpOiBFeGVjdXRlQWN0aW9uIHwgdW5kZWZpbmVkIHtcclxuICAgICAgICBsZXQgYWN0aW9uID0gY29udGV4dC5wYXJzZUFjdGlvbihcclxuICAgICAgICAgICAgc2VuZGVyLnBhcmVudCxcclxuICAgICAgICAgICAgc291cmNlW3RoaXMubmFtZV0sXHJcbiAgICAgICAgICAgIFtdLFxyXG4gICAgICAgICAgICBmYWxzZSk7XHJcblxyXG4gICAgICAgIGlmIChhY3Rpb24gJiYgYWN0aW9uIGluc3RhbmNlb2YgRXhlY3V0ZUFjdGlvbikge1xyXG4gICAgICAgICAgICByZXR1cm4gYWN0aW9uO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29udGV4dC5sb2dQYXJzZUV2ZW50KFxyXG4gICAgICAgICAgICAgICAgQWRhcHRpdmUuVmFsaWRhdGlvbkV2ZW50LkFjdGlvblR5cGVOb3RBbGxvd2VkLFxyXG4gICAgICAgICAgICAgICAgXCJcXFwiYXV0b1JlZnJlc2hcXFwiIG11c3QgaGF2ZSBpdHMgXFxcImFjdGlvblxcXCIgcHJvcGVydHkgZGVmaW5lZCBhcyBhbiBBY3Rpb24uRXhlY3V0ZSBvYmplY3RcIixcclxuICAgICAgICAgICAgICAgIHNlbmRlcik7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB0b0pTT04oc2VuZGVyOiBBZGFwdGl2ZS5TZXJpYWxpemFibGVPYmplY3QsIHRhcmdldDogQWRhcHRpdmUuUHJvcGVydHlCYWcsIHZhbHVlOiBFeGVjdXRlQWN0aW9uIHwgdW5kZWZpbmVkLCBjb250ZXh0OiBBZGFwdGl2ZS5TZXJpYWxpemF0aW9uQ29udGV4dCkge1xyXG4gICAgICAgIGNvbnRleHQuc2VyaWFsaXplVmFsdWUodGFyZ2V0LCB0aGlzLm5hbWUsIHZhbHVlID8gdmFsdWUudG9KU09OKGNvbnRleHQpIDogdW5kZWZpbmVkKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdHJ1Y3RvcihyZWFkb25seSB0YXJnZXRWZXJzaW9uOiBBZGFwdGl2ZS5WZXJzaW9uLCByZWFkb25seSBuYW1lOiBzdHJpbmcpIHtcclxuICAgICAgICBzdXBlcih0YXJnZXRWZXJzaW9uLCBuYW1lLCB1bmRlZmluZWQpO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgY2xhc3MgQXV0b1JlZnJlc2hEZWZpbml0aW9uIGV4dGVuZHMgQWRhcHRpdmUuU2VyaWFsaXphYmxlT2JqZWN0IHtcclxuICAgIC8vI3JlZ2lvbiBTY2hlbWFcclxuXHJcbiAgICBzdGF0aWMgcmVhZG9ubHkgdXNlcklkc1Byb3BlcnR5ID0gbmV3IEFkYXB0aXZlLlN0cmluZ0FycmF5UHJvcGVydHkoQWRhcHRpdmUuVmVyc2lvbnMudjFfMCwgXCJ1c2VySWRzXCIpO1xyXG4gICAgc3RhdGljIHJlYWRvbmx5IGRpc3BsYXlDdXJyZW50Q2FyZFdoaWxlUmVmcmVzaGluZ1Byb3BlcnR5ID0gbmV3IEFkYXB0aXZlLkJvb2xQcm9wZXJ0eShBZGFwdGl2ZS5WZXJzaW9ucy52MV8wLCBcImRpc3BsYXlDdXJyZW50Q2FyZFdoaWxlUmVmcmVzaGluZ1wiLCB0cnVlKTtcclxuICAgIHN0YXRpYyByZWFkb25seSBhY3Rpb25Qcm9wZXJ0eSA9IG5ldyBBdXRvUmVmcmVzaEFjdGlvblByb3BlcnR5KEFkYXB0aXZlLlZlcnNpb25zLnYxXzAsIFwiYWN0aW9uXCIpO1xyXG5cclxuICAgIEBBZGFwdGl2ZS5wcm9wZXJ0eShBdXRvUmVmcmVzaERlZmluaXRpb24udXNlcklkc1Byb3BlcnR5KVxyXG4gICAgdXNlcklkczogc3RyaW5nW107XHJcblxyXG4gICAgQEFkYXB0aXZlLnByb3BlcnR5KEF1dG9SZWZyZXNoRGVmaW5pdGlvbi5kaXNwbGF5Q3VycmVudENhcmRXaGlsZVJlZnJlc2hpbmdQcm9wZXJ0eSlcclxuICAgIGRpc3BsYXlDdXJyZW50Q2FyZFdoaWxlUmVmcmVzaGluZzogYm9vbGVhbjtcclxuXHJcbiAgICBAQWRhcHRpdmUucHJvcGVydHkoQXV0b1JlZnJlc2hEZWZpbml0aW9uLmFjdGlvblByb3BlcnR5KVxyXG4gICAgZ2V0IGFjdGlvbigpOiBFeGVjdXRlQWN0aW9uIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRWYWx1ZShBdXRvUmVmcmVzaERlZmluaXRpb24uYWN0aW9uUHJvcGVydHkpO1xyXG4gICAgfVxyXG5cclxuICAgIHNldCBhY3Rpb24odmFsdWU6IEV4ZWN1dGVBY3Rpb24pIHtcclxuICAgICAgICB0aGlzLnNldFZhbHVlKEF1dG9SZWZyZXNoRGVmaW5pdGlvbi5hY3Rpb25Qcm9wZXJ0eSwgdmFsdWUpO1xyXG5cclxuICAgICAgICBpZiAodmFsdWUpIHtcclxuICAgICAgICAgICAgdmFsdWUuc2V0UGFyZW50KHRoaXMucGFyZW50KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJvdGVjdGVkIGdldFNjaGVtYUtleSgpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiBcIkF1dG9SZWZyZXNoRGVmaW5pdGlvblwiO1xyXG4gICAgfVxyXG5cclxuICAgIC8vI2VuZHJlZ2lvblxyXG5cclxuICAgIHBhcmVudDogQWRhcHRpdmUuQ2FyZEVsZW1lbnQ7XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBBZGFwdGl2ZUFwcGxldENhcmQgZXh0ZW5kcyBBZGFwdGl2ZS5BZGFwdGl2ZUNhcmQge1xyXG4gICAgLy8jcmVnaW9uIFNjaGVtYVxyXG5cclxuICAgIHN0YXRpYyByZWFkb25seSBhcHBJZFByb3BlcnR5ID0gbmV3IEFkYXB0aXZlLlN0cmluZ1Byb3BlcnR5KEFkYXB0aXZlLlZlcnNpb25zLnYxXzAsIFwiYXBwSWRcIiwgdHJ1ZSk7XHJcbiAgICBzdGF0aWMgcmVhZG9ubHkgYXV0b1JlZnJlc2hQcm9wZXJ0eSA9IG5ldyBBZGFwdGl2ZS5TZXJpYWxpemFibGVPYmplY3RQcm9wZXJ0eShBZGFwdGl2ZS5WZXJzaW9ucy52MV8wLCBcImF1dG9SZWZyZXNoXCIsIEF1dG9SZWZyZXNoRGVmaW5pdGlvbiwgdHJ1ZSk7XHJcblxyXG4gICAgQEFkYXB0aXZlLnByb3BlcnR5KEFkYXB0aXZlQXBwbGV0Q2FyZC5hcHBJZFByb3BlcnR5KVxyXG4gICAgYXBwSWQ6IHN0cmluZztcclxuXHJcbiAgICBAQWRhcHRpdmUucHJvcGVydHkoQWRhcHRpdmVBcHBsZXRDYXJkLmF1dG9SZWZyZXNoUHJvcGVydHkpXHJcbiAgICBnZXQgYXV0b1JlZnJlc2goKTogQXV0b1JlZnJlc2hEZWZpbml0aW9uIHwgdW5kZWZpbmVkIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5nZXRWYWx1ZShBZGFwdGl2ZUFwcGxldENhcmQuYXV0b1JlZnJlc2hQcm9wZXJ0eSk7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0IGF1dG9SZWZyZXNoKHZhbHVlOiBBdXRvUmVmcmVzaERlZmluaXRpb24gfCB1bmRlZmluZWQpIHtcclxuICAgICAgICB0aGlzLnNldFZhbHVlKEFkYXB0aXZlQXBwbGV0Q2FyZC5hdXRvUmVmcmVzaFByb3BlcnR5LCB2YWx1ZSk7XHJcblxyXG4gICAgICAgIGlmICh2YWx1ZSkge1xyXG4gICAgICAgICAgICB2YWx1ZS5wYXJlbnQgPSB0aGlzO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcm90ZWN0ZWQgZ2V0U2NoZW1hS2V5KCk6IHN0cmluZyB7XHJcbiAgICAgICAgcmV0dXJuIFwiQWRhcHRpdmVBcHBsZXRDYXJkXCI7XHJcbiAgICB9XHJcblxyXG4gICAgLy8jZW5kcmVnaW9uXHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBBZGFwdGl2ZUFwcGxldCB7XHJcbiAgICBwcml2YXRlIHN0YXRpYyBfZWxlbWVudHNSZWdpc3RyeSA9IG5ldyBBZGFwdGl2ZS5DYXJkT2JqZWN0UmVnaXN0cnk8QWRhcHRpdmUuQ2FyZEVsZW1lbnQ+KCk7XHJcbiAgICBwcml2YXRlIHN0YXRpYyBfYWN0aW9uc1JlZ2lzdHJ5ID0gbmV3IEFkYXB0aXZlLkNhcmRPYmplY3RSZWdpc3RyeTxBZGFwdGl2ZS5BY3Rpb24+KCk7XHJcblxyXG4gICAgc3RhdGljIG1heGltdW1SZXF1ZXN0QXR0ZW1wdHM6IG51bWJlciA9IDM7XHJcbiAgICBzdGF0aWMgZGVmYXVsdFRpbWVCZXR3ZWVuQXR0ZW1wdHM6IG51bWJlciA9IDMwMDA7IC8vIDMgc2Vjb25kc1xyXG4gICAgc3RhdGljIGF1dGhQcm9tcHRXaWR0aDogbnVtYmVyID0gNDAwO1xyXG4gICAgc3RhdGljIGF1dGhQcm9tcHRIZWlnaHQ6IG51bWJlciA9IDYwMDtcclxuXHJcbiAgICBzdGF0aWMgaW5pdGlhbGl6ZSgpIHtcclxuICAgICAgICBBZGFwdGl2ZS5HbG9iYWxSZWdpc3RyeS5wb3B1bGF0ZVdpdGhEZWZhdWx0RWxlbWVudHMoQWRhcHRpdmVBcHBsZXQuX2VsZW1lbnRzUmVnaXN0cnkpO1xyXG4gICAgICAgIEFkYXB0aXZlLkdsb2JhbFJlZ2lzdHJ5LnBvcHVsYXRlV2l0aERlZmF1bHRBY3Rpb25zKEFkYXB0aXZlQXBwbGV0Ll9hY3Rpb25zUmVnaXN0cnkpO1xyXG5cclxuICAgICAgICBBZGFwdGl2ZUFwcGxldC5fYWN0aW9uc1JlZ2lzdHJ5LnVucmVnaXN0ZXIoXCJBY3Rpb24uU3VibWl0XCIpO1xyXG4gICAgICAgIEFkYXB0aXZlQXBwbGV0Ll9hY3Rpb25zUmVnaXN0cnkucmVnaXN0ZXIoXCJBY3Rpb24uRXhlY3V0ZVwiLCBFeGVjdXRlQWN0aW9uLCBBZGFwdGl2ZS5WZXJzaW9ucy52MV8yKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF9jYXJkPzogQWRhcHRpdmVBcHBsZXRDYXJkO1xyXG4gICAgcHJpdmF0ZSBfY2FyZFBheWxvYWQ6IGFueTtcclxuICAgIHByaXZhdGUgX2NhcmREYXRhOiBhbnk7XHJcblxyXG4gICAgcHJpdmF0ZSBkaXNwbGF5Q2FyZChjYXJkOiBBZGFwdGl2ZS5BZGFwdGl2ZUNhcmQpIHtcclxuICAgICAgICBpZiAoY2FyZC5yZW5kZXJlZEVsZW1lbnQpIHtcclxuICAgICAgICAgICAgd2hpbGUgKHRoaXMucmVuZGVyZWRFbGVtZW50LmZpcnN0Q2hpbGQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZWRFbGVtZW50LnJlbW92ZUNoaWxkKHRoaXMucmVuZGVyZWRFbGVtZW50LmZpcnN0Q2hpbGQpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVkRWxlbWVudC5hcHBlbmRDaGlsZChjYXJkLnJlbmRlcmVkRWxlbWVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJkaXNwbGF5Q2FyZDogdW5kZWZpbmVkIGNhcmQuXCIpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNyZWF0ZUFjdGl2aXR5UmVxdWVzdChhY3Rpb246IEV4ZWN1dGVBY3Rpb24sIGNvbnRleHQ6IEFjdGl2aXR5SW52b2NhdGlvbkNvbnRleHQpOiBBY3Rpdml0eVJlcXVlc3QgfCB1bmRlZmluZWQge1xyXG4gICAgICAgIGlmICh0aGlzLmNhcmQpIHtcclxuICAgICAgICAgICAgbGV0IHJlcXVlc3Q6IEFjdGl2aXR5UmVxdWVzdCA9IHtcclxuICAgICAgICAgICAgICAgIGNvbnRleHQ6IGNvbnRleHQsXHJcbiAgICAgICAgICAgICAgICBhY3Rpdml0eToge1xyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiaW52b2tlXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogXCJhZGFwdGl2ZUNhcmQvYWN0aW9uXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgYXBwSWQ6IHRoaXMuY2FyZC5hcHBJZCxcclxuICAgICAgICAgICAgICAgICAgICBsb2NhbFRpbWV6b25lOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsVGltZXN0YW1wOiBcIlwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJBY3Rpb24uRXhlY3V0ZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGFjdGlvbi5pZCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZlcmI6IGFjdGlvbi52ZXJiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogYWN0aW9uLmRhdGFcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBhdHRlbXB0TnVtYmVyOiAwXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBsZXQgY2FuY2VsID0gdGhpcy5vblByZXBhcmVBY3Rpdml0eVJlcXVlc3QgPyAhdGhpcy5vblByZXBhcmVBY3Rpdml0eVJlcXVlc3QodGhpcywgYWN0aW9uLCByZXF1ZXN0KSA6IGZhbHNlO1xyXG5cclxuICAgICAgICAgICAgcmV0dXJuIGNhbmNlbCA/IHVuZGVmaW5lZCA6IHJlcXVlc3Q7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJjcmVhdGVBY3Rpdml0eVJlcXVlc3Q6IG5vIGNhcmQgaGFzIGJlZW4gc2V0LlwiKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjcmVhdGVNYWdpY0NvZGVJbnB1dENhcmQoYXR0ZW1wdE51bWJlcjogbnVtYmVyKTogQWRhcHRpdmUuQWRhcHRpdmVDYXJkIHtcclxuICAgICAgICBsZXQgcGF5bG9hZCA9IHtcclxuICAgICAgICAgICAgdHlwZTogXCJBZGFwdGl2ZUNhcmRcIixcclxuICAgICAgICAgICAgdmVyc2lvbjogXCIxLjBcIixcclxuICAgICAgICAgICAgYm9keTogW1xyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiVGV4dEJsb2NrXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgY29sb3I6IFwiYXR0ZW50aW9uXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogYXR0ZW1wdE51bWJlciA9PT0gMCA/IHVuZGVmaW5lZCA6IFwiVGhhdCBkaWRuJ3Qgd29yay4uLiBsZXQncyB0cnkgYWdhaW4uXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgd3JhcDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICBob3Jpem9udGFsQWxpZ25tZW50OiBcImNlbnRlclwiXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiVGV4dEJsb2NrXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogXCJQbGVhc2UgbG9naW4gaW4gdGhlIHBvcHVwLiBZb3Ugd2lsbCBvYnRhaW4gYSBtYWdpYyBjb2RlLiBQYXN0ZSB0aGF0IGNvZGUgYmVsb3cgYW5kIHNlbGVjdCBcXFwiU3VibWl0XFxcIlwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHdyYXA6IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgaG9yaXpvbnRhbEFsaWdubWVudDogXCJjZW50ZXJcIlxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIklucHV0LlRleHRcIixcclxuICAgICAgICAgICAgICAgICAgICBpZDogXCJtYWdpY0NvZGVcIixcclxuICAgICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogXCJFbnRlciBtYWdpYyBjb2RlXCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJBY3Rpb25TZXRcIixcclxuICAgICAgICAgICAgICAgICAgICBob3Jpem9udGFsQWxpZ25tZW50OiBcImNlbnRlclwiLFxyXG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbnM6IFtcclxuICAgICAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJBY3Rpb24uU3VibWl0XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZDogXCJzdWJtaXRNYWdpY0NvZGVcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiBcIlN1Ym1pdFwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiQWN0aW9uLlN1Ym1pdFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IFwiY2FuY2VsXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogXCJDYW5jZWxcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIkFjdGlvbi5TdWJtaXRcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBcIndvbnRXb3JrXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogXCJUaGlzIHdvbid0IHdvcmtcIlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgXVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBdXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgbGV0IGNhcmQgPSBuZXcgQWRhcHRpdmUuQWRhcHRpdmVDYXJkKCk7XHJcbiAgICAgICAgY2FyZC5wYXJzZShwYXlsb2FkKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGNhcmQ7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpbnRlcm5hbEV4ZWN1dGVBY3Rpb24oYWN0aW9uOiBBZGFwdGl2ZS5BY3Rpb24sIGNvbnRleHQ6IEFjdGl2aXR5SW52b2NhdGlvbkNvbnRleHQpIHtcclxuICAgICAgICBpZiAodGhpcy5jaGFubmVsQWRhcHRlcikge1xyXG4gICAgICAgICAgICBpZiAoYWN0aW9uIGluc3RhbmNlb2YgRXhlY3V0ZUFjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgbGV0IHJlcXVlc3QgPSB0aGlzLmNyZWF0ZUFjdGl2aXR5UmVxdWVzdChhY3Rpb24sIGNvbnRleHQpO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChyZXF1ZXN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnRlcm5hbFNlbmRBY3Rpdml0eVJlcXVlc3RBc3luYyhyZXF1ZXN0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImludGVybmFsRXhlY3V0ZUFjdGlvbjogVW5zdXBwb3J0ZWQgYWN0aW9uIHR5cGUuXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJpbnRlcm5hbEV4ZWN1dGVBY3Rpb246IE5vIGNoYW5uZWwgYWRhcHRlciBzZXQuXCIpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGFzeW5jIGludGVybmFsU2VuZEFjdGl2aXR5UmVxdWVzdEFzeW5jKHJlcXVlc3Q6IEFjdGl2aXR5UmVxdWVzdCkge1xyXG4gICAgICAgIGlmICghdGhpcy5jaGFubmVsQWRhcHRlcikge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJpbnRlcm5hbFNlbmRBY3Rpdml0eVJlcXVlc3RBc3luYzogY2hhbm5lbEFkYXB0ZXIgaXMgbm90IHNldC5cIilcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBvdmVybGF5ID0gdGhpcy5jcmVhdGVQcm9ncmVzc092ZXJsYXkocmVxdWVzdC5jb250ZXh0KTtcclxuXHJcbiAgICAgICAgdGhpcy5yZW5kZXJlZEVsZW1lbnQuYXBwZW5kQ2hpbGQob3ZlcmxheSk7XHJcblxyXG4gICAgICAgIGxldCBkb25lID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHdoaWxlICghZG9uZSkge1xyXG4gICAgICAgICAgICBsZXQgcmVzcG9uc2U6IEFjdGl2aXR5UmVzcG9uc2UgfCB1bmRlZmluZWQgPSB1bmRlZmluZWQ7XHJcblxyXG4gICAgICAgICAgICBpZiAocmVxdWVzdC5hdHRlbXB0TnVtYmVyID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlNlbmRpbmcgYWN0aXZpdHkgcmVxdWVzdCB0byBjaGFubmVsIChhdHRlbXB0IFwiICsgKHJlcXVlc3QuYXR0ZW1wdE51bWJlciArIDEpICsgXCIpXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJSZS1zZW5kaW5nIGFjdGl2aXR5IHJlcXVlc3QgdG8gY2hhbm5lbCAoYXR0ZW1wdCBcIiArIChyZXF1ZXN0LmF0dGVtcHROdW1iZXIgKyAxKSArIFwiKVwiKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gYXdhaXQgdGhpcy5jaGFubmVsQWRhcHRlci5zZW5kUmVxdWVzdEFzeW5jKHJlcXVlc3QpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkFjdGl2aXR5IHJlcXVlc3QgZmFpbGVkOiBcIiArIGVycm9yKTtcclxuXHJcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcmVkRWxlbWVudC5yZW1vdmVDaGlsZChvdmVybGF5KTtcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgZG9uZSA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICAgICAgYWxlcnQoXCJTb21ldGhpbmcgd2VudCB3cm9uZzogXCIgKyBlcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgc3dpdGNoIChyZXNwb25zZS5zdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlIEFjdGl2aXR5U3RhdHVzLlN1Y2Nlc3M6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZWRFbGVtZW50LnJlbW92ZUNoaWxkKG92ZXJsYXkpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwYXJzZWRSZXN1bHQ6IGFueSA9IHVuZGVmaW5lZDtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJzZWRSZXN1bHQgPSBKU09OLnBhcnNlKHJlc3BvbnNlLmNvbnRlbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhdGNoIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlZFJlc3VsdCA9IHJlc3BvbnNlLmNvbnRlbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgcGFyc2VkUmVzdWx0ID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlRoZSBhY3Rpdml0eSByZXF1ZXN0IHJldHVybmVkIGEgc3RyaW5nIGFmdGVyIFwiICsgKHJlcXVlc3QuYXR0ZW1wdE51bWJlciArIDEpICsgXCIgYXR0ZW1wdChzKS5cIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQocGFyc2VkUmVzdWx0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgcGFyc2VkUmVzdWx0ID09PSBcIm9iamVjdFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHBhcnNlZFJlc3VsdFtcInR5cGVcIl0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQWRhcHRpdmVDYXJkXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiVGhlIGFjdGl2aXR5IHJlcXVlc3QgcmV0dXJuZWQgYW4gQWRhcHRpdmUgQ2FyZCBhZnRlciBcIiArIChyZXF1ZXN0LmF0dGVtcHROdW1iZXIgKyAxKSArIFwiIGF0dGVtcHQocykuXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRDYXJkKHBhcnNlZFJlc3VsdCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiQWN0aXZpdHkuSW52b2NhdGlvbkVycm9yLlVuYXV0aG9yaXplZFwiOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlRoZSBhY3Rpdml0eSByZXF1ZXN0IHJldHVybmVkIEFjdGl2aXR5Lkludm9jYXRpb25FcnJvci5VbmF1dGhvcml6ZWQgYWZ0ZXIgXCIgKyAocmVxdWVzdC5hdHRlbXB0TnVtYmVyICsgMSkgKyBcIiBhdHRlbXB0KHMpLlwiKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgocmVxdWVzdC5hdHRlbXB0TnVtYmVyICsgMSkgPD0gQWRhcHRpdmVBcHBsZXQubWF4aW11bVJlcXVlc3RBdHRlbXB0cykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGxvZ2luVXJsOiBVUkw7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dpblVybCA9IG5ldyBVUkwocGFyc2VkUmVzdWx0W1wibG9naW5VcmxcIl0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiSW52YWxpZCBsb2dpblVybDogXCIgKyBwYXJzZWRSZXN1bHRbXCJsb2dpblVybFwiXSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJMb2dpbiByZXF1aXJlZCBhdCBcIiArIGxvZ2luVXJsLnRvU3RyaW5nKCkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBtYWdpY0NvZGVJbnB1dENhcmQgPSB0aGlzLmNyZWF0ZU1hZ2ljQ29kZUlucHV0Q2FyZChyZXF1ZXN0LmF0dGVtcHROdW1iZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFnaWNDb2RlSW5wdXRDYXJkLnJlbmRlcigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWFnaWNDb2RlSW5wdXRDYXJkLm9uRXhlY3V0ZUFjdGlvbiA9IChzdWJtaXRNYWdpY0NvZGVBY3Rpb246IEFkYXB0aXZlLkFjdGlvbikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNhcmQgJiYgc3VibWl0TWFnaWNDb2RlQWN0aW9uIGluc3RhbmNlb2YgQWRhcHRpdmUuU3VibWl0QWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoc3VibWl0TWFnaWNDb2RlQWN0aW9uLmlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwic3VibWl0TWFnaWNDb2RlXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG1hZ2ljQ29kZTogc3RyaW5nIHwgdW5kZWZpbmVkID0gdW5kZWZpbmVkO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3VibWl0TWFnaWNDb2RlQWN0aW9uLmRhdGEgJiYgdHlwZW9mICg8YW55PnN1Ym1pdE1hZ2ljQ29kZUFjdGlvbi5kYXRhKVtcIm1hZ2ljQ29kZVwiXSA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYWdpY0NvZGUgPSAoPGFueT5zdWJtaXRNYWdpY0NvZGVBY3Rpb24uZGF0YSlbXCJtYWdpY0NvZGVcIl07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobWFnaWNDb2RlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzcGxheUNhcmQodGhpcy5jYXJkKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuYWN0aXZpdHkudmFsdWUubWFnaWNDb2RlID0gbWFnaWNDb2RlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LmF0dGVtcHROdW1iZXIrKztcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW50ZXJuYWxTZW5kQWN0aXZpdHlSZXF1ZXN0QXN5bmMocmVxdWVzdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGVydChcIlBsZWFzZSBlbnRlciB0aGUgbWFnaWMgY29kZSB5b3UgcmVjZWl2ZWQuXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiY2FuY2VsXCI6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKFwiQXV0aGVudGljYXRpb24gY2FuY2VsbGVkIGJ5IHVzZXIuXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc3BsYXlDYXJkKHRoaXMuY2FyZCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiVW5lc3BlY3RlZCBhY3Rpb24gdGFrZW4gZnJvbSBtYWdpYyBjb2RlIGlucHV0IGNhcmQgKGlkID0gXCIgKyBzdWJtaXRNYWdpY0NvZGVBY3Rpb24uaWQgKyBcIilcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KFwiU29tZXRoaW5nIHdlbnQgd3JvbmcuIFRoaXMgYWN0aW9uIGNhbid0IGJlIGhhbmRsZWQuXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc3BsYXlDYXJkKG1hZ2ljQ29kZUlucHV0Q2FyZCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGxlZnQgPSB3aW5kb3cuc2NyZWVuWCArICh3aW5kb3cub3V0ZXJXaWR0aCAtIEFkYXB0aXZlQXBwbGV0LmF1dGhQcm9tcHRXaWR0aCkgLyAyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHRvcCA9IHdpbmRvdy5zY3JlZW5ZICsgKHdpbmRvdy5vdXRlckhlaWdodCAtIEFkYXB0aXZlQXBwbGV0LmF1dGhQcm9tcHRIZWlnaHQpIC8gMjtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cub3Blbihsb2dpblVybC50b1N0cmluZygpLCBcIkxvZ2luXCIsIGB3aWR0aD0ke0FkYXB0aXZlQXBwbGV0LmF1dGhQcm9tcHRXaWR0aH0saGVpZ2h0PSR7QWRhcHRpdmVBcHBsZXQuYXV0aFByb21wdEhlaWdodH0sbGVmdD0ke2xlZnR9LHRvcD0ke3RvcH1gKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJBdXRoZW50aWNhdGlvbiBmYWlsZWQuIEdpdmluZyB1cCBhZnRlciBcIiArIChyZXF1ZXN0LmF0dGVtcHROdW1iZXIgKyAxKSArIFwiIGF0dGVtcHQocylcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoXCJBdXRoZW50aWNhdGlvbiBmYWlsZWQuXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJpbnRlcm5hbFNlbmRBY3Rpdml0eVJlcXVlc3RBc3luYzogQWN0aW9uLkV4ZWN1dGUgcmVzdWx0IGlzIG9mIHVuc3VwcG9ydGVkIHR5cGUgKFwiICsgdHlwZW9mIHBhcnNlZFJlc3VsdCArIFwiKVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImludGVybmFsU2VuZEFjdGl2aXR5UmVxdWVzdEFzeW5jOiBBY3Rpb24uRXhlY3V0ZSByZXN1bHQgaXMgb2YgdW5zdXBwb3J0ZWQgdHlwZSAoXCIgKyB0eXBlb2YgcGFyc2VkUmVzdWx0ICsgXCIpXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkb25lID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgQWN0aXZpdHlTdGF0dXMuRmFpbHVyZTpcclxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgcmV0cnlJbjogbnVtYmVyID0gdGhpcy5vbkFjdGl2aXR5UmVxdWVzdENvbXBsZXRlZCA/IHRoaXMub25BY3Rpdml0eVJlcXVlc3RDb21wbGV0ZWQodGhpcywgcmVzcG9uc2UpIDogQWRhcHRpdmVBcHBsZXQuZGVmYXVsdFRpbWVCZXR3ZWVuQXR0ZW1wdHM7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmV0cnlJbiA+PSAwICYmIChyZXF1ZXN0LmF0dGVtcHROdW1iZXIgKyAxKSA8IEFkYXB0aXZlQXBwbGV0Lm1heGltdW1SZXF1ZXN0QXR0ZW1wdHMpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihcIkFjdGl2aXR5IHJlcXVlc3QgZmFpbGVkLiBSZXRyeWluZyBpbiBcIiArIHJldHJ5SW4gKyBcIm1zXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuYXR0ZW1wdE51bWJlcisrO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQoXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoKSA9PiB7IHJlc29sdmUoKTsgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHJ5SW5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkFjdGl2aXR5IHJlcXVlc3QgZmFpbGVkLiBHaXZpbmcgdXAgYWZ0ZXIgXCIgKyAocmVxdWVzdC5hdHRlbXB0TnVtYmVyICsgMSkgKyBcIiBhdHRlbXB0KHMpXCIpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZWRFbGVtZW50LnJlbW92ZUNoaWxkKG92ZXJsYXkpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvbmUgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KHJlc3BvbnNlLmNvbnRlbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGNyZWF0ZVByb2dyZXNzT3ZlcmxheShjb250ZXh0OiBBY3Rpdml0eUludm9jYXRpb25Db250ZXh0KTogSFRNTEVsZW1lbnQge1xyXG4gICAgICAgIGxldCBvdmVybGF5OiBIVE1MRWxlbWVudCB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZDtcclxuXHJcbiAgICAgICAgaWYgKHRoaXMub25DcmVhdGVQcm9ncmVzc092ZXJsYXkpIHtcclxuICAgICAgICAgICAgb3ZlcmxheSA9IHRoaXMub25DcmVhdGVQcm9ncmVzc092ZXJsYXkodGhpcywgY29udGV4dCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIW92ZXJsYXkpIHtcclxuICAgICAgICAgICAgb3ZlcmxheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgICAgIG92ZXJsYXkuY2xhc3NOYW1lID0gXCJhYWYtcHJvZ3Jlc3Mtb3ZlcmxheVwiO1xyXG5cclxuICAgICAgICAgICAgbGV0IHNwaW5uZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xyXG4gICAgICAgICAgICBzcGlubmVyLmNsYXNzTmFtZSA9IFwiYWFmLXNwaW5uZXJcIjtcclxuICAgICAgICAgICAgc3Bpbm5lci5zdHlsZS53aWR0aCA9IFwiMjhweFwiO1xyXG4gICAgICAgICAgICBzcGlubmVyLnN0eWxlLmhlaWdodCA9IFwiMjhweFwiO1xyXG5cclxuICAgICAgICAgICAgb3ZlcmxheS5hcHBlbmRDaGlsZChzcGlubmVyKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBvdmVybGF5O1xyXG4gICAgfVxyXG5cclxuICAgIHJlYWRvbmx5IHJlbmRlcmVkRWxlbWVudDogSFRNTEVsZW1lbnQ7XHJcblxyXG4gICAgdXNlcklkPzogc3RyaW5nO1xyXG4gICAgY2hhbm5lbEFkYXB0ZXI6IENoYW5uZWxBZGFwdGVyIHwgdW5kZWZpbmVkID0gdW5kZWZpbmVkO1xyXG5cclxuICAgIG9uQ2FyZENoYW5naW5nPzogKHNlbmRlcjogQWRhcHRpdmVBcHBsZXQsIGNhcmQ6IGFueSkgPT4gYm9vbGVhbjtcclxuICAgIG9uQ2FyZENoYW5nZWQ/OiAoc2VuZGVyOiBBZGFwdGl2ZUFwcGxldCkgPT4gdm9pZDtcclxuICAgIG9uUHJlcGFyZUFjdGl2aXR5UmVxdWVzdD86IChzZW5kZXI6IEFkYXB0aXZlQXBwbGV0LCBhY3Rpb246IEV4ZWN1dGVBY3Rpb24sIHJlcXVlc3Q6IEFjdGl2aXR5UmVxdWVzdCkgPT4gYm9vbGVhbjtcclxuICAgIG9uQWN0aXZpdHlSZXF1ZXN0Q29tcGxldGVkPzogKHNlbmRlcjogQWRhcHRpdmVBcHBsZXQsIHJlc3BvbnNlOiBBY3Rpdml0eVJlc3BvbnNlKSA9PiBudW1iZXI7XHJcbiAgICBvbkNyZWF0ZVByb2dyZXNzT3ZlcmxheT86IChzZW5kZXI6IEFkYXB0aXZlQXBwbGV0LCBhY3Rpb25FeGVjdXRpb25Db250ZXh0OiBBY3Rpdml0eUludm9jYXRpb25Db250ZXh0KSA9PiBIVE1MRWxlbWVudCB8IHVuZGVmaW5lZDtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICB0aGlzLnJlbmRlcmVkRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XHJcbiAgICAgICAgdGhpcy5yZW5kZXJlZEVsZW1lbnQuc3R5bGUucG9zaXRpb24gPSBcInJlbGF0aXZlXCI7XHJcbiAgICB9XHJcblxyXG4gICAgc2V0Q2FyZChwYXlsb2FkOiBhbnkpIHtcclxuICAgICAgICBpZiAodHlwZW9mIHBheWxvYWQgPT09IFwib2JqZWN0XCIpIHtcclxuICAgICAgICAgICAgaWYgKHBheWxvYWRbXCJ0eXBlXCJdID09PSBcIkFkYXB0aXZlQ2FyZFwiKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocGF5bG9hZFtcIiRkYXRhXCJdICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jYXJkRGF0YSA9IHBheWxvYWRbXCIkZGF0YVwiXTtcclxuICAgICAgICAgICAgICAgICAgICBkZWxldGUgcGF5bG9hZFtcIiRkYXRhXCJdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHRoaXMuX2NhcmRQYXlsb2FkID0gcGF5bG9hZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2NhcmREYXRhID0gcGF5bG9hZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHRoaXMuX2NhcmRQYXlsb2FkKSB7XHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgY2FyZCA9IG5ldyBBZGFwdGl2ZUFwcGxldENhcmQoKTtcclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgc2VyaWFsaXphdGlvbkNvbnRleHQgPSBuZXcgQWRhcHRpdmUuU2VyaWFsaXphdGlvbkNvbnRleHQoKTtcclxuICAgICAgICAgICAgICAgIHNlcmlhbGl6YXRpb25Db250ZXh0LnNldEVsZW1lbnRSZWdpc3RyeShBZGFwdGl2ZUFwcGxldC5fZWxlbWVudHNSZWdpc3RyeSk7XHJcbiAgICAgICAgICAgICAgICBzZXJpYWxpemF0aW9uQ29udGV4dC5zZXRBY3Rpb25SZWdpc3RyeShBZGFwdGl2ZUFwcGxldC5fYWN0aW9uc1JlZ2lzdHJ5KTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fY2FyZERhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgZXZhbHVhdGlvbkNvbnRleHQgPSBuZXcgVGVtcGxhdGluZy5FdmFsdWF0aW9uQ29udGV4dCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGV2YWx1YXRpb25Db250ZXh0LiRyb290ID0gdGhpcy5fY2FyZERhdGE7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGxldCB0ZW1wbGF0ZSA9IG5ldyBUZW1wbGF0aW5nLlRlbXBsYXRlKHRoaXMuX2NhcmRQYXlsb2FkKVxyXG4gICAgICAgICAgICAgICAgICAgIGxldCBleHBhbmRlZENhcmRQYXlsb2FkID0gdGVtcGxhdGUuZXhwYW5kKGV2YWx1YXRpb25Db250ZXh0KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgY2FyZC5wYXJzZShleHBhbmRlZENhcmRQYXlsb2FkLCBzZXJpYWxpemF0aW9uQ29udGV4dCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXJkLnBhcnNlKHRoaXMuX2NhcmRQYXlsb2FkLCBzZXJpYWxpemF0aW9uQ29udGV4dCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKCFjYXJkLmFwcElkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBjYXJkIHBheWxvYWQuIFRoZSBhcHBJZCBwcm9wZXJ0eSBpcyBtaXNzaW5nLlwiKVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGxldCBkb0NoYW5nZUNhcmQgPSB0aGlzLm9uQ2FyZENoYW5naW5nID8gdGhpcy5vbkNhcmRDaGFuZ2luZyh0aGlzLCB0aGlzLl9jYXJkUGF5bG9hZCkgOiB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmIChkb0NoYW5nZUNhcmQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jYXJkID0gY2FyZDtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jYXJkLm9uRXhlY3V0ZUFjdGlvbiA9IChhY3Rpb246IEFkYXB0aXZlLkFjdGlvbikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmludGVybmFsRXhlY3V0ZUFjdGlvbihhY3Rpb24sIEFjdGl2aXR5SW52b2NhdGlvbkNvbnRleHQuVXNlckludGVyYWN0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2NhcmQucmVuZGVyKCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl9jYXJkLnJlbmRlcmVkRWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc3BsYXlDYXJkKHRoaXMuX2NhcmQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub25DYXJkQ2hhbmdlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkNhcmRDaGFuZ2VkKHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fY2FyZC5hdXRvUmVmcmVzaCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnRlcm5hbEV4ZWN1dGVBY3Rpb24odGhpcy5fY2FyZC5hdXRvUmVmcmVzaC5hY3Rpb24sIEFjdGl2aXR5SW52b2NhdGlvbkNvbnRleHQuQXV0b1JlZnJlc2gpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgLy8gSWdub3JlIGFsbCBlcnJvcnNcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJzZXRDYXJkOiBcIiArIGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBnZXQgY2FyZCgpOiBBZGFwdGl2ZUFwcGxldENhcmQgfCB1bmRlZmluZWQge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9jYXJkO1xyXG4gICAgfVxyXG59XHJcblxyXG5BZGFwdGl2ZUFwcGxldC5pbml0aWFsaXplKCk7IiwiaW1wb3J0IHsgQ2hhbm5lbEFkYXB0ZXIgfSBmcm9tIFwiLi9jaGFubmVsLWFkYXB0ZXJcIjtcclxuaW1wb3J0IHsgQWN0aXZpdHlSZXF1ZXN0LCBBY3Rpdml0eVJlc3BvbnNlLCBBY3Rpdml0eVN0YXR1cyB9IGZyb20gXCIuL2ludm9rZS1hY3Rpdml0eVwiO1xyXG5cclxuXHJcbmV4cG9ydCBjbGFzcyBIdHRwQ2hhbm5lbEFkYXB0ZXIgZXh0ZW5kcyBDaGFubmVsQWRhcHRlciB7XHJcbiAgICBjb25zdHJ1Y3RvcihyZWFkb25seSB1cmw6IHN0cmluZykge1xyXG4gICAgICAgIHN1cGVyKCk7XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgc2VuZFJlcXVlc3RBc3luYyhyZXF1ZXN0OiBBY3Rpdml0eVJlcXVlc3QpOiBQcm9taXNlPEFjdGl2aXR5UmVzcG9uc2U+IHtcclxuICAgICAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcclxuICAgICAgICAgICAgdGhpcy51cmwsXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCJcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShyZXF1ZXN0LmFjdGl2aXR5KVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgKVxyXG5cclxuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIHJlcXVlc3Q6IHJlcXVlc3QsXHJcbiAgICAgICAgICAgICAgICBzdGF0dXM6IEFjdGl2aXR5U3RhdHVzLlN1Y2Nlc3MsXHJcbiAgICAgICAgICAgICAgICBjb250ZW50OiBhd2FpdCByZXNwb25zZS50ZXh0KClcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0OiByZXF1ZXN0LFxyXG4gICAgICAgICAgICAgICAgc3RhdHVzOiBBY3Rpdml0eVN0YXR1cy5GYWlsdXJlLFxyXG4gICAgICAgICAgICAgICAgY29udGVudDogcmVzcG9uc2Uuc3RhdHVzVGV4dFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKlxyXG4gICAgICAgIHN3aXRjaCAocmVxdWVzdC5hY3Rpdml0eS52YWx1ZS5hY3Rpb24udmVyYikge1xyXG4gICAgICAgICAgICBjYXNlIFwic3VjY2VlZFJldHVybkNhcmRcIjpcclxuICAgICAgICAgICAgY2FzZSBcImFjdGlvbldpdGhBdXRoXCI6XHJcbiAgICAgICAgICAgICAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVybCxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHJlcXVlc3QuYWN0aXZpdHkpXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgKVxyXG5cclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3Q6IHJlcXVlc3QsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogQWN0aXZpdHlTdGF0dXMuU3VjY2VzcyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogYXdhaXQgcmVzcG9uc2UudGV4dCgpXHJcbiAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3Q6IHJlcXVlc3QsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogQWN0aXZpdHlTdGF0dXMuRmFpbHVyZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudDogcmVzcG9uc2Uuc3RhdHVzVGV4dFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2FzZSBcInN1Y2NlZWRSZXR1cm5TdHJpbmdcIjpcclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdDogcmVxdWVzdCxcclxuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IEFjdGl2aXR5U3RhdHVzLlN1Y2Nlc3MsXHJcbiAgICAgICAgICAgICAgICAgICAgY29udGVudDogXCJJdCB3b3JrZWQhXCJcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIGNhc2UgXCJmYWlsXCI6XHJcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlcXVlc3Q6IHJlcXVlc3QsXHJcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBBY3Rpdml0eVN0YXR1cy5GYWlsdXJlLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IFwiSXQgZmFpbGVkIG1pc2VyYWJseS4uLlwiXHJcbiAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBjYXNlIFwiZXhjZXB0aW9uXCI6XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJdCBkaWRuJ3Qgd29yayFcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgICovXHJcbiAgICB9XHJcbn1cclxuIiwiZXhwb3J0IGludGVyZmFjZSBJbnZva2VBY3Rpdml0eSB7XHJcbiAgICB0eXBlOiBcImludm9rZVwiLFxyXG4gICAgbmFtZTogXCJhZGFwdGl2ZUNhcmQvYWN0aW9uXCIsXHJcbiAgICBhcHBJZDogc3RyaW5nLFxyXG4gICAgY2hhbm5lbElkPzogc3RyaW5nLFxyXG4gICAgbG9jYWxUaW1lem9uZTogc3RyaW5nLFxyXG4gICAgbG9jYWxUaW1lc3RhbXA6IHN0cmluZyxcclxuICAgIGZyb20/OiB7XHJcbiAgICAgICAgaWQ6IHN0cmluZ1xyXG4gICAgfSxcclxuICAgIGNvbnZlcnNhdGlvbj86IHtcclxuICAgICAgICBpZDogc3RyaW5nXHJcbiAgICB9LFxyXG4gICAgcmVwbHlUb0lkPzogc3RyaW5nLCAvLyBSZW1vdmU/XHJcbiAgICBlbnRpdGllcz86IG9iamVjdFtdLFxyXG4gICAgY2hhbm5lbERhdGE/OiBvYmplY3QsXHJcbiAgICBzZXJ2aWNlVXJsPzogc3RyaW5nLCAvLyBSZW1vdmU/XHJcbiAgICB2YWx1ZToge1xyXG4gICAgICAgIGFjdGlvbjoge1xyXG4gICAgICAgICAgICB0eXBlOiBcIkFjdGlvbi5FeGVjdXRlXCIsXHJcbiAgICAgICAgICAgIGlkPzogc3RyaW5nLFxyXG4gICAgICAgICAgICB2ZXJiOiBzdHJpbmcsXHJcbiAgICAgICAgICAgIGRhdGE/OiBvYmplY3RcclxuICAgICAgICB9LFxyXG4gICAgICAgIG1hZ2ljQ29kZT86IHN0cmluZ1xyXG4gICAgfSxcclxuICAgIHJlbGF0ZXNUbz86IHN0cmluZ1xyXG59XHJcblxyXG5leHBvcnQgZW51bSBBY3Rpdml0eUludm9jYXRpb25Db250ZXh0IHtcclxuICAgIEF1dG9SZWZyZXNoLFxyXG4gICAgVXNlckludGVyYWN0aW9uXHJcbn1cclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgQWN0aXZpdHlSZXF1ZXN0IHtcclxuICAgIHJlYWRvbmx5IGFjdGl2aXR5OiBJbnZva2VBY3Rpdml0eSxcclxuICAgIHJlYWRvbmx5IGNvbnRleHQ6IEFjdGl2aXR5SW52b2NhdGlvbkNvbnRleHQsXHJcbiAgICBhdHRlbXB0TnVtYmVyOiBudW1iZXJcclxufVxyXG5cclxuZXhwb3J0IGVudW0gQWN0aXZpdHlTdGF0dXMge1xyXG4gICAgU3VjY2VzcyxcclxuICAgIEZhaWx1cmVcclxufVxyXG5cclxuZXhwb3J0IGludGVyZmFjZSBBY3Rpdml0eVJlc3BvbnNlIHtcclxuICAgIHJlYWRvbmx5IHJlcXVlc3Q6IEFjdGl2aXR5UmVxdWVzdCxcclxuICAgIHJlYWRvbmx5IHN0YXR1czogQWN0aXZpdHlTdGF0dXMsXHJcbiAgICByZWFkb25seSBjb250ZW50OiBzdHJpbmdcclxufVxyXG4iXSwic291cmNlUm9vdCI6IiJ9